import{g as i,t as s,i as c,d as t,a as g,m as Y,e as oe,o as ce,M,f as D,h as Z,j as ge,E as ue,S as de}from"./web.5PWvPun-.js";import{e as G,c as w,B as F,b as A,I as V}from"./utils.CPa6uZZn.js";import{e as me,a as O,o as v,s as u,b as y,n as E,c as he,l as q,u as X,d as ee}from"./index.BmTnCDYh.js";import{c as ne}from"./store.UIwYTWTH.js";/* empty css                                 */import{T as W}from"./Textarea.lGUyJjjl.js";const L=1,j="SAVE",B="PROGRAM",J={registrationId:-1,name:"Demo",email:"demo@mail.com",handynummer:"+41 12 123 12 12",wantsEmailUpdates:!0,games:[],lastSaved:"2024-08-15T07:45:21.335Z"};function Se(){const n=localStorage.getItem(j);let e;return n===null?e={version:L,data:J}:e=JSON.parse(n),e.version!==L&&(console.error("Your local storage data was outdated and has been replaced with new demo content."),e={version:L,data:J}),localStorage.setItem(j,JSON.stringify(e)),e.data}const z={gameList:[],reservedList:[]};function $e(){const n=localStorage.getItem(B);let e;return n===null?e={version:L,data:z}:e=JSON.parse(n),e.version!==L&&(console.error("Your local storage data was outdated and has been replaced with new demo content."),e={version:L,data:z}),localStorage.setItem(B,JSON.stringify(e)),e.data}const te=me(["SATURDAY","SUNDAY"]);O(v({uuid:u(),description:y(u()),title:y(u()),system:u(),master:v({first:u(),last:y(u())}),playerCount:v({min:E(),max:E()}),slot:v({day:te,start:E(),end:E()})}));const re=v({game:u(),self:q(!0),spielerName:he()}),ae=v({game:u(),self:q(!1),spielerName:u()}),pe=X([re.extend({id:E()}),ae.extend({id:E()})]),fe=X([re,ae]),_e=v({registrationId:E(),name:u(),email:u(),handynummer:u(),wantsEmailUpdates:ee(),games:O(pe),lastSaved:u()});v({registrationId:E(),name:u(),email:u(),handynummer:u(),wantsEmailUpdates:ee(),games:O(fe),lastSaved:u()});async function be(n){if(n==="demo")return{kind:"SUCCESS",save:Se()};const e=G("/rst24/load");e.searchParams.append("secret",n);const r=await fetch(e);if(!r.ok)return{kind:"FAILED"};const a=await r.json(),o=_e.safeParse(a);return o.success?{kind:"SUCCESS",save:o.data}:{kind:"FAILED"}}const ve=v({uuid:u(),title:y(u()),system:u(),description:y(u()),playerCount:v({min:E(),max:E()}),master:v({first:u(),last:y(u())}),slot:v({day:te,start:E(),end:E()})}),Ee=v({id:E(),gameId:u()});async function Pe(n){if(n)return{kind:"SUCCESS",program:$e()};const e=G("/rst24/program"),r=G("/rst24/reserved"),[a,o]=await Promise.all([fetch(e),fetch(r)]);if(!a.ok)return{kind:"FAILED"};if(!o.ok)return{kind:"FAILED"};const S=await a.json(),p=await o.json(),b=O(ve).safeParse(S);if(!b.success)return{kind:"FAILED"};const P=O(Ee).safeParse(p);return P.success?{kind:"SUCCESS",program:{gameList:b.data,reservedList:P.data}}:{kind:"FAILED"}}const ke=["CHOOSE","PLAYER","GAMEMASTER","GAMEMASTER_NEW","HELPING","SUMMARY"],K={CHOOSE:"Übersicht",PLAYER:"Spielanmeldung",GAMEMASTER:"Spielleitung",GAMEMASTER_NEW:"Neue Spielrunde",HELPING:"Helfen",SUMMARY:"Zusammenfassung"};function ie(n){const e=n.searchParams.get("page");return ke.find(r=>e?.toUpperCase()===r.toUpperCase())??"CHOOSE"}function Re(){const n=new URL(location.href),e=n.searchParams.get("secret"),r=ie(n),a=n.searchParams.get("showCreateMessage")==="true";return{secret:e,page:r,showCreateMessage:a}}async function le(n){if(n.secret===null)throw Error("SECRET_ERROR");const e=await be(n.secret);if(e.kind==="FAILED")throw Error("SECRET_ERROR");return{state:"IDLE",secret:n.secret,page:n.page,showCreateMessage:n.showCreateMessage,gameRoundEdit:{titel:"",system:"",descriptionShort:"",descriptionLong:"",slot:1,playerCountMin:3,playerCountMax:6,tags:[]},currentSave:e.save,activeTab:"Contact",lastSaved:e.save.lastSaved,hasChanged:!1,tentativeReservations:[],markedForDeletionReservations:[]}}async function we(n=!1){const e=await Pe(n);if(e.kind==="FAILED")throw Error("PROGRAM_ERROR");return e.program}function Ae(n){const[e,r]=ne(n);function a(l){r("activeTab",l),window.scrollTo({top:0})}function o(l){const d=new URL(location.href);d.searchParams.set("page",l.toLowerCase()),d.searchParams.delete("showCreateMessage"),history.replaceState({page:l},"",d);const f=K[l];document.title=`Meine Anmeldung: ${f} | Luzerner Rollenspieltage `}o(n.page);function S(l,d=!1){if(l===e.page)return;if(!d){const m=new URL(location.href);m.searchParams.set("page",l.toLowerCase()),history.pushState({page:l},"",m)}const f=K[l];document.title=`Meine Anmeldung: ${f} | Luzerner Rollenspieltage `,r("page",l),window.scrollTo({top:0})}function p(l,d){r("hasChanged",!0),r("currentSave",l,d)}async function b(){if(e.state!=="IDLE")throw Error("ASSERTION_ERROR");r("state","SAVING");const l=G("/rst24/save"),d={...e.currentSave,games:[...e.currentSave.games.filter(m=>!e.markedForDeletionReservations.includes(m.id)),...e.tentativeReservations.map(m=>m.friendsName===null?{game:m.gameUuid,self:!0,spielerName:null}:{game:m.gameUuid,self:!1,spielerName:m.friendsName})]};if((await fetch(l,{method:"post",body:JSON.stringify(d),headers:{"Content-Type":"application/json"}})).ok){const m=await le({secret:e.secret,page:e.page,showCreateMessage:!1});r({...m,activeTab:e.activeTab})}else throw Error("SAVE_ERROR")}function P(l){r("hasChanged",!0),r("tentativeReservations",d=>[...d,l])}function k(l){if(r("hasChanged",!0),l.confirmed)r("markedForDeletionReservations",d=>[...d,l.reservationId]);else{const d=e.currentSave.name;r("tentativeReservations",f=>f.filter(m=>m.gameUuid!==l.gameUuid?!0:m.friendsName===l.name?!1:l.name!==d))}}return{state:e,actions:{changeTab:a,changePage:S,updateSave:p,saveCurrentState:b,addTentativeReservation:P,deleteReservation:k}}}var Q=s("<br>"),Ce=s("<strong>Donnerstag, 21. August 2025");const Me=function(){const e="Donnerstag, 21. August 2025",r=["Deine Anmeldung wurde erfolgreich gestartet.",i(Q),i(Q),"Wir haben eine E-Mail an deine Adresse gesendet. In dieser E-Mail findest du einen persönlichen Link, um deine Anmeldung bis am"," ",i(Ce)," anzupassen."];return{registrationDeadline:e,registrationStarted:r}}();var xe=s("<div class=grid><!$><!/><div>"),ye=s("<div class=boxLink>");function I(n){const e=n.type??"special";return(()=>{var r=i(ye);return c(r,t(F,{type:e,get onClick(){return n.onClick},get children(){var a=i(xe),o=a.firstChild,[S,p]=g(o.nextSibling),b=S.nextSibling;return c(a,t(w,{get icon(){return n.icon}}),S,p),c(b,()=>n.children),a}})),r})()}var Le=s("<div class=tooltip-wrapper><div class=tooltip></div><!$><!/>");function U(n){return(()=>{var e=i(Le),r=e.firstChild,a=r.nextSibling,[o,S]=g(a.nextSibling);return c(r,()=>n.tooltip),c(e,()=>n.children,o,S),e})()}var Te=s("<div class=quickmenu-wrapper><div class=quickmenu><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),Ne=s('<div class="quickmenu extended"><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>'),Ue=s("<div class=grid><!$><!/><span>Zur Übersicht"),Ie=s("<div class=grid><!$><!/><span>Zu den Spielrunden"),Oe=s("<div class=grid><!$><!/><span>Zu deinen Spielrunden"),De=s("<div class=grid><!$><!/><span>Zum Helferplan"),Ge=s("<div class=grid><!$><!/><span>Zur Zusammenfassung");function Fe(n){return(()=>{var e=i(Te),r=e.firstChild,a=r.firstChild,[o,S]=g(a.nextSibling),p=o.nextSibling,[b,P]=g(p.nextSibling),k=b.nextSibling,[l,d]=g(k.nextSibling),f=l.nextSibling,[m,C]=g(f.nextSibling),x=m.nextSibling,[N,h]=g(x.nextSibling);return c(r,t(U,{tooltip:"Zur Übersicht",get children(){return t(A,{get label(){return t(w,{icon:"backward"})},onClick:()=>n.changePage("CHOOSE")})}}),o,S),c(r,t(U,{tooltip:"Zu den Spielrunden",get children(){return t(A,{get label(){return t(w,{icon:"dice-d20"})},onClick:()=>n.changePage("PLAYER")})}}),b,P),c(r,t(U,{tooltip:"Zu deinen Spielrunden",get children(){return t(A,{get label(){return t(w,{icon:"grid-2-plus"})},onClick:()=>n.changePage("GAMEMASTER")})}}),l,d),c(r,t(U,{tooltip:"Zum Helferplan",get children(){return t(A,{get label(){return t(w,{icon:"hand-heart"})},onClick:()=>n.changePage("HELPING")})}}),m,C),c(r,t(U,{tooltip:"Zur Zusammenfassung",get children(){return t(A,{get label(){return t(w,{icon:"list"})},onClick:()=>n.changePage("SUMMARY")})}}),N,h),e})()}function He(n){return(()=>{var e=i(Ne),r=e.firstChild,[a,o]=g(r.nextSibling),S=a.nextSibling,[p,b]=g(S.nextSibling),P=p.nextSibling,[k,l]=g(P.nextSibling),d=k.nextSibling,[f,m]=g(d.nextSibling),C=f.nextSibling,[x,N]=g(C.nextSibling);return c(e,t(A,{get label(){return(()=>{var h=i(Ue),R=h.firstChild,[_,$]=g(R.nextSibling);return _.nextSibling,c(h,t(w,{icon:"backward"}),_,$),h})()},onClick:()=>n.changePage("CHOOSE")}),a,o),c(e,t(A,{get label(){return(()=>{var h=i(Ie),R=h.firstChild,[_,$]=g(R.nextSibling);return _.nextSibling,c(h,t(w,{icon:"dice-d20"}),_,$),h})()},onClick:()=>n.changePage("PLAYER")}),p,b),c(e,t(A,{get label(){return(()=>{var h=i(Oe),R=h.firstChild,[_,$]=g(R.nextSibling);return _.nextSibling,c(h,t(w,{icon:"grid-2-plus"}),_,$),h})()},onClick:()=>n.changePage("GAMEMASTER")}),k,l),c(e,t(A,{get label(){return(()=>{var h=i(De),R=h.firstChild,[_,$]=g(R.nextSibling);return _.nextSibling,c(h,t(w,{icon:"hand-heart"}),_,$),h})()},onClick:()=>n.changePage("HELPING")}),f,m),c(e,t(A,{get label(){return(()=>{var h=i(Ge),R=h.firstChild,[_,$]=g(R.nextSibling);return _.nextSibling,c(h,t(w,{icon:"list"}),_,$),h})()},onClick:()=>n.changePage("SUMMARY")}),x,N),e})()}var Ye=s("<div class=page><!$><!/><div><h2></h2><br><!$><!/></div><!$><!/>");function T(n){return(()=>{var e=i(Ye),r=e.firstChild,[a,o]=g(r.nextSibling),S=a.nextSibling,p=S.firstChild,b=p.nextSibling,P=b.nextSibling,[k,l]=g(P.nextSibling),d=S.nextSibling,[f,m]=g(d.nextSibling);return c(e,(()=>{var C=Y(()=>n.showQuickmenu!==!1);return()=>C()?t(Fe,{get changePage(){return n.changePage}}):null})(),a,o),c(p,()=>n.title),c(S,()=>n.children,k,l),c(e,(()=>{var C=Y(()=>n.showQuickmenu!==!1);return()=>C()?t(He,{get changePage(){return n.changePage}}):null})(),f,m),e})()}var Ze=s("<h3>Spielrunden ansehen"),Ve=s("<p>Melde dich (und deine Freunde) für diverse Spielrunden an."),H=s("<br>"),We=s("<h3>Spielrunden erstellen"),je=s("<p>Falls du wenig oder gar keine Erfahrung als Spielleiter:in hast, werden wir dich vor und während dem Anlass unterstützen."),Be=s("<h3>Helfen"),Je=s("<p>Beim Kiosk und der Essensausgabe können wir immer ein paar helfende Hände gebrauchen."),ze=s("<h3>Zusammenfassung"),Ke=s("<p>Erhalte einen Überblick über dein gesamtes Programm.");function Qe(n){return t(T,{title:"Wo möchtest du starten?",showQuickmenu:!1,get changePage(){return n.changePage},get children(){return[t(I,{icon:"dice-d20",onClick:()=>n.changePage("PLAYER"),get children(){return[i(Ze),i(Ve)]}}),i(H),t(I,{icon:"grid-2-plus",onClick:()=>n.changePage("GAMEMASTER"),get children(){return[i(We),i(je)]}}),i(H),t(I,{icon:"hand-heart",onClick:()=>n.changePage("HELPING"),get children(){return[i(Be),i(Je)]}}),i(H),t(I,{icon:"list",onClick:()=>n.changePage("SUMMARY"),get children(){return[i(ze),i(Ke)]}})]}})}var qe=s("<h3>Neue Spielrunde erstellen"),Xe=s("<form novalidate><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>");function en(n){return t(T,{title:"Meine Spielrunden",get changePage(){return n.changePage},get children(){return t(I,{icon:"grid-2-plus",type:"success",onClick:()=>n.changePage("GAMEMASTER_NEW"),get children(){return i(qe)}})}})}function nn(n){const[e,r]=ne(n.store);function a(o){o.preventDefault(),console.log(e)}return t(T,{title:"Neue Spielrunde erfassen",get changePage(){return n.changePage},get children(){var o=i(Xe),S=o.firstChild,[p,b]=g(S.nextSibling),P=p.nextSibling,[k,l]=g(P.nextSibling),d=k.nextSibling,[f,m]=g(d.nextSibling),C=f.nextSibling,[x,N]=g(C.nextSibling),h=x.nextSibling,[R,_]=g(h.nextSibling);return o.addEventListener("submit",a),c(o,t(V,{label:"Titel",name:"title",get value(){return e.titel},onValueUpdate:$=>r("titel",$)}),p,b),c(o,t(V,{label:"System",name:"System",get value(){return e.system},onValueUpdate:$=>r("system",$)}),k,l),c(o,t(W,{label:"Beschreibung (kurz)",name:"descriptionShort",get value(){return e.descriptionShort},onValueUpdate:$=>r("descriptionShort",$)}),f,m),c(o,t(W,{label:"Beschreibung (lang, optional)",name:"descriptionLong",get value(){return e.descriptionLong},onValueUpdate:$=>r("descriptionLong",$)}),x,N),c(o,t(A,{type:"submit",kind:"success",label:"Spielrunde erstellen"}),R,_),o}})}var tn=s("<pre><code>Noch nicht implementiert");function rn(n){return t(T,{title:"Helfen",get changePage(){return n.changePage},get children(){return i(tn)}})}var an=s("<pre><code>Noch nicht implementiert");function ln(n){return t(T,{title:"Spielrundenübersicht",get changePage(){return n.changePage},get children(){return i(an)}})}var sn=s("<pre><code>Noch nicht implementiert");function on(n){return t(T,{title:"Zusammenfassung",get changePage(){return n.changePage},get children(){return i(sn)}})}var cn=s("<p>Deine Anmeldung wird geladen..."),gn=s("<p>Wir konnten leider keine Anmeldung finden. Wenn du bereits eine Anmeldung begonnen hast, solltest du den korrekten Link per E-Mail erhalten haben.<br><br> Falls du noch keine Anmeldung begonnen hast, kannst du <a href=/anmeldung>hier</a> deine persönliche Anmeldung beginnen. <br><br>Für generelle Fragen oder Probleme, schreibe uns doch bitte über unser <a href=/kontatk>Kontaktformular</a>."),un=s("<p>Leider ist ein unerwarteter Fehler passiert. Versuche deine Anmeldung erneut zu laden. Wiederholt sich dieser Fehler, bitte kontaktiere uns sobald als möglich über das <a href=/kontakt>Kontaktformular</a>, da dies nicht passieren sollte."),dn=s("<br>"),mn=s("<pre>");function se(){return t(F,{get children(){return i(cn)}})}function En(){const[n,e]=oe(null);return ce(()=>{e(Re())}),t(D,{get fallback(){return t(se,{})},get children(){return t(M,{get when(){return n()},children:r=>t(hn,{get params(){return r()}})})}})}function hn(n){const[e]=Z(()=>le(n.params)),[r]=Z(()=>we(n.params.secret==="demo"));return t(ue,{fallback:a=>t(F,{type:"danger",get children(){return t(D,{get fallback(){return i(un)},get children(){return t(M,{get when(){return a.message==="SECRET_ERROR"},get children(){return i(gn)}})}})}}),get children(){return t(ge,{get fallback(){return t(se,{})},get children(){return t(D,{get children(){return t(M,{get when(){return e()},children:a=>t(Sn,{get state(){return a()},programResource:r})})}})}})}})}function Sn(n){const{state:e,actions:r}=Ae(n.state);return window.addEventListener("popstate",a=>{if(typeof a=="object"&&a!==null&&"state"in a){const o=new URL(location.href),S=ie(o);r.changePage(S,!0)}}),[t(de,{get when(){return e.showCreateMessage},get children(){return[t(F,{type:"success",get children(){return Me.registrationStarted}}),i(dn)]}}),t(D,{get fallback(){return t(Qe,{get changePage(){return r.changePage}})},get children(){return[t(M,{get when(){return e.page==="PLAYER"},get children(){return t(ln,{get changePage(){return r.changePage}})}}),t(M,{get when(){return e.page==="GAMEMASTER"},get children(){return t(en,{get changePage(){return r.changePage}})}}),t(M,{get when(){return e.page==="GAMEMASTER_NEW"},get children(){return t(nn,{get store(){return e.gameRoundEdit},get changePage(){return r.changePage}})}}),t(M,{get when(){return e.page==="HELPING"},get children(){return t(rn,{get changePage(){return r.changePage}})}}),t(M,{get when(){return e.page==="SUMMARY"},get children(){return t(on,{get changePage(){return r.changePage}})}})]}}),(()=>{var a=i(mn);return c(a,()=>JSON.stringify(e,null,2)),a})()]}export{En as MeineAnmeldungWrapper};
