import{c as lt,I as wn,B as C,d as Rn,f as re,g as vt,h as B,b as Z,s as An,i as Xt,S as Nt,j as yt,k as Tn,e as Fe,l as Dn,m as en,n as Un,u as On}from"./utils.D4lVKdag.js";import{b as tn,g as d,t as g,a as c,u as Pn,i as s,c as r,S as E,d as ge,e as De,F as z,M as R,f as $e,s as kt,h as at,j as st,k as ot,m as O,r as dt,l as Tt,n as Ke,o as ut,p as it,q as nn,E as Nn}from"./web.BCh8zNxO.js";/* empty css                                 */import{c as T,u as We}from"./store.BK-5lGMP.js";import{T as Mn}from"./Textarea.BaP5nL_S.js";import{s as f,n as Q,e as ct,T as x,o as v,a as ie,C as Dt,d as rn,b as Be,l as U,c as Le,u as Ut,f as In}from"./texts.CWjYF-lE.js";var Ln=g("<dialog><!$><!/><!$><!/><!$><!/>"),Fn=g("<h4>");function Ae(e=!1){return{open:e}}function Ue(e){let t;const[n,i]=T(e.store);tn(()=>{n.open?t.showModal():t.close()});function l(){i({open:!1}),e.onClose?.()}const a=()=>{const o=[];return e.type!==void 0&&o.push(e.type),e.size!==void 0&&o.push(e.size),e.onClose!==void 0&&o.push("dialog-with-close"),o};return(()=>{var o=d(Ln),u=o.firstChild,[m,h]=c(u.nextSibling),$=m.nextSibling,[S,_]=c($.nextSibling),b=S.nextSibling,[y,k]=c(b.nextSibling);o.addEventListener("close",l);var p=t;return typeof p=="function"?Pn(p,o):t=o,s(o,r(E,{get when(){return e.onClose},get children(){return r(lt,{onClick:l,icon:"circle-xmark",kind:"gray"})}}),m,h),s(o,r(E,{get when(){return e.title},children:w=>(()=>{var P=d(Fn);return s(P,w),P})()}),S,_),s(o,()=>e.children,y,k),ge(()=>De(o,a().join(" "))),o})()}var Ot=g("<p>");function Ze(e){const[t,n]=T(e.store),i=e.showErrors==="ALWAYS",l=()=>i||t.isDirty?e.errors??[]:[];return[r(wn,{get label(){return e.label},get name(){return e.name},get value(){return t.value},onValueUpdate:a=>n("value",a),onBlur:()=>n("isDirty",!0),get type(){return e.type},get required(){return e.required},get isHoneypot(){return e.isHoneypot},get disabled(){return e.disabled}}),r(E,{get when(){return l().length>0},get children(){return r(C,{type:"danger",get children(){return r(z,{get each(){return l()},children:a=>(()=>{var o=d(Ot);return s(o,a),o})()})}})}})]}function Mt(e){const[t,n]=T(e.store),i=e.showErrors==="ALWAYS",l=()=>i||t.isDirty?e.errors??[]:[];return[r(Rn,{get label(){return e.label},get name(){return e.name},get value(){return t.value},onValueUpdate:a=>n("value",a),onBlur:()=>n("isDirty",!0),get required(){return e.required},get isHoneypot(){return e.isHoneypot},get min(){return e.min},get max(){return e.max},get disabled(){return e.disabled}}),r(E,{get when(){return l().length>0},get children(){return r(C,{type:"danger",get children(){return r(z,{get each(){return l()},children:a=>(()=>{var o=d(Ot);return s(o,a),o})()})}})}})]}function Rt(e){const[t,n]=T(e.store),i=e.showErrors==="ALWAYS",l=()=>i||t.isDirty?e.errors??[]:[];return[r(Mn,{get label(){return e.label},get name(){return e.name},get value(){return t.value},onValueUpdate:a=>n("value",a),onBlur:()=>n("isDirty",!0),get required(){return e.required},get size(){return e.size},get disabled(){return e.disabled}}),r(E,{get when(){return l().length>0},get children(){return r(C,{type:"danger",get children(){return r(z,{get each(){return l()},children:a=>(()=>{var o=d(Ot);return s(o,a),o})()})}})}})]}const tt=f().transform(e=>({value:e,isDirty:!1}));function xt(e){return{value:e,isDirty:!1}}const It=Q().transform(e=>({value:e,isDirty:!1})),Te={SATURDAY:{open:{from:10,to:24},breaks:[{from:13,to:14},{from:18,to:19}]},SUNDAY:{open:{from:10,to:18},breaks:[{from:13,to:14}]}};ct(["SATURDAY","SUNDAY"]);function nt(e,t){const{from:n,to:i}=t;return n<e&&e<i}function Gn(e,t){const{from:n,to:i}=e,{from:l,to:a}=t;return nt(n,t)||nt(i,t)||nt(l,e)||nt(a,e)||n===l&&i===a}function Je(e,t=!1){const{from:n,to:i}=e;if(n>i)return[];const l=i-n;return ln(t?l+1:l,n)}function ln(e,t=0){return[...Array(e)].map((n,i)=>i+t)}var Hn=g("<div class=dynamic-columns style=gap:1rem;--min-width:30rem;><!$><!/><!$><!/>"),Yn=g("<div><h4 style=margin-block-end:1.5rem;></h4><!$><!/>"),Bn=g("<p>Konflikte gefunden! Bitte stelle sicher, dass du nicht zeitlich Ã¼berlappende Spielrunden eingetragen hast:"),zn=g('<div style="display:grid;grid-template-columns:1fr max-content 1fr;gap:1rem;margin-block:0.5rem;"><!$><!/><span style=color:var(--clr-warning-10);align-self:center;font-size:2rem;></span><!$><!/>'),jn=g("<div class=timetable><!$><!/><div class=entries></div><div class=after-hour><div class=annotation>"),Wn=g("<div><div class=annotation></div><div class=background>"),Zn=g("<div class=entry>");function Kn(e){return(()=>{var t=d(Hn),n=t.firstChild,[i,l]=c(n.nextSibling),a=i.nextSibling,[o,u]=c(a.nextSibling);return s(t,r(Lt,{get programEntries(){return e.programEntries.SATURDAY},get openingHours(){return Te.SATURDAY},day:"SATURDAY"}),i,l),s(t,r(Lt,{get programEntries(){return e.programEntries.SUNDAY},get openingHours(){return Te.SUNDAY},day:"SUNDAY"}),o,u),t})()}function Lt(e){const t=Vn(e.programEntries);return(()=>{var n=d(Yn),i=n.firstChild,l=i.nextSibling,[a,o]=c(l.nextSibling);return s(i,()=>x.days[e.day]),s(n,r($e,{get fallback(){return[r(C,{type:"danger",get children(){return d(Bn)}}),r(z,{each:t,children:([u,m])=>(()=>{var h=d(zn),$=h.firstChild,[S,_]=c($.nextSibling),b=S.nextSibling,y=b.nextSibling,[k,p]=c(y.nextSibling);return s(h,()=>u.component(),S,_),s(b,r(re,{icon:"triangle-exclamation"})),s(h,()=>m.component(),k,p),h})()})]},get children(){return r(R,{get when(){return t.length===0},get children(){return r(Jn,{get programEntries(){return e.programEntries},get openingHours(){return e.openingHours},get day(){return e.day}})}})}}),a,o),n})()}function Jn(e){const t=Je(e.openingHours.open),n=e.openingHours.breaks.map(({from:a})=>a),i=(t[0]??0)-1,l=t.at(-1)??0;return(()=>{var a=d(jn),o=a.firstChild,[u,m]=c(o.nextSibling),h=u.nextSibling,$=h.nextSibling,S=$.firstChild;return s(a,r(z,{each:t,children:_=>{const b=n.includes(_);return(()=>{var y=d(Wn),k=y.firstChild;return De(y,`hour ${b?"break":""}`),s(k,_),ge(p=>kt(y,Ft({from:_,to:_},i,e.day),p)),y})()}}),u,m),s(h,r(z,{get each(){return e.programEntries},children:_=>(()=>{var b=d(Zn);return s(b,()=>_.component()),ge(y=>kt(b,Ft(_.range,i,e.day),y)),b})()})),s(S,l+1),ge(_=>kt(h,`grid-row: 1 / ${l-i+1};`,_)),a})()}function Ft(e,t,n){const{from:i,to:l}=e,a=i-t,o=l-t,u=Te[n].open.to;return vt(a>0,`Entry can't start at ${i}.`),vt(o>0,`Entry can't end at ${l}.`),vt(l<=u,`Entry can't end at ${l}.`),`grid-row: ${a} / ${o};`}function Vn(e){const t=[];return e.forEach((n,i)=>{e.slice(i+1).forEach(l=>{Gn(n.range,l.range)&&t.push([n,l])})}),t}var qn=g("<span>");function an(e){const t=()=>{const n=["chip"];return n.push(e.kind??"gray"),e.inverted&&n.push("inverted"),e.size==="small"&&n.push("small"),n.join(" ")};return(()=>{var n=d(qn);return s(n,()=>e.children),ge(i=>{var l=t(),a=e.title;return l!==i.e&&De(n,i.e=l),a!==i.t&&at(n,"title",i.t=a),i},{e:void 0,t:void 0}),n})()}var sn=g("<br>"),Qn=g("<div>"),Xn=g("<div style=display:grid;gap:1rem;><h3>Meine Kontaktdaten</h3><p><strong>Name:</strong> <!$><!/></p><p><strong>E-Mail:</strong> <!$><!/></p><p><strong>Handynummer:</strong> <!$><!/></p><!$><!/>"),er=g("<form novalidate><!$><!/><!$><!/><!$><!/><!$><!/>"),tr=g("<h3>Mein Programm"),nr=g("<div><!$><!/><!$><!/><h5></h5><p class=duration>von <!$><!/> bis <!$><!/> Uhr <em><small>(<!$><!/> <!$><!/>)");function rr(e){const t=e.store.master.games.flatMap(a=>a.slots.map(o=>({status:a.kind,uuid:a.uuid,title:a.title.value,dateTime:o}))),n=()=>{const a=e.program();return a?.kind==="SUCCESS"?a.data:[]},i=()=>{const a=e.store.playing.reservations.map(o=>o.gameRound);return new Set(a)},l=()=>n().filter(a=>i().has(a.uuid)).map(a=>({uuid:a.uuid,title:a.title,dateTime:a.slot}));return[r(ir,{get store(){return e.store.init},get isEditable(){return e.isEditable}}),d(sn),r(ar,{get entries(){return{play:l(),master:t,help:[]}},get changePage(){return e.changePage},get isEditable(){return e.isEditable}})]}function ir(e){const[t,n]=T(e.store),[i,l]=T(Ae());return r(C,{get children(){return[r(E,{get when(){return i.open},get children(){return r(lr,{dialogStore:i,get currentState(){return e.store},updateCurrentState:n})}}),(()=>{var a=d(Xn),o=a.firstChild,u=o.nextSibling,m=u.firstChild,h=m.nextSibling,$=h.nextSibling,[S,_]=c($.nextSibling),b=u.nextSibling,y=b.firstChild,k=y.nextSibling,p=k.nextSibling,[w,P]=c(p.nextSibling),N=b.nextSibling,I=N.firstChild,j=I.nextSibling,L=j.nextSibling,[M,X]=c(L.nextSibling),te=N.nextSibling,[K,F]=c(te.nextSibling);return s(u,()=>e.store.name,S,_),s(b,()=>e.store.email,w,P),s(N,()=>e.store.mobile,M,X),s(a,r(E,{get when(){return e.isEditable},get children(){var ee=d(Qn);return s(ee,r(B,{icon:"pencil",label:"Kontaktdaten editieren",onClick:()=>l("open",!0)})),ee}}),K,F),a})()]}})}function lr(e){const[t]=T({name:xt(e.currentState.name),email:xt(e.currentState.email),mobile:xt(e.currentState.mobile)}),n=st(()=>{const a={name:[],email:[]};return t.name.value.trim().length===0&&a.name.push(x.mandatoryField),t.email.value.trim().length===0?a.email.push(x.mandatoryField):t.email.value.includes("@")||a.email.push(x.invalidEmail),{...a,hasErrors:a.name.length+a.email.length>0}}),[i,l]=T(e.dialogStore);return r(Ue,{get store(){return e.dialogStore},title:"Kontaktdaten editieren",onClose:()=>{},size:"medium",get children(){var a=d(er),o=a.firstChild,[u,m]=c(o.nextSibling),h=u.nextSibling,[$,S]=c(h.nextSibling),_=$.nextSibling,[b,y]=c(_.nextSibling),k=b.nextSibling,[p,w]=c(k.nextSibling);return s(a,r(Ze,{get store(){return t.name},label:"Name",name:"name",showErrors:"ON_BLUR",get errors(){return n().name}}),u,m),s(a,r(Ze,{get store(){return t.email},label:"E-Mail",name:"email",showErrors:"ON_BLUR",get errors(){return n().email}}),$,S),s(a,r(Ze,{get store(){return t.mobile},label:"Handynummer",name:"mobile"}),b,y),s(a,r(Z,{label:"Speichern",get disabled(){return n().hasErrors},onClick:()=>{n().hasErrors||(e.updateCurrentState({name:t.name.value,email:t.email.value,mobile:t.mobile.value}),l("open",!1))}}),p,w),a}})}function ar(e){const t=sr(e.entries,e.changePage,e.isEditable);return[d(tr),d(sn),r(Kn,{programEntries:t})]}function pt(e){const t=e.range.to-e.range.from,n={"master-draft":{label:"SL",help:"Spielleitung",link:{icon:"pencil",label:"Spielrunde bearbeiten"}},master:{label:"SL",help:"Spielleitung",link:{icon:"pencil",label:"Spielrunde bearbeiten"}},play:{label:"TN",help:"Teilnehmer:in",link:{icon:"link",label:"Zur Spielrunde"}},help:{label:"HL",help:"Helfen",link:{icon:"link",label:""}}}[e.kind],i=()=>{const l=["timeview-entry","box-simple"];return e.kind==="master-draft"&&l.push("gray"),e.kind==="master"&&l.push("special"),e.kind==="play"&&l.push("danger"),l.join(" ")};return(()=>{var l=d(nr),a=l.firstChild,[o,u]=c(a.nextSibling),m=o.nextSibling,[h,$]=c(m.nextSibling),S=h.nextSibling,_=S.nextSibling,b=_.firstChild,y=b.nextSibling,[k,p]=c(y.nextSibling),w=k.nextSibling,P=w.nextSibling,[N,I]=c(P.nextSibling),j=N.nextSibling,L=j.nextSibling,M=L.firstChild,X=M.firstChild,te=X.nextSibling,[K,F]=c(te.nextSibling),ee=K.nextSibling,W=ee.nextSibling,[le,ae]=c(W.nextSibling);return le.nextSibling,s(l,r(an,{get title(){return n.help},inverted:!0,size:"small",get children(){return n.label}}),o,u),s(l,r(E,{get when(){return e.onClick},children:G=>r(lt,{get icon(){return n.link.icon},kind:"ghost",get onClick(){return G()},get title(){return n.link.label}})}),h,$),s(S,()=>e.title),s(_,()=>e.range.from,k,p),s(_,()=>e.range.to,N,I),s(M,t,K,F),s(M,t===1?"Stunde":"Stunden",le,ae),ge(G=>{var ne=i(),J=e.title;return ne!==G.e&&De(l,G.e=ne),J!==G.t&&at(S,"title",G.t=J),G},{e:void 0,t:void 0}),l})()}function sr(e,t,n){const i={SATURDAY:[],SUNDAY:[]};return n&&(e.play.forEach(l=>{i[l.dateTime.day].push({range:l.dateTime,component:()=>r(pt,{get title(){return l.title},get range(){return l.dateTime},kind:"play",onClick:()=>t({kind:"GAME",uuid:l.uuid})})})}),e.master.forEach(l=>{if(l.status==="archived")return;const a=[l.title];l.status==="draft"&&a.unshift("(noch nicht verÃ¶ffentlicht)"),i[l.dateTime.day].push({range:l.dateTime,component:()=>r(pt,{get title(){return a.join(" ")},get range(){return l.dateTime},get kind(){return l.status==="published"?"master":"master-draft"},onClick:()=>t({kind:"EDIT_GAMEROUND",uuid:l.uuid})})})}),e.help.forEach(l=>{i[l.dateTime.day].push({range:l.dateTime,component:()=>r(pt,{get title(){return l.title},get range(){return l.dateTime},kind:"help"})})})),i}var or=g("<p>Diese Seite ist leider noch nicht bereit. Komm bitte spÃ¤ter nochmal zurÃ¼ck.");function dr(){return r(C,{type:"danger",get children(){return d(or)}})}var ur=g("<div class=grid><!$><!/><div>"),cr=g("<div class=boxLink>");function Ie(e){const t=e.type??"special";return(()=>{var n=d(cr);return s(n,r(C,{type:t,get onClick(){return e.onClick},get children(){var i=d(ur),l=i.firstChild,[a,o]=c(l.nextSibling),u=a.nextSibling;return s(i,r(re,{get icon(){return e.icon}}),a,o),s(u,()=>e.children),i}})),n})()}const Pt=ct(["SATURDAY","SUNDAY"]),on=v({uuid:f().uuid(),day:Pt,from:Q(),to:Q()}).refine(e=>e.from<e.to,{message:"A TimeSlot can't end before it starts."});v({name:f(),label:f(),description:f()});const gt=ct(["draft","published","archived"]),gr=v({uuid:f().uuid(),kind:gt,title:f(),system:f(),description:v({short:f(),long:f()}),slots:ie(on),playerCount:v({min:Q().min(1),max:Q()}).transform(e=>{const[t,n]=An([e.min,e.max]);return{min:t,max:n}}),tagNames:ie(f())}),dn=v({uuid:f().uuid(),kind:gt,title:tt,system:tt,description:v({short:tt,long:tt}),slots:ie(on),playerCount:v({min:It,max:It}),tagNames:ie(f())});function mr(){const e={uuid:crypto.randomUUID(),kind:"draft",title:"",system:"",description:{short:"",long:""},slots:[],playerCount:{min:2,max:4},tagNames:["deutsch"]},t=hr(e);if(t.success)return t.data;throw console.error(t),Error("should not happen")}function hr(e){return dn.safeParse(e)}function $r(e){return{...e,title:e.title.value,system:e.system.value,description:{short:e.description.short.value,long:e.description.long.value},playerCount:{min:e.playerCount.min.value,max:e.playerCount.max.value}}}const Qe=[{name:"ab6jahren",label:"Ab 6 Jahren",description:"Spannungs- und Bedrohungsmomente werden kurz gehalten. In Begleitung oder nach Absprache mit einem Elternteil. Beispiele: My Little Pony, ..."},{name:"ab12jahren",label:"Ab 12 Jahren",description:"Antisoziales und destruktives wird auf ein Minimum begrenzt. Keine Diskriminierung, keine Radikalisierung, SexualitÃ¤t wird nicht explizit dargestellt."},{name:"ab18jahren",label:"Ab 18 Jahren",description:"Keinerlei Richtlinien bezÃ¼glich Inhalt, in der Gruppe sollte aber diskutiert werden, was akzeptabel ist und was nicht. Beispiele: Vampire the Masquerade, ..."},{name:"fantasy",label:"Fantasy",description:"Spielt in einer alternativen Vergangenheit, in welcher Elemente wie: Ritterinnen, Hexenmeister, RÃ¼stungen, Magie, Goblins, Turniere usw. vorkommen kÃ¶nnen. Beispiele: Das Schwarze Auge, Dungeons & Dragons, ..."},{name:"sciencefiction",label:"Science Fiction",description:"Spielt in einer alternativen Zukunft, in welcher Elemente wie: Raumschiffe, Sternenportale, KÃ¼nstliche Intelligenzen, Laserkanonen usw. vorkommen kÃ¶nnen. Beispiele: Shadowrun, Alien, ..."},{name:"postapokalyptisch",label:"Postapokalyptisch",description:"Spielt in einer Welt mitten oder nach einem Kollaps, wo die Mehrheit ums Ãberleben kÃ¤mpft. Beispiele: Mutant Year Zero, Apocalypse World"},{name:"horror",label:"Horror",description:"Eine gruselige AtmosphÃ¤re, psychologischer Druck oder unvorhersehbare Schreckensmomente. Beispiele: Cthulhu, ..."},{name:"offenewelt",label:"Offene Welt",description:"Es gibt nur einen losen Handlungsfaden, die Rollenspiel-Gruppe muss sich ihre Ziele selber festlegen. Beispiele: Ironsworn, Blades in the Dark, ..."},{name:"gemeinsamespielleitung",label:"Gemeinsame Spielleitung",description:"Die Regeln und die Umwelt werden gemeinsam von allen Spielenden umgesetzt. Beispiele: Microscope, The Quiet Year, ..."},{name:"regelleicht",label:"Regelleicht",description:"Die kompletten Regeln haben alle auf einer Seite Platz. Beispiele: Fiasco, Everyone is John, ..."},{name:"deutsch",label:"Deutsch",description:"Bei der Spielrunde reden die Spielenden miteinander Deutsch."},{name:"englisch",label:"Englisch",description:"Bei der Spielrunde reden die Spielenden miteinander Englisch."},{name:"workshop",label:"Workshop",description:"Unter Anleitung, gemeinsam ein Rollenspiel-Thema vertiefen. Kreative Techniken stehen im Vordergrund. Beispiele: Gemeinsam einen Dungeon erschaffen, gemeinsam eine Hintergrundgeschichte schreiben, ..."}],mt=200,un=500,cn=200;function Sr(e){const t=e.title.value.trim().length===0,n=e.description.short.value.trim().length===0,i=e.description.short.value.length>mt,l=e.description.long.value.length>un,a=e.slots.length===0;return{titleMissing:t,descriptionShortMissing:n,descriptionShortTooLong:i,descriptionLongTooLong:l,slotMissing:a,hasErrors:t||n||i||l||a}}function _r(e){const t=e.updateText.value.trim().length===0,n=e.updateText.value.length>cn;return{missing:t,tooLong:n,hasErrors:t||n}}var br=g("<h3>"),fr=g("<br>"),vr=g("<div style=margin-top:2rem;><h3 style=margin-bottom:1rem;></h3><ul class=event-list role=list>"),yr=g('<li><h3 class=event-title></h3><div class=event-details><div class=event-tags><strong>Status:</strong><!$><!/></div><div class=event-tags><strong>System:</strong><!$><!/></div><div class=event-tags><strong>Tag, Zeit:</strong><!$><!/></div><div class=event-tags><strong>Spielende:</strong> <!$><!/> - <!$><!/></div> <div class=event-tags><strong>Kategorien:</strong> <!$><!/></div></div><div class="event-description content"><p><strong>Kurzbeschreibung:</strong><br><!$><!/></p></div><ul role=list class=event-links><li><button class=event-link><span>Bearbeiten'),ze=g("<em>"),kr=g("<span><!$><!/>, <!$><!/> - <!$><!/> Uhr");function xr(e){const[t,n]=T(e.store);function i(){const l=mr();n("games",t.games.length,l),e.changePage({kind:"EDIT_GAMEROUND",uuid:l.uuid})}return[r(E,{get when(){return e.isEditable},get children(){return r(Ie,{icon:"grid-2-plus",type:"success",onClick:i,get children(){var l=d(br);return s(l,()=>x.createNewGameRound),l}})}}),d(fr),r(Dt,{label:"Ich habe wenig bis keine Spielleitung-Erfahrung und mÃ¶chte gerne in der Vorbereitung und/oder wÃ¤hrend der Spielrunde unterstÃ¼tzt werden.",get checked(){return t.wantsHelp},name:"wantsHelp",value:"wantsHelp",onValueUpdate:l=>{n("wantsHelp",l)},get disabled(){return!e.isEditable}}),r(E,{get when(){return e.store.games},children:l=>(()=>{var a=d(vr),o=a.firstChild,u=o.nextSibling;return s(o,()=>x.myGameRounds),s(u,r(z,{get each(){return l().filter(m=>m.kind!=="archived")},children:m=>{const h=m.tagNames.map($=>Qe.find(({name:S})=>S===$)).filter($=>$!==void 0).map(({label:$})=>$);return r(z,{get each(){return m.slots},get fallback(){return r(Gt,{game:m,slot:null,tags:h,get changePage(){return e.changePage}})},children:$=>r(Gt,{game:m,slot:$,tags:h,get changePage(){return e.changePage}})})}})),a})()})]}function Gt(e){const{game:t,slot:n,tags:i,changePage:l}=e;return(()=>{var a=d(yr),o=a.firstChild,u=o.nextSibling,m=u.firstChild,h=m.firstChild,$=h.nextSibling,[S,_]=c($.nextSibling),b=m.nextSibling,y=b.firstChild,k=y.nextSibling,[p,w]=c(k.nextSibling),P=b.nextSibling,N=P.firstChild,I=N.nextSibling,[j,L]=c(I.nextSibling),M=P.nextSibling,X=M.firstChild,te=X.nextSibling,K=te.nextSibling,[F,ee]=c(K.nextSibling),W=F.nextSibling,le=W.nextSibling,[ae,G]=c(le.nextSibling),ne=M.nextSibling,J=ne.nextSibling,V=J.firstChild,me=V.nextSibling,D=me.nextSibling,[oe,de]=c(D.nextSibling),ue=u.nextSibling,q=ue.firstChild,Se=q.firstChild,fe=Se.nextSibling,xe=fe.nextSibling,[ve,_e]=c(xe.nextSibling),he=ue.nextSibling,pe=he.firstChild,Ee=pe.firstChild;return s(o,(()=>{var A=O(()=>t.title.value.length>0);return()=>A()?t.title.value:(()=>{var ce=d(ze);return s(ce,()=>x.missingTitle),ce})()})()),s(m,()=>x.publishingSteps[t.kind],S,_),s(b,()=>t.system.value||(()=>{var A=d(ze);return s(A,()=>x.missingSystem),A})(),p,w),s(P,n!==null?(()=>{var A=d(kr),ce=A.firstChild,[Oe,Ce]=c(ce.nextSibling),Ge=Oe.nextSibling,He=Ge.nextSibling,[ye,ht]=c(He.nextSibling),$t=ye.nextSibling,Xe=$t.nextSibling,[et,St]=c(Xe.nextSibling);return et.nextSibling,s(A,()=>x.days[n.day],Oe,Ce),s(A,()=>n.from,ye,ht),s(A,()=>n.to,et,St),A})():(()=>{var A=d(ze);return s(A,()=>x.missingSlot),A})(),j,L),s(M,()=>t.playerCount.min.value,F,ee),s(M,()=>t.playerCount.max.value,ae,G),s(J,()=>i.join(", ")||(()=>{var A=d(ze);return s(A,()=>x.missingTags),A})(),oe,de),s(q,(()=>{var A=O(()=>t.description.short.value.length===0);return()=>A()?(()=>{var ce=d(ze);return s(ce,()=>x.missingShortDescription),ce})():Xt(t.description.short.value,mt)})(),ve,_e),Ee.$$click=()=>l({kind:"EDIT_GAMEROUND",uuid:t.uuid}),ge(()=>De(a,["event-entry",t.kind==="draft"?"gray":""].join(" "))),dt(),a})()}ot(["click"]);var pr=g("<div class=game-dialog><ul role=list style=display:grid;gap:0.5rem;><li><strong style=color:var(--clr-accent-1);>Spielleitung:</strong><br> <!$><!/></li><li><strong style=color:var(--clr-accent-1);>System:</strong><br><!$><!/></li><li><strong style=color:var(--clr-accent-1);>Tag, Zeit:</strong> <br><!$><!/>, <!$><!/> - <!$><!/> Uhr</li><li><strong style=color:var(--clr-accent-1);>Freie PlÃ¤tze:</strong><br><!$><!/> (von <!$><!/>)</li><li><strong style=color:var(--clr-accent-1);>Kategorien:</strong><br><!$><!/></li><li><strong style=color:var(--clr-accent-1);>Kurze Beschreibung:</strong><br><!$><!/></li><li><strong style=color:var(--clr-accent-1);>Lange Beschreibung:</strong><br><!$><!/></li></ul><div class=reservations><h5 style=margin-block-start:0>PlÃ¤tze reservieren</h5><div class=reservation-table>"),Er=g("<em>kein System angegeben"),Cr=g("<em>keine Kategorien"),wr=g("<em>Keine lange Beschreibung angegeben."),Rr=g("<div class=count>"),Ar=g("<div class=reservation-table-entry><p>Reserviert fÃ¼r mich </p><!$><!/>"),Tr=g('<div class=reservation-table-entry><p>Reserviert fÃ¼r "<!$><!/>"</p><!$><!/>'),Dr=g('<div style="display:grid;gap:1rem;grid-template-columns:max-content 1fr;"><!$><!/><!$><!/>'),Ur=g('<form style="display:grid;gap:0rem;grid-template-columns:1fr max-content"class=input-button><input type=text style=border-color:var(--clr-special-9);><!$><!/>');function Or(e){const t=()=>e.reservations.filter(u=>u.gameRound===e.entry.uuid),n=Math.max(e.entry.playerCount.reserved+1-t.length,1),i=e.entry.tags.map(u=>Qe.find(({name:m})=>m===u)).filter(u=>u!==void 0).map(({label:u})=>u),l=e.entry.playerCount.max,a=()=>ln(l).map(u=>{const m=t()[u];return m!==void 0?m:u+1===l?{kind:"RESERVED_SPONTANIOUS"}:l-n<=u?{kind:"RESERVED_OTHER"}:{kind:"FREE"}}),o=()=>t().find(u=>u.kind==="SELF")!==void 0;return(()=>{var u=d(pr),m=u.firstChild,h=m.firstChild,$=h.firstChild,S=$.nextSibling,_=S.nextSibling,b=_.nextSibling,[y,k]=c(b.nextSibling),p=h.nextSibling,w=p.firstChild,P=w.nextSibling,N=P.nextSibling,[I,j]=c(N.nextSibling),L=p.nextSibling,M=L.firstChild,X=M.nextSibling,te=X.nextSibling,K=te.nextSibling,[F,ee]=c(K.nextSibling),W=F.nextSibling,le=W.nextSibling,[ae,G]=c(le.nextSibling),ne=ae.nextSibling,J=ne.nextSibling,[V,me]=c(J.nextSibling);V.nextSibling;var D=L.nextSibling,oe=D.firstChild,de=oe.nextSibling,ue=de.nextSibling,[q,Se]=c(ue.nextSibling),fe=q.nextSibling,xe=fe.nextSibling,[ve,_e]=c(xe.nextSibling);ve.nextSibling;var he=D.nextSibling,pe=he.firstChild,Ee=pe.nextSibling,A=Ee.nextSibling,[ce,Oe]=c(A.nextSibling),Ce=he.nextSibling,Ge=Ce.firstChild,He=Ge.nextSibling,ye=He.nextSibling,[ht,$t]=c(ye.nextSibling),Xe=Ce.nextSibling,et=Xe.firstChild,St=et.nextSibling,fn=St.nextSibling,[vn,yn]=c(fn.nextSibling),kn=m.nextSibling,xn=kn.firstChild,pn=xn.nextSibling;return s(h,()=>e.entry.gamemaster,y,k),s(p,(()=>{var H=O(()=>e.entry.system.trim().length>0);return()=>H()?e.entry.system:d(Er)})(),I,j),s(L,()=>x.days[e.entry.slot.day],F,ee),s(L,()=>e.entry.slot.from,ae,G),s(L,()=>e.entry.slot.to,V,me),s(D,()=>Math.max(e.entry.playerCount.max-1-e.entry.playerCount.reserved,0),q,Se),s(D,()=>e.entry.playerCount.max-1,ve,_e),s(he,(()=>{var H=O(()=>i.length>0);return()=>H()?i.join(", "):d(Cr)})(),ce,Oe),s(Ce,()=>e.entry.description.short,ht,$t),s(Xe,(()=>{var H=O(()=>e.entry.description.long.trim().length>0);return()=>H()?O(()=>e.entry.description.long):d(wr)})(),vn,yn),s(pn,r(z,{get each(){return a()},children:(H,En)=>[(()=>{var Y=d(Rr);return s(Y,()=>En()+1),Y})(),r($e,{get children(){return[r(R,{get when(){return H.kind==="RESERVED_OTHER"},get children(){return r(C,{children:"Bereits reserviert"})}}),r(R,{get when(){return H.kind==="RESERVED_SPONTANIOUS"},get children(){return r(C,{children:"Reserviert fÃ¼r spontane Spieler:innen"})}}),r(R,{get when(){return!e.isEditable},get children(){return r(C,{children:"Freier Platz"})}}),r(R,{get when(){return H.kind==="SELF"},get children(){return r(Nt,{type:"success",get children(){var Y=d(Ar),we=Y.firstChild,Pe=we.nextSibling,[Ye,Ne]=c(Pe.nextSibling);return s(Y,r(lt,{icon:"trash",onClick:()=>e.removeReservation(H.kind==="SELF"?H.uuid:"should not happen")}),Ye,Ne),Y}})}}),r(R,{get when(){return H.kind==="FRIEND"},get children(){return r(Nt,{type:"success",get children(){var Y=d(Tr),we=Y.firstChild,Pe=we.firstChild,Ye=Pe.nextSibling,[Ne,_t]=c(Ye.nextSibling);Ne.nextSibling;var bt=we.nextSibling,[ft,Cn]=c(bt.nextSibling);return s(we,()=>H.kind==="FRIEND"?H.name:"[Fehler beim Laden]",Ne,_t),s(Y,r(lt,{icon:"trash",onClick:()=>e.removeReservation(H.kind==="FRIEND"?H.uuid:"should not happen")}),ft,Cn),Y}})}}),r(R,{get when(){return H.kind==="FREE"},get children(){return r(E,{get when(){return o()},get fallback(){return(()=>{var Y=d(Dr),we=Y.firstChild,[Pe,Ye]=c(we.nextSibling),Ne=Pe.nextSibling,[_t,bt]=c(Ne.nextSibling);return s(Y,r(B,{icon:"person-to-portal",label:"Mich anmelden",kind:"success",onClick:()=>e.addReservation({kind:"SELF",gameRound:e.entry.uuid})}),Pe,Ye),s(Y,r(Ht,{addFriend:ft=>e.addReservation({kind:"FRIEND",gameRound:e.entry.uuid,name:ft})}),_t,bt),Y})()},get children(){return r(Ht,{addFriend:Y=>e.addReservation({kind:"FRIEND",gameRound:e.entry.uuid,name:Y})})}})}})]}})]})),u})()}function Ht(e){const[t,n]=Tt("");return(()=>{var i=d(Ur),l=i.firstChild,a=l.nextSibling,[o,u]=c(a.nextSibling);return i.addEventListener("submit",m=>{m.preventDefault();const h=t();h.trim().length>0&&e.addFriend(h)}),Ke(i,"novalidate",!0),l.$$input=m=>n(m.target.value),s(i,r(B,{icon:"arrow-right",type:"submit",label:"Begleitperson anmelden",kind:"special"}),o,u),ge(()=>Ke(l,"value",t())),dt(),i})()}ot(["input"]);var Pr=g("<div style=display:flex;flex-wrap:wrap;gap:1rem;justify-content:space-between;><h5 style=margin:0;>Filter</h5><!$><!/>"),Nr=g("<h6 style=margin-block:0.5rem;>Tage"),Mr=g("<div style=display:flex;flex-wrap:wrap;gap:0.5rem;><!$><!/><!$><!/>"),Ir=g("<h6 style=margin-block:0.5rem;>Kategorien"),Lr=g("<div style=display:flex;flex-wrap:wrap;gap:0.5rem;>");const se={day:"fDay",tags:"fTags",options:"fOpts"};function Fr(){const e=new URL(location.href),t=e.searchParams.get(se.day),n=t==="SATURDAY"||t==="SUNDAY"?t:null,i=e.searchParams.getAll(se.tags),l=e.searchParams.getAll(se.options);return{day:n,tags:i,withOpenSeats:l.includes("withOpenSeats"),iHaveTime:l.includes("iHaveTime")}}function Gr(e,t){return{toggleDay:n=>{const i=e.day===n,l=new URL(location.href);i?(l.searchParams.delete(se.day),t("day",null)):(l.searchParams.set(se.day,n),t("day",n)),history.pushState(We(e),"",l)},toggleTag:n=>{const i=e.tags.includes(n),l=new URL(location.href);i?(l.searchParams.delete(se.tags),t("tags",e.tags.filter(a=>a!==n)),e.tags.forEach(a=>{l.searchParams.append(se.tags,a)})):(l.searchParams.append(se.tags,n),t("tags",e.tags.length,n)),history.pushState(We(e),"",l)},toggleOption:n=>{const i=e[n],l=new URL(location.href);t(n,!i),["withOpenSeats","iHaveTime"].forEach(a=>{e[a]&&l.searchParams.append(se.options,a)}),history.pushState(We(e),"",l)},reset:()=>{t({day:null,tags:[],withOpenSeats:!1,iHaveTime:!1});const n=new URL(location.href);n.searchParams.delete(se.day),n.searchParams.delete(se.tags),n.searchParams.delete(se.options),history.pushState(We(e),"",n)}}}function Hr(e){const[t,n]=T(e.activeFilter),i=Gr(t,n);return r(C,{get children(){return[(()=>{var l=d(Pr),a=l.firstChild,o=a.nextSibling,[u,m]=c(o.nextSibling);return s(l,r(B,{label:"Filter zurÃ¼cksetzen",icon:"circle-xmark",kind:"ghost-danger",onClick:()=>i.reset()}),u,m),l})(),d(Nr),(()=>{var l=d(Mr),a=l.firstChild,[o,u]=c(a.nextSibling),m=o.nextSibling,[h,$]=c(m.nextSibling);return s(l,r(Z,{label:"Samstag",get kind(){return t.day!=="SUNDAY"?"success":"gray"},onClick:()=>i.toggleDay("SATURDAY")}),o,u),s(l,r(Z,{label:"Sonntag",get kind(){return t.day!=="SATURDAY"?"success":"gray"},onClick:()=>i.toggleDay("SUNDAY")}),h,$),l})(),d(Ir),(()=>{var l=d(Lr);return s(l,r(z,{each:Qe,children:a=>r(Z,{get label(){return a.label},get kind(){return t.tags.length===0||t.tags.includes(a.name)?"success":"gray"},onClick:()=>i.toggleTag(a.name)})})),l})()]}})}function Yr(e,t){return e.filter(n=>!(t.day!==n.slot.day&&t.day!==null||!Br(n.tags,t.tags)))}function Br(e,t){return t.length===0?!0:t.filter(i=>!e.includes(i)).length===0}var zr=g("<p>WIP"),Re=g("<br>"),jr=g("<p>Diese Seite ist leider noch nicht bereit. Komm bitte spÃ¤ter nochmal zurÃ¼ck."),Wr=g("<p>Programm konnte nicht geladen werden."),Zr=g("<em><!$><!/> von <!$><!/> Runden gefunden."),Kr=g("<h3>"),Jr=g("<h4 style=margin-block-start:2rem;margin-block-end:1rem;>Start: <!$><!/> Uhr"),Vr=g('<ul class="event-list max"role=list>'),qr=g("<small><!$><!/> - <!$><!/> Uhr"),Qr=g("<h4 style=margin-block-end:0.5rem;>"),Xr=g("<p>Wir kochen: <span>"),ei=g("<div style=margin-block-start:2rem;>"),ti=g('<li><h3 class=event-title></h3><div class=event-details><div class=event-tags><strong>Spielleitung:</strong><!$><!/></div><div class=event-tags><strong>System:</strong><!$><!/></div><div class=event-tags><strong>Tag, Zeit:</strong><span><!$><!/>, <!$><!/> - <!$><!/> Uhr</span></div><div class=event-tags><strong>Freie PlÃ¤tze:</strong> <!$><!/> (von <!$><!/>)</div> <div class=event-tags><strong>Kategorien:</strong> <!$><!/></div></div><div class="event-description content"><p><strong>Kurzbeschreibung:</strong><br><!$><!/></p></div><ul role=list class=event-links><li><button class=event-link><span>Details & Teilnahme'),ni=g("<em>kein System angegeben"),ri=g("<em>keine Kategorien");function ii(e){const[t,n]=T({playing:e.store,activeFilter:Fr()});return r($e,{get fallback(){return r(C,{type:"danger",get children(){return d(jr)}})},get children(){return r(R,{get when(){return e.isDebugging},get children(){return[r(C,{type:"danger",get children(){return d(zr)}}),d(Re),r(Dt,{label:"Schickt mir bitte E-Mails, wenn neue Spielrunden verÃ¶ffentlicht werden.",get checked(){return t.playing.wantsUpdates},name:"wantsUpdates",value:"wantsUpdates",onValueUpdate:i=>{n("playing","wantsUpdates",i)}}),d(Re),r(Hr,{get activeFilter(){return t.activeFilter}}),d(Re),r(ut,{get fallback(){return r(C,{get children(){return x.loading.program}})},get children(){return r(E,{get when(){return e.program()},get fallback(){return r(C,{type:"danger",get children(){return x.error.program}})},children:i=>r(E,{get when(){return i().kind==="SUCCESS"},get fallback(){return r(C,{type:"danger",get children(){return d(Wr)}})},get children(){return r(li,{get program(){return i().data},get filter(){return t.activeFilter},get reservations(){return t.playing.reservations},get isEditable(){return e.isEditable},addReservation:l=>n("playing","reservations",t.playing.reservations.length,{...l,uuid:crypto.randomUUID()}),removeReservation:l=>{n("playing","reservations",t.playing.reservations.filter(a=>a.uuid!==l))},get uuid(){return e.uuid},get changePage(){return e.changePage}})}})})}})]}})}})}function li(e){const[t,n]=T(Ae(e.uuid!==void 0));tn(()=>{n("open",e.uuid!==null)});const i=()=>e.program.find(o=>o.uuid===e.uuid),l=()=>Yr(e.program,e.filter),a=()=>oi(si(l()));return[(()=>{var o=d(Zr),u=o.firstChild,[m,h]=c(u.nextSibling),$=m.nextSibling,S=$.nextSibling,[_,b]=c(S.nextSibling);return _.nextSibling,s(o,()=>l().length,m,h),s(o,()=>e.program.length,_,b),o})(),d(Re),r(E,{get when(){return i()},children:o=>r(Ue,{store:t,get title(){return o().title},onClose:()=>e.changePage({kind:"PLAYER"},{disableScroll:!0}),size:"large",get children(){return r(Or,{get entry(){return o()},get reservations(){return e.reservations},get isEditable(){return e.isEditable},get addReservation(){return e.addReservation},get removeReservation(){return e.removeReservation}})}})}),d(Re),r(Yt,{day:"SATURDAY",get programOfDay(){return a().SATURDAY},get changePage(){return e.changePage}}),d(Re),d(Re),r(Yt,{day:"SUNDAY",get programOfDay(){return a().SUNDAY},get changePage(){return e.changePage}})]}function Yt(e){const t=()=>Object.values(e.programOfDay).flat().length>0,i=Te[e.day].breaks.map(a=>a.from),l=a=>i.indexOf(a)===0?"LUNCH":"DINNER";return[(()=>{var a=d(Kr);return s(a,()=>x.days[e.day]),a})(),r(E,{get when(){return t()},get fallback(){return r(C,{get children(){return["Keine Spielrunden mit den ausgewÃ¤hlten Filtern am"," ",O(()=>x.days[e.day])," gefunden."]}})},get children(){return r(z,{get each(){return Object.entries(e.programOfDay)},children:([a,o])=>i.includes(Number(a))?r(ai,{get type(){return l(Number(a))},get range(){return{from:Number(a),to:Number(a)-1}}}):o.length===0?null:[(()=>{var u=d(Jr),m=u.firstChild,h=m.nextSibling,[$,S]=c(h.nextSibling);return $.nextSibling,s(u,a,$,S),u})(),(()=>{var u=d(Vr);return s(u,r(z,{each:o,children:m=>r(di,{entry:m,get changePage(){return e.changePage}})})),u})()]})}})]}function ai(e){const t=e.type==="LUNCH"?"Mittagessen":"Nachtessen";return(()=>{var n=d(ei);return s(n,r(C,{get children(){return[(()=>{var i=d(qr),l=i.firstChild,[a,o]=c(l.nextSibling),u=a.nextSibling,m=u.nextSibling,[h,$]=c(m.nextSibling);return h.nextSibling,s(i,()=>e.range.from,a,o),s(i,()=>e.range.to,h,$),i})(),(()=>{var i=d(Qr);return s(i,t),i})(),(()=>{var i=d(Xr),l=i.firstChild,a=l.nextSibling;return Ke(a,"innerHTML","Pilzrisotto (vegi&nbsp;/&nbsp;vegan), Penne All'Arrabbiata und Penne Pesto (vegi&nbsp;/&nbsp;vegan)."),i})()]}})),n})()}function si(e){const t=Object.groupBy(e,n=>n.slot.day);return{SATURDAY:t.SATURDAY??[],SUNDAY:t.SUNDAY??[]}}function oi(e){function t(o,u){const{from:m,to:h}=o.slot,{from:$,to:S}=u.slot;return m===$?h-S:m-$}const n=e.SATURDAY.toSorted(t),i=e.SUNDAY.toSorted(t),l=Je(Te.SATURDAY.open).reduce((o,u)=>(o[u]=n.filter(m=>m.slot.from===u),o),{}),a=Je(Te.SUNDAY.open).reduce((o,u)=>(o[u]=i.filter(m=>m.slot.from===u),o),{});return{SATURDAY:l,SUNDAY:a}}function di(e){const t=e.entry.tags.map(n=>Qe.find(({name:i})=>i===n)).filter(n=>n!==void 0).map(({label:n})=>n);return(()=>{var n=d(ti),i=n.firstChild,l=i.nextSibling,a=l.firstChild,o=a.firstChild,u=o.nextSibling,[m,h]=c(u.nextSibling),$=a.nextSibling,S=$.firstChild,_=S.nextSibling,[b,y]=c(_.nextSibling),k=$.nextSibling,p=k.firstChild,w=p.nextSibling,P=w.firstChild,[N,I]=c(P.nextSibling),j=N.nextSibling,L=j.nextSibling,[M,X]=c(L.nextSibling),te=M.nextSibling,K=te.nextSibling,[F,ee]=c(K.nextSibling);F.nextSibling;var W=k.nextSibling,le=W.firstChild,ae=le.nextSibling,G=ae.nextSibling,[ne,J]=c(G.nextSibling),V=ne.nextSibling,me=V.nextSibling,[D,oe]=c(me.nextSibling);D.nextSibling;var de=W.nextSibling,ue=de.nextSibling,q=ue.firstChild,Se=q.nextSibling,fe=Se.nextSibling,[xe,ve]=c(fe.nextSibling),_e=l.nextSibling,he=_e.firstChild,pe=he.firstChild,Ee=pe.nextSibling,A=Ee.nextSibling,[ce,Oe]=c(A.nextSibling),Ce=_e.nextSibling,Ge=Ce.firstChild,He=Ge.firstChild;return s(i,()=>e.entry.title),s(a,()=>e.entry.gamemaster,m,h),s($,(()=>{var ye=O(()=>e.entry.system.trim().length>0);return()=>ye()?e.entry.system:d(ni)})(),b,y),s(w,()=>x.days[e.entry.slot.day],N,I),s(w,()=>e.entry.slot.from,M,X),s(w,()=>e.entry.slot.to,F,ee),s(W,()=>Math.max(e.entry.playerCount.max-1-e.entry.playerCount.reserved,0),ne,J),s(W,()=>e.entry.playerCount.max-1,D,oe),s(ue,(()=>{var ye=O(()=>t.length>0);return()=>ye()?t.join(", "):d(ri)})(),xe,ve),s(he,()=>Xt(e.entry.description.short,mt),ce,Oe),He.$$click=()=>e.changePage({kind:"GAME",uuid:e.entry.uuid},{disableScroll:!0}),ge(()=>De(n,["event-entry"].join(" "))),dt(),n})()}ot(["click"]);var Bt=g("<h3>Spielrunden ansehen"),zt=g("<p>Melde dich (und deine Freunde) fÃ¼r diverse Spielrunden an."),Et=g("<br>"),ui=g("<h3>Spielrunden erstellen"),ci=g("<p>Falls du wenig oder gar keine Erfahrung als Spielleiter:in hast, werden wir dich vor und wÃ¤hrend dem Anlass unterstÃ¼tzen."),gi=g("<h3>Helfen"),mi=g("<p>Beim Kiosk und der Essensausgabe kÃ¶nnen wir immer ein paar helfende HÃ¤nde gebrauchen."),jt=g("<p><strong>Noch nicht verfÃ¼gbar."),hi=g("<h3>Zusammenfassung"),$i=g("<p>Erhalte einen Ãberblick Ã¼ber dein gesamtes Programm.");function Si(e){return[r($e,{get fallback(){return r(Ie,{type:"gray",icon:"dice-d20",onClick:()=>e.changePage({kind:"PLAYER"}),get children(){return[d(Bt),d(zt),d(jt)]}})},get children(){return r(R,{get when(){return e.isDebugging},get children(){return r(Ie,{icon:"dice-d20",onClick:()=>e.changePage({kind:"PLAYER"}),get children(){return[d(Bt),d(zt)]}})}})}}),d(Et),r(Ie,{icon:"grid-2-plus",onClick:()=>e.changePage({kind:"GAMEMASTER"}),get children(){return[d(ui),d(ci)]}}),d(Et),r(Ie,{type:"gray",icon:"hand-heart",onClick:()=>e.changePage({kind:"HELPING"}),get children(){return[d(gi),d(mi),d(jt)]}}),d(Et),r(Ie,{icon:"list",onClick:()=>e.changePage({kind:"SUMMARY"}),get children(){return[d(hi),d($i)]}})]}var _i=g("<fieldset><legend>Zeitslots</legend><!$><!/><!$><!/>"),Wt=g("<br>"),bi=g("<div style=margin-block-end:0.5rem;>Zeitslot: <!$><!/>, <!$><!/> -<!$><!/> Uhr"),fi=g("<ul class=event-list role=list>"),vi=g("<em>werden geladen..."),yi=g("<li class=event-entry><h3 class=event-title><!$><!/>, <!$><!/> - <!$><!/> Uhr</h3><div class=event-details><div class=event-tags><strong>Dauer:</strong><!$><!/> <!$><!/></div><div class=event-tags><strong>Spielende:</strong> <!$><!/></div></div><div></div><ul role=list class=event-links>"),ki=g("<em>Fehler beim Laden."),xi=g("<em>noch keine Anmeldungen"),pi=g("<li><em style=font-size:smaller;>Aktionen werden geladen..."),Zt=g("<li><em style=font-size:smaller;>kann nicht gelÃ¶scht werden"),Ei=g("<li><button type=button class=event-link><div style=display:flex;gap:0.25rem;align-items:center;><!$><!/><span>LÃ¶schen"),Ci=g("<div style=display:grid;gap:0.5rem;>"),wi=g("<div style=display:grid;gap:0.5rem;><!$><!/><!$><!/>"),Ri=g("<div style=display:grid;gap:0.5rem;><!$><!/><!$><!/><!$><!/>"),Ai=g("<div style=display:grid;gap:0.5rem;><!$><!/><!$><!/><!$><!/><div style=margin-block-start:1rem;>"),Ti=g("<div style=display:flex;flex-wrap:wrap;gap:0.5rem;align-items:center;><!$><!/> <span>Neuen Slot erfassen"),Di=g("<em>WÃ¤hle eine Tag:"),Ui=g("<div style=display:flex;flex-wrap:wrap;gap:.5rem;><!$><!/><!$><!/>"),Oi=g("<em>WÃ¤hle eine Startzeit:"),gn=g("<div style=display:flex;flex-wrap:wrap;gap:.5rem;>"),mn=g("<span style=white-space:nowrap;><!$><!/> Uhr"),Pi=g("<em>WÃ¤hle eine Endzeit:");function Ni(e){return(()=>{var t=d(_i),n=t.firstChild,i=n.nextSibling,[l,a]=c(i.nextSibling),o=l.nextSibling,[u,m]=c(o.nextSibling);return s(t,r(Ii,{get store(){return e.store},get registrations(){return e.registrations},get isEditable(){return e.isEditable}}),l,a),s(t,r(E,{get when(){return e.slotMissing},get children(){return r(C,{type:"danger",children:"WÃ¤hle mindestens einen Zeitslot aus."})}}),u,m),t})()}const Kt=1;function Mi(e){function t(n){const i=Je(n.open,!0);return n.breaks.map(a=>Je(a,!0)).reduce((a,o)=>{const u=o.at(0),m=o.at(-1);if(u===void 0||m===void 0)return a;const h=[];return a.forEach($=>{const S=[],_=[];$.forEach(b=>{b<=u&&S.push(b),m<=b&&_.push(b)}),S.length>0&&h.push(S),_.length>0&&h.push(_)}),h},[i]).map(a=>{const o=a.slice(0,Kt*-1);return Tn(o.map(u=>{const m=a.filter(h=>h>=u+Kt);return[u,m]}))}).reduce((a,o)=>({...a,...o}),{})}return{SATURDAY:t(e.SATURDAY),SUNDAY:t(e.SUNDAY)}}function Ii(e){const[t,n]=T(e.store),[i,l]=T({dialog:Ae()}),a=st(()=>Mi(Te));function o(h){n(t.concat(h))}function u(h){l("dialog","open",!1),l("slot",void 0),n(t.filter($=>$.uuid!==h))}function m(h){l("dialog","open",!0),l("slot",t.find($=>$.uuid===h))}return[r(Fi,{get daySections(){return a()},chooseTimeSlot:o,get isEditable(){return e.isEditable}}),d(Wt),d(Wt),r(Ue,{get store(){return i.dialog},title:"Zeitslot lÃ¶schen",onClose:()=>l("slot",void 0),get children(){return[(()=>{var h=d(bi),$=h.firstChild,S=$.nextSibling,[_,b]=c(S.nextSibling),y=_.nextSibling,k=y.nextSibling,[p,w]=c(k.nextSibling),P=p.nextSibling,N=P.nextSibling,[I,j]=c(N.nextSibling);return I.nextSibling,s(h,()=>x.days[i.slot?.day],_,b),s(h,()=>i.slot?.from,p,w),s(h,()=>i.slot?.to,I,j),h})(),r(B,{kind:"danger",icon:"trash",label:"LÃ¶schen",onClick:()=>u(i.slot?.uuid)})]}}),r(Li,{slots:t,get registrations(){return e.registrations},confirmRemoval:m,get isEditable(){return e.isEditable}})]}function Li(e){return(()=>{var t=d(fi);return s(t,r(z,{get each(){return Gi(e.slots)},children:n=>(()=>{var i=d(yi),l=i.firstChild,a=l.firstChild,[o,u]=c(a.nextSibling),m=o.nextSibling,h=m.nextSibling,[$,S]=c(h.nextSibling),_=$.nextSibling,b=_.nextSibling,[y,k]=c(b.nextSibling);y.nextSibling;var p=l.nextSibling,w=p.firstChild,P=w.firstChild,N=P.nextSibling,[I,j]=c(N.nextSibling),L=I.nextSibling,M=L.nextSibling,[X,te]=c(M.nextSibling),K=w.nextSibling,F=K.firstChild,ee=F.nextSibling,W=ee.nextSibling,[le,ae]=c(W.nextSibling),G=p.nextSibling,ne=G.nextSibling;return s(l,()=>x.days[n.day],o,u),s(l,()=>n.from,$,S),s(l,()=>n.to,y,k),s(w,()=>n.to-n.from,I,j),s(w,()=>n.to-n.from>1?"Stunden":"Stunde",X,te),s(K,r($e,{get children(){return[r(R,{get when(){return e.registrations.loading},get children(){return d(vi)}}),r(R,{get when(){return e.registrations()},children:J=>{const V=J();if(V.kind==="FAILURE")return d(ki);const me=V.data.filter(D=>D.uuid===n.uuid).map(D=>D.name);return O(()=>me.join(", ")||d(xi))}})]}}),le,ae),s(ne,r(ut,{get fallback(){return d(pi)},get children(){return r(E,{get when(){return e.registrations()},children:J=>{const V=J();return V.kind==="FAILURE"?d(Zt):V.data.filter(D=>D.uuid===n.uuid).map(D=>D.name).length>0?d(Zt):(()=>{var D=d(Ei),oe=D.firstChild,de=oe.firstChild,ue=de.firstChild,[q,Se]=c(ue.nextSibling);return q.nextSibling,oe.$$click=()=>e.confirmRemoval(n.uuid),s(de,r(re,{icon:"trash"}),q,Se),ge(()=>Ke(oe,"disabled",!e.isEditable)),dt(),D})()}})}})),i})()})),t})()}function Fi(e){const[t,n]=T({slot:{kind:"CHOOSE_DAY"},dialog:Ae()});function i(){n("slot",{kind:"CHOOSE_DAY"}),n("dialog","open",!1)}function l(a){e.chooseTimeSlot(a),i()}return[r(Z,{kind:"success",get label(){return(()=>{var a=d(Ti),o=a.firstChild,[u,m]=c(o.nextSibling);return u.nextSibling,s(a,r(re,{icon:"circle-plus"}),u,m),a})()},onClick:()=>n("dialog","open",!0),get disabled(){return!e.isEditable}}),r(Ue,{title:"Zeitslot erfassen",get store(){return t.dialog},size:"medium",onClose:i,get children(){return r($e,{get children(){return[r(R,{get when(){return t.slot.kind==="CHOOSE_DAY"},get children(){var a=d(Ci);return s(a,r(rt,{changeDay:o=>n("slot",{kind:"CHOOSE_START",day:o})})),a}}),r(R,{get when(){return t.slot.kind==="CHOOSE_START"},get children(){var a=d(wi),o=a.firstChild,[u,m]=c(o.nextSibling),h=u.nextSibling,[$,S]=c(h.nextSibling);return s(a,r(rt,{get chosenDay(){return t.slot.kind==="CHOOSE_START"?t.slot.day:void 0},changeDay:_=>n("slot",{kind:"CHOOSE_START",day:_})}),u,m),s(a,r(Ct,{get startTimes(){return O(()=>t.slot.kind==="CHOOSE_START")()?yt(e.daySections[t.slot.day]):[]},changeStart:_=>n("slot",{kind:"CHOOSE_END",start:_})}),$,S),a}}),r(R,{get when(){return t.slot.kind==="CHOOSE_END"},get children(){var a=d(Ri),o=a.firstChild,[u,m]=c(o.nextSibling),h=u.nextSibling,[$,S]=c(h.nextSibling),_=$.nextSibling,[b,y]=c(_.nextSibling);return s(a,r(rt,{get chosenDay(){return t.slot.kind==="CHOOSE_END"?t.slot.day:void 0},changeDay:k=>n("slot",{kind:"CHOOSE_START",day:k})}),u,m),s(a,r(Ct,{get chosenStart(){return t.slot.kind==="CHOOSE_END"?t.slot.start:void 0},get startTimes(){return O(()=>t.slot.kind==="CHOOSE_END")()?yt(e.daySections[t.slot.day]):[]},changeStart:k=>n("slot",{kind:"CHOOSE_END",start:k})}),$,S),s(a,r(Jt,{get endTimes(){return t.slot.kind==="CHOOSE_END"?e.daySections[t.slot.day][t.slot.start]??[]:[]},changeEnd:k=>{t.slot.kind==="CHOOSE_END"&&n("slot",{kind:"WAIT_FOR_CONFIRMATION",day:t.slot.day,start:t.slot.start,end:k})}}),b,y),a}}),r(R,{get when(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"},get children(){var a=d(Ai),o=a.firstChild,[u,m]=c(o.nextSibling),h=u.nextSibling,[$,S]=c(h.nextSibling),_=$.nextSibling,[b,y]=c(_.nextSibling),k=b.nextSibling;return s(a,r(rt,{get chosenDay(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"?t.slot.day:void 0},changeDay:p=>n("slot",{kind:"CHOOSE_START",day:p})}),u,m),s(a,r(Ct,{get chosenStart(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"?t.slot.start:void 0},get startTimes(){return O(()=>t.slot.kind==="WAIT_FOR_CONFIRMATION")()?yt(e.daySections[t.slot.day]):[]},changeStart:p=>n("slot",{kind:"CHOOSE_END",start:p})}),$,S),s(a,r(Jt,{get chosenEnd(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"?t.slot.end:void 0},get endTimes(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"?e.daySections[t.slot.day][t.slot.start]??[]:[]},changeEnd:p=>{t.slot.kind==="WAIT_FOR_CONFIRMATION"&&n("slot",{kind:"WAIT_FOR_CONFIRMATION",day:t.slot.day,start:t.slot.start,end:p})}}),b,y),s(k,r(Z,{get label(){return`Slot "${t.slot.kind==="WAIT_FOR_CONFIRMATION"?`${x.days[t.slot.day]}, von ${t.slot.start} bis ${t.slot.end} Uhr`:""}" erstellen`},kind:"success",onClick:()=>{t.slot.kind==="WAIT_FOR_CONFIRMATION"&&l({uuid:crypto.randomUUID(),day:t.slot.day,from:t.slot.start,to:t.slot.end})}})),a}})]}})}})]}function rt(e){return[d(Di),(()=>{var t=d(Ui),n=t.firstChild,[i,l]=c(n.nextSibling),a=i.nextSibling,[o,u]=c(a.nextSibling);return s(t,r(Z,{get kind(){return e.chosenDay==="SATURDAY"?"success":"gray"},label:"Samstag",onClick:()=>e.changeDay("SATURDAY")}),i,l),s(t,r(Z,{get kind(){return e.chosenDay==="SUNDAY"?"success":"gray"},label:"Sonntag",onClick:()=>e.changeDay("SUNDAY")}),o,u),t})()]}function Ct(e){return[d(Oi),(()=>{var t=d(gn);return s(t,r(z,{get each(){return e.startTimes},children:n=>r(Z,{get kind(){return e.chosenStart===n?"success":"gray"},get label(){return(()=>{var i=d(mn),l=i.firstChild,[a,o]=c(l.nextSibling);return a.nextSibling,s(i,n,a,o),i})()},onClick:()=>e.changeStart(n)})})),t})()]}function Jt(e){return[d(Pi),(()=>{var t=d(gn);return s(t,r(z,{get each(){return e.endTimes},children:n=>r(Z,{get kind(){return e.chosenEnd===n?"success":"gray"},get label(){return(()=>{var i=d(mn),l=i.firstChild,[a,o]=c(l.nextSibling);return a.nextSibling,s(i,n,a,o),i})()},onClick:()=>e.changeEnd(n)})})),t})()]}function Gi(e){return e.toSorted((t,n)=>t.day!==n.day?t.day==="SATURDAY"?-1:1:t.from-n.from)}ot(["click"]);const Hi={version:1,init:{name:"",email:"",mobile:""},lastSaved:new Date().toISOString(),playing:{wantsUpdates:!0,reservations:[]},master:{games:[],wantsHelp:!1},helping:{},publishState:"draft"};async function Yi(e){const t=new URL(Fe("/rst25/load"));t.searchParams.append("secret",e);const n=await fetch(t);if(!n.ok)return{kind:"FAILURE"};const i=await n.json();return typeof i=="object"&&i!==null?{kind:"SUCCESS",data:Object.assign(Hi,i)}:(console.error("`last_save` not found on ",i),{kind:"FAILURE"})}async function Bi(e,t){try{const n=await fetch(Fe("/rst25/save"),{method:"post",body:JSON.stringify({secret:t,save:e}),headers:{"Content-Type":"application/json"}});return n.ok?{kind:"SUCCESS",data:t}:(console.error(await n.text()),{kind:"FAILURE"})}catch(n){return console.error(n),{kind:"FAILURE"}}}async function zi(){try{const e=await fetch(Fe("/rst25/program"),{headers:{"Content-Type":"application/json"}});return e.ok?{kind:"SUCCESS",data:await e.json()}:(console.error(await e.text()),{kind:"FAILURE"})}catch(e){return console.error(e),{kind:"FAILURE"}}}async function ji(e){try{const t=new URL(Fe("/rst25/reservations"));t.searchParams.append("secret",e);const n=await fetch(t);return n.ok?{kind:"SUCCESS",data:await n.json()}:(console.error(await n.text()),{kind:"FAILURE"})}catch(t){return console.error(t),{kind:"FAILURE"}}}async function Wi(e){try{const t=await fetch(Fe("/rst25/publishGameround"),{method:"post",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});return t.ok?{kind:"SUCCESS",data:e.gameroundUuid}:(console.error(await t.text()),{kind:"FAILURE"})}catch(t){return console.error(t),{kind:"FAILURE"}}}async function Zi(e){try{const t=await fetch(Fe("/rst25/sendGameroundUpdate"),{method:"post",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});return t.ok?{kind:"SUCCESS",data:e.gameroundUuid}:(console.error(await t.text()),{kind:"FAILURE"})}catch(t){return console.error(t),{kind:"FAILURE"}}}function Ki(e){return async()=>{await Wi(e)}}function Ji(e){return async()=>{await Zi(e)}}var Ve=g("<br>"),Vi=g("<div class=content><p>MÃ¶chtest du diese Spielrunde gerne verÃ¶ffentlichen?</p><!$><!/>"),qi=g("<em>Informationen zu den Anmeldungen mÃ¼ssen geladen werden..."),Qi=g("<em>Du kannst kein Update versenden, da sich noch niemand fÃ¼r diese Spielrunde angemeldet hat."),Xi=g("<p>An: <!$><!/>"),el=g("<em>Du kannst die Spielrunde nur lÃ¶schen, wenn du zuerst alle Zeitslots entfernt hast."),tl=g("<div class=content><p>Bist du sicher, dass du die Spielrunde lÃ¶schen mÃ¶chtest?</p><!$><!/>"),nl=g('<form novalidate><!$><!/><!$><!/><!$><!/><div style="display:grid;grid-template-columns:repeat(2, 1fr);gap:1rem;"><!$><!/><!$><!/></div><!$><!/><!$><!/><!$><!/><fieldset><legend>Kategorien (optional)</legend><!$><!/></fieldset><!$><!/><div style=display:flex;flex-wrap:wrap;gap:1rem;justify-content:space-between;><!$><!/><div style=display:flex;flex-wrap:wrap;gap:1rem;><!$><!/><!$><!/><!$><!/>'),rl=g("<h4>Spielrunde inkomplett"),il=g("<p>Du hast noch einen oder mehre Fehler/fehlende Informationen in dieser Spielrunde:"),ll=g("<li>Â«TitelÂ» ist ein Pflichtfeld."),al=g("<li>Â«kurz BeschreibungÂ» ist ein Pflichtfeld."),sl=g("<li>Â«kurz BeschreibungÂ» ist zu lang."),ol=g("<li>Â«lange BeschreibungÂ» ist zu lang."),dl=g("<li>Mindest einen Zeitslot muss ausgewÃ¤hlt werden."),ul=g("<ul><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),cl=g("<p><strong>ErklÃ¤rung:</strong> Hast du eine wichtige Ãnderung an dieser Spielrunde durchgefÃ¼hrt, wÃ¤hrend bereits Spielende angemeldet waren? Lass hiermit die Angemeldeten wissen, was du geÃ¤ndert hast. Wichtige Ãnderungen kÃ¶nnen sein: System geÃ¤ndert, Kategorien geÃ¤ndert. FÃ¼r kleine Ãnderungen, wie z.B. Rechtschreibfehler, sollte dies nicht genutzt werden."),gl=g("<p><em>Halte dich kurz und am besten Stichwortartig."),ml=g("<form><!$><!/><!$><!/>"),hl=g("<div style=display:grid;gap:0.5rem;margin-block-end:1rem;>");function $l(e){const t=e.allRounds.find(n=>n.uuid===e.uuid);return r(E,{get fallback(){return e.fallback},when:t,children:n=>e.children(n())})}function Sl(e){const[t,n]=T(e.store),[i,l]=T({delete:Ae(),publish:Ae(),sendUpdate:Ae()});function a(u){u.preventDefault(),l("publish","open",!0)}function o(){e.changePage({kind:"GAMEMASTER"})}return[r(an,{kind:"special",get children(){return["Status: ",O(()=>x.publishingSteps[t.kind])]}}),d(Ve),d(Ve),r(vl,{store:t,get registrations(){return e.registrations},onSubmit:a,onCancel:()=>l("delete","open",!0),onSendUpdate:()=>l("sendUpdate","open",!0),goBack:o,get isEditable(){return e.isEditable}}),r(_l,{get store(){return i.publish},get title(){return t.title.value},onPublish:()=>{n("kind","published"),l("publish","open",!1),e.queue.enqueue(Ki({secret:e.secret,gameroundUuid:t.uuid}))}}),r(bl,{get store(){return i.sendUpdate},get players(){return xl(e.registrations,t.slots.map(u=>u.uuid))},onSend:u=>{e.queue.enqueue(Ji({update:u,slotUuids:t.slots.map(m=>m.uuid),gameroundUuid:t.uuid}))}}),r(fl,{get store(){return i.delete},get hasSlots(){return t.slots.length!==0},get title(){return t.title.value},onDelete:()=>{n("kind","archived"),e.changePage({kind:"GAMEMASTER"})}})]}function _l(e){return r(Ue,{get store(){return e.store},title:"Spielrunde verÃ¶ffentlichen",onClose:()=>{},get children(){var t=d(Vi),n=t.firstChild,i=n.nextSibling,[l,a]=c(i.nextSibling);return s(t,r(B,{kind:"success",icon:"circle-plus",get label(){return`Ja, bitte "${e.title||"["+x.missingTitle+"]"}" verÃ¶ffentlichen.`},get onClick(){return e.onPublish}}),l,a),t}})}function bl(e){return r(Ue,{get store(){return e.store},title:"Update senden",onClose:()=>{},size:"medium",get children(){return()=>e.players.kind==="LOADING"?d(qi):e.players.kind==="ERROR"?O(()=>x.error.general):e.players.data.length===0?d(Qi):[(()=>{var t=d(Xi),n=t.firstChild,i=n.nextSibling,[l,a]=c(i.nextSibling);return s(t,()=>e.players.data.map(o=>o.name).join(", "),l,a),t})(),d(Ve),r(yl,{get onSend(){return e.onSend}})]}})}function fl(e){return r(Ue,{get store(){return e.store},title:"Spielrunde lÃ¶schen",onClose:()=>{},get children(){return[r(E,{get when(){return e.hasSlots},get children(){return d(el)}}),r(E,{get when(){return!e.hasSlots},get children(){var t=d(tl),n=t.firstChild,i=n.nextSibling,[l,a]=c(i.nextSibling);return s(t,r(B,{kind:"danger",icon:"trash",get label(){return`Ja, bitte "${e.title||"["+x.missingTitle+"]"}" lÃ¶schen.`},get onClick(){return e.onDelete}}),l,a),t}})]}})}function vl(e){const[t]=T(e.store),n=st(()=>Sr(t));return(()=>{var i=d(nl),l=i.firstChild,[a,o]=c(l.nextSibling),u=a.nextSibling,[m,h]=c(u.nextSibling),$=m.nextSibling,[S,_]=c($.nextSibling),b=S.nextSibling,y=b.firstChild,[k,p]=c(y.nextSibling),w=k.nextSibling,[P,N]=c(w.nextSibling),I=b.nextSibling,[j,L]=c(I.nextSibling),M=j.nextSibling,[X,te]=c(M.nextSibling),K=X.nextSibling,[F,ee]=c(K.nextSibling),W=F.nextSibling,le=W.firstChild,ae=le.nextSibling,[G,ne]=c(ae.nextSibling),J=W.nextSibling,[V,me]=c(J.nextSibling),D=V.nextSibling,oe=D.firstChild,[de,ue]=c(oe.nextSibling),q=de.nextSibling,Se=q.firstChild,[fe,xe]=c(Se.nextSibling),ve=fe.nextSibling,[_e,he]=c(ve.nextSibling),pe=_e.nextSibling,[Ee,A]=c(pe.nextSibling);return s(i,r(E,{get when(){return t.kind==="published"},get children(){return r(Vt,{get errors(){return n()}})}}),a,o),s(i,r(Ze,{get store(){return t.title},label:"Titel",name:"title",get showErrors(){return t.kind==="published"?"ALWAYS":"ON_BLUR"},get errors(){return n().titleMissing?[x.mandatoryField]:[]},get disabled(){return!e.isEditable}}),m,h),s(i,r(Ze,{get store(){return t.system},label:"System (optional)",name:"System",get disabled(){return!e.isEditable}}),S,_),s(b,r(Mt,{get store(){return t.playerCount.min},label:"Anzahl Mitspielende (Minimum)",name:"playerCountMin",min:1,get max(){return t.playerCount.max.value},get disabled(){return!e.isEditable}}),k,p),s(b,r(Mt,{get store(){return t.playerCount.max},label:"Anzahl Mitspielende (Maximum)",name:"playerCountMax",get min(){return t.playerCount.min.value},get disabled(){return!e.isEditable}}),P,N),s(i,r(Rt,{get store(){return t.description.short},label:"kurze Beschreibung",name:"descriptionShort",size:"small",get showErrors(){return t.kind==="published"?"ALWAYS":"ON_BLUR"},get errors(){return O(()=>!!n().descriptionShortMissing)()?[x.mandatoryField]:O(()=>!!n().descriptionShortTooLong)()?[x.charLimitBy.replace("{}",String(mt))]:[]},get disabled(){return!e.isEditable}}),j,L),s(i,r(Rt,{get store(){return t.description.long},label:"lange Beschreibung (optional)",name:"descriptionLong",get showErrors(){return t.kind==="published"?"ALWAYS":"ON_BLUR"},get errors(){return O(()=>!!n().descriptionLongTooLong)()?[x.charLimitBy.replace("{}",String(un))]:[]},get disabled(){return!e.isEditable}}),X,te),s(i,r(Ni,{get store(){return e.store.slots},get registrations(){return e.registrations},get slotMissing(){return n().slotMissing},get isEditable(){return e.isEditable}}),F,ee),s(W,r(kl,{get store(){return t.tagNames},get isEditable(){return e.isEditable}}),G,ne),s(i,r(Vt,{get errors(){return n()}}),V,me),s(D,r(B,{icon:"backward",label:"ZurÃ¼ck zu deinen Spielrunden",get onClick(){return e.goBack}}),de,ue),s(q,r(E,{get when(){return t.kind!=="archived"},get children(){return r(B,{icon:"trash",kind:"danger",label:"LÃ¶schen",onClick:()=>e.onCancel(),get disabled(){return!e.isEditable}})}}),fe,xe),s(q,r(E,{get when(){return t.kind==="draft"},get children(){return r(B,{icon:"circle-plus",get kind(){return n().hasErrors?"gray":"success"},get disabled(){return n().hasErrors||!e.isEditable},label:"Spielrunde verÃ¶ffentlichen",get onClick(){return n().hasErrors?void 0:e.onSubmit}})}}),_e,he),s(q,r(E,{get when(){return t.kind==="published"},get children(){return r(B,{icon:"circle-plus",kind:"success",label:"Update an Spielende schicken",get onClick(){return e.onSendUpdate},get disabled(){return!e.isEditable}})}}),Ee,A),i})()}function Vt(e){return r(E,{get when(){return e.errors.hasErrors},get children(){return r(C,{type:"danger",get children(){return[d(rl),d(il),(()=>{var t=d(ul),n=t.firstChild,[i,l]=c(n.nextSibling),a=i.nextSibling,[o,u]=c(a.nextSibling),m=o.nextSibling,[h,$]=c(m.nextSibling),S=h.nextSibling,[_,b]=c(S.nextSibling),y=_.nextSibling,[k,p]=c(y.nextSibling);return s(t,r(E,{get when(){return e.errors.titleMissing},get children(){return d(ll)}}),i,l),s(t,r(E,{get when(){return e.errors.descriptionShortMissing},get children(){return d(al)}}),o,u),s(t,r(E,{get when(){return e.errors.descriptionShortTooLong},get children(){return d(sl)}}),h,$),s(t,r(E,{get when(){return e.errors.descriptionLongTooLong},get children(){return d(ol)}}),_,b),s(t,r(E,{get when(){return e.errors.slotMissing},get children(){return d(dl)}}),k,p),t})()]}})}})}function yl(e){const[t,n]=T({updateText:{value:"",isDirty:!1},hasBeenSent:!1}),i=st(()=>_r(t));return r($e,{get fallback(){return r(C,{type:"success",children:"Nachricht wurde registriert und wird in den nÃ¤chsten 24 Stunden an die Spielenden verschickt."})},get children(){return r(R,{get when(){return!t.hasBeenSent},get children(){return[d(cl),d(Ve),d(gl),d(Ve),(()=>{var l=d(ml),a=l.firstChild,[o,u]=c(a.nextSibling),m=o.nextSibling,[h,$]=c(m.nextSibling);return Ke(l,"novalidate",!0),s(l,r(Rt,{get store(){return t.updateText},label:"Zusammenfassung der Ãnderung",name:"updateText",size:"small",showErrors:"ALWAYS",get errors(){return O(()=>!!i().missing)()?[x.mandatoryField]:O(()=>!!i().tooLong)()?[x.charLimitBy.replace("{}",String(cn))]:[]}}),o,u),s(l,r(B,{icon:"paper-plane",label:"Spielende informieren",get kind(){return i().hasErrors?"gray":"success"},get disabled(){return i().hasErrors},get onClick(){return i().hasErrors?void 0:()=>{e.onSend(t.updateText.value),n("hasBeenSent",!0)}}}),h,$),l})()]}})}})}function kl(e){const[t,n]=T(e.store);return[(()=>{var i=d(hl);return s(i,r(z,{each:Qe,children:l=>r(Dt,{get label(){return l.label},get description(){return l.description},get checked(){return t.includes(l.name)},get name(){return l.name},get value(){return l.name},onValueUpdate:a=>{n(a?t.concat([l.name]):t.filter(o=>o!==l.name))},get disabled(){return!e.isEditable}})})),i})(),r(C,{get children(){return x.tagIdeas}})]}const xl=(e,t)=>{if(e.loading)return{kind:"LOADING"};if(e.error)return{kind:"ERROR"};const n=e();return n===void 0||n.kind==="FAILURE"?{kind:"ERROR"}:{kind:"SUCCESS",data:n.data.filter(i=>t.includes(i.uuid))}},pl=rn("kind",[v({kind:U("CHOOSE"),uuid:Be()}),v({kind:U("PLAYER"),uuid:Be()}),v({kind:U("GAME"),uuid:f().uuid()}),v({kind:U("GAMEMASTER"),uuid:Be()}),v({kind:U("HELPING"),uuid:Be()}),v({kind:U("SUMMARY"),uuid:Be()}),v({kind:U("EDIT_GAMEROUND"),uuid:f().uuid()})]);rn("kind",[v({kind:U("CHOOSE")}),v({kind:U("PLAYER")}),v({kind:U("GAME"),uuid:f().uuid()}),v({kind:U("GAMEMASTER")}),v({kind:U("HELPING")}),v({kind:U("SUMMARY")}),v({kind:U("EDIT_GAMEROUND"),uuid:f().uuid()})]);const El=ct(["SAVING","IDLE","ERROR"]),Cl=v({saveState:El,page:pl,secret:f(),showCreateMessage:Le(),isDebugging:Le()});function hn(e){const t=e.searchParams.get("page")??"",n=e.searchParams.get("uuid")??null,i=e.searchParams.get("secret")??"",l=e.searchParams.get("showCreateMessage")==="true",a=e.searchParams.get("debug")==="true",o=Cl.safeParse({saveState:"IDLE",page:{kind:t.toUpperCase(),uuid:n},secret:i,showCreateMessage:l,isDebugging:a});return o.success?o.data:{saveState:"IDLE",page:{kind:"CHOOSE",uuid:null},secret:i,showCreateMessage:l,isDebugging:a}}function wl(e,t){return e.kind!==t.kind?!1:e.kind==="EDIT_GAMEROUND"&&t.kind==="EDIT_GAMEROUND"||e.kind==="GAME"&&t.kind==="GAME"?e.uuid===t.uuid:!0}const Rl="2024-08-15T07:45:21.335Z",be={game:"37831e19-29d6-40bd-b99d-fb91b78aa7f9",slot:"bfcbd156-b703-4664-9944-8936aede8476",slot2:"f58e7242-e1ff-4cfc-a992-ca18dd5207c3",program:"16f387ab-0adf-406b-ba5c-2e4eb200fda8",program2:"11b6b38a-a4d3-40ed-9d4a-d2abcab661a5",program3:"5294bc63-4857-404e-b72d-53ecbd87a27b",program4:"6e9477f1-6dd5-4cd7-b3c3-03085022d967"};function Al(e,t){const n=localStorage.getItem(e);return n===null?t:n}function Tl(e,t){localStorage.setItem(e,t)}const $n="SAVE",Dl={version:1,init:{name:"John Doe",email:"john@doe.ch",mobile:"+41 66 123 45 67"},lastSaved:Rl,playing:{wantsUpdates:!1,reservations:[]},master:{games:[{uuid:be.game,kind:"published",title:"Grolle in der Dunkelheit",system:"Warhammer Fantasy Rollenspiel",description:{short:"Ein kurzes Abenteuer bei dem es um Fantasy, Action und einfaches Rollenspiel geht.",long:"Eine kleine Gruppe wagt sich in die dunklen SchÃ¤chten einer Mine und weiter hinab, um einen mÃ¤chtigen Gegenstand wieder zu erlangen. Wie werden die GefÃ¤hrten auf die Gefahren des Untergrundes reagieren und welche Gefahren lauern in der Finsternis?"},slots:[{uuid:be.slot,day:"SATURDAY",from:10,to:12},{uuid:be.slot2,day:"SUNDAY",from:14,to:17}],playerCount:{min:1,max:3},tagNames:["deutsch"]}],wantsHelp:!1},helping:{},publishState:"published"};async function Ul(){return new Promise(e=>setTimeout(()=>e({kind:"SUCCESS",data:JSON.parse(Al($n,JSON.stringify(Dl)))}),1e3))}async function Ol(e,t){return new Promise(n=>setTimeout(()=>(Tl($n,JSON.stringify(e)),n({kind:"SUCCESS",data:t})),1e3))}const Pl=[{uuid:be.program,gamemaster:"Game Master",title:"Grolle in der Dunkelheit",system:"Warhammer Fantasy Rollenspiel",description:{short:"Ein kurzes Abenteuer bei dem es um Fantasy, Action und einfaches Rollenspiel geht.",long:"Eine kleine Gruppe wagt sich in die dunklen SchÃ¤chten einer Mine und weiter hinab, um einen mÃ¤chtigen Gegenstand wieder zu erlangen. Wie werden die GefÃ¤hrten auf die Gefahren des Untergrundes reagieren und welche Gefahren lauern in der Finsternis?"},slot:{day:"SATURDAY",from:10,to:13},playerCount:{min:1,max:3,reserved:0},tags:["ab12jahren"]},{uuid:be.program2,gamemaster:"Other Game Master",title:"Acrimony",system:"D&D",description:{short:"Ein Lo-Fi Space Western Abenteuer",long:'Ein Lo-Fi Space Western Abenteuer: "Eine frisch formierte Gruppe von KopfgeldjÃ¤gern wird mit einer riskanten Mission betraut: Sie mÃ¼ssen den berÃ¼chtigten Outlaw Jeb "Rusty" Rourke in der abgeschiedenen Grenzstadt aufspÃ¼ren. Bei dieser unbarmherzigen Jagd lernen die Spieler die harte RealitÃ¤t der Kopfgeldjagd kennen, wo jeder Schuss und jede Entscheidung Ã¼ber ihr Schicksal entscheidet.'},slot:{day:"SATURDAY",from:10,to:13},playerCount:{min:2,max:8,reserved:3},tags:["ab12jahren","horror"]},{uuid:be.program3,gamemaster:"Other Game Master",title:"Acrimony",system:"D&D",description:{short:"Ein Lo-Fi Space Western Abenteuer",long:'Ein Lo-Fi Space Western Abenteuer: "Eine frisch formierte Gruppe von KopfgeldjÃ¤gern wird mit einer riskanten Mission betraut: Sie mÃ¼ssen den berÃ¼chtigten Outlaw Jeb "Rusty" Rourke in der abgeschiedenen Grenzstadt aufspÃ¼ren. Bei dieser unbarmherzigen Jagd lernen die Spieler die harte RealitÃ¤t der Kopfgeldjagd kennen, wo jeder Schuss und jede Entscheidung Ã¼ber ihr Schicksal entscheidet.'},slot:{day:"SATURDAY",from:14,to:18},playerCount:{min:2,max:8,reserved:3},tags:["ab12jahren","horror"]},{uuid:be.program4,gamemaster:"Some Other Game Master",title:"Solo RPGs",system:"",description:{short:"Wir spielen primÃ¤r das Solo Rollenspiel NoteQuest, werden aber kurz auch noch ein paar andere Solo Rollenspiele miteinander anschauen.",long:""},slot:{day:"SATURDAY",from:14,to:18},playerCount:{min:2,max:4,reserved:3},tags:[]}];async function Nl(){return new Promise(e=>setTimeout(()=>e({kind:"SUCCESS",data:Pl}),5e3))}const Ml=[{uuid:be.slot,name:"Alice"},{uuid:be.slot,name:"Bob"}];async function Il(e){return new Promise(t=>setTimeout(()=>t({kind:"SUCCESS",data:Ml.filter(n=>e.includes(n.uuid))}),5e3))}var Ll=g("<div aria-atomic=true><!$><!/><!$><!/>"),Fl=g("<div class=toast-container aria-live=polite aria-atomic=true>");const[ke,qe]=T([]);function Gl(e){const t=()=>{const n=["toast"];return e.options.kind!==void 0&&n.push(`toast-${e.options.kind}`),n.join(" ")};return(()=>{var n=d(Ll),i=n.firstChild,[l,a]=c(i.nextSibling),o=l.nextSibling,[u,m]=c(o.nextSibling);return s(n,()=>e.options.message,l,a),s(n,r(E,{get when(){return e.options.dismissable},get children(){return r(Z,{kind:"ghost",get label(){return r(re,{icon:"xmark",classes:["toast-dismiss"]})},get onClick(){return e.dismiss}})}}),u,m),ge(h=>{var $=t(),S=e.options.kind==="danger"?"alert":"status",_=e.options.kind==="danger"?"assertive":"polite";return $!==h.e&&De(n,h.e=$),S!==h.t&&at(n,"role",h.t=S),_!==h.a&&at(n,"aria-live",h.a=_),h},{e:void 0,t:void 0,a:void 0}),n})()}function Hl(){function e(t){ke.find(n=>n.uuid===t)?.cleanup(),qe(ke.filter(n=>n.uuid!==t))}return(()=>{var t=d(Fl);return s(t,r(z,{each:ke,children:n=>r(Gl,{options:n,dismiss:()=>e(n.uuid)})})),t})()}function Sn(e,t){if(t?.uuid!==void 0&&ke.find(u=>u.uuid===t.uuid)!==void 0)return At(t.uuid,e,t);const n=t?.uuid??crypto.randomUUID(),i=t?.duration??5e3,l=t?.kind??"gray",a=t?.dismissable??!0,o=setTimeout(()=>{qe(ke.filter(u=>u.uuid!==n))},i);return qe(ke.length,{uuid:n,kind:l,message:e,duration:i,dismissable:a,cleanup:()=>clearTimeout(o)}),n}function At(e,t,n){const i=ke.find(m=>m.uuid===e);if(i===void 0)return e;i.cleanup();const l=n.duration??i.duration,a=n.kind??i.kind,o=n?.dismissable??i.dismissable,u=setTimeout(()=>{qe(ke.filter(m=>m.uuid!==e))},l);return qe(m=>m.uuid===e,{uuid:e,kind:a,message:t,duration:l,dismissable:o,cleanup:()=>clearTimeout(u)}),e}const Yl=v({name:f(),email:f(),mobile:f()}),Bl=v({name:f(),email:f(),mobile:f()}),zl=Ut([v({kind:U("SELF"),gameRound:f().uuid(),uuid:f().uuid()}),v({kind:U("FRIEND"),gameRound:f().uuid(),name:f(),uuid:f().uuid()})]),jl=v({wantsUpdates:Le(),reservations:ie(zl)}),Wl=Ut([v({kind:U("SELF"),gameRound:f().uuid(),uuid:f().uuid()}),v({kind:U("FRIEND"),gameRound:f().uuid(),name:f(),uuid:f().uuid()})]);Ut([v({kind:U("SELF"),gameRound:f().uuid()}),v({kind:U("FRIEND"),gameRound:f().uuid(),name:f()})]);const Zl=v({wantsUpdates:Le(),reservations:ie(Wl)}),Kl=v({games:ie(gr),wantsHelp:Le()}),Jl=v({games:ie(dn),wantsHelp:Le()}),Vl=v({}),ql=v({}),Ql=v({version:U(1),init:Yl,lastSaved:f(),playing:jl,master:Kl,helping:Vl,publishState:gt}),Xl=v({version:U(1),init:Bl,lastSaved:In.date(),playing:Zl,master:Jl,helping:ql,publishState:gt});async function ea(e){const t=e==="demo"?await Ul():await Yi(e);if(t.kind==="FAILURE")return console.error("Unexpected error. Maybe network, maybe server error."),{kind:"FAILURE"};const n=Ql.safeParse(t.data);if(!n.success)return console.error(n.error),{kind:"FAILURE"};const i=ta(n.data);return i.success?{kind:"SUCCESS",data:i.data}:{kind:"FAILURE"}}function ta(e){return Xl.safeParse(e)}const wt=crypto.randomUUID();async function na(e,t,n){const[i,l]=T(e);l("saveState","SAVING"),Sn("Am Speichern...",{uuid:wt,dismissable:!1});const a=new Date;t.lastSaved=a;const o=ra(t);try{if((n==="demo"?await Ol(o,n):await Bi(o,n)).kind==="FAILURE")throw Error("")}catch(u){return l("saveState","ERROR"),console.error(u),At(wt,"Speichern war nicht mÃ¶glich!",{kind:"danger",duration:1e4,dismissable:!0}),{kind:"FAILURE"}}return At(wt,`Zuletzt gespeichert um: ${en(a)} Uhr`,{kind:"success",dismissable:!0}),l("saveState","IDLE"),{kind:"SUCCESS",data:a}}function ra(e){return{...e,lastSaved:String(e.lastSaved),master:{...e.master,games:e.master.games.map($r)}}}const ia=Dn(na,1e3);var la=g("<div class=tooltip-wrapper><div class=tooltip></div><!$><!/>");function je(e){return(()=>{var t=d(la),n=t.firstChild,i=n.nextSibling,[l,a]=c(i.nextSibling);return s(n,()=>e.tooltip),s(t,()=>e.children,l,a),t})()}var aa=g("<div class=quickmenu-wrapper><div class=quickmenu><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),sa=g('<div class="quickmenu extended"><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>'),oa=g("<div style=margin-block-start:1rem;display:flex;gap:0.5rem;align-items:center;><!$><!/><em>Zuletzt gespeichert um: <!$><!/> Uhr"),da=g("<div style=margin-block-start:1rem;display:flex;gap:0.5rem;align-items:center;><!$><!/><em>Am Speichern..."),ua=g("<div style=margin-block-start:1rem;display:flex;gap:0.5rem;align-items:center;><!$><!/><em>Speichern war nicht mÃ¶glich!");function ca(e){return(()=>{var t=d(aa),n=t.firstChild,i=n.firstChild,[l,a]=c(i.nextSibling),o=l.nextSibling,[u,m]=c(o.nextSibling),h=u.nextSibling,[$,S]=c(h.nextSibling),_=$.nextSibling,[b,y]=c(_.nextSibling),k=b.nextSibling,[p,w]=c(k.nextSibling);return s(n,r(je,{tooltip:"Zur Ãbersicht",get children(){return r(Z,{get label(){return r(re,{icon:"backward"})},onClick:()=>e.changePage({kind:"CHOOSE"})})}}),l,a),s(n,r(je,{tooltip:"Zu den Spielrunden",get children(){return r(Z,{get label(){return r(re,{icon:"dice-d20"})},onClick:()=>e.changePage({kind:"PLAYER"})})}}),u,m),s(n,r(je,{tooltip:"Zu deinen Spielrunden",get children(){return r(Z,{get label(){return r(re,{icon:"grid-2-plus"})},onClick:()=>e.changePage({kind:"GAMEMASTER"})})}}),$,S),s(n,r(je,{tooltip:"Zum Helferplan",get children(){return r(Z,{get label(){return r(re,{icon:"hand-heart"})},onClick:()=>e.changePage({kind:"HELPING"})})}}),b,y),s(n,r(je,{tooltip:"Zur Zusammenfassung",get children(){return r(Z,{get label(){return r(re,{icon:"list"})},onClick:()=>e.changePage({kind:"SUMMARY"})})}}),p,w),t})()}function ga(e){return[r(C,{type:"gray",get children(){var t=d(sa),n=t.firstChild,[i,l]=c(n.nextSibling),a=i.nextSibling,[o,u]=c(a.nextSibling),m=o.nextSibling,[h,$]=c(m.nextSibling),S=h.nextSibling,[_,b]=c(S.nextSibling),y=_.nextSibling,[k,p]=c(y.nextSibling);return s(t,r(B,{icon:"backward",label:"Zur Ãbersicht",onClick:()=>e.changePage({kind:"CHOOSE"})}),i,l),s(t,r(B,{icon:"dice-d20",label:"Zu den Spielrunden",onClick:()=>e.changePage({kind:"PLAYER"})}),o,u),s(t,r(B,{icon:"grid-2-plus",label:"Zu deinen Spielrunden",onClick:()=>e.changePage({kind:"GAMEMASTER"})}),h,$),s(t,r(B,{icon:"hand-heart",label:"Zum Helferplan",onClick:()=>e.changePage({kind:"HELPING"})}),_,b),s(t,r(B,{icon:"list",label:"Zur Zusammenfassung",onClick:()=>e.changePage({kind:"SUMMARY"})}),k,p),t}}),r(ma,{get saveState(){return e.saveState},get lastSaved(){return e.lastSaved}})]}function ma(e){return r($e,{get children(){return[r(R,{get when(){return e.saveState==="IDLE"},get children(){var t=d(oa),n=t.firstChild,[i,l]=c(n.nextSibling),a=i.nextSibling,o=a.firstChild,u=o.nextSibling,[m,h]=c(u.nextSibling);return m.nextSibling,s(t,r(re,{icon:"circle-check"}),i,l),s(a,()=>en(e.lastSaved),m,h),t}}),r(R,{get when(){return e.saveState==="SAVING"},get children(){var t=d(da),n=t.firstChild,[i,l]=c(n.nextSibling);return i.nextSibling,s(t,r(re,{icon:"floppy-disk-circle-arrow-right"}),i,l),t}}),r(R,{get when(){return e.saveState==="ERROR"},get children(){var t=d(ua),n=t.firstChild,[i,l]=c(n.nextSibling);return i.nextSibling,s(t,r(re,{icon:"triangle-exclamation"}),i,l),t}})]}})}var ha=g("<div class=page><!$><!/><div class=page-content><h2></h2><br><!$><!/></div><!$><!/>"),$a=g("<div class=extended-wrapper style=margin-block-start:1rem;>");function Me(e){return(()=>{var t=d(ha),n=t.firstChild,[i,l]=c(n.nextSibling),a=i.nextSibling,o=a.firstChild,u=o.nextSibling,m=u.nextSibling,[h,$]=c(m.nextSibling),S=a.nextSibling,[_,b]=c(S.nextSibling);return s(t,(()=>{var y=O(()=>e.showQuickmenu!==!1);return()=>y()?r(ca,{get changePage(){return e.changePage},get saveState(){return e.saveState},get lastSaved(){return e.lastSaved}}):null})(),i,l),s(o,()=>e.title),s(a,()=>e.children,h,$),s(t,(()=>{var y=O(()=>e.showQuickmenu!==!1);return()=>y()?(()=>{var k=d($a);return s(k,r(ga,{get changePage(){return e.changePage},get saveState(){return e.saveState},get lastSaved(){return e.lastSaved}})),k})():null})(),_,b),t})()}const Sa=v({uuid:f().uuid(),name:f()}),_n=ie(Sa),_a=_n;async function ba(e,t){const n=e==="demo"?await Il(t):await ji(e);if(n.kind==="FAILURE")return console.error("Unexpected error. Maybe network, maybe server error."),{kind:"FAILURE"};const i=_n.safeParse(n.data);if(!i.success)return{kind:"FAILURE"};const l=fa(i.data);return l.success?{kind:"SUCCESS",data:l.data}:{kind:"FAILURE"}}function fa(e){return _a.safeParse(e)}const va=v({uuid:f().uuid(),title:f(),system:f(),gamemaster:f(),description:v({short:f(),long:f()}),slot:v({day:Pt,from:Q(),to:Q()}),playerCount:v({min:Q(),max:Q(),reserved:Q()}),tags:ie(f())}),ya=ie(va),ka=v({uuid:f().uuid(),title:f(),system:f(),gamemaster:f(),description:v({short:f(),long:f()}),slot:v({day:Pt,from:Q(),to:Q()}),playerCount:v({min:Q(),max:Q(),reserved:Q()}),tags:ie(f())}),xa=ie(ka);async function pa(e){const t=e==="demo"?await Nl():await zi();if(t.kind==="FAILURE")return console.error("Unexpected error. Maybe network, maybe server error."),{kind:"FAILURE"};const n=ya.safeParse(t.data);if(!n.success)return{kind:"FAILURE"};const i=Ea(n.data);return i.success?{kind:"SUCCESS",data:i.data}:{kind:"FAILURE"}}function Ea(e){return xa.safeParse(e)}var qt=g("<br>"),Qt=g("<pre>"),Ca=g("<hr>"),wa=g("<div><code>Reservations (read-only)"),Ra=g("<em>loading...");function Aa(e){const t=new URL(location.href);t.searchParams.set("page",e.page.kind.toLowerCase()),e.page.kind==="EDIT_GAMEROUND"&&t.searchParams.set("uuid",e.page.uuid),t.searchParams.delete("showCreateMessage"),history.replaceState({page:e},"",t);const n=x.pageTitle[e.page.kind];document.title=x.metaTitle.replace("{}",n)}function Ta(e){const[t,n]=T(e.page);return(i,l)=>{if(wl(i,t))return;const a=l?.backButton??!1,o=l?.disableScroll??!1,u=new URL(location.href);u.searchParams.set("page",i.kind.toLowerCase()),i.kind==="EDIT_GAMEROUND"||i.kind==="GAME"?(u.searchParams.set("uuid",i.uuid),n(i)):(u.searchParams.delete("uuid"),n({...i,uuid:null})),a||history.pushState({page:i},"",u);const m=x.pageTitle[i.kind];document.title=x.metaTitle.replace("{}",m),o||window.scrollTo({top:0})}}function Da(e){Aa(e.meta);const[t,n]=T({meta:e.meta,save:e.save}),i=()=>t.save.master.games.flatMap(S=>S.slots.map(_=>_.uuid)),[l]=it(i(),S=>ba(t.meta.secret,S)),[a]=it(()=>pa(t.meta.secret)),o=crypto.randomUUID(),[u,m]=Tt(!1);it(()=>JSON.stringify(t.save),async()=>{if(!u()){m(!0);return}if(t.save.publishState!=="published"){Sn("Diese Anmeldung wurde deaktiviert und kann nicht editiert werden.",{kind:"danger",uuid:o});return}const S=We(t.save);try{const _=await ia(t.meta,S,t.meta.secret);_.kind==="FAILURE"?console.error(_):n("save","lastSaved",_.data)}catch(_){console.error(_),n("meta","saveState","ERROR")}});const h=Ta(t.meta),$=Un();return nn(()=>{window.addEventListener("popstate",S=>{if(typeof S=="object"&&S!==null&&"state"in S){const _=new URL(location.href),b=hn(_);h(b.page,{backButton:!0})}}),setInterval(async()=>{const S=$.dequeue();S.kind==="NEXT_ELEMENT"&&await S.data()},1e3)}),[r(E,{get when(){return t.meta.showCreateMessage},get children(){return[r(C,{type:"success",get children(){return x.registrationStarted}}),d(qt)]}}),r(E,{get when(){return t.save.publishState!=="published"},get children(){return[r(C,{type:"danger",children:"Diese Anmeldung wurde deaktiviert. Sollte dies ein Fehler sein, kontaktiere uns bitte."}),d(qt)]}}),r($e,{get fallback(){return r(Me,{title:"Wo mÃ¶chtest du starten?",showQuickmenu:!1,changePage:h,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r(Si,{changePage:h,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get isDebugging(){return t.meta.isDebugging}})}})},get children(){return[r(R,{get when(){return t.meta.page.kind==="PLAYER"||t.meta.page.kind==="GAME"},get children(){return r(Me,{title:"SpielrundenÃ¼bersicht",changePage:h,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r(ii,{get store(){return t.save.playing},program:a,get uuid(){return t.meta.page.kind==="GAME"?t.meta.page.uuid:null},get isEditable(){return t.save.publishState==="published"},changePage:h,get isDebugging(){return t.meta.isDebugging}})}})}}),r(R,{get when(){return t.meta.page.kind==="GAMEMASTER"},get children(){return r(Me,{title:"Meine Spielrunden",changePage:h,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r(xr,{get store(){return t.save.master},get isEditable(){return t.save.publishState==="published"},changePage:h})}})}}),r(R,{get when(){return t.meta.page.kind==="EDIT_GAMEROUND"},get children(){return r(Me,{title:"Spielrunde editieren",changePage:h,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r($l,{get allRounds(){return t.save.master.games},get uuid(){return t.meta.page.kind==="EDIT_GAMEROUND"?t.meta.page.uuid:"should never happen"},get fallback(){return r(C,{type:"danger",get children(){return x.error.gameroundUuidError}})},children:S=>r(Sl,{store:S,registrations:l,queue:$,get isEditable(){return t.save.publishState==="published"},changePage:h,get secret(){return t.meta.secret}})})}})}}),r(R,{get when(){return t.meta.page.kind==="HELPING"},get children(){return r(Me,{title:"Helfen",changePage:h,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r(dr,{})}})}}),r(R,{get when(){return t.meta.page.kind==="SUMMARY"},get children(){return r(Me,{title:"Zusammenfassung",changePage:h,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r(rr,{get store(){return t.save},program:a,get isEditable(){return t.save.publishState==="published"},changePage:h})}})}})]}}),r(E,{get when(){return t.meta.isDebugging},get children(){return[(()=>{var S=d(Qt);return s(S,()=>JSON.stringify(t,null,2)),S})(),d(Ca),d(wa),r(ut,{get fallback(){return d(Ra)},get children(){return r(E,{get when(){return l()},children:S=>(()=>{var _=d(Qt);return s(_,()=>JSON.stringify(S(),null,2)),_})()})}})]}}),r(Hl,{})]}function bn(){return r(C,{get children(){return x.loading.registration}})}function Fa(){const[e,t]=Tt(null);return nn(()=>{const n=new URL(location.href);t(hn(n))}),r(E,{get fallback(){return r(bn,{})},get when(){return e()},children:n=>r(Ua,{get page(){return n()}})})}function Ua(e){const[t]=it(()=>ea(e.page.secret));return r(Nn,{fallback:n=>(console.error(n),r(C,{type:"danger",get children(){return x.error.general}})),get children(){return r(ut,{get fallback(){return r(bn,{})},get children(){return r($e,{get children(){return r(R,{get when(){return t()},children:n=>{const{kind:i,value:l}=On(n());return i==="SECRET_INVALID"?r(C,{type:"danger",get children(){return x.error.secretError}}):i==="FAILURE"?(console.error(l),r(C,{type:"danger",get children(){return x.error.ourMistake}})):r(Da,{get meta(){return e.page},get save(){return l.data}})}})}})}})}})}export{Fa as MeineAnmeldungWrapper};
