import{g as a,c as s,t as o,i as m,S as ne,a as h,b as H,s as je,e as Q,d as We,f as Ze,k as g,j as de,r as V,l as q,h as j,M as W,n as ue,E as Ke}from"./web.rQZjh9gh.js";import{I as ge,B as U,a as Je,S as he}from"./Box.C2zLLvCz.js";import{e as fe,a as Z,o as D,s as _,b as Y,n as C,c as qe,l as _e,u as Se,d as Re}from"./index.CHtXok7j.js";import{c as Qe}from"./store.D7njCBRK.js";var Xe=o("<h2>Kontaktdaten"),et=o("<div class=content><small>Deine persönlichen Daten werden ausschliesslich verwendet, um dich über das Programm der Luzerner Rollenspieltage 2024 zu informieren. Nach dem Event werden diese gelöscht."),re=o("<br>"),ae=o("<div style=margin-block:.5rem;>");function tt(e){let n;return[a(Xe),a(et),a(re),s(ge,{label:"Name",name:"name",get value(){return e.save.name},onValueUpdate:t=>e.updateSave("name",t)}),s(ne,{get when(){return e.save.name.trim().length===0},get children(){var t=a(ae);return m(t,s(U,{type:"danger",children:"Dies ist ein Pflichtfeld."})),t}}),a(re),s(Je,{label:"E-Mail",name:"email",type:"email",get value(){return e.save.email},onValueUpdate:t=>e.updateSave("email",t),ref(t){var i=n;typeof i=="function"?i(t):n=t}}),s(ne,{get when(){return e.save.email.trim().length===0},get children(){var t=a(ae);return m(t,s(U,{type:"danger",children:"Dies ist ein Pflichtfeld."})),t}}),s(ne,{get when(){return e.save.email.length>0&&n.validity.typeMismatch},get children(){var t=a(ae);return m(t,s(U,{type:"danger",children:"Die Eingabe scheint keine gültige E-Mail-Adresse zu sein."})),t}}),a(re),s(ge,{label:"Handynummer",name:"tel",type:"tel",get value(){return e.save.handynummer},required:!1,onValueUpdate:t=>e.updateSave("handynummer",t)})]}const be=fe(["SATURDAY","SUNDAY"]);Z(D({uuid:_(),description:Y(_()),title:Y(_()),system:_(),master:D({first:_(),last:Y(_())}),playerCount:D({min:C(),max:C()}),slot:D({day:be,start:C(),end:C()})}));const ye=fe(["INITIALIZED","IN_PROGRESS","CONFIRMED","CONFIRMED_W_INVALID_CHANGES","CONFIRMED_W_VALID_CHANGES","RECONFIRMED"]),Ne=D({game:_(),self:_e(!0),spielerName:qe()}),xe=D({game:_(),self:_e(!1),spielerName:_()}),nt=Se([Ne.extend({id:C()}),xe.extend({id:C()})]),rt=Se([Ne,xe]),at=D({registrationId:C(),progress:ye,name:_(),email:_(),handynummer:_(),wantsEmailUpdates:Re(),games:Z(nt),lastSaved:_()});D({registrationId:C(),progress:ye,name:_(),email:_(),handynummer:_(),wantsEmailUpdates:Re(),games:Z(rt),lastSaved:_()});async function it(e){const n=new URL("https://elysium.gildedernacht.ch/rst24/load");n.searchParams.append("secret",e);const t=await fetch(n);if(!t.ok)return{kind:"FAILED"};const i=await t.json(),l=at.safeParse(i);return l.success?{kind:"SUCCESS",save:l.data}:{kind:"FAILED"}}const lt=D({uuid:_(),title:Y(_()),system:_(),description:Y(_()),playerCount:D({min:C(),max:C()}),master:D({first:_(),last:Y(_())}),slot:D({day:be,start:C(),end:C()})}),st=D({id:C(),gameId:_()});async function dt(){const e=new URL("https://elysium.gildedernacht.ch/rst24/program"),n=new URL("https://elysium.gildedernacht.ch/rst24/reserved"),[t,i]=await Promise.all([fetch(e),fetch(n)]);if(!t.ok)return{kind:"FAILED"};if(!i.ok)return{kind:"FAILED"};const l=await t.json(),r=await i.json(),d=Z(lt).safeParse(l);if(!d.success)return{kind:"FAILED"};const u=Z(st).safeParse(r);return u.success?{kind:"SUCCESS",program:{gameList:d.data,reservedList:u.data}}:{kind:"FAILED"}}function ke(e,n){const i=n.gameList.filter(r=>r.slot.day===e).map(r=>{const d=r.uuid,u=n.reservedList.filter(v=>v.gameId===d);return{...r,reservedIds:u.map(v=>v.id)}});let l={};for(const r of i){const{start:d}=r.slot,u=l[d]??[];u.push(r),l[d]=u}return Object.entries(l)}var ot=o("<label class=input-checkbox><input type=checkbox><!$><!/>");function ut(e){return(()=>{var n=a(ot),t=n.firstChild,i=t.nextSibling,[l,r]=h(i.nextSibling);return t.addEventListener("change",d=>e.onValueUpdate(d.target.checked)),m(n,()=>e.label,l,r),H(()=>je(t,"name",e.name)),H(()=>Q(t,"value",e.value)),H(()=>Q(t,"checked",e.checked)),n})()}var gt=o("<div style=display:flex;flex-wrap:wrap;gap:0.5rem;align-items:center;><p><strong></strong></p>|<small><!$><!/> bis <!$><!/> Uhr"),mt=o("<p><small>"),ct=o("<small><!$><!/> - <!$><!/> Uhr"),vt=o("<h4 style=margin-block-end:0.5rem;>"),$t=o("<p>Wir kochen: <span>");function X(e){const n=e.type==="LUNCH"?13:18,t=e.type==="LUNCH"?14:19,i=e.small===!0,l=e.type==="LUNCH"?"Mittagessen":"Nachtessen";return i?s(U,{get children(){return[(()=>{var r=a(gt),d=r.firstChild,u=d.firstChild,v=d.nextSibling,c=v.nextSibling,f=c.firstChild,[$,S]=h(f.nextSibling),R=$.nextSibling,y=R.nextSibling,[x,p]=h(y.nextSibling);return x.nextSibling,m(u,l),m(c,n,$,S),m(c,t,x,p),r})(),(()=>{var r=a(mt),d=r.firstChild;return Q(d,"innerHTML","Pilzrisotto (vegi&nbsp;/&nbsp;vegan), Penne All'Arrabbiata und Penne Pesto (vegi&nbsp;/&nbsp;vegan)."),r})()]}}):s(U,{get children(){return[(()=>{var r=a(ct),d=r.firstChild,[u,v]=h(d.nextSibling),c=u.nextSibling,f=c.nextSibling,[$,S]=h(f.nextSibling);return $.nextSibling,m(r,n,u,v),m(r,t,$,S),r})(),(()=>{var r=a(vt);return m(r,l),r})(),(()=>{var r=a($t),d=r.firstChild,u=d.nextSibling;return Q(u,"innerHTML","Pilzrisotto (vegi&nbsp;/&nbsp;vegan), Penne All'Arrabbiata und Penne Pesto (vegi&nbsp;/&nbsp;vegan)."),r})()]}})}var ht=o("<li><h1 class=event-title></h1><div class=event-details><div class=event-tags><strong>Zeit:</strong> <!$><!/> - <!$><!/> Uhr</div><div class=event-tags><strong>Spielleitung:</strong> <!$><!/> <!$><!/></div><div class=event-tags><strong>Freie Plätze:</strong> <!$><!/></div><!$><!/></div><div class=event-description><!$><!/><!$><!/></div><!$><!/>"),ft=o("<span>Es hat noch <strong><!$><!/> Plätze</strong> frei."),_t=o("<span>Es hat noch <strong><!$><!/> Platz</strong> frei."),St=o("<div class=event-tags style=display:block;><em>(Du hast dich bereits für eine Spielrunde eingetragen, die diese Spielrunde zeitlich überschneidet.)"),Rt=o('<div class="event-description content"><p><strong>Beschreibung:</strong><br><!$><!/>'),bt=o("<div><p><strong>Deine Reservationen</strong></p><ul>"),yt=o("<li style=font-size:0.83rem;>"),Nt=o("<s>"),me=o('<span title="ungespeicherte Änderung"> *'),xt=o('<a href=javascript:; style=border:none; title="Reservation löschen"><i class="fa-duotone fa-circle-xmark">'),kt=o("<ul role=list class=event-links><li><a class=event-link href=javascript:;>+ Platz für mich reservieren"),Et=o("<ul role=list class=event-links><li><a class=event-link href=javascript:;>+ Platz für Begleitung reservieren"),Dt=o("<h3 style=margin-block:1rem;>Start <!$><!/> Uhr"),Ct=o("<ul class=event-list role=list>"),At=o(`<style>
          .event-filters .active {
            color: var(--clr-success-10) !important;
          }
        `),Ut=o("<div class=content><small>Auf dieser Seite kannst du dich und deine Freunde für Spielrunden einschreiben, solange es freie Plätze hat."),ce=o("<br>"),pt=o("<div class=event-filters><h2>Filter</h2><ul role=list><li><a href=javascript:;>Alle</a></li><!$><!/>"),ve=o("<div style=margin-block:2rem;>"),Tt=o("<li><a href=javascript:;><!$><!/> Uhr");const wt=1;function J(e,n){const{from:t,to:i}=n;return t<=e&&e<=i}function Ft(e,n){const{from:t,to:i}=e,{from:l,to:r}=n;return J(t,n)||J(i,n)||J(l,e)||J(r,e)}function It(e){function n(){return[...e.confirmedReservations.map(l=>({name:l.spielerName??e.selfName,confirmed:!0,gameUuid:e.entry.uuid,reservationId:l.id,markedForDeletion:e.markedForDeletionReservations.includes(l.id)})),...e.tentativeReservations.map(l=>({name:l.friendsName??e.selfName,confirmed:!1,gameUuid:e.entry.uuid,markedForDeletion:!1}))]}function t(){const l=e.confirmedReservations.map(d=>d.id),r=e.entry.reservedIds.filter(d=>!l.includes(d));return e.entry.playerCount.max-wt-r.length-n().filter(d=>!d.markedForDeletion).length}function i(){const{start:l,end:r}=e.entry.slot;return e.reservedTimeRanges.filter(u=>Ft({from:l,to:r},u.range)).filter(u=>u.gameUuid!==e.entry.uuid).length===0}return(()=>{var l=a(ht),r=l.firstChild,d=r.nextSibling,u=d.firstChild,v=u.firstChild,c=v.nextSibling,f=c.nextSibling,[$,S]=h(f.nextSibling),R=$.nextSibling,y=R.nextSibling,[x,p]=h(y.nextSibling);x.nextSibling;var k=u.nextSibling,L=k.firstChild,I=L.nextSibling,F=I.nextSibling,[M,B]=h(F.nextSibling),z=M.nextSibling,ee=z.nextSibling,[Ce,Ae]=h(ee.nextSibling),te=k.nextSibling,Ue=te.firstChild,pe=Ue.nextSibling,Te=pe.nextSibling,[we,Fe]=h(Te.nextSibling),Ie=te.nextSibling,[Oe,Pe]=h(Ie.nextSibling),K=d.nextSibling,Le=K.firstChild,[oe,Me]=h(Le.nextSibling),Be=oe.nextSibling,[Ge,He]=h(Be.nextSibling),Ye=K.nextSibling,[ze,Ve]=h(Ye.nextSibling);return m(r,()=>e.entry.title===null?e.entry.system:`${e.entry.title} (${e.entry.system})`),m(u,()=>e.entry.slot.start,$,S),m(u,()=>e.entry.slot.end,x,p),m(k,()=>e.entry.master.first,M,B),m(k,()=>e.entry.master.last,Ce,Ae),m(te,(()=>{var T=g(()=>t()>1);return()=>T()?(()=>{var b=a(ft),A=b.firstChild,E=A.nextSibling,N=E.firstChild,[w,O]=h(N.nextSibling);return w.nextSibling,m(E,t,w,O),b})():g(()=>t()===1)()?(()=>{var b=a(_t),A=b.firstChild,E=A.nextSibling,N=E.firstChild,[w,O]=h(N.nextSibling);return w.nextSibling,m(E,t,w,O),b})():"Diese Spielrunde ist bereits voll besetzt."})(),we,Fe),m(d,(()=>{var T=g(()=>t()>0&&!i());return()=>T()?a(St):null})(),Oe,Pe),m(K,(()=>{var T=g(()=>e.entry.description!==null&&e.entry.description.trim().length>0);return()=>T()?(()=>{var b=a(Rt),A=b.firstChild,E=A.firstChild,N=E.nextSibling,w=N.nextSibling,[O,P]=h(w.nextSibling);return m(A,()=>e.entry.description,O,P),b})():null})(),oe,Me),m(K,(()=>{var T=g(()=>n().length>0);return()=>T()?(()=>{var b=a(bt),A=b.firstChild,E=A.nextSibling;return m(E,()=>n().map(N=>(()=>{var w=a(yt);return m(w,(()=>{var O=g(()=>!!N.markedForDeletion);return()=>O()?[(()=>{var P=a(Nt);return m(P,()=>N.name),P})(),a(me)]:[g(()=>N.name),g(()=>g(()=>!!N.confirmed)()?null:a(me)),(()=>{var P=a(xt);return P.$$click=()=>e.deleteReservation(N),V(),P})()]})()),w})())),b})():null})(),Ge,He),m(l,(()=>{var T=g(()=>!!(t()>0&&i()));return()=>T()?g(()=>n().filter(b=>!b.markedForDeletion).length===0)()?(()=>{var b=a(kt),A=b.firstChild,E=A.firstChild;return E.$$click=()=>e.addTentativeReservation({gameUuid:e.entry.uuid,friendsName:null}),V(),b})():(()=>{var b=a(Et),A=b.firstChild,E=A.firstChild;return E.$$click=()=>{const N=prompt("Bitte teile uns mit, wie deine Begleitung heisst:");N!==null&&N.trim().length>0&&e.addTentativeReservation({gameUuid:e.entry.uuid,friendsName:N})},V(),b})():null})(),ze,Ve),H(()=>de(l,`event-entry ${n().filter(T=>!T.markedForDeletion).length>0?"success":t()>0&&i()?"special":"gray"}`)),l})()}function Ot(e){const n=e.confirmedReservations.filter(r=>!e.markedForDeletionReservations.includes(r.id)).map(r=>r.game);n.push(...e.tentativeReservations.map(r=>r.gameUuid));const t=new Set(n);return e.programByHour.flatMap(([r,d])=>d).filter(r=>t.has(r.uuid)).map(r=>({range:{from:r.slot.start,to:r.slot.end},gameUuid:r.uuid}))}function Pt(e){const n={MORNING:[],AFTERNOON:[],EVENING:[]};return e.forEach(t=>{const i=Number(t[0]);i<13?n.MORNING.push(t):i<18?n.AFTERNOON.push(t):n.EVENING.push(t)}),n}function Ee(e){const[n,t]=Ze([]);function i(c){t(f=>f.includes(c)?f.filter($=>$!==c):[...f,c])}const l=()=>Ot({programByHour:e.programByHour,confirmedReservations:e.confirmedReservations,tentativeReservations:e.tentativeReservations,markedForDeletionReservations:e.markedForDeletionReservations}),{MORNING:r,AFTERNOON:d,EVENING:u}=Pt(e.programByHour);function v(c){return g(()=>c.program.filter(([f])=>n().includes(f)||n().length===0).map(([f,$])=>[(()=>{var S=a(Dt),R=S.firstChild,y=R.nextSibling,[x,p]=h(y.nextSibling);return x.nextSibling,m(S,f,x,p),S})(),(()=>{var S=a(Ct);return m(S,()=>$.map(R=>s(It,{entry:R,get selfName(){return e.selfName},get confirmedReservations(){return e.confirmedReservations.filter(y=>y.game===R.uuid)},get tentativeReservations(){return e.tentativeReservations.filter(y=>y.gameUuid===R.uuid)},get markedForDeletionReservations(){return e.markedForDeletionReservations},get reservedTimeRanges(){return l()},get addTentativeReservation(){return e.addTentativeReservation},get deleteReservation(){return e.deleteReservation}}))),S})()]))}return[a(At),a(Ut),a(ce),s(ut,{get checked(){return e.wantsEmailUpdates},onValueUpdate:c=>e.updateSave("wantsEmailUpdates",c),label:"Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschaltet werden.",name:"wantsUpdates",value:"true"}),a(ce),(()=>{var c=a(pt),f=c.firstChild,$=f.nextSibling,S=$.firstChild,R=S.firstChild,y=S.nextSibling,[x,p]=h(y.nextSibling);return R.$$click=()=>t([]),m($,()=>e.programByHour.map(([k,L])=>(()=>{var I=a(Tt),F=I.firstChild,M=F.firstChild,[B,z]=h(M.nextSibling);return B.nextSibling,F.$$click=()=>i(k),m(F,k,B,z),H(()=>de(F,n().includes(k)?"active":"")),V(),I})()),x,p),H(()=>de(R,n().length===0?"active":"")),V(),c})(),s(v,{program:r}),(()=>{var c=a(ve);return m(c,s(X,{type:"LUNCH"})),c})(),s(v,{program:d}),g(()=>g(()=>u.length>0)()?[(()=>{var c=a(ve);return m(c,s(X,{type:"DINNER"})),c})(),s(v,{program:u})," "]:null)]}We(["click"]);function Lt(e){const n=ke("SATURDAY",e.program);return s(Ee,{get selfName(){return e.selfName},programByHour:n,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get wantsEmailUpdates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})}function Mt(e){const n=ke("SUNDAY",e.program);return s(Ee,{get selfName(){return e.selfName},programByHour:n,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get wantsEmailUpdates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})}var Bt=o("<p><strong><!$><!/> </strong>| <!$><!/>, <!$><!/> bis <!$><!/> Uhr"),Gt=o("<p>Reservation für <strong>"),Ht=o("<ul role=list style=display:grid;gap:.5rem;>"),Yt=o("<li>"),$e=o("<div style=max-inline-size:60ch;>"),zt=o("<h3>Kontaktdaten"),Vt=o("<ul><li><strong>Name:</strong> <!$><!/></li><li><strong>E-Mail:</strong> <!$><!/></li><li><strong>Handynummer:</strong> <!$><!/>"),jt=o("<br>"),Wt=o("<h3>Deine Reservationen"),Zt=o("<p>Weitere Spielrunden sind spontan verfügbar - wir halten immer einige Plätze frei."),Kt=o("<p><em>Noch keine Reservationen getätigt."),Jt=o("<h4>Unbestätigt"),qt=o("<p>Bitte speichere deinen aktuellen Stand der Anmeldung, damit wir die folgenden Reservationen bestätigen können."),ie=o("<h5>Samstag, 24. August 2024"),le=o("<h5>Sonntag, 25. August 2024"),Qt=o("<h4>Reservationen, die du entfernen möchtest"),Xt=o("<p>Bitte speichere deinen aktuellen Stand der Anmeldung, damit wir die folgenden Reservationen entfernen können."),en=o("<h4>Bestätigt");function tn(e){const{game:n}=e;return s(U,{get type(){return e.type??"gray"},get children(){return[(()=>{var t=a(Bt),i=t.firstChild,l=i.firstChild,[r,d]=h(l.nextSibling);r.nextSibling;var u=i.nextSibling,v=u.nextSibling,[c,f]=h(v.nextSibling),$=c.nextSibling,S=$.nextSibling,[R,y]=h(S.nextSibling),x=R.nextSibling,p=x.nextSibling,[k,L]=h(p.nextSibling);return k.nextSibling,m(i,()=>n.title===null?n.system:`${n.title} (${n.system})`,r,d),m(t,()=>n.slot.day==="SATURDAY"?"Samstag":"Sonntag",c,f),m(t,()=>n.slot.start,R,y),m(t,()=>n.slot.end,k,L),t})(),(()=>{var t=a(Gt),i=t.firstChild,l=i.nextSibling;return m(l,()=>e.players.join(", ")),t})()]}})}function se(e,n){const t=[],i=[];for(const l of e){const r=n.gameList.find(d=>d.uuid===l.gameUuid);r?.slot.day==="SATURDAY"&&t.push({reservation:l,game:r}),r?.slot.day==="SUNDAY"&&i.push({reservation:l,game:r})}return{SATURDAY:t.toSorted((l,r)=>l.game.slot.start<r.game.slot.start?-1:1),SUNDAY:i.toSorted((l,r)=>l.game.slot.start<r.game.slot.start?-1:1)}}function nn(e,n){const t=Object.groupBy(e,i=>i.game.uuid);return Object.values(t).map(i=>{const l=i?.[0];return i===void 0||l===void 0?null:{game:l.game,players:i.map(r=>r.reservation.friendsName??n)}}).filter(i=>i!==null)}function rn(e){const n={MORNING:[],AFTERNOON:[],EVENING:[]};return e.forEach(t=>{const i=t.game.slot.start;i<13?n.MORNING.push(t):i<18?n.AFTERNOON.push(t):n.EVENING.push(t)}),n}function G(e){const n=nn(e.entries,e.selfName),{MORNING:t,AFTERNOON:i,EVENING:l}=rn(n),r=e.entries[0]?.game.slot.day==="SATURDAY";function d(u){return(()=>{var v=a(Ht);return m(v,()=>u.entries.map(c=>(()=>{var f=a(Yt);return m(f,s(tn,{get game(){return c.game},get players(){return c.players},get type(){return e.type}})),f})())),v})()}return[g(()=>g(()=>t.length>0)()?s(d,{entries:t}):null),g(()=>g(()=>t.length>0||i.length>0)()?(()=>{var u=a($e);return m(u,s(X,{type:"LUNCH",small:!0})),u})():null),g(()=>g(()=>i.length>0)()?s(d,{entries:i}):null),g(()=>g(()=>!!(r&&(i.length>0||l.length>0)))()?(()=>{var u=a($e);return m(u,s(X,{type:"DINNER",small:!0})),u})():null),g(()=>g(()=>l.length>0)()?s(d,{entries:l}):null)]}function an(e){const{con:n,del:t}=e.save.games.reduce((d,u)=>e.markedForDeletionReservations.includes(u.id)?{...d,del:[...d.del,u]}:{...d,con:[...d.con,u]},{con:[],del:[]}),i=se(n.map(d=>({gameUuid:d.game,friendsName:d.spielerName})),e.program),l=se(t.map(d=>({gameUuid:d.game,friendsName:d.spielerName})),e.program),r=se(e.tentativeReservations,e.program);return[a(zt),(()=>{var d=a(Vt),u=d.firstChild,v=u.firstChild,c=v.nextSibling,f=c.nextSibling,[$,S]=h(f.nextSibling),R=u.nextSibling,y=R.firstChild,x=y.nextSibling,p=x.nextSibling,[k,L]=h(p.nextSibling),I=R.nextSibling,F=I.firstChild,M=F.nextSibling,B=M.nextSibling,[z,ee]=h(B.nextSibling);return m(u,()=>e.save.name,$,S),m(R,()=>e.save.email,k,L),m(I,()=>e.save.handynummer,z,ee),d})(),a(jt),a(Wt),g(()=>g(()=>e.save.games.length===0&&e.tentativeReservations.length===0)()?a(Kt):null),g(()=>g(()=>e.tentativeReservations.length>0)()?[a(Jt),a(qt),g(()=>g(()=>r.SATURDAY.length>0)()?[a(ie),s(G,{get entries(){return r.SATURDAY},get selfName(){return e.save.name},type:"special"})]:null),g(()=>g(()=>r.SUNDAY.length>0)()?[a(le),s(G,{get entries(){return r.SUNDAY},get selfName(){return e.save.name},type:"special"})]:null)]:null),g(()=>g(()=>t.length>0)()?[a(Qt),a(Xt),g(()=>g(()=>l.SATURDAY.length>0)()?[a(ie),s(G,{get entries(){return l.SATURDAY},get selfName(){return e.save.name},type:"danger"})]:null),g(()=>g(()=>l.SUNDAY.length>0)()?[a(le),s(G,{get entries(){return l.SUNDAY},get selfName(){return e.save.name},type:"danger"})]:null)]:null),g(()=>g(()=>n.length>0)()?[a(en),g(()=>g(()=>i.SATURDAY.length>0)()?[a(ie),s(G,{get entries(){return i.SATURDAY},get selfName(){return e.save.name},type:"success"})]:null),g(()=>g(()=>i.SUNDAY.length>0)()?[a(le),s(G,{get entries(){return i.SUNDAY},get selfName(){return e.save.name},type:"success"})]:null)]:null),s(U,{type:"special",get children(){return a(Zt)}})]}var ln=o("<div style=display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:1rem;><div>Zuletzt gespeichert am <!$><!/>"),sn=o('<div style="padding-block:2rem 1rem;bottom:0;background-image:linear-gradient(transparent, var(--clr-3) 25%);">'),dn=o("<div style=padding-block:1rem;>"),on=o("<h2>Programm Samstag"),un=o("<h2>Programm Sonntag"),gn=o("<div class=content><h2>Zusammenfassung</h2><small>Hier hast du die komplette Übersicht über alle deine Eingaben.</small><!$><!/>");function mn(e){const n=new Intl.DateTimeFormat("de-CH",{timeStyle:"short",dateStyle:"long"});return s(he,{get type(){return e.state==="HAS_CHANGES"?"success":"gray"},get children(){var t=a(ln),i=t.firstChild,l=i.firstChild,r=l.nextSibling,[d,u]=h(r.nextSibling);return m(i,()=>n.format(new Date(e.lastSaved)),d,u),t}})}function cn(e){return(()=>{var n=a(dn);return m(n,s(he,{get children(){return[g(()=>g(()=>e.activeTab==="Contact")()?s(tt,{get save(){return e.save},get updateSave(){return e.updateSave}}):g(()=>e.activeTab==="Saturday")()?[a(on),s(q,{get fallback(){return s(U,{children:"Programm wird geladen ..."})},get children(){return s(j,{get children(){return s(W,{get when(){return e.programResource()},children:t=>s(Lt,{get selfName(){return e.save.name},get program(){return t()},get wantsEmailUpdates(){return e.save.wantsEmailUpdates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})})}})}})]:g(()=>e.activeTab==="Sunday")()?[a(un),s(q,{get fallback(){return s(U,{children:"Programm wird geladen ..."})},get children(){return s(j,{get children(){return s(W,{get when(){return e.programResource()},children:t=>s(Mt,{get selfName(){return e.save.name},get program(){return t()},get wantsEmailUpdates(){return e.save.wantsEmailUpdates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})})}})}})]:(()=>{var t=a(gn),i=t.firstChild,l=i.nextSibling,r=l.nextSibling,[d,u]=h(r.nextSibling);return m(t,s(q,{get fallback(){return s(U,{children:"Zusammenfassung wird geladen ..."})},get children(){return s(j,{get children(){return s(W,{get when(){return e.programResource()},children:v=>s(an,{get save(){return e.save},get tentativeReservations(){return e.tentativeReservations},get program(){return v()},get markedForDeletionReservations(){return e.markedForDeletionReservations}})})}})}}),d,u),t})()),(()=>{var t=a(sn);return m(t,s(mn,{get lastSaved(){return e.lastSaved},get saveCurrentState(){return e.saveCurrentState},get state(){return e.saveState}})),t})()]}})),n})()}function vn(){const e=new URL(location.href),n=e.searchParams.get("secret"),t=e.searchParams.get("showCreateMessage")==="true";return{secret:n,showCreateMessage:t}}async function De(e){if(e.secret===null)throw Error("SECRET_ERROR");const n=await it(e.secret);if(n.kind==="FAILED")throw Error("SECRET_ERROR");return{state:"IDLE",secret:e.secret,showCreateMessage:e.showCreateMessage,currentSave:n.save,activeTab:"Contact",lastSaved:n.save.lastSaved,hasChanged:!1,tentativeReservations:[],markedForDeletionReservations:[]}}async function $n(){const e=await dt();if(e.kind==="FAILED")throw Error("PROGRAM_ERROR");return e.program}function hn(e){const[n,t]=Qe(e);function i(v){t("activeTab",v),window.scrollTo({top:0})}function l(v,c){t("hasChanged",!0),t("currentSave",v,c)}async function r(){if(n.state!=="IDLE")throw Error("ASSERTION_ERROR");t("state","SAVING");const v=new URL("https://elysium.gildedernacht.ch/rst24/save"),c={...n.currentSave,games:[...n.currentSave.games.filter($=>!n.markedForDeletionReservations.includes($.id)),...n.tentativeReservations.map($=>$.friendsName===null?{game:$.gameUuid,self:!0,spielerName:null}:{game:$.gameUuid,self:!1,spielerName:$.friendsName})]};if((await fetch(v,{method:"post",body:JSON.stringify(c),headers:{"Content-Type":"application/json"}})).ok){const $=await De({secret:n.secret,showCreateMessage:!1});t({...$,activeTab:n.activeTab})}else throw Error("SAVE_ERROR")}function d(v){t("hasChanged",!0),t("tentativeReservations",c=>[...c,v])}function u(v){if(t("hasChanged",!0),v.confirmed)t("markedForDeletionReservations",c=>[...c,v.reservationId]);else{const c=n.currentSave.name;t("tentativeReservations",f=>f.filter($=>$.gameUuid!==v.gameUuid?!0:$.friendsName===v.name?!1:v.name!==c))}}return{state:n,actions:{changeTab:i,updateSave:l,saveCurrentState:r,addTentativeReservation:d,deleteReservation:u}}}var fn=o("<p>Wir konnten leider keine Anmeldung finden. Wenn du bereits eine Anmeldung begonnen hast, solltest du den korrekten Link per E-Mail erhalten haben.<br><br>Für generelle Fragen oder Probleme, schreibe uns doch bitte über unser <a href=/kontatk>Kontaktformular</a>."),_n=o("<p>Leider ist ein unerwarteter Fehler passiert. Versuche deine Anmeldung erneut zu laden. Wiederholt sich dieser Fehler, bitte kontaktiere uns sobald als möglich über das <a href=/kontakt>Kontaktformular</a>, da dies nicht passieren sollte."),Sn=o("<p>Deine Anmeldung wird geladen...");function Rn(e){const{state:n,actions:t}=hn(e.state);return s(cn,{activeTab:"Summary",get changeTab(){return t.changeTab},get save(){return n.currentSave},get updateSave(){return t.updateSave},get lastSaved(){return n.lastSaved},get saveCurrentState(){return t.saveCurrentState},get saveState(){return n.state==="SAVING"?"SAVING":n.hasChanged?"HAS_CHANGES":"NO_CHANGES"},get programResource(){return e.programResource},get confirmedReservations(){return n.currentSave.games},get tentativeReservations(){return n.tentativeReservations},get addTentativeReservation(){return t.addTentativeReservation},get deleteReservation(){return t.deleteReservation},get markedForDeletionReservations(){return n.markedForDeletionReservations}})}function kn(){const e=vn(),[n]=ue(()=>De(e)),[t]=ue(()=>$n());return s(Ke,{fallback:i=>s(U,{type:"danger",get children(){return s(j,{get fallback(){return a(_n)},get children(){return s(W,{get when(){return i.message==="SECRET_ERROR"},get children(){return a(fn)}})}})}}),get children(){return s(q,{get fallback(){return s(U,{get children(){return a(Sn)}})},get children(){return s(j,{get children(){return s(W,{get when(){return n()},children:i=>s(Rn,{get state(){return i()},programResource:t})})}})}})}})}export{kn as MeineAnmeldung};
