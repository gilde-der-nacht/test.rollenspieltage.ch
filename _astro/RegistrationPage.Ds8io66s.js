import{g as m,c as t,t as f,a as i,i as s,S as g}from"./web.BCh8zNxO.js";import{e as G,I as D,B as c,a as H,b as q}from"./utils.D4lVKdag.js";import{c as z}from"./store.BK-5lGMP.js";import{o as J,s as X,T as x,C as K}from"./texts.CWjYF-lE.js";var Q=f("<form novalidate><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),E=f("<br>"),Y=f("<a href=/kontakt>kontaktiere uns direkt"),Z=f("<span>Ich best√§tige, dass ich den <a href=/verhaltenskodex target=_blank>Verhaltenskodex</a> gelesen habe und mich an die Regeln halten werde.");function ae(){const[e,r]=z({form:{name:"",email:"",tel:"",coc:!1},errors:{nameMissing:!1,emailMissing:!1,emailInvalid:!1,cocMissing:!1,general:!1},state:"IDLE"});let h;async function L(n){n.preventDefault();const $=e.form.name.trim().length===0;r("errors","nameMissing",$);const d=e.form.email.trim().length===0;r("errors","emailMissing",d);const b=h.validity.typeMismatch;if(r("errors","emailInvalid",b),r("errors","cocMissing",!e.form.coc),!(e.errors.nameMissing||e.errors.emailMissing||e.errors.emailInvalid||e.errors.cocMissing)){r("state","LOADING");try{const u={version:1,init:{name:e.form.name,email:e.form.email,mobile:e.form.tel},playing:{wantsUpdates:!0,reservations:[]},master:{wantsHelp:!1,games:[]},helping:[],lastSaved:new Date},l=await fetch(G("/rst25/start"),{method:"post",body:JSON.stringify(u),headers:{"Content-Type":"application/json"}});if(!l.ok)r("errors","general",!0);else{const _=await l.json(),p=J({secret:X()}).parse(_),o=new URL(location.origin+"/meine-anmeldung");o.searchParams.append("secret",p.secret),o.searchParams.append("showCreateMessage","true"),window.location.replace(o)}}catch{r("errors","general",!0),r("state","IDLE")}}}return[(()=>{var n=m(Q),$=n.firstChild,[d,b]=i($.nextSibling),u=d.nextSibling,[l,_]=i(u.nextSibling),y=l.nextSibling,[p,o]=i(y.nextSibling),C=p.nextSibling,[S,N]=i(C.nextSibling),T=S.nextSibling,[v,U]=i(T.nextSibling),V=v.nextSibling,[w,A]=i(V.nextSibling),j=w.nextSibling,[M,B]=i(j.nextSibling),F=M.nextSibling,[I,O]=i(F.nextSibling),P=I.nextSibling,[R,W]=i(P.nextSibling);return n.addEventListener("submit",L),s(n,t(D,{label:"Name",name:"name",get value(){return e.form.name},onValueUpdate:a=>{r("form","name",a),r("errors","nameMissing",!1)}}),d,b),s(n,t(g,{get when(){return e.errors.nameMissing},get children(){return t(c,{type:"danger",get children(){return x.mandatoryField}})}}),l,_),s(n,t(H,{label:"E-Mail",name:"email",type:"email",get value(){return e.form.email},onValueUpdate:a=>{r("form","email",a),r("errors","emailMissing",!1),r("errors","emailInvalid",!1)},ref(a){var k=h;typeof k=="function"?k(a):h=a}}),p,o),s(n,t(g,{get when(){return e.errors.emailMissing},get children(){return t(c,{type:"danger",get children(){return x.mandatoryField}})}}),S,N),s(n,t(g,{get when(){return e.errors.emailInvalid},get children(){return t(c,{type:"danger",get children(){return x.invalidEmail}})}}),v,U),s(n,t(D,{label:"Handynummer",name:"tel",type:"tel",get value(){return e.form.tel},required:!1,onValueUpdate:a=>r("form","tel",a)}),w,A),s(n,t(K,{get label(){return m(Z)},name:"coc",value:"coc",get checked(){return e.form.coc},onValueUpdate:a=>r("form","coc",a)}),M,B),s(n,t(g,{get when(){return e.errors.cocMissing},get children(){return t(c,{type:"danger",children:"Der Verhaltenskodex muss gelesen und akzeptiert werden."})}}),I,O),s(n,t(q,{type:"submit",get kind(){return e.state==="IDLE"?"success":"gray"},get label(){return e.state==="IDLE"?"Anmeldung starten":"Anmeldung wird gestartet"},get disabled(){return e.state==="LOADING"}}),R,W),n})(),m(E),t(g,{get when(){return e.errors.general},get children(){return[t(c,{type:"danger",get children(){return["Es gab ein Problem, das wir nicht erwartet haben. Bitte versuche es erneut oder ",m(Y),"."]}}),m(E)]}})]}export{ae as AnmeldungWrapper};
