import{g as a,c as i,t as u,i as o,S as X,a as h,s as me,d as tt,b as Ne,m as c,e as oe,f as ge,r as K,h as ee,j as Y,M as V,o as nt,k as ve,E as rt}from"./web.D4dnCiBo.js";import{I as $e,B as w,a as at,e as te,S as Ee,b as G}from"./utils.CO8D4He7.js";import{e as it,a as W,o as C,s as S,b as z,n as A,c as lt,l as Ce,u as Ae,d as Te,C as st}from"./Checkbox.Df8Vlmdz.js";import{c as dt}from"./store.CSRn8cdC.js";var ut=u("<h2>Kontaktdaten"),ot=u("<div class=content><small>Deine persönlichen Daten werden ausschliesslich verwendet, um dich über das Programm der Luzerner Rollenspieltage 2024 zu informieren. Nach dem Event werden diese gelöscht."),q=u("<br>"),ie=u("<div style=margin-block:.5rem;>"),gt=u('<p style=display:flex;flex-wrap;gap:0.75rem;color:var(--clr-success-10);><i class="fa-duotone fa-square-check"style=position:relative;top:0.25rem;></i><span>Ich bestätige, dass ich den <a href=/verhaltenskodex target=_blank>Verhaltenskodex</a> gelesen habe und mich an die Regeln halten werde.');function ct(e){let t;return[a(ut),a(ot),a(q),i($e,{label:"Name",name:"name",get value(){return e.save.name},onValueUpdate:n=>e.updateSave("name",n)}),i(X,{get when(){return e.save.name.trim().length===0},get children(){var n=a(ie);return o(n,i(w,{type:"danger",children:"Dies ist ein Pflichtfeld."})),n}}),a(q),i(at,{label:"E-Mail",name:"email",type:"email",get value(){return e.save.email},onValueUpdate:n=>e.updateSave("email",n),ref(n){var l=t;typeof l=="function"?l(n):t=n}}),i(X,{get when(){return e.save.email.trim().length===0},get children(){var n=a(ie);return o(n,i(w,{type:"danger",children:"Dies ist ein Pflichtfeld."})),n}}),i(X,{get when(){return e.save.email.length>0&&t.validity.typeMismatch},get children(){var n=a(ie);return o(n,i(w,{type:"danger",children:"Die Eingabe scheint keine gültige E-Mail-Adresse zu sein."})),n}}),a(q),i($e,{label:"Handynummer",name:"tel",type:"tel",get value(){return e.save.handynummer},required:!1,onValueUpdate:n=>e.updateSave("handynummer",n)}),a(q),a(gt)]}const j=1,he="SAVE",fe="PROGRAM",Se={registrationId:-1,name:"Demo",email:"demo@mail.com",handynummer:"+41 12 123 12 12",wantsEmailUpdates:!0,games:[],lastSaved:"2024-08-15T07:45:21.335Z"};function mt(){const e=localStorage.getItem(he);let t;return e===null?t={version:j,data:Se}:t=JSON.parse(e),t.version!==j&&(console.error("Your local storage data was outdated and has been replaced with new demo content."),t={version:j,data:Se}),localStorage.setItem(he,JSON.stringify(t)),t.data}const _e={gameList:[],reservedList:[]};function vt(){const e=localStorage.getItem(fe);let t;return e===null?t={version:j,data:_e}:t=JSON.parse(e),t.version!==j&&(console.error("Your local storage data was outdated and has been replaced with new demo content."),t={version:j,data:_e}),localStorage.setItem(fe,JSON.stringify(t)),t.data}const we=it(["SATURDAY","SUNDAY"]);W(C({uuid:S(),description:z(S()),title:z(S()),system:S(),master:C({first:S(),last:z(S())}),playerCount:C({min:A(),max:A()}),slot:C({day:we,start:A(),end:A()})}));const De=C({game:S(),self:Ce(!0),spielerName:lt()}),Ue=C({game:S(),self:Ce(!1),spielerName:S()}),$t=Ae([De.extend({id:A()}),Ue.extend({id:A()})]),ht=Ae([De,Ue]),ft=C({registrationId:A(),name:S(),email:S(),handynummer:S(),wantsEmailUpdates:Te(),games:W($t),lastSaved:S()});C({registrationId:A(),name:S(),email:S(),handynummer:S(),wantsEmailUpdates:Te(),games:W(ht),lastSaved:S()});async function St(e){if(e==="demo")return{kind:"SUCCESS",save:mt()};const t=te("/rst24/load");t.searchParams.append("secret",e);const n=await fetch(t);if(!n.ok)return{kind:"FAILED"};const l=await n.json(),s=ft.safeParse(l);return s.success?{kind:"SUCCESS",save:s.data}:{kind:"FAILED"}}const _t=C({uuid:S(),title:z(S()),system:S(),description:z(S()),playerCount:C({min:A(),max:A()}),master:C({first:S(),last:z(S())}),slot:C({day:we,start:A(),end:A()})}),bt=C({id:A(),gameId:S()});async function yt(e){if(e)return{kind:"SUCCESS",program:vt()};const t=te("/rst24/program"),n=te("/rst24/reserved"),[l,s]=await Promise.all([fetch(t),fetch(n)]);if(!l.ok)return{kind:"FAILED"};if(!s.ok)return{kind:"FAILED"};const r=await l.json(),d=await s.json(),g=W(_t).safeParse(r);if(!g.success)return{kind:"FAILED"};const v=W(bt).safeParse(d);return v.success?{kind:"SUCCESS",program:{gameList:g.data,reservedList:v.data}}:{kind:"FAILED"}}function pe(e,t){const l=t.gameList.filter(r=>r.slot.day===e).map(r=>{const d=r.uuid,g=t.reservedList.filter(v=>v.gameId===d);return{...r,reservedIds:g.map(v=>v.id)}});let s={};for(const r of l){const{start:d}=r.slot,g=s[d]??[];g.push(r),s[d]=g}return Object.entries(s)}var Rt=u("<div style=display:flex;flex-wrap:wrap;gap:0.5rem;align-items:center;><p><strong></strong></p>|<small><!$><!/> bis <!$><!/> Uhr"),kt=u("<p><small>"),xt=u("<small><!$><!/> - <!$><!/> Uhr"),Nt=u("<h4 style=margin-block-end:0.5rem;>"),Et=u("<p>Wir kochen: <span>");function ne(e){const t=e.type==="LUNCH"?13:18,n=e.type==="LUNCH"?14:19,l=e.small===!0,s=e.type==="LUNCH"?"Mittagessen":"Nachtessen";return l?i(w,{get children(){return[(()=>{var r=a(Rt),d=r.firstChild,g=d.firstChild,v=d.nextSibling,m=v.nextSibling,f=m.firstChild,[$,_]=h(f.nextSibling),b=$.nextSibling,R=b.nextSibling,[x,D]=h(R.nextSibling);return x.nextSibling,o(g,s),o(m,t,$,_),o(m,n,x,D),r})(),(()=>{var r=a(kt),d=r.firstChild;return me(d,"innerHTML","Pilzrisotto (vegi&nbsp;/&nbsp;vegan), Penne All'Arrabbiata und Penne Pesto (vegi&nbsp;/&nbsp;vegan)."),r})()]}}):i(w,{get children(){return[(()=>{var r=a(xt),d=r.firstChild,[g,v]=h(d.nextSibling),m=g.nextSibling,f=m.nextSibling,[$,_]=h(f.nextSibling);return $.nextSibling,o(r,t,g,v),o(r,n,$,_),r})(),(()=>{var r=a(Nt);return o(r,s),r})(),(()=>{var r=a(Et),d=r.firstChild,g=d.nextSibling;return me(g,"innerHTML","Pilzrisotto (vegi&nbsp;/&nbsp;vegan), Penne All'Arrabbiata und Penne Pesto (vegi&nbsp;/&nbsp;vegan)."),r})()]}})}var Ct=u("<li><h1 class=event-title></h1><div class=event-details><div class=event-tags><strong>Zeit:</strong> <!$><!/> - <!$><!/> Uhr</div><div class=event-tags><strong>Spielleitung:</strong> <!$><!/> <!$><!/></div><div class=event-tags><strong>Freie Plätze:</strong> <!$><!/></div><!$><!/></div><div class=event-description><!$><!/><!$><!/></div><!$><!/>"),At=u("<span>Es hat noch <strong><!$><!/> Plätze</strong> frei."),Tt=u("<span>Es hat noch <strong><!$><!/> Platz</strong> frei."),wt=u("<div class=event-tags style=display:block;><em>(Du hast dich bereits für eine Spielrunde eingetragen, die diese Spielrunde zeitlich überschneidet.)"),Dt=u('<div class="event-description content"><p><strong>Beschreibung:</strong><br><!$><!/>'),Ut=u("<div><p><strong>Deine Reservationen</strong></p><ul>"),pt=u("<li style=font-size:0.83rem;>"),Ft=u("<s>"),be=u('<span title="ungespeicherte Änderung"> *'),It=u('<a href=javascript:; style=border:none; title="Reservation löschen"><i class="fa-duotone fa-circle-xmark">'),Ot=u("<ul role=list class=event-links><li><a class=event-link href=javascript:;>+ Platz für mich reservieren"),Pt=u("<ul role=list class=event-links><li><a class=event-link href=javascript:;>+ Platz für Begleitung reservieren"),Gt=u("<h3 style=margin-block:1rem;>Start <!$><!/> Uhr"),Mt=u("<ul class=event-list role=list>"),Lt=u(`<style>
          .event-filters .active {
            color: var(--clr-success-10) !important;
          }
        `),Ht=u("<div class=content><small>Auf dieser Seite kannst du dich und deine Freunde für Spielrunden einschreiben, solange es freie Plätze hat."),ye=u("<br>"),Bt=u("<div class=event-filters><h2>Filter</h2><ul role=list><li><a href=javascript:;>Alle</a></li><!$><!/>"),Re=u("<div style=margin-block:2rem;>"),Yt=u("<li><a href=javascript:;><!$><!/> Uhr");const Vt=1;function Q(e,t){const{from:n,to:l}=t;return n<=e&&e<=l}function zt(e,t){const{from:n,to:l}=e,{from:s,to:r}=t;return Q(n,t)||Q(l,t)||Q(s,e)||Q(r,e)}function jt(e){function t(){return[...e.confirmedReservations.map(s=>({name:s.spielerName??e.selfName,confirmed:!0,gameUuid:e.entry.uuid,reservationId:s.id,markedForDeletion:e.markedForDeletionReservations.includes(s.id)})),...e.tentativeReservations.map(s=>({name:s.friendsName??e.selfName,confirmed:!1,gameUuid:e.entry.uuid,markedForDeletion:!1}))]}function n(){const s=e.confirmedReservations.map(d=>d.id),r=e.entry.reservedIds.filter(d=>!s.includes(d));return e.entry.playerCount.max-Vt-r.length-t().filter(d=>!d.markedForDeletion).length}function l(){const{start:s,end:r}=e.entry.slot;return e.reservedTimeRanges.filter(g=>zt({from:s,to:r},g.range)).filter(g=>g.gameUuid!==e.entry.uuid).length===0}return(()=>{var s=a(Ct),r=s.firstChild,d=r.nextSibling,g=d.firstChild,v=g.firstChild,m=v.nextSibling,f=m.nextSibling,[$,_]=h(f.nextSibling),b=$.nextSibling,R=b.nextSibling,[x,D]=h(R.nextSibling);x.nextSibling;var N=g.nextSibling,M=N.firstChild,I=M.nextSibling,F=I.nextSibling,[L,H]=h(F.nextSibling),J=L.nextSibling,re=J.nextSibling,[Pe,Ge]=h(re.nextSibling),ae=N.nextSibling,Me=ae.firstChild,Le=Me.nextSibling,He=Le.nextSibling,[Be,Ye]=h(He.nextSibling),Ve=ae.nextSibling,[ze,je]=h(Ve.nextSibling),Z=d.nextSibling,Je=Z.firstChild,[ce,Ke]=h(Je.nextSibling),We=ce.nextSibling,[Ze,qe]=h(We.nextSibling),Qe=Z.nextSibling,[Xe,et]=h(Qe.nextSibling);return o(r,()=>e.entry.title===null?e.entry.system:`${e.entry.title} (${e.entry.system})`),o(g,()=>e.entry.slot.start,$,_),o(g,()=>e.entry.slot.end,x,D),o(N,()=>e.entry.master.first,L,H),o(N,()=>e.entry.master.last,Pe,Ge),o(ae,(()=>{var U=c(()=>n()>1);return()=>U()?(()=>{var y=a(At),T=y.firstChild,E=T.nextSibling,k=E.firstChild,[p,O]=h(k.nextSibling);return p.nextSibling,o(E,n,p,O),y})():c(()=>n()===1)()?(()=>{var y=a(Tt),T=y.firstChild,E=T.nextSibling,k=E.firstChild,[p,O]=h(k.nextSibling);return p.nextSibling,o(E,n,p,O),y})():"Diese Spielrunde ist bereits voll besetzt."})(),Be,Ye),o(d,(()=>{var U=c(()=>n()>0&&!l());return()=>U()?a(wt):null})(),ze,je),o(Z,(()=>{var U=c(()=>e.entry.description!==null&&e.entry.description.trim().length>0);return()=>U()?(()=>{var y=a(Dt),T=y.firstChild,E=T.firstChild,k=E.nextSibling,p=k.nextSibling,[O,P]=h(p.nextSibling);return o(T,()=>e.entry.description,O,P),y})():null})(),ce,Ke),o(Z,(()=>{var U=c(()=>t().length>0);return()=>U()?(()=>{var y=a(Ut),T=y.firstChild,E=T.nextSibling;return o(E,()=>t().map(k=>(()=>{var p=a(pt);return o(p,(()=>{var O=c(()=>!!k.markedForDeletion);return()=>O()?[(()=>{var P=a(Ft);return o(P,()=>k.name),P})(),a(be)]:[c(()=>k.name),c(()=>c(()=>!!k.confirmed)()?null:a(be)),(()=>{var P=a(It);return P.$$click=()=>e.deleteReservation(k),K(),P})()]})()),p})())),y})():null})(),Ze,qe),o(s,(()=>{var U=c(()=>!!(n()>0&&l()));return()=>U()?c(()=>t().filter(y=>!y.markedForDeletion).length===0)()?(()=>{var y=a(Ot),T=y.firstChild,E=T.firstChild;return E.$$click=()=>e.addTentativeReservation({gameUuid:e.entry.uuid,friendsName:null}),K(),y})():(()=>{var y=a(Pt),T=y.firstChild,E=T.firstChild;return E.$$click=()=>{const k=prompt("Bitte teile uns mit, wie deine Begleitung heisst:");k!==null&&k.trim().length>0&&e.addTentativeReservation({gameUuid:e.entry.uuid,friendsName:k})},K(),y})():null})(),Xe,et),oe(()=>ge(s,`event-entry ${t().filter(U=>!U.markedForDeletion).length>0?"success":n()>0&&l()?"special":"gray"}`)),s})()}function Jt(e){const t=e.confirmedReservations.filter(r=>!e.markedForDeletionReservations.includes(r.id)).map(r=>r.game);t.push(...e.tentativeReservations.map(r=>r.gameUuid));const n=new Set(t);return e.programByHour.flatMap(([r,d])=>d).filter(r=>n.has(r.uuid)).map(r=>({range:{from:r.slot.start,to:r.slot.end},gameUuid:r.uuid}))}function Kt(e){const t={MORNING:[],AFTERNOON:[],EVENING:[]};return e.forEach(n=>{const l=Number(n[0]);l<13?t.MORNING.push(n):l<18?t.AFTERNOON.push(n):t.EVENING.push(n)}),t}function Fe(e){const[t,n]=Ne([]);function l(m){n(f=>f.includes(m)?f.filter($=>$!==m):[...f,m])}const s=()=>Jt({programByHour:e.programByHour,confirmedReservations:e.confirmedReservations,tentativeReservations:e.tentativeReservations,markedForDeletionReservations:e.markedForDeletionReservations}),{MORNING:r,AFTERNOON:d,EVENING:g}=Kt(e.programByHour);function v(m){return c(()=>m.program.filter(([f])=>t().includes(f)||t().length===0).map(([f,$])=>[(()=>{var _=a(Gt),b=_.firstChild,R=b.nextSibling,[x,D]=h(R.nextSibling);return x.nextSibling,o(_,f,x,D),_})(),(()=>{var _=a(Mt);return o(_,()=>$.map(b=>i(jt,{entry:b,get selfName(){return e.selfName},get confirmedReservations(){return e.confirmedReservations.filter(R=>R.game===b.uuid)},get tentativeReservations(){return e.tentativeReservations.filter(R=>R.gameUuid===b.uuid)},get markedForDeletionReservations(){return e.markedForDeletionReservations},get reservedTimeRanges(){return s()},get addTentativeReservation(){return e.addTentativeReservation},get deleteReservation(){return e.deleteReservation}}))),_})()]))}return[a(Lt),a(Ht),a(ye),i(st,{get checked(){return e.wantsEmailUpdates},onValueUpdate:m=>e.updateSave("wantsEmailUpdates",m),label:"Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschaltet werden.",name:"wantsUpdates",value:"true"}),a(ye),(()=>{var m=a(Bt),f=m.firstChild,$=f.nextSibling,_=$.firstChild,b=_.firstChild,R=_.nextSibling,[x,D]=h(R.nextSibling);return b.$$click=()=>n([]),o($,()=>e.programByHour.map(([N,M])=>(()=>{var I=a(Yt),F=I.firstChild,L=F.firstChild,[H,J]=h(L.nextSibling);return H.nextSibling,F.$$click=()=>l(N),o(F,N,H,J),oe(()=>ge(F,t().includes(N)?"active":"")),K(),I})()),x,D),oe(()=>ge(b,t().length===0?"active":"")),K(),m})(),i(v,{program:r}),(()=>{var m=a(Re);return o(m,i(ne,{type:"LUNCH"})),m})(),i(v,{program:d}),c(()=>c(()=>g.length>0)()?[(()=>{var m=a(Re);return o(m,i(ne,{type:"DINNER"})),m})(),i(v,{program:g})," "]:null)]}tt(["click"]);function Wt(e){const t=pe("SATURDAY",e.program);return i(Fe,{get selfName(){return e.selfName},programByHour:t,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get wantsEmailUpdates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})}function Zt(e){const t=pe("SUNDAY",e.program);return i(Fe,{get selfName(){return e.selfName},programByHour:t,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get wantsEmailUpdates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})}var qt=u("<p><strong><!$><!/> </strong>| <!$><!/>, <!$><!/> bis <!$><!/> Uhr"),Qt=u("<p>Reservation für <strong>"),Xt=u("<ul role=list style=display:grid;gap:.5rem;>"),en=u("<li>"),ke=u("<div style=max-inline-size:60ch;>"),tn=u("<h3>Kontaktdaten"),nn=u("<ul><li><strong>Name:</strong> <!$><!/></li><li><strong>E-Mail:</strong> <!$><!/></li><li><strong>Handynummer:</strong> <!$><!/>"),xe=u("<br>"),rn=u("<h3>Deine Reservationen"),an=u("<h3>Updates"),ln=u("<p><em>"),sn=u("<p><em>Noch keine Reservationen getätigt."),dn=u("<h4>Unbestätigt"),un=u("<p>Bitte speichere deinen aktuellen Stand der Anmeldung, damit wir die folgenden Reservationen bestätigen können."),le=u("<h5>Samstag, 24. August 2024"),se=u("<h5>Sonntag, 25. August 2024"),on=u("<h4>Reservationen, die du entfernen möchtest"),gn=u("<p>Bitte speichere deinen aktuellen Stand der Anmeldung, damit wir die folgenden Reservationen entfernen können."),cn=u("<h4>Bestätigt"),mn=u("<span style=color:var(--clr-success-10);>Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschaltet werden."),vn=u("<span style=color:var(--clr-danger-10);>Nein, ich möchte keine E-Mails über neue Spielrunden erhalten.");function $n(e){const{game:t}=e;return i(w,{get type(){return e.type??"gray"},get children(){return[(()=>{var n=a(qt),l=n.firstChild,s=l.firstChild,[r,d]=h(s.nextSibling);r.nextSibling;var g=l.nextSibling,v=g.nextSibling,[m,f]=h(v.nextSibling),$=m.nextSibling,_=$.nextSibling,[b,R]=h(_.nextSibling),x=b.nextSibling,D=x.nextSibling,[N,M]=h(D.nextSibling);return N.nextSibling,o(l,()=>t.title===null?t.system:`${t.title} (${t.system})`,r,d),o(n,()=>t.slot.day==="SATURDAY"?"Samstag":"Sonntag",m,f),o(n,()=>t.slot.start,b,R),o(n,()=>t.slot.end,N,M),n})(),(()=>{var n=a(Qt),l=n.firstChild,s=l.nextSibling;return o(s,()=>e.players.join(", ")),n})()]}})}function de(e,t){const n=[],l=[];for(const s of e){const r=t.gameList.find(d=>d.uuid===s.gameUuid);r?.slot.day==="SATURDAY"&&n.push({reservation:s,game:r}),r?.slot.day==="SUNDAY"&&l.push({reservation:s,game:r})}return{SATURDAY:n.toSorted((s,r)=>s.game.slot.start<r.game.slot.start?-1:1),SUNDAY:l.toSorted((s,r)=>s.game.slot.start<r.game.slot.start?-1:1)}}function hn(e,t){const n=Object.groupBy(e,l=>l.game.uuid);return Object.values(n).map(l=>{const s=l?.[0];return l===void 0||s===void 0?null:{game:s.game,players:l.map(r=>r.reservation.friendsName??t)}}).filter(l=>l!==null)}function fn(e){const t={MORNING:[],AFTERNOON:[],EVENING:[]};return e.forEach(n=>{const l=n.game.slot.start;l<13?t.MORNING.push(n):l<18?t.AFTERNOON.push(n):t.EVENING.push(n)}),t}function B(e){const t=hn(e.entries,e.selfName),{MORNING:n,AFTERNOON:l,EVENING:s}=fn(t),r=e.entries[0]?.game.slot.day==="SATURDAY";function d(g){return(()=>{var v=a(Xt);return o(v,()=>g.entries.map(m=>(()=>{var f=a(en);return o(f,i($n,{get game(){return m.game},get players(){return m.players},get type(){return e.type}})),f})())),v})()}return[c(()=>c(()=>n.length>0)()?i(d,{entries:n}):null),c(()=>c(()=>n.length>0||l.length>0)()?(()=>{var g=a(ke);return o(g,i(ne,{type:"LUNCH",small:!0})),g})():null),c(()=>c(()=>l.length>0)()?i(d,{entries:l}):null),c(()=>c(()=>!!(r&&(l.length>0||s.length>0)))()?(()=>{var g=a(ke);return o(g,i(ne,{type:"DINNER",small:!0})),g})():null),c(()=>c(()=>s.length>0)()?i(d,{entries:s}):null)]}function Sn(e){const{con:t,del:n}=e.save.games.reduce((d,g)=>e.markedForDeletionReservations.includes(g.id)?{...d,del:[...d.del,g]}:{...d,con:[...d.con,g]},{con:[],del:[]}),l=de(t.map(d=>({gameUuid:d.game,friendsName:d.spielerName})),e.program),s=de(n.map(d=>({gameUuid:d.game,friendsName:d.spielerName})),e.program),r=de(e.tentativeReservations,e.program);return[a(tn),(()=>{var d=a(nn),g=d.firstChild,v=g.firstChild,m=v.nextSibling,f=m.nextSibling,[$,_]=h(f.nextSibling),b=g.nextSibling,R=b.firstChild,x=R.nextSibling,D=x.nextSibling,[N,M]=h(D.nextSibling),I=b.nextSibling,F=I.firstChild,L=F.nextSibling,H=L.nextSibling,[J,re]=h(H.nextSibling);return o(g,()=>e.save.name,$,_),o(b,()=>e.save.email,N,M),o(I,()=>e.save.handynummer,J,re),d})(),a(xe),a(rn),c(()=>c(()=>e.save.games.length===0&&e.tentativeReservations.length===0)()?a(sn):null),c(()=>c(()=>e.tentativeReservations.length>0)()?[a(dn),a(un),c(()=>c(()=>r.SATURDAY.length>0)()?[a(le),i(B,{get entries(){return r.SATURDAY},get selfName(){return e.save.name},type:"special"})]:null),c(()=>c(()=>r.SUNDAY.length>0)()?[a(se),i(B,{get entries(){return r.SUNDAY},get selfName(){return e.save.name},type:"special"})]:null)]:null),c(()=>c(()=>n.length>0)()?[a(on),a(gn),c(()=>c(()=>s.SATURDAY.length>0)()?[a(le),i(B,{get entries(){return s.SATURDAY},get selfName(){return e.save.name},type:"danger"})]:null),c(()=>c(()=>s.SUNDAY.length>0)()?[a(se),i(B,{get entries(){return s.SUNDAY},get selfName(){return e.save.name},type:"danger"})]:null)]:null),c(()=>c(()=>t.length>0)()?[a(cn),c(()=>c(()=>l.SATURDAY.length>0)()?[a(le),i(B,{get entries(){return l.SATURDAY},get selfName(){return e.save.name},type:"success"})]:null),c(()=>c(()=>l.SUNDAY.length>0)()?[a(se),i(B,{get entries(){return l.SUNDAY},get selfName(){return e.save.name},type:"success"})]:null)]:null),a(xe),a(an),(()=>{var d=a(ln),g=d.firstChild;return o(g,(()=>{var v=c(()=>!!e.save.wantsEmailUpdates);return()=>v()?a(mn):a(vn)})()),d})()]}var _n=u("<ul role=list style=display:flex;flex-wrap:wrap;column-gap:1rem;row-gap:.5rem;><li></li><li></li><li></li><li>"),bn=u("<div style=display:flex;justify-content:space-between;><div></div><div>"),yn=u("<div style=display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:1rem;><div>Zuletzt gespeichert am <!$><!/></div><div style=display:flex;flex-wrap:wrap;gap:1rem;align-items:center;margin-left:auto;><p><em><small></small></em></p><!$><!/>"),Rn=u('<div style="padding-block:2rem 1rem;position:sticky;bottom:0;background-image:linear-gradient(transparent, var(--clr-3) 25%);">'),kn=u("<div style=padding-block:1rem;>"),xn=u("<h2>Programm Samstag"),Nn=u("<h2>Programm Sonntag"),En=u("<div class=content><h2>Zusammenfassung</h2><small>Hier hast du die komplette Übersicht über alle deine Eingaben. Du kannst bis am <strong>Freitag, 23. August 2024</strong> zurückkommen und deine Kontaktdaten und Reservationen anpassen.</small><!$><!/>");function Cn(e){return(()=>{var t=a(_n),n=t.firstChild,l=n.nextSibling,s=l.nextSibling,r=s.nextSibling;return o(n,i(G,{label:"Kontaktdaten",get kind(){return e.activeTab==="Contact"?"special":"gray"},onClick:()=>e.changeTab("Contact")})),o(l,i(G,{label:"Programm Samstag",get kind(){return e.activeTab==="Saturday"?"special":"gray"},onClick:()=>e.changeTab("Saturday")})),o(s,i(G,{label:"Program Sonntag",get kind(){return e.activeTab==="Sunday"?"special":"gray"},onClick:()=>e.changeTab("Sunday")})),o(r,i(G,{label:"Zusammenfassung",get kind(){return e.activeTab==="Summary"?"special":"gray"},onClick:()=>e.changeTab("Summary")})),t})()}function An(e){function t(){switch(e.activeTab){case"Saturday":e.changeTab("Contact");break;case"Sunday":e.changeTab("Saturday");break;case"Summary":e.changeTab("Sunday");break}}function n(){switch(e.activeTab){case"Contact":e.changeTab("Saturday");break;case"Saturday":e.changeTab("Sunday");break;case"Sunday":e.changeTab("Summary");break}}return(()=>{var l=a(bn),s=l.firstChild,r=s.nextSibling;return o(s,(()=>{var d=c(()=>e.activeTab!=="Contact");return()=>d()?i(G,{label:"<< Vorheriger Schritt",onClick:t}):null})()),o(r,(()=>{var d=c(()=>e.activeTab!=="Summary");return()=>d()?i(G,{label:"Nächster Schritt >>",onClick:n}):null})()),l})()}function Tn(e){const t=new Intl.DateTimeFormat("de-CH",{timeStyle:"short",dateStyle:"long"});return i(Ee,{get type(){return e.state==="HAS_CHANGES"?"success":"gray"},get children(){var n=a(yn),l=n.firstChild,s=l.firstChild,r=s.nextSibling,[d,g]=h(r.nextSibling),v=l.nextSibling,m=v.firstChild,f=m.firstChild,$=f.firstChild,_=m.nextSibling,[b,R]=h(_.nextSibling);return o(l,()=>t.format(new Date(e.lastSaved)),d,g),o($,()=>e.state==="NO_CHANGES"?"keine Änderungen entdeckt":e.state==="HAS_CHANGES"?"ungespeicherte Änderungen entdeckt":""),o(v,i(G,{get disabled(){return e.state!=="HAS_CHANGES"},get label(){return e.state==="NO_CHANGES"?"Gespeichert.":e.state==="SAVING"?"Wird gespeichert...":"Speichern"},get kind(){return e.state==="HAS_CHANGES"?"success":"gray"},get onClick(){return e.saveCurrentState}}),b,R),n}})}function wn(e){return[i(Cn,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}}),(()=>{var t=a(kn);return o(t,i(Ee,{get children(){return[c(()=>c(()=>e.activeTab==="Contact")()?i(ct,{get save(){return e.save},get updateSave(){return e.updateSave}}):c(()=>e.activeTab==="Saturday")()?[a(xn),i(ee,{get fallback(){return i(w,{children:"Programm wird geladen ..."})},get children(){return i(Y,{get children(){return i(V,{get when(){return e.programResource()},children:n=>i(Wt,{get selfName(){return e.save.name},get program(){return n()},get wantsEmailUpdates(){return e.save.wantsEmailUpdates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})})}})}})]:c(()=>e.activeTab==="Sunday")()?[a(Nn),i(ee,{get fallback(){return i(w,{children:"Programm wird geladen ..."})},get children(){return i(Y,{get children(){return i(V,{get when(){return e.programResource()},children:n=>i(Zt,{get selfName(){return e.save.name},get program(){return n()},get wantsEmailUpdates(){return e.save.wantsEmailUpdates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})})}})}})]:(()=>{var n=a(En),l=n.firstChild,s=l.nextSibling,r=s.nextSibling,[d,g]=h(r.nextSibling);return o(n,i(ee,{get fallback(){return i(w,{children:"Zusammenfassung wird geladen ..."})},get children(){return i(Y,{get children(){return i(V,{get when(){return e.programResource()},children:v=>i(Sn,{get save(){return e.save},get tentativeReservations(){return e.tentativeReservations},get program(){return v()},get markedForDeletionReservations(){return e.markedForDeletionReservations}})})}})}}),d,g),n})()),(()=>{var n=a(Rn);return o(n,i(Tn,{get lastSaved(){return e.lastSaved},get saveCurrentState(){return e.saveCurrentState},get state(){return e.saveState}})),n})()]}})),t})(),i(An,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}})]}function Dn(){return typeof window<"u"}function Un(){if(Dn()){const e=new URL(location.href),t=e.searchParams.get("secret"),n=e.searchParams.get("showCreateMessage")==="true";return{secret:t,showCreateMessage:n}}return null}async function Ie(e){if(e.secret===null)throw Error("SECRET_ERROR");const t=await St(e.secret);if(t.kind==="FAILED")throw Error("SECRET_ERROR");return{state:"IDLE",secret:e.secret,showCreateMessage:e.showCreateMessage,currentSave:t.save,activeTab:"Contact",lastSaved:t.save.lastSaved,hasChanged:!1,tentativeReservations:[],markedForDeletionReservations:[]}}async function pn(e=!1){const t=await yt(e);if(t.kind==="FAILED")throw Error("PROGRAM_ERROR");return t.program}function Fn(e){const[t,n]=dt(e);function l(v){n("activeTab",v),window.scrollTo({top:0})}function s(v,m){n("hasChanged",!0),n("currentSave",v,m)}async function r(){if(t.state!=="IDLE")throw Error("ASSERTION_ERROR");n("state","SAVING");const v=te("/rst24/save"),m={...t.currentSave,games:[...t.currentSave.games.filter($=>!t.markedForDeletionReservations.includes($.id)),...t.tentativeReservations.map($=>$.friendsName===null?{game:$.gameUuid,self:!0,spielerName:null}:{game:$.gameUuid,self:!1,spielerName:$.friendsName})]};if((await fetch(v,{method:"post",body:JSON.stringify(m),headers:{"Content-Type":"application/json"}})).ok){const $=await Ie({secret:t.secret,showCreateMessage:!1});n({...$,activeTab:t.activeTab})}else throw Error("SAVE_ERROR")}function d(v){n("hasChanged",!0),n("tentativeReservations",m=>[...m,v])}function g(v){if(n("hasChanged",!0),v.confirmed)n("markedForDeletionReservations",m=>[...m,v.reservationId]);else{const m=t.currentSave.name;n("tentativeReservations",f=>f.filter($=>$.gameUuid!==v.gameUuid?!0:$.friendsName===v.name?!1:v.name!==m))}}return{state:t,actions:{changeTab:l,updateSave:s,saveCurrentState:r,addTentativeReservation:d,deleteReservation:g}}}var ue=u("<br>"),In=u("<strong>Freitag, 23. August 2024"),On=u("<p>Deine Anmeldung wird geladen..."),Pn=u("<p>Wir konnten leider keine Anmeldung finden. Wenn du bereits eine Anmeldung begonnen hast, solltest du den korrekten Link per E-Mail erhalten haben.<br><br> Falls du noch keine Anmeldung begonnen hast, kannst du <a href=/anmeldung>hier</a> deine persönliche Anmeldung beginnen. <br><br>Für generelle Fragen oder Probleme, schreibe uns doch bitte über unser <a href=/kontatk>Kontaktformular</a>."),Gn=u("<p>Leider ist ein unerwarteter Fehler passiert. Versuche deine Anmeldung erneut zu laden. Wiederholt sich dieser Fehler, bitte kontaktiere uns sobald als möglich über das <a href=/kontakt>Kontaktformular</a>, da dies nicht passieren sollte.");function Mn(e){const{state:t,actions:n}=Fn(e.state);return[i(X,{get when(){return t.showCreateMessage},get children(){return[i(w,{type:"success",get children(){return["Deine Anmeldung wurde erfolgreich gestartet.",a(ue),a(ue),"Wir haben eine E-Mail an deine Adresse gesendet. In dieser E-Mail findest du einen persönlichen Link, um deine Anmeldung bis am"," ",a(In)," anzupassen."]}}),a(ue)]}}),i(wn,{get activeTab(){return t.activeTab},get changeTab(){return n.changeTab},get save(){return t.currentSave},get updateSave(){return n.updateSave},get lastSaved(){return t.lastSaved},get saveCurrentState(){return n.saveCurrentState},get saveState(){return t.state==="SAVING"?"SAVING":t.hasChanged?"HAS_CHANGES":"NO_CHANGES"},get programResource(){return e.programResource},get confirmedReservations(){return t.currentSave.games},get tentativeReservations(){return t.tentativeReservations},get addTentativeReservation(){return n.addTentativeReservation},get deleteReservation(){return n.deleteReservation},get markedForDeletionReservations(){return t.markedForDeletionReservations}})]}function Oe(){return i(w,{get children(){return a(On)}})}function zn(){const[e,t]=Ne(null);return nt(()=>{t(Un())}),i(Y,{get fallback(){return i(Oe,{})},get children(){return i(V,{get when(){return e()},children:n=>i(Ln,{get params(){return n()}})})}})}function Ln(e){const[t]=ve(()=>Ie(e.params)),[n]=ve(()=>pn(e.params.secret==="demo"));return i(rt,{fallback:l=>i(w,{type:"danger",get children(){return i(Y,{get fallback(){return a(Gn)},get children(){return i(V,{get when(){return l.message==="SECRET_ERROR"},get children(){return a(Pn)}})}})}}),get children(){return i(ee,{get fallback(){return i(Oe,{})},get children(){return i(Y,{get children(){return i(V,{get when(){return t()},children:l=>i(Mn,{get state(){return l()},programResource:n})})}})}})}})}export{zn as MeineAnmeldungWrapper};
