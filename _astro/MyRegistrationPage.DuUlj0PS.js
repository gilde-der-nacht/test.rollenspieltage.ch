import{c as Dt,I as Qt,B as w,d as Xt,f as z,g as Je,h as Y,b as W,s as en,i as Ut,j as Ve,k as tn,e as st,l as nn,m as Ot,n as rn,u as ln}from"./utils.CDxFvly-.js";import{b as an,g as o,t as c,a as d,u as sn,i as s,c as r,S as C,d as se,e as $e,F,M as T,f as oe,s as Qe,h as Ge,j as ze,k as ot,m as M,r as ut,l as dt,n as on,o as He,p as It,q as Mt,E as un}from"./web.CQCfMWOb.js";/* empty css                                 */import{c as R,u as dn}from"./store.C6sBeAjO.js";import{T as cn}from"./Textarea.Bmm2iH4o.js";import{s as p,n as L,e as We,T as k,o as x,a as ee,C as Nt,d as gn,l as ce,b as pe,c as mn}from"./texts.D7lwL5J7.js";var hn=c("<dialog><!$><!/><!$><!/><!$><!/>"),$n=c("<h4>");function ve(){return{open:!1}}function ke(e){let t;const[n,i]=R(e.store);an(()=>{n.open?t.showModal():t.close()});function l(){i({open:!1}),e.onClose?.()}const a=()=>{const u=[];return e.type!==void 0&&u.push(e.type),e.size!==void 0&&u.push(e.size),e.onClose!==void 0&&u.push("dialog-with-close"),u};return(()=>{var u=o(hn),g=u.firstChild,[m,$]=d(g.nextSibling),h=m.nextSibling,[S,_]=d(h.nextSibling),b=S.nextSibling,[f,v]=d(b.nextSibling);u.addEventListener("close",l);var y=t;return typeof y=="function"?sn(y,u):t=u,s(u,r(C,{get when(){return e.onClose},get children(){return r(Dt,{onClick:l,icon:"circle-xmark",kind:"gray"})}}),m,$),s(u,r(C,{get when(){return e.title},children:E=>(()=>{var D=o($n);return s(D,E),D})()}),S,_),s(u,()=>e.children,f,v),se(()=>$e(u,a().join(" "))),u})()}var ct=c("<p>");function De(e){const[t,n]=R(e.store),i=e.showErrors==="ALWAYS",l=()=>i||t.isDirty?e.errors??[]:[];return[r(Qt,{get label(){return e.label},get name(){return e.name},get value(){return t.value},onValueUpdate:a=>n("value",a),onBlur:()=>n("isDirty",!0),get type(){return e.type},get required(){return e.required},get isHoneypot(){return e.isHoneypot}}),r(C,{get when(){return l().length>0},get children(){return r(w,{type:"danger",get children(){return r(F,{get each(){return l()},children:a=>(()=>{var u=o(ct);return s(u,a),u})()})}})}})]}function $t(e){const[t,n]=R(e.store),i=e.showErrors==="ALWAYS",l=()=>i||t.isDirty?e.errors??[]:[];return[r(Xt,{get label(){return e.label},get name(){return e.name},get value(){return t.value},onValueUpdate:a=>n("value",a),onBlur:()=>n("isDirty",!0),get required(){return e.required},get isHoneypot(){return e.isHoneypot},get min(){return e.min},get max(){return e.max}}),r(C,{get when(){return l().length>0},get children(){return r(w,{type:"danger",get children(){return r(F,{get each(){return l()},children:a=>(()=>{var u=o(ct);return s(u,a),u})()})}})}})]}function it(e){const[t,n]=R(e.store),i=e.showErrors==="ALWAYS",l=()=>i||t.isDirty?e.errors??[]:[];return[r(cn,{get label(){return e.label},get name(){return e.name},get value(){return t.value},onValueUpdate:a=>n("value",a),onBlur:()=>n("isDirty",!0),get required(){return e.required},get size(){return e.size}}),r(C,{get when(){return l().length>0},get children(){return r(w,{type:"danger",get children(){return r(F,{get each(){return l()},children:a=>(()=>{var u=o(ct);return s(u,a),u})()})}})}})]}const Pe=p().transform(e=>({value:e,isDirty:!1}));function Xe(e){return{value:e,isDirty:!1}}const St=L().transform(e=>({value:e,isDirty:!1})),Ye={SATURDAY:{open:{from:10,to:24},breaks:[{from:13,to:14},{from:18,to:19}]},SUNDAY:{open:{from:10,to:18},breaks:[{from:13,to:14}]}};We(["SATURDAY","SUNDAY"]);function Le(e,t){const{from:n,to:i}=t;return n<e&&e<i}function Sn(e,t){const{from:n,to:i}=e,{from:l,to:a}=t;return Le(n,t)||Le(i,t)||Le(l,e)||Le(a,e)||n===l&&i===a}function lt(e,t=!1){const{from:n,to:i}=e;if(n>i)return[];const l=i-n;return[...Array(t?l+1:l)].map((a,u)=>u+n)}var _n=c("<div class=dynamic-columns style=gap:1rem;--min-width:30rem;><!$><!/><!$><!/>"),bn=c("<div><h4 style=margin-block-end:1.5rem;></h4><!$><!/>"),fn=c("<p>Konflikte gefunden! Bitte stelle sicher, dass du nicht zeitlich Ã¼berlappende Spielrunden eingetragen hast:"),vn=c('<div style="display:grid;grid-template-columns:1fr max-content 1fr;gap:1rem;margin-block:0.5rem;"><!$><!/><span style=color:var(--clr-warning-10);align-self:center;font-size:2rem;></span><!$><!/>'),pn=c("<div class=timetable><!$><!/><div class=entries></div><div class=after-hour><div class=annotation>"),kn=c("<div><div class=annotation></div><div class=background>"),yn=c("<div class=entry>");function xn(e){return(()=>{var t=o(_n),n=t.firstChild,[i,l]=d(n.nextSibling),a=i.nextSibling,[u,g]=d(a.nextSibling);return s(t,r(_t,{get programEntries(){return e.programEntries.SATURDAY},get openingHours(){return Ye.SATURDAY},day:"SATURDAY"}),i,l),s(t,r(_t,{get programEntries(){return e.programEntries.SUNDAY},get openingHours(){return Ye.SUNDAY},day:"SUNDAY"}),u,g),t})()}function _t(e){const t=En(e.programEntries);return(()=>{var n=o(bn),i=n.firstChild,l=i.nextSibling,[a,u]=d(l.nextSibling);return s(i,()=>k.days[e.day]),s(n,r(oe,{get fallback(){return[r(w,{type:"danger",get children(){return o(fn)}}),r(F,{each:t,children:([g,m])=>(()=>{var $=o(vn),h=$.firstChild,[S,_]=d(h.nextSibling),b=S.nextSibling,f=b.nextSibling,[v,y]=d(f.nextSibling);return s($,()=>g.component(),S,_),s(b,r(z,{icon:"triangle-exclamation"})),s($,()=>m.component(),v,y),$})()})]},get children(){return r(T,{get when(){return t.length===0},get children(){return r(Cn,{get programEntries(){return e.programEntries},get openingHours(){return e.openingHours},get day(){return e.day}})}})}}),a,u),n})()}function Cn(e){const t=lt(e.openingHours.open),n=e.openingHours.breaks.map(({from:a})=>a),i=(t[0]??0)-1,l=t.at(-1)??0;return(()=>{var a=o(pn),u=a.firstChild,[g,m]=d(u.nextSibling),$=g.nextSibling,h=$.nextSibling,S=h.firstChild;return s(a,r(F,{each:t,children:_=>{const b=n.includes(_);return(()=>{var f=o(kn),v=f.firstChild;return $e(f,`hour ${b?"break":""}`),s(v,_),se(y=>Qe(f,bt({from:_,to:_},i,e.day),y)),f})()}}),g,m),s($,r(F,{get each(){return e.programEntries},children:_=>(()=>{var b=o(yn);return s(b,()=>_.component()),se(f=>Qe(b,bt(_.range,i,e.day),f)),b})()})),s(S,l+1),se(_=>Qe($,`grid-row: 1 / ${l-i+1};`,_)),a})()}function bt(e,t,n){const{from:i,to:l}=e,a=i-t,u=l-t,g=Ye[n].open.to;return Je(a>0,`Entry can't start at ${i}.`),Je(u>0,`Entry can't end at ${l}.`),Je(l<=g,`Entry can't end at ${l}.`),`grid-row: ${a} / ${u};`}function En(e){const t=[];return e.forEach((n,i)=>{e.slice(i+1).forEach(l=>{Sn(n.range,l.range)&&t.push([n,l])})}),t}var wn=c("<span>");function Pt(e){const t=()=>{const n=["chip"];return n.push(e.kind??"gray"),e.inverted&&n.push("inverted"),e.size==="small"&&n.push("small"),n.join(" ")};return(()=>{var n=o(wn);return s(n,()=>e.children),se(i=>{var l=t(),a=e.title;return l!==i.e&&$e(n,i.e=l),a!==i.t&&Ge(n,"title",i.t=a),i},{e:void 0,t:void 0}),n})()}var Lt=c("<br>"),An=c("<div style=display:grid;gap:1rem;><h3>Meine Kontaktdaten</h3><p><strong>Name:</strong> <!$><!/></p><p><strong>E-Mail:</strong> <!$><!/></p><p><strong>Handynummer:</strong> <!$><!/></p><div>"),Rn=c("<form novalidate><!$><!/><!$><!/><!$><!/><!$><!/>"),Tn=c("<h3>Mein Programm"),Dn=c("<div><!$><!/><!$><!/><h5></h5><p class=duration>von <!$><!/> bis <!$><!/> Uhr <em><small>(<!$><!/> <!$><!/>)");function Un(e){const t=e.store.master.games.flatMap(n=>n.slots.map(i=>({status:n.kind,uuid:n.uuid,title:n.title.value,dateTime:i})));return[r(On,{get store(){return e.store.init}}),o(Lt),r(Mn,{entries:{play:[],master:t,help:[]},get changePage(){return e.changePage}})]}function On(e){const[t,n]=R(e.store),[i,l]=R(ve());return r(w,{get children(){return[r(C,{get when(){return i.open},get children(){return r(In,{dialogStore:i,get currentState(){return e.store},updateCurrentState:n})}}),(()=>{var a=o(An),u=a.firstChild,g=u.nextSibling,m=g.firstChild,$=m.nextSibling,h=$.nextSibling,[S,_]=d(h.nextSibling),b=g.nextSibling,f=b.firstChild,v=f.nextSibling,y=v.nextSibling,[E,D]=d(y.nextSibling),O=b.nextSibling,N=O.firstChild,H=N.nextSibling,J=H.nextSibling,[I,j]=d(J.nextSibling),V=O.nextSibling;return s(g,()=>e.store.name,S,_),s(b,()=>e.store.email,E,D),s(O,()=>e.store.mobile,I,j),s(V,r(Y,{icon:"pencil",label:"Kontakdaten editieren",onClick:()=>l("open",!0)})),a})()]}})}function In(e){const[t]=R({name:Xe(e.currentState.name),email:Xe(e.currentState.email),mobile:Xe(e.currentState.mobile)}),n=ze(()=>{const a={name:[],email:[]};return t.name.value.trim().length===0&&a.name.push(k.mandatoryField),t.email.value.trim().length===0?a.email.push(k.mandatoryField):t.email.value.includes("@")||a.email.push(k.invalidEmail),{...a,hasErrors:a.name.length+a.email.length>0}}),[i,l]=R(e.dialogStore);return r(ke,{get store(){return e.dialogStore},title:"Kontaktdaten editieren",onClose:()=>{},size:"medium",get children(){var a=o(Rn),u=a.firstChild,[g,m]=d(u.nextSibling),$=g.nextSibling,[h,S]=d($.nextSibling),_=h.nextSibling,[b,f]=d(_.nextSibling),v=b.nextSibling,[y,E]=d(v.nextSibling);return s(a,r(De,{get store(){return t.name},label:"Name",name:"name",showErrors:"ON_BLUR",get errors(){return n().name}}),g,m),s(a,r(De,{get store(){return t.email},label:"E-Mail",name:"email",showErrors:"ON_BLUR",get errors(){return n().email}}),h,S),s(a,r(De,{get store(){return t.mobile},label:"Handynummer",name:"mobile"}),b,f),s(a,r(W,{label:"Speichern",get disabled(){return n().hasErrors},onClick:()=>{n().hasErrors||(e.updateCurrentState({name:t.name.value,email:t.email.value,mobile:t.mobile.value}),l("open",!1))}}),y,E),a}})}function Mn(e){const t=Nn(e.entries,e.changePage);return[o(Tn),o(Lt),r(xn,{programEntries:t})]}function et(e){const t=e.range.to-e.range.from,n={"master-draft":{label:"SL",help:"Spielleitung",link:{icon:"pencil",label:"Spielrunde bearbeiten"}},master:{label:"SL",help:"Spielleitung",link:{icon:"pencil",label:"Spielrunde bearbeiten"}},play:{label:"TN",help:"Teilnehmer:in",link:{icon:"link",label:"Zur Spielrunde"}},help:{label:"HL",help:"Helfen",link:{icon:"link",label:""}}}[e.kind],i=()=>{const l=["timeview-entry","box-simple"];return e.kind==="master-draft"&&l.push("gray"),e.kind==="master"&&l.push("special"),l.join(" ")};return(()=>{var l=o(Dn),a=l.firstChild,[u,g]=d(a.nextSibling),m=u.nextSibling,[$,h]=d(m.nextSibling),S=$.nextSibling,_=S.nextSibling,b=_.firstChild,f=b.nextSibling,[v,y]=d(f.nextSibling),E=v.nextSibling,D=E.nextSibling,[O,N]=d(D.nextSibling),H=O.nextSibling,J=H.nextSibling,I=J.firstChild,j=I.firstChild,V=j.nextSibling,[Q,Z]=d(V.nextSibling),ne=Q.nextSibling,G=ne.nextSibling,[te,re]=d(G.nextSibling);return te.nextSibling,s(l,r(Pt,{get title(){return n.help},inverted:!0,size:"small",get children(){return n.label}}),u,g),s(l,r(C,{get when(){return e.onClick},children:P=>r(Dt,{get icon(){return n.link.icon},kind:"ghost",get onClick(){return P()},get title(){return n.link.label}})}),$,h),s(S,()=>e.title),s(_,()=>e.range.from,v,y),s(_,()=>e.range.to,O,N),s(I,t,Q,Z),s(I,t===1?"Stunde":"Stunden",te,re),se(P=>{var X=i(),B=e.title;return X!==P.e&&$e(l,P.e=X),B!==P.t&&Ge(S,"title",P.t=B),P},{e:void 0,t:void 0}),l})()}function Nn(e,t){const n={SATURDAY:[],SUNDAY:[]};return e.play.forEach(i=>{n[i.dateTime.day].push({range:i.dateTime,component:()=>r(et,{get title(){return i.title},get range(){return i.dateTime},kind:"play"})})}),e.master.forEach(i=>{if(i.status==="deleted")return;const l=[i.title];i.status==="draft"&&l.unshift("(noch nicht verÃ¶ffentlicht)"),n[i.dateTime.day].push({range:i.dateTime,component:()=>r(et,{get title(){return l.join(" ")},get range(){return i.dateTime},get kind(){return i.status==="published"?"master":"master-draft"},onClick:()=>t({kind:"EDIT_GAMEROUND",uuid:i.uuid})})})}),e.help.forEach(i=>{n[i.dateTime.day].push({range:i.dateTime,component:()=>r(et,{get title(){return i.title},get range(){return i.dateTime},kind:"help"})})}),n}var Pn=c("<p>Diese Seite ist leider noch nicht bereit. Komm bitte spÃ¤ter nochmal zurÃ¼ck.");function Ln(){return r(w,{type:"danger",get children(){return o(Pn)}})}var Fn=c("<div class=grid><!$><!/><div>"),Hn=c("<div class=boxLink>");function fe(e){const t=e.type??"special";return(()=>{var n=o(Hn);return s(n,r(w,{type:t,get onClick(){return e.onClick},get children(){var i=o(Fn),l=i.firstChild,[a,u]=d(l.nextSibling),g=a.nextSibling;return s(i,r(z,{get icon(){return e.icon}}),a,u),s(g,()=>e.children),i}})),n})()}const gt=We(["SATURDAY","SUNDAY"]),Ft=x({uuid:p().uuid(),day:gt,from:L(),to:L()}).refine(e=>e.from<e.to,{message:"A TimeSlot can't end before it starts."});x({name:p(),label:p(),description:p()});const Ht=We(["draft","published","deleted"]),Gn=x({uuid:p().uuid(),kind:Ht,title:p(),system:p(),description:x({short:p(),long:p()}),slots:ee(Ft),playerCount:x({min:L().min(1),max:L()}).transform(e=>{const[t,n]=en([e.min,e.max]);return{min:t,max:n}}),tagNames:ee(p())}),Gt=x({uuid:p().uuid(),kind:Ht,title:Pe,system:Pe,description:x({short:Pe,long:Pe}),slots:ee(Ft),playerCount:x({min:St,max:St}),tagNames:ee(p())});function Yn(){const e={uuid:crypto.randomUUID(),kind:"draft",title:"",system:"",description:{short:"",long:""},slots:[],playerCount:{min:2,max:4},tagNames:["deutsch"]},t=Bn(e);if(t.success)return t.data;throw console.error(t),Error("should not happen")}function Bn(e){return Gt.safeParse(e)}function zn(e){return{...e,title:e.title.value,system:e.system.value,description:{short:e.description.short.value,long:e.description.long.value},playerCount:{min:e.playerCount.min.value,max:e.playerCount.max.value}}}const mt=[{name:"ab6jahren",label:"Ab 6 Jahren",description:"Spannungs- und Bedrohungsmomente werden kurz gehalten. In Begleitung oder nach Absprache mit einem Elternteil. Beispiele: My Little Pony, ..."},{name:"ab12jahren",label:"Ab 12 Jahren",description:"Antisoziales und destruktives wird auf ein Minimum begrenzt. Keine Diskriminierung, keine Radikalisierung, SexualitÃ¤t wird nicht explizit dargestellt."},{name:"ab18jahren",label:"Ab 18 Jahren",description:"Keinerlei Richtlinien bezÃ¼glich Inhalt, in der Gruppe sollte aber diskutiert werden, was akzeptabel ist und was nicht. Beispiele: Vampire the Masquerade, ..."},{name:"fantasy",label:"Fantasy",description:"Spielt in einer alternativen Vergangenheit, in welcher Elemente wie: Ritterinnen, Hexenmeister, RÃ¼stungen, Magie, Goblins, Turniere usw. vorkommen kÃ¶nnen. Beispiele: Das Schwarze Auge, Dungeons & Dragons, ..."},{name:"sciencefiction",label:"Science Fiction",description:"Spielt in einer alternativen Zukunft, in welcher Elemente wie: Raumschiffe, Sternenportale, KÃ¼nstliche Intelligenzen, Laserkanonen usw. vorkommen kÃ¶nnen. Beispiele: Shadowrun, Alien, ..."},{name:"postapokalyptisch",label:"Postapokalyptisch",description:"Spielt in einer Welt mitten oder nach einem Kollaps, wo die Mehrheit ums Ãberleben kÃ¤mpft. Beispiele: Mutant Year Zero, Apocalypse World"},{name:"horror",label:"Horror",description:"Eine gruselige AtmosphÃ¤re, psychologischen Druck oder unvorhersehbare Schreckensmomente. Beispiele: Cthulhu, ..."},{name:"offenewelt",label:"Offene Welt",description:"Es gibt nur einen losen Handlungsfaden, die Rollenspiel-Gruppe muss sich ihre Ziele selber festlegen. Beispiele: Ironsworn, Blades in the Dark, ..."},{name:"gemeinsamespielleitung",label:"Gemeinsame Spielleitung",description:"Die Regeln und die Umwelt werden gemeinsam von allen Spielenden umgesetzt. Beispiele: Microscope, The Quiet Year, ..."},{name:"regelleicht",label:"Regelleicht",description:"Die kompletten Regeln haben alle auf einer Seite Platz. Beispiele: Fiasco, Everyone is John, ..."},{name:"deutsch",label:"Deutsch",description:"Bei der Spielrunde reden die Spielenden miteinander Deutsch."},{name:"englisch",label:"Englisch",description:"Bei der Spielrunde reden die Spielenden miteinander Englisch."},{name:"workshop",label:"Workshop",description:"Unter Anleitung, gemeinsam ein Rollenspiel-Thema vertiefen. Kreative Techniken stehen im Vordergrund. Beispiele: Gemeinsam ein Dungeon erschaffen, Gemeinsam ein Hintergrundgeschichte schreiben, ..."}],je=200,Yt=500,Bt=200;function Wn(e){const t=e.title.value.trim().length===0,n=e.description.short.value.trim().length===0,i=e.description.short.value.length>je,l=e.description.long.value.length>Yt,a=e.slots.length===0;return{titleMissing:t,descriptionShortMissing:n,descriptionShortTooLong:i,descriptionLongTooLong:l,slotMissing:a,hasErrors:t||n||i||l||a}}function jn(e){const t=e.updateText.value.trim().length===0,n=e.updateText.value.length>Bt;return{missing:t,tooLong:n,hasErrors:t||n}}var Zn=c("<h3>"),Kn=c("<br>"),qn=c("<div style=margin-top:2rem;><h3 style=margin-bottom:1rem;></h3><ul class=event-list role=list>"),Jn=c('<li><h3 class=event-title></h3><div class=event-details><div class=event-tags><strong>Status:</strong><!$><!/></div><div class=event-tags><strong>System:</strong><!$><!/></div><div class=event-tags><strong>Tag, Zeit:</strong><!$><!/></div><div class=event-tags><strong>Spielende:</strong> <!$><!/> - <!$><!/></div> <div class=event-tags><strong>Kategorien:</strong> <!$><!/></div></div><div class="event-description content"><p><strong>Kurzbeschreibung:</strong><br><!$><!/></p></div><ul role=list class=event-links><li><button class=event-link><span>Bearbeiten'),Ae=c("<em>"),Vn=c("<span><!$><!/>, <!$><!/> - <!$><!/> Uhr");function Qn(e){const[t,n]=R(e.store);function i(){const l=Yn();n("games",t.games.length,l),e.changePage({kind:"EDIT_GAMEROUND",uuid:l.uuid})}return[r(fe,{icon:"grid-2-plus",type:"success",onClick:i,get children(){var l=o(Zn);return s(l,()=>k.createNewGameRound),l}}),o(Kn),r(Nt,{label:"Ich habe wenig bis keine Spielleitung-Erfahrung und mÃ¶chte gerne in der Vorbereitung und/oder wÃ¤hrend der Spielrunde unterstÃ¼tzt werden.",get checked(){return t.wantsHelp},name:"wantsHelp",value:"wantsHelp",onValueUpdate:l=>{n("wantsHelp",l)}}),r(C,{get when(){return e.store.games},children:l=>(()=>{var a=o(qn),u=a.firstChild,g=u.nextSibling;return s(u,()=>k.myGameRounds),s(g,r(F,{get each(){return l().filter(m=>m.kind!=="deleted")},children:m=>{const $=m.tagNames.map(h=>mt.find(({name:S})=>S===h)).filter(h=>h!==void 0).map(({label:h})=>h);return r(F,{get each(){return m.slots},get fallback(){return r(ft,{game:m,slot:null,tags:$,get changePage(){return e.changePage}})},children:h=>r(ft,{game:m,slot:h,tags:$,get changePage(){return e.changePage}})})}})),a})()})]}function ft(e){const{game:t,slot:n,tags:i,changePage:l}=e;return(()=>{var a=o(Jn),u=a.firstChild,g=u.nextSibling,m=g.firstChild,$=m.firstChild,h=$.nextSibling,[S,_]=d(h.nextSibling),b=m.nextSibling,f=b.firstChild,v=f.nextSibling,[y,E]=d(v.nextSibling),D=b.nextSibling,O=D.firstChild,N=O.nextSibling,[H,J]=d(N.nextSibling),I=D.nextSibling,j=I.firstChild,V=j.nextSibling,Q=V.nextSibling,[Z,ne]=d(Q.nextSibling),G=Z.nextSibling,te=G.nextSibling,[re,P]=d(te.nextSibling),X=I.nextSibling,B=X.nextSibling,K=B.firstChild,ue=K.nextSibling,U=ue.nextSibling,[de,ie]=d(U.nextSibling),le=g.nextSibling,q=le.firstChild,me=q.firstChild,Se=me.nextSibling,ye=Se.nextSibling,[xe,he]=d(ye.nextSibling),_e=le.nextSibling,Ce=_e.firstChild,Ee=Ce.firstChild;return s(u,(()=>{var A=M(()=>t.title.value.length>0);return()=>A()?t.title.value:(()=>{var ae=o(Ae);return s(ae,()=>k.missingTitle),ae})()})()),s(m,()=>k.publishingSteps[t.kind],S,_),s(b,()=>t.system.value||(()=>{var A=o(Ae);return s(A,()=>k.missingSystem),A})(),y,E),s(D,n!==null?(()=>{var A=o(Vn),ae=A.firstChild,[Ie,Ze]=d(ae.nextSibling),Me=Ie.nextSibling,Ke=Me.nextSibling,[Ne,qe]=d(Ke.nextSibling),we=Ne.nextSibling,Jt=we.nextSibling,[ht,Vt]=d(Jt.nextSibling);return ht.nextSibling,s(A,()=>k.days[n.day],Ie,Ze),s(A,()=>n.from,Ne,qe),s(A,()=>n.to,ht,Vt),A})():(()=>{var A=o(Ae);return s(A,()=>k.missingSlot),A})(),H,J),s(I,()=>t.playerCount.min.value,Z,ne),s(I,()=>t.playerCount.max.value,re,P),s(B,()=>i.join(", ")||(()=>{var A=o(Ae);return s(A,()=>k.missingTags),A})(),de,ie),s(q,(()=>{var A=M(()=>t.description.short.value.length===0);return()=>A()?(()=>{var ae=o(Ae);return s(ae,()=>k.missingShortDescription),ae})():Ut(t.description.short.value,je)})(),xe,he),Ee.$$click=()=>l({kind:"EDIT_GAMEROUND",uuid:t.uuid}),se(()=>$e(a,["event-entry",t.kind==="draft"?"gray":""].join(" "))),ut(),a})()}ot(["click"]);var Xn=c("<p>WIP"),er=c("<p>Diese Seite ist leider noch nicht bereit. Komm bitte spÃ¤ter nochmal zurÃ¼ck."),tr=c("<h1>loading"),nr=c("<p>Programm konnte nicht geladen werden."),Re=c("<br>"),rr=c("<h3>Samstag"),vt=c('<ul class="event-list max"role=list>'),ir=c("<h3>Sonntag"),lr=c('<li><h3 class=event-title></h3><div class=event-details><div class=event-tags><strong>Spielleitung:</strong><!$><!/></div><div class=event-tags><strong>System:</strong><!$><!/></div><div class=event-tags><strong>Tag, Zeit:</strong><span><!$><!/>, <!$><!/> - <!$><!/> Uhr</span></div><div class=event-tags><strong>Freie PlÃ¤tze:</strong> <!$><!/> (von <!$><!/>)</div> <div class=event-tags><strong>Kategorien:</strong> <!$><!/></div></div><div class="event-description content"><p><strong>Kurzbeschreibung:</strong><br><!$><!/></p></div><ul role=list class=event-links><li><button class=event-link><span>Teilnehmen</span></button></li><li><button class=event-link><span>Details'),ar=c("<em>kein System angegeben"),sr=c("<em>keine Kategorien");function or(e){return r(oe,{get fallback(){return r(w,{type:"danger",get children(){return o(er)}})},get children(){return r(T,{get when(){return e.isDebugging},get children(){return[r(w,{type:"danger",get children(){return o(Xn)}}),r(C,{get when(){return e.program()},get fallback(){return o(tr)},children:t=>r(C,{get when(){return t().kind==="SUCCESS"},get fallback(){return r(w,{type:"danger",get children(){return o(nr)}})},get children(){return r(ur,{get program(){return t().data}})}})})]}})}})}function ur(e){const t=cr(dr(e.program));return[o(Re),o(rr),o(Re),(()=>{var n=o(vt);return s(n,r(F,{get each(){return t.SATURDAY},get fallback(){return r(w,{children:"Keine Spielrunden gefunden."})},children:i=>r(pt,{entry:i})})),n})(),o(Re),o(Re),o(ir),o(Re),(()=>{var n=o(vt);return s(n,r(F,{get each(){return t.SUNDAY},get fallback(){return r(w,{children:"Keine Spielrunden gefunden."})},children:i=>r(pt,{entry:i})})),n})()]}function dr(e){const t=Object.groupBy(e,n=>n.slot.day);return{SATURDAY:t.SATURDAY??[],SUNDAY:t.SUNDAY??[]}}function cr(e){function t(n,i){const{from:l,to:a}=n.slot,{from:u,to:g}=i.slot;return l===u?a-g:l-u}return{SATURDAY:e.SATURDAY.toSorted(t),SUNDAY:e.SUNDAY.toSorted(t)}}function pt(e){const t=e.entry.tags.map(n=>mt.find(({name:i})=>i===n)).filter(n=>n!==void 0).map(({label:n})=>n);return(()=>{var n=o(lr),i=n.firstChild,l=i.nextSibling,a=l.firstChild,u=a.firstChild,g=u.nextSibling,[m,$]=d(g.nextSibling),h=a.nextSibling,S=h.firstChild,_=S.nextSibling,[b,f]=d(_.nextSibling),v=h.nextSibling,y=v.firstChild,E=y.nextSibling,D=E.firstChild,[O,N]=d(D.nextSibling),H=O.nextSibling,J=H.nextSibling,[I,j]=d(J.nextSibling),V=I.nextSibling,Q=V.nextSibling,[Z,ne]=d(Q.nextSibling);Z.nextSibling;var G=v.nextSibling,te=G.firstChild,re=te.nextSibling,P=re.nextSibling,[X,B]=d(P.nextSibling),K=X.nextSibling,ue=K.nextSibling,[U,de]=d(ue.nextSibling);U.nextSibling;var ie=G.nextSibling,le=ie.nextSibling,q=le.firstChild,me=q.nextSibling,Se=me.nextSibling,[ye,xe]=d(Se.nextSibling),he=l.nextSibling,_e=he.firstChild,Ce=_e.firstChild,Ee=Ce.nextSibling,A=Ee.nextSibling,[ae,Ie]=d(A.nextSibling),Ze=he.nextSibling,Me=Ze.firstChild,Ke=Me.firstChild,Ne=Me.nextSibling,qe=Ne.firstChild;return s(i,()=>e.entry.title),s(a,()=>e.entry.gamemaster,m,$),s(h,(()=>{var we=M(()=>e.entry.system.trim().length>0);return()=>we()?e.entry.system:o(ar)})(),b,f),s(E,()=>k.days[e.entry.slot.day],O,N),s(E,()=>e.entry.slot.from,I,j),s(E,()=>e.entry.slot.to,Z,ne),s(G,()=>Math.max(e.entry.playerCount.max-1-e.entry.playerCount.reserved,0),X,B),s(G,()=>e.entry.playerCount.max-1,U,de),s(le,(()=>{var we=M(()=>t.length>0);return()=>we()?t.join(", "):o(sr)})(),ye,xe),s(_e,()=>Ut(e.entry.description.short,je),ae,Ie),Ke.$$click=()=>console.log("not yet implemented"),qe.$$click=()=>console.log("not yet implemented"),se(()=>$e(n,["event-entry"].join(" "))),ut(),n})()}ot(["click"]);var kt=c("<h3>Spielrunden ansehen"),yt=c("<p>Melde dich (und deine Freunde) fÃ¼r diverse Spielrunden an."),tt=c("<br>"),gr=c("<h3>Spielrunden erstellen"),mr=c("<p>Falls du wenig oder gar keine Erfahrung als Spielleiter:in hast, werden wir dich vor und wÃ¤hrend dem Anlass unterstÃ¼tzen."),hr=c("<h3>Helfen"),$r=c("<p>Beim Kiosk und der Essensausgabe kÃ¶nnen wir immer ein paar helfende HÃ¤nde gebrauchen."),xt=c("<p><strong>Noch nicht verfÃ¼gbar."),Sr=c("<h3>Zusammenfassung"),_r=c("<p>Erhalte einen Ãberblick Ã¼ber dein gesamtes Programm.");function br(e){return[r(oe,{get fallback(){return r(fe,{type:"gray",icon:"dice-d20",onClick:()=>e.changePage({kind:"PLAYER"}),get children(){return[o(kt),o(yt),o(xt)]}})},get children(){return r(T,{get when(){return e.isDebugging},get children(){return r(fe,{icon:"dice-d20",onClick:()=>e.changePage({kind:"PLAYER"}),get children(){return[o(kt),o(yt)]}})}})}}),o(tt),r(fe,{icon:"grid-2-plus",onClick:()=>e.changePage({kind:"GAMEMASTER"}),get children(){return[o(gr),o(mr)]}}),o(tt),r(fe,{type:"gray",icon:"hand-heart",onClick:()=>e.changePage({kind:"HELPING"}),get children(){return[o(hr),o($r),o(xt)]}}),o(tt),r(fe,{icon:"list",onClick:()=>e.changePage({kind:"SUMMARY"}),get children(){return[o(Sr),o(_r)]}})]}var fr=c("<fieldset><legend>Zeitslots</legend><!$><!/><!$><!/>"),Ct=c("<br>"),vr=c("<div style=margin-block-end:0.5rem;>Zeitslot: <!$><!/>, <!$><!/> -<!$><!/> Uhr"),pr=c("<ul class=event-list role=list>"),kr=c("<em>werden geladen..."),yr=c("<li class=event-entry><h3 class=event-title><!$><!/>, <!$><!/> - <!$><!/> Uhr</h3><div class=event-details><div class=event-tags><strong>Dauer:</strong><!$><!/> <!$><!/></div><div class=event-tags><strong>Spielende:</strong> <!$><!/></div></div><div></div><ul role=list class=event-links>"),xr=c("<em>Fehler beim Laden."),Cr=c("<em>noch keine Anmeldungen"),Er=c("<li><em style=font-size:smaller;>Aktionen werden geladen..."),Et=c("<li><em style=font-size:smaller;>kann nicht gelÃ¶scht werden"),wr=c("<li><button type=button class=event-link><div style=display:flex;gap:0.25rem;align-items:center;><!$><!/><span>LÃ¶schen"),Ar=c("<div style=display:grid;gap:0.5rem;>"),Rr=c("<div style=display:grid;gap:0.5rem;><!$><!/><!$><!/>"),Tr=c("<div style=display:grid;gap:0.5rem;><!$><!/><!$><!/><!$><!/>"),Dr=c("<div style=display:grid;gap:0.5rem;><!$><!/><!$><!/><!$><!/><div style=margin-block-start:1rem;>"),Ur=c("<div style=display:flex;flex-wrap:wrap;gap:0.5rem;align-items:center;><!$><!/> <span>Neuen Slot erfassen"),Or=c("<em>WÃ¤hle eine Tag:"),Ir=c("<div style=display:flex;flex-wrap:wrap;gap:.5rem;><!$><!/><!$><!/>"),Mr=c("<em>WÃ¤hle eine Startzeit:"),zt=c("<div style=display:flex;flex-wrap:wrap;gap:.5rem;>"),Wt=c("<span style=white-space:nowrap;><!$><!/> Uhr"),Nr=c("<em>WÃ¤hle eine Endzeit:");function Pr(e){return(()=>{var t=o(fr),n=t.firstChild,i=n.nextSibling,[l,a]=d(i.nextSibling),u=l.nextSibling,[g,m]=d(u.nextSibling);return s(t,r(Fr,{get store(){return e.store},get registrations(){return e.registrations}}),l,a),s(t,r(C,{get when(){return e.slotMissing},get children(){return r(w,{type:"danger",children:"WÃ¤hle mindestens einen Zeitslot aus."})}}),g,m),t})()}const wt=1;function Lr(e){function t(n){const i=lt(n.open,!0);return n.breaks.map(a=>lt(a,!0)).reduce((a,u)=>{const g=u.at(0),m=u.at(-1);if(g===void 0||m===void 0)return a;const $=[];return a.forEach(h=>{const S=[],_=[];h.forEach(b=>{b<=g&&S.push(b),m<=b&&_.push(b)}),S.length>0&&$.push(S),_.length>0&&$.push(_)}),$},[i]).map(a=>{const u=a.slice(0,wt*-1);return tn(u.map(g=>{const m=a.filter($=>$>=g+wt);return[g,m]}))}).reduce((a,u)=>({...a,...u}),{})}return{SATURDAY:t(e.SATURDAY),SUNDAY:t(e.SUNDAY)}}function Fr(e){const[t,n]=R(e.store),[i,l]=R({dialog:ve()}),a=ze(()=>Lr(Ye));function u($){n(t.concat($))}function g($){l("dialog","open",!1),l("slot",void 0),n(t.filter(h=>h.uuid!==$))}function m($){l("dialog","open",!0),l("slot",t.find(h=>h.uuid===$))}return[r(Gr,{get daySections(){return a()},chooseTimeSlot:u}),o(Ct),o(Ct),r(ke,{get store(){return i.dialog},title:"Zeitslot lÃ¶schen",onClose:()=>l("slot",void 0),get children(){return[(()=>{var $=o(vr),h=$.firstChild,S=h.nextSibling,[_,b]=d(S.nextSibling),f=_.nextSibling,v=f.nextSibling,[y,E]=d(v.nextSibling),D=y.nextSibling,O=D.nextSibling,[N,H]=d(O.nextSibling);return N.nextSibling,s($,()=>k.days[i.slot?.day],_,b),s($,()=>i.slot?.from,y,E),s($,()=>i.slot?.to,N,H),$})(),r(Y,{kind:"danger",icon:"trash",label:"LÃ¶schen",onClick:()=>g(i.slot?.uuid)})]}}),r(Hr,{slots:t,get registrations(){return e.registrations},confirmRemoval:m})]}function Hr(e){return(()=>{var t=o(pr);return s(t,r(F,{get each(){return Yr(e.slots)},children:n=>(()=>{var i=o(yr),l=i.firstChild,a=l.firstChild,[u,g]=d(a.nextSibling),m=u.nextSibling,$=m.nextSibling,[h,S]=d($.nextSibling),_=h.nextSibling,b=_.nextSibling,[f,v]=d(b.nextSibling);f.nextSibling;var y=l.nextSibling,E=y.firstChild,D=E.firstChild,O=D.nextSibling,[N,H]=d(O.nextSibling),J=N.nextSibling,I=J.nextSibling,[j,V]=d(I.nextSibling),Q=E.nextSibling,Z=Q.firstChild,ne=Z.nextSibling,G=ne.nextSibling,[te,re]=d(G.nextSibling),P=y.nextSibling,X=P.nextSibling;return s(l,()=>k.days[n.day],u,g),s(l,()=>n.from,h,S),s(l,()=>n.to,f,v),s(E,()=>n.to-n.from,N,H),s(E,()=>n.to-n.from>1?"Stunden":"Stunde",j,V),s(Q,r(oe,{get children(){return[r(T,{get when(){return e.registrations.loading},get children(){return o(kr)}}),r(T,{get when(){return e.registrations()},children:B=>{const K=B();if(K.kind==="FAILURE")return o(xr);const ue=K.data.entries.filter(U=>U.uuid===n.uuid).map(U=>U.name);return M(()=>ue.join(", ")||o(Cr))}})]}}),te,re),s(X,r(dt,{get fallback(){return o(Er)},get children(){return r(C,{get when(){return e.registrations()},children:B=>{const K=B();return K.kind==="FAILURE"?o(Et):K.data.entries.filter(U=>U.uuid===n.uuid).map(U=>U.name).length>0?o(Et):(()=>{var U=o(wr),de=U.firstChild,ie=de.firstChild,le=ie.firstChild,[q,me]=d(le.nextSibling);return q.nextSibling,de.$$click=()=>e.confirmRemoval(n.uuid),s(ie,r(z,{icon:"trash"}),q,me),ut(),U})()}})}})),i})()})),t})()}function Gr(e){const[t,n]=R({slot:{kind:"CHOOSE_DAY"},dialog:ve()});function i(){n("slot",{kind:"CHOOSE_DAY"}),n("dialog","open",!1)}function l(a){e.chooseTimeSlot(a),i()}return[r(W,{kind:"success",get label(){return(()=>{var a=o(Ur),u=a.firstChild,[g,m]=d(u.nextSibling);return g.nextSibling,s(a,r(z,{icon:"circle-plus"}),g,m),a})()},onClick:()=>n("dialog","open",!0)}),r(ke,{title:"Zeitslot erfassen",get store(){return t.dialog},size:"medium",onClose:i,get children(){return r(oe,{get children(){return[r(T,{get when(){return t.slot.kind==="CHOOSE_DAY"},get children(){var a=o(Ar);return s(a,r(Fe,{changeDay:u=>n("slot",{kind:"CHOOSE_START",day:u})})),a}}),r(T,{get when(){return t.slot.kind==="CHOOSE_START"},get children(){var a=o(Rr),u=a.firstChild,[g,m]=d(u.nextSibling),$=g.nextSibling,[h,S]=d($.nextSibling);return s(a,r(Fe,{get chosenDay(){return t.slot.kind==="CHOOSE_START"?t.slot.day:void 0},changeDay:_=>n("slot",{kind:"CHOOSE_START",day:_})}),g,m),s(a,r(nt,{get startTimes(){return M(()=>t.slot.kind==="CHOOSE_START")()?Ve(e.daySections[t.slot.day]):[]},changeStart:_=>n("slot",{kind:"CHOOSE_END",start:_})}),h,S),a}}),r(T,{get when(){return t.slot.kind==="CHOOSE_END"},get children(){var a=o(Tr),u=a.firstChild,[g,m]=d(u.nextSibling),$=g.nextSibling,[h,S]=d($.nextSibling),_=h.nextSibling,[b,f]=d(_.nextSibling);return s(a,r(Fe,{get chosenDay(){return t.slot.kind==="CHOOSE_END"?t.slot.day:void 0},changeDay:v=>n("slot",{kind:"CHOOSE_START",day:v})}),g,m),s(a,r(nt,{get chosenStart(){return t.slot.kind==="CHOOSE_END"?t.slot.start:void 0},get startTimes(){return M(()=>t.slot.kind==="CHOOSE_END")()?Ve(e.daySections[t.slot.day]):[]},changeStart:v=>n("slot",{kind:"CHOOSE_END",start:v})}),h,S),s(a,r(At,{get endTimes(){return t.slot.kind==="CHOOSE_END"?e.daySections[t.slot.day][t.slot.start]??[]:[]},changeEnd:v=>{t.slot.kind==="CHOOSE_END"&&n("slot",{kind:"WAIT_FOR_CONFIRMATION",day:t.slot.day,start:t.slot.start,end:v})}}),b,f),a}}),r(T,{get when(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"},get children(){var a=o(Dr),u=a.firstChild,[g,m]=d(u.nextSibling),$=g.nextSibling,[h,S]=d($.nextSibling),_=h.nextSibling,[b,f]=d(_.nextSibling),v=b.nextSibling;return s(a,r(Fe,{get chosenDay(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"?t.slot.day:void 0},changeDay:y=>n("slot",{kind:"CHOOSE_START",day:y})}),g,m),s(a,r(nt,{get chosenStart(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"?t.slot.start:void 0},get startTimes(){return M(()=>t.slot.kind==="WAIT_FOR_CONFIRMATION")()?Ve(e.daySections[t.slot.day]):[]},changeStart:y=>n("slot",{kind:"CHOOSE_END",start:y})}),h,S),s(a,r(At,{get chosenEnd(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"?t.slot.end:void 0},get endTimes(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"?e.daySections[t.slot.day][t.slot.start]??[]:[]},changeEnd:y=>{t.slot.kind==="WAIT_FOR_CONFIRMATION"&&n("slot",{kind:"WAIT_FOR_CONFIRMATION",day:t.slot.day,start:t.slot.start,end:y})}}),b,f),s(v,r(W,{get label(){return`Slot "${t.slot.kind==="WAIT_FOR_CONFIRMATION"?`${k.days[t.slot.day]}, von ${t.slot.start} bis ${t.slot.end} Uhr`:""}" erstellen`},kind:"success",onClick:()=>{t.slot.kind==="WAIT_FOR_CONFIRMATION"&&l({uuid:crypto.randomUUID(),day:t.slot.day,from:t.slot.start,to:t.slot.end})}})),a}})]}})}})]}function Fe(e){return[o(Or),(()=>{var t=o(Ir),n=t.firstChild,[i,l]=d(n.nextSibling),a=i.nextSibling,[u,g]=d(a.nextSibling);return s(t,r(W,{get kind(){return e.chosenDay==="SATURDAY"?"success":"gray"},label:"Samstag",onClick:()=>e.changeDay("SATURDAY")}),i,l),s(t,r(W,{get kind(){return e.chosenDay==="SUNDAY"?"success":"gray"},label:"Sonntag",onClick:()=>e.changeDay("SUNDAY")}),u,g),t})()]}function nt(e){return[o(Mr),(()=>{var t=o(zt);return s(t,r(F,{get each(){return e.startTimes},children:n=>r(W,{get kind(){return e.chosenStart===n?"success":"gray"},get label(){return(()=>{var i=o(Wt),l=i.firstChild,[a,u]=d(l.nextSibling);return a.nextSibling,s(i,n,a,u),i})()},onClick:()=>e.changeStart(n)})})),t})()]}function At(e){return[o(Nr),(()=>{var t=o(zt);return s(t,r(F,{get each(){return e.endTimes},children:n=>r(W,{get kind(){return e.chosenEnd===n?"success":"gray"},get label(){return(()=>{var i=o(Wt),l=i.firstChild,[a,u]=d(l.nextSibling);return a.nextSibling,s(i,n,a,u),i})()},onClick:()=>e.changeEnd(n)})})),t})()]}function Yr(e){return e.toSorted((t,n)=>t.day!==n.day?t.day==="SATURDAY"?-1:1:t.from-n.from)}ot(["click"]);function Br(e){const t=new Date;return async()=>new Promise(n=>{setTimeout(()=>(console.error("NOT YET IMPLEMENTED: `publishGameround`",e,t),n()),500)})}function zr(e,t){const n=new Date;return async()=>new Promise(i=>{setTimeout(()=>(console.error("NOT YET IMPLEMENTED: `sendGameroundUpdate`",e,t.join(", "),n),i()),500)})}var Ue=c("<br>"),Wr=c("<div class=content><p>MÃ¶chtest du diese Spielrunde gerne verÃ¶ffentlichen?</p><!$><!/>"),jr=c("<em>Informationen zu den Anmeldungen mÃ¼ssen geladen werden..."),Zr=c("<em>Du kannst kein Update versenden, da sich noch niemand fÃ¼r diese Spielrunde angemeldet hat."),Kr=c("<p>An: <!$><!/>"),qr=c("<em>Du kannst die Spielrunde nur lÃ¶schen, wenn du zuerst alle Zeitslots entfernt hast."),Jr=c("<div class=content><p>Bist du sicher, dass du die Spielrunde lÃ¶schen mÃ¶chtest?</p><!$><!/>"),Vr=c('<form novalidate><!$><!/><!$><!/><!$><!/><div style="display:grid;grid-template-columns:repeat(2, 1fr);gap:1rem;"><!$><!/><!$><!/></div><!$><!/><!$><!/><!$><!/><fieldset><legend>Kategorien (optional)</legend><!$><!/></fieldset><!$><!/><div style=display:flex;flex-wrap:wrap;gap:1rem;justify-content:space-between;><!$><!/><div style=display:flex;flex-wrap:wrap;gap:1rem;><!$><!/><!$><!/><!$><!/>'),Qr=c("<h4>Spielrunde inkomplett"),Xr=c("<p>Du hast noch einen oder mehre Fehler/fehlende Informationen in dieser Spielrunde:"),ei=c("<li>Â«TitelÂ» ist ein Pflichtfeld."),ti=c("<li>Â«kurz BeschreibungÂ» ist ein Pflichtfeld."),ni=c("<li>Â«kurz BeschreibungÂ» ist zu lang."),ri=c("<li>Â«lange BeschreibungÂ» ist zu lang."),ii=c("<li>Mindest einen Zeitslot muss ausgewÃ¤hlt werden."),li=c("<ul><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),ai=c("<p><strong>ErklÃ¤rung:</strong> Hast du eine wichtige Ãnderung an dieser Spielrunde durchgefÃ¼hrt, wÃ¤hrend bereits Spielende angemeldet waren? Lass hiermit die Angemeldeten wissen, was du geÃ¤ndert hast. Wichtige Ãnderungen kÃ¶nnen sein: System geÃ¤ndert, Kategorien geÃ¤ndert. FÃ¼r kleine Ãnderungen, wie z.B. Rechtschreibfehler, sollte dies nicht genutzt werden."),si=c("<p><em>Halte dich kurz und am besten Stichwortartig."),oi=c("<form><!$><!/><!$><!/>"),ui=c("<div style=display:grid;gap:0.5rem;margin-block-end:1rem;>");function di(e){const t=e.allRounds.find(n=>n.uuid===e.uuid);return r(C,{get fallback(){return e.fallback},when:t,children:n=>e.children(n())})}function ci(e){const[t,n]=R(e.store),[i,l]=R({delete:ve(),publish:ve(),sendUpdate:ve()});function a(g){g.preventDefault(),l("publish","open",!0)}function u(){e.changePage({kind:"GAMEMASTER"})}return[r(Pt,{kind:"special",get children(){return["Status: ",M(()=>k.publishingSteps[t.kind])]}}),o(Ue),o(Ue),r($i,{store:t,get registrations(){return e.registrations},onSubmit:a,onCancel:()=>l("delete","open",!0),onSendUpdate:()=>l("sendUpdate","open",!0),goBack:u}),r(gi,{get store(){return i.publish},get title(){return t.title.value},onPublish:()=>{n("kind","published"),l("publish","open",!1),e.queue.enqueue(Br(t.uuid))}}),r(mi,{get store(){return i.sendUpdate},get players(){return bi(e.registrations,t.slots.map(g=>g.uuid))},onSend:g=>{e.queue.enqueue(zr(g,t.slots.map(m=>m.uuid)))}}),r(hi,{get store(){return i.delete},get hasSlots(){return t.slots.length!==0},get title(){return t.title.value},onDelete:()=>{n("kind","deleted"),e.changePage({kind:"GAMEMASTER"})}})]}function gi(e){return r(ke,{get store(){return e.store},title:"Spielrunde verÃ¶ffentlichen",onClose:()=>{},get children(){var t=o(Wr),n=t.firstChild,i=n.nextSibling,[l,a]=d(i.nextSibling);return s(t,r(Y,{kind:"success",icon:"circle-plus",get label(){return`Ja, bitte "${e.title||"["+k.missingTitle+"]"}" verÃ¶ffentlichen.`},get onClick(){return e.onPublish}}),l,a),t}})}function mi(e){return r(ke,{get store(){return e.store},title:"Update senden",onClose:()=>{},size:"medium",get children(){return()=>e.players.kind==="LOADING"?o(jr):e.players.kind==="ERROR"?M(()=>k.error.general):e.players.data.length===0?o(Zr):[(()=>{var t=o(Kr),n=t.firstChild,i=n.nextSibling,[l,a]=d(i.nextSibling);return s(t,()=>e.players.data.map(u=>u.name).join(", "),l,a),t})(),o(Ue),r(Si,{get onSend(){return e.onSend}})]}})}function hi(e){return r(ke,{get store(){return e.store},title:"Spielrunde lÃ¶schen",onClose:()=>{},get children(){return[r(C,{get when(){return e.hasSlots},get children(){return o(qr)}}),r(C,{get when(){return!e.hasSlots},get children(){var t=o(Jr),n=t.firstChild,i=n.nextSibling,[l,a]=d(i.nextSibling);return s(t,r(Y,{kind:"danger",icon:"trash",get label(){return`Ja, bitte "${e.title||"["+k.missingTitle+"]"}" lÃ¶schen.`},get onClick(){return e.onDelete}}),l,a),t}})]}})}function $i(e){const[t]=R(e.store),n=ze(()=>Wn(t));return(()=>{var i=o(Vr),l=i.firstChild,[a,u]=d(l.nextSibling),g=a.nextSibling,[m,$]=d(g.nextSibling),h=m.nextSibling,[S,_]=d(h.nextSibling),b=S.nextSibling,f=b.firstChild,[v,y]=d(f.nextSibling),E=v.nextSibling,[D,O]=d(E.nextSibling),N=b.nextSibling,[H,J]=d(N.nextSibling),I=H.nextSibling,[j,V]=d(I.nextSibling),Q=j.nextSibling,[Z,ne]=d(Q.nextSibling),G=Z.nextSibling,te=G.firstChild,re=te.nextSibling,[P,X]=d(re.nextSibling),B=G.nextSibling,[K,ue]=d(B.nextSibling),U=K.nextSibling,de=U.firstChild,[ie,le]=d(de.nextSibling),q=ie.nextSibling,me=q.firstChild,[Se,ye]=d(me.nextSibling),xe=Se.nextSibling,[he,_e]=d(xe.nextSibling),Ce=he.nextSibling,[Ee,A]=d(Ce.nextSibling);return s(i,r(C,{get when(){return t.kind==="published"},get children(){return r(Rt,{get errors(){return n()}})}}),a,u),s(i,r(De,{get store(){return t.title},label:"Titel",name:"title",get showErrors(){return t.kind==="published"?"ALWAYS":"ON_BLUR"},get errors(){return n().titleMissing?[k.mandatoryField]:[]}}),m,$),s(i,r(De,{get store(){return t.system},label:"System (optional)",name:"System"}),S,_),s(b,r($t,{get store(){return t.playerCount.min},label:"Anzahl Mitspielende (Minimum)",name:"playerCountMin",min:1,get max(){return t.playerCount.max.value}}),v,y),s(b,r($t,{get store(){return t.playerCount.max},label:"Anzahl Mitspielende (Maximum)",name:"playerCountMax",get min(){return t.playerCount.min.value}}),D,O),s(i,r(it,{get store(){return t.description.short},label:"kurze Beschreibung",name:"descriptionShort",size:"small",get showErrors(){return t.kind==="published"?"ALWAYS":"ON_BLUR"},get errors(){return M(()=>!!n().descriptionShortMissing)()?[k.mandatoryField]:M(()=>!!n().descriptionShortTooLong)()?[k.charLimitBy.replace("{}",String(je))]:[]}}),H,J),s(i,r(it,{get store(){return t.description.long},label:"lange Beschreibung (optional)",name:"descriptionLong",get showErrors(){return t.kind==="published"?"ALWAYS":"ON_BLUR"},get errors(){return M(()=>!!n().descriptionLongTooLong)()?[k.charLimitBy.replace("{}",String(Yt))]:[]}}),j,V),s(i,r(Pr,{get store(){return e.store.slots},get registrations(){return e.registrations},get slotMissing(){return n().slotMissing}}),Z,ne),s(G,r(_i,{get store(){return t.tagNames}}),P,X),s(i,r(Rt,{get errors(){return n()}}),K,ue),s(U,r(Y,{icon:"backward",label:"ZurÃ¼ck zu deinen Spielrunden",get onClick(){return e.goBack}}),ie,le),s(q,r(C,{get when(){return t.kind!=="deleted"},get children(){return r(Y,{icon:"trash",kind:"danger",label:"LÃ¶schen",onClick:()=>e.onCancel()})}}),Se,ye),s(q,r(C,{get when(){return t.kind==="draft"},get children(){return r(Y,{icon:"circle-plus",get kind(){return n().hasErrors?"gray":"success"},get disabled(){return n().hasErrors},label:"Spielrunde verÃ¶ffentlichen",get onClick(){return n().hasErrors?void 0:e.onSubmit}})}}),he,_e),s(q,r(C,{get when(){return t.kind==="published"},get children(){return r(Y,{icon:"circle-plus",kind:"success",label:"Update an Spielende schicken",get onClick(){return e.onSendUpdate}})}}),Ee,A),i})()}function Rt(e){return r(C,{get when(){return e.errors.hasErrors},get children(){return r(w,{type:"danger",get children(){return[o(Qr),o(Xr),(()=>{var t=o(li),n=t.firstChild,[i,l]=d(n.nextSibling),a=i.nextSibling,[u,g]=d(a.nextSibling),m=u.nextSibling,[$,h]=d(m.nextSibling),S=$.nextSibling,[_,b]=d(S.nextSibling),f=_.nextSibling,[v,y]=d(f.nextSibling);return s(t,r(C,{get when(){return e.errors.titleMissing},get children(){return o(ei)}}),i,l),s(t,r(C,{get when(){return e.errors.descriptionShortMissing},get children(){return o(ti)}}),u,g),s(t,r(C,{get when(){return e.errors.descriptionShortTooLong},get children(){return o(ni)}}),$,h),s(t,r(C,{get when(){return e.errors.descriptionLongTooLong},get children(){return o(ri)}}),_,b),s(t,r(C,{get when(){return e.errors.slotMissing},get children(){return o(ii)}}),v,y),t})()]}})}})}function Si(e){const[t,n]=R({updateText:{value:"",isDirty:!1},hasBeenSent:!1}),i=ze(()=>jn(t));return r(oe,{get fallback(){return r(w,{type:"success",children:"Nachricht wurde registriert und wird in den nÃ¤chsten 24 Stunden an die Spielenden verschickt."})},get children(){return r(T,{get when(){return!t.hasBeenSent},get children(){return[o(ai),o(Ue),o(si),o(Ue),(()=>{var l=o(oi),a=l.firstChild,[u,g]=d(a.nextSibling),m=u.nextSibling,[$,h]=d(m.nextSibling);return on(l,"novalidate",!0),s(l,r(it,{get store(){return t.updateText},label:"Zusammenfassung der Ãnderung",name:"updateText",size:"small",showErrors:"ALWAYS",get errors(){return M(()=>!!i().missing)()?[k.mandatoryField]:M(()=>!!i().tooLong)()?[k.charLimitBy.replace("{}",String(Bt))]:[]}}),u,g),s(l,r(Y,{icon:"paper-plane",label:"Spielende informieren",get kind(){return i().hasErrors?"gray":"success"},get disabled(){return i().hasErrors},get onClick(){return i().hasErrors?void 0:()=>{e.onSend(t.updateText.value),n("hasBeenSent",!0)}}}),$,h),l})()]}})}})}function _i(e){const[t,n]=R(e.store);return[(()=>{var i=o(ui);return s(i,r(F,{each:mt,children:l=>r(Nt,{get label(){return l.label},get description(){return l.description},get checked(){return t.includes(l.name)},get name(){return l.name},get value(){return l.name},onValueUpdate:a=>{n(a?t.concat([l.name]):t.filter(u=>u!==l.name))}})})),i})(),r(w,{get children(){return k.tagIdeas}})]}const bi=(e,t)=>{if(e.loading)return{kind:"LOADING"};if(e.error)return{kind:"ERROR"};const n=e();return n===void 0||n.kind==="FAILURE"?{kind:"ERROR"}:{kind:"SUCCESS",data:n.data.entries.filter(i=>t.includes(i.uuid))}},fi=gn("kind",[x({kind:ce("CHOOSE")}),x({kind:ce("PLAYER")}),x({kind:ce("GAMEMASTER")}),x({kind:ce("HELPING")}),x({kind:ce("SUMMARY")}),x({kind:ce("EDIT_GAMEROUND"),uuid:p().uuid()})]),vi=We(["SAVING","IDLE","ERROR"]),pi=x({saveState:vi,page:fi,secret:p(),showCreateMessage:pe(),isDebugging:pe()});function jt(e){const t=e.searchParams.get("page")??"",n=e.searchParams.get("uuid")??void 0,i=e.searchParams.get("secret")??"",l=e.searchParams.get("showCreateMessage")==="true",a=e.searchParams.get("debug")==="true",u=pi.safeParse({saveState:"IDLE",page:{kind:t.toUpperCase(),uuid:n},secret:i,showCreateMessage:l,isDebugging:a});return u.success?u.data:{saveState:"IDLE",page:{kind:"CHOOSE"},secret:i,showCreateMessage:l,isDebugging:a}}function ki(e,t){return e.kind!==t.kind?!1:e.kind!=="EDIT_GAMEROUND"||t.kind!=="EDIT_GAMEROUND"?!0:e.uuid===t.uuid}const yi="2024-08-15T07:45:21.335Z",Be={game:"37831e19-29d6-40bd-b99d-fb91b78aa7f9",slot:"bfcbd156-b703-4664-9944-8936aede8476"};function xi(e,t){const n=localStorage.getItem(e);return n===null?t:n}function Ci(e,t){localStorage.setItem(e,t)}const Zt="SAVE",Ei={version:1,init:{name:"John Doe",email:"john@doe.ch",mobile:"+41 66 123 45 67"},lastSaved:yi,playing:{wantsUpdates:!1},master:{games:[{uuid:Be.game,kind:"published",title:"Grolle in der Dunkelheit",system:"Warhammer Fantasy Rollenspiel",description:{short:"Ein kurzes Abenteuer bei dem es um Fantasy, Action und einfaches Rollenspiel geht.",long:"Eine kleine Gruppe wagt sich in die dunklen SchÃ¤chten einer Mine und weiter hinab, um einen mÃ¤chtigen Gegenstand wieder zu erlangen. Wie werden die GefÃ¤hrten auf die Gefahren des Untergrundes reagieren und welche Gefahren lauern in der Finsternis?"},slots:[{uuid:Be.slot,day:"SATURDAY",from:10,to:12},{uuid:crypto.randomUUID(),day:"SUNDAY",from:14,to:17}],playerCount:{min:1,max:3},tagNames:["deutsch"]}],wantsHelp:!1},helping:{}};async function wi(){return new Promise(e=>setTimeout(()=>e({kind:"SUCCESS",data:JSON.parse(xi(Zt,JSON.stringify(Ei)))}),1e3))}async function Ai(e,t){return new Promise(n=>setTimeout(()=>(Ci(Zt,JSON.stringify(e)),n({kind:"SUCCESS",data:t})),1e3))}const Ri=[{uuid:crypto.randomUUID(),gamemaster:"Game Master",title:"Grolle in der Dunkelheit",system:"Warhammer Fantasy Rollenspiel",description:{short:"Ein kurzes Abenteuer bei dem es um Fantasy, Action und einfaches Rollenspiel geht.",long:"Eine kleine Gruppe wagt sich in die dunklen SchÃ¤chten einer Mine und weiter hinab, um einen mÃ¤chtigen Gegenstand wieder zu erlangen. Wie werden die GefÃ¤hrten auf die Gefahren des Untergrundes reagieren und welche Gefahren lauern in der Finsternis?"},slot:{day:"SATURDAY",from:10,to:13},playerCount:{min:1,max:3,reserved:0},tags:["ab12jahren"]},{uuid:crypto.randomUUID(),gamemaster:"Other Game Master",title:"Acrimony",system:"D&D",description:{short:"Ein Lo-Fi Space Western Abenteuer",long:'Ein Lo-Fi Space Western Abenteuer: "Eine frisch formierte Gruppe von KopfgeldjÃ¤gern wird mit einer riskanten Mission betraut: Sie mÃ¼ssen den berÃ¼chtigten Outlaw Jeb "Rusty" Rourke in der abgeschiedenen Grenzstadt aufspÃ¼ren. Bei dieser unbarmherzigen Jagd lernen die Spieler die harte RealitÃ¤t der Kopfgeldjagd kennen, wo jeder Schuss und jede Entscheidung Ã¼ber ihr Schicksal entscheidet.'},slot:{day:"SATURDAY",from:10,to:13},playerCount:{min:2,max:8,reserved:3},tags:["ab12jahren","horror"]},{uuid:crypto.randomUUID(),gamemaster:"Some Other Game Master",title:"Solo RPGs",system:"",description:{short:"Wir spielen primÃ¤r das Solo Rollenspiel NoteQuest, werden aber kurz auch noch ein paar andere Solo Rollenspiele miteinander anschauen.",long:""},slot:{day:"SATURDAY",from:14,to:18},playerCount:{min:2,max:4,reserved:3},tags:[]}];async function Ti(){return new Promise(e=>setTimeout(()=>e({kind:"SUCCESS",data:Ri}),5e3))}const Di={entries:[{uuid:Be.slot,name:"Alice"},{uuid:Be.slot,name:"Bob"}]};async function Ui(e){return new Promise(t=>setTimeout(()=>t({entries:Di.entries.filter(n=>e.includes(n.uuid))}),5e3))}var Oi=c("<div aria-atomic=true><!$><!/><!$><!/>"),Ii=c("<div class=toast-container aria-live=polite aria-atomic=true>");const[ge,Oe]=R([]);function Mi(e){const t=()=>{const n=["toast"];return e.options.kind!==void 0&&n.push(`toast-${e.options.kind}`),n.join(" ")};return(()=>{var n=o(Oi),i=n.firstChild,[l,a]=d(i.nextSibling),u=l.nextSibling,[g,m]=d(u.nextSibling);return s(n,()=>e.options.message,l,a),s(n,r(C,{get when(){return e.options.dismissable},get children(){return r(W,{kind:"ghost",get label(){return r(z,{icon:"xmark",classes:["toast-dismiss"]})},get onClick(){return e.dismiss}})}}),g,m),se($=>{var h=t(),S=e.options.kind==="danger"?"alert":"status",_=e.options.kind==="danger"?"assertive":"polite";return h!==$.e&&$e(n,$.e=h),S!==$.t&&Ge(n,"role",$.t=S),_!==$.a&&Ge(n,"aria-live",$.a=_),$},{e:void 0,t:void 0,a:void 0}),n})()}function Ni(){function e(t){ge.find(n=>n.uuid===t)?.cleanup(),Oe(ge.filter(n=>n.uuid!==t))}return(()=>{var t=o(Ii);return s(t,r(F,{each:ge,children:n=>r(Mi,{options:n,dismiss:()=>e(n.uuid)})})),t})()}function Pi(e,t){if(t?.uuid!==void 0&&ge.find(g=>g.uuid===t.uuid)!==void 0)return at(t.uuid,e,t);const n=t?.uuid??crypto.randomUUID(),i=t?.duration??5e3,l=t?.kind??"gray",a=t?.dismissable,u=setTimeout(()=>{Oe(ge.filter(g=>g.uuid!==n))},i);return Oe(ge.length,{uuid:n,kind:l,message:e,duration:i,dismissable:a,cleanup:()=>clearTimeout(u)}),n}function at(e,t,n){const i=ge.find(m=>m.uuid===e);if(i===void 0)return e;i.cleanup();const l=n.duration??i.duration,a=n.kind??i.kind,u=n?.dismissable??i.dismissable,g=setTimeout(()=>{Oe(ge.filter(m=>m.uuid!==e))},l);return Oe(m=>m.uuid===e,{uuid:e,kind:a,message:t,duration:l,dismissable:u,cleanup:()=>clearTimeout(g)}),e}const Li={version:1,init:{name:"",email:"",mobile:""},lastSaved:new Date().toISOString(),playing:{wantsUpdates:!0},master:{games:[],wantsHelp:!1},helping:{}};async function Fi(e){const t=new URL(st("/rst25/load"));t.searchParams.append("secret",e);const n=await fetch(t);if(!n.ok)return{kind:"FAILURE"};const i=await n.json();return typeof i=="object"&&i!==null?{kind:"SUCCESS",data:Object.assign(Li,i)}:(console.error("`last_save` not found on ",i),{kind:"FAILURE"})}async function Hi(e,t){try{const n=await fetch(st("/rst25/save"),{method:"post",body:JSON.stringify({secret:t,save:e}),headers:{"Content-Type":"application/json"}});return n.ok?{kind:"SUCCESS",data:t}:(console.error(await n.text()),{kind:"FAILURE"})}catch(n){return console.error(n),{kind:"FAILURE"}}}async function Gi(){try{const e=await fetch(st("/rst25/program"),{headers:{"Content-Type":"application/json"}});return e.ok?{kind:"SUCCESS",data:await e.json()}:(console.error(await e.text()),{kind:"FAILURE"})}catch(e){return console.error(e),{kind:"FAILURE"}}}const Yi=x({name:p(),email:p(),mobile:p()}),Bi=x({name:p(),email:p(),mobile:p()}),zi=x({wantsUpdates:pe()}),Wi=x({wantsUpdates:pe()}),ji=x({games:ee(Gn),wantsHelp:pe()}),Zi=x({games:ee(Gt),wantsHelp:pe()}),Ki=x({}),qi=x({}),Ji=x({version:ce(1),init:Yi,lastSaved:p(),playing:zi,master:ji,helping:Ki}),Vi=x({version:ce(1),init:Bi,lastSaved:mn.date(),playing:Wi,master:Zi,helping:qi});async function Qi(e){const t=e==="demo"?await wi():await Fi(e);if(t.kind==="FAILURE")return console.error("Unexpected error. Maybe network, maybe server error."),{kind:"FAILURE"};const n=Ji.safeParse(t.data);if(!n.success)return console.error(n.error),{kind:"FAILURE"};const i=Xi(n.data);return i.success?{kind:"SUCCESS",data:i.data}:{kind:"FAILURE"}}function Xi(e){return Vi.safeParse(e)}const rt=crypto.randomUUID();async function el(e,t,n){const[i,l]=R(e);l("saveState","SAVING"),Pi("Am Speichern...",{uuid:rt,dismissable:!1});const a=new Date;t.lastSaved=a;const u=tl(t);try{if((n==="demo"?await Ai(u,n):await Hi(u,n)).kind==="FAILURE")throw Error("")}catch(g){return l("saveState","ERROR"),console.error(g),at(rt,"Speichern war nicht mÃ¶glich!",{kind:"danger",duration:1e4,dismissable:!0}),{kind:"FAILURE"}}return at(rt,`Zuletzt gespeichert um: ${Ot(a)} Uhr`,{kind:"success",dismissable:!0}),l("saveState","IDLE"),{kind:"SUCCESS",data:a}}function tl(e){return{...e,lastSaved:String(e.lastSaved),master:{...e.master,games:e.master.games.map(zn)}}}const nl=nn(el,1e3);var rl=c("<div class=tooltip-wrapper><div class=tooltip></div><!$><!/>");function Te(e){return(()=>{var t=o(rl),n=t.firstChild,i=n.nextSibling,[l,a]=d(i.nextSibling);return s(n,()=>e.tooltip),s(t,()=>e.children,l,a),t})()}var il=c("<div class=quickmenu-wrapper><div class=quickmenu><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),ll=c('<div class="quickmenu extended"><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>'),al=c("<div style=margin-block-start:1rem;display:flex;gap:0.5rem;align-items:center;><!$><!/><em>Zuletzt gespeichert um: <!$><!/> Uhr"),sl=c("<div style=margin-block-start:1rem;display:flex;gap:0.5rem;align-items:center;><!$><!/><em>Am Speichern..."),ol=c("<div style=margin-block-start:1rem;display:flex;gap:0.5rem;align-items:center;><!$><!/><em>Speichern war nicht mÃ¶glich!");function ul(e){return(()=>{var t=o(il),n=t.firstChild,i=n.firstChild,[l,a]=d(i.nextSibling),u=l.nextSibling,[g,m]=d(u.nextSibling),$=g.nextSibling,[h,S]=d($.nextSibling),_=h.nextSibling,[b,f]=d(_.nextSibling),v=b.nextSibling,[y,E]=d(v.nextSibling);return s(n,r(Te,{tooltip:"Zur Ãbersicht",get children(){return r(W,{get label(){return r(z,{icon:"backward"})},onClick:()=>e.changePage({kind:"CHOOSE"})})}}),l,a),s(n,r(Te,{tooltip:"Zu den Spielrunden",get children(){return r(W,{get label(){return r(z,{icon:"dice-d20"})},onClick:()=>e.changePage({kind:"PLAYER"})})}}),g,m),s(n,r(Te,{tooltip:"Zu deinen Spielrunden",get children(){return r(W,{get label(){return r(z,{icon:"grid-2-plus"})},onClick:()=>e.changePage({kind:"GAMEMASTER"})})}}),h,S),s(n,r(Te,{tooltip:"Zum Helferplan",get children(){return r(W,{get label(){return r(z,{icon:"hand-heart"})},onClick:()=>e.changePage({kind:"HELPING"})})}}),b,f),s(n,r(Te,{tooltip:"Zur Zusammenfassung",get children(){return r(W,{get label(){return r(z,{icon:"list"})},onClick:()=>e.changePage({kind:"SUMMARY"})})}}),y,E),t})()}function dl(e){return[r(w,{type:"gray",get children(){var t=o(ll),n=t.firstChild,[i,l]=d(n.nextSibling),a=i.nextSibling,[u,g]=d(a.nextSibling),m=u.nextSibling,[$,h]=d(m.nextSibling),S=$.nextSibling,[_,b]=d(S.nextSibling),f=_.nextSibling,[v,y]=d(f.nextSibling);return s(t,r(Y,{icon:"backward",label:"Zur Ãbersicht",onClick:()=>e.changePage({kind:"CHOOSE"})}),i,l),s(t,r(Y,{icon:"dice-d20",label:"Zu den Spielrunden",onClick:()=>e.changePage({kind:"PLAYER"})}),u,g),s(t,r(Y,{icon:"grid-2-plus",label:"Zu deinen Spielrunden",onClick:()=>e.changePage({kind:"GAMEMASTER"})}),$,h),s(t,r(Y,{icon:"hand-heart",label:"Zum Helferplan",onClick:()=>e.changePage({kind:"HELPING"})}),_,b),s(t,r(Y,{icon:"list",label:"Zur Zusammenfassung",onClick:()=>e.changePage({kind:"SUMMARY"})}),v,y),t}}),r(cl,{get saveState(){return e.saveState},get lastSaved(){return e.lastSaved}})]}function cl(e){return r(oe,{get children(){return[r(T,{get when(){return e.saveState==="IDLE"},get children(){var t=o(al),n=t.firstChild,[i,l]=d(n.nextSibling),a=i.nextSibling,u=a.firstChild,g=u.nextSibling,[m,$]=d(g.nextSibling);return m.nextSibling,s(t,r(z,{icon:"circle-check"}),i,l),s(a,()=>Ot(e.lastSaved),m,$),t}}),r(T,{get when(){return e.saveState==="SAVING"},get children(){var t=o(sl),n=t.firstChild,[i,l]=d(n.nextSibling);return i.nextSibling,s(t,r(z,{icon:"floppy-disk-circle-arrow-right"}),i,l),t}}),r(T,{get when(){return e.saveState==="ERROR"},get children(){var t=o(ol),n=t.firstChild,[i,l]=d(n.nextSibling);return i.nextSibling,s(t,r(z,{icon:"triangle-exclamation"}),i,l),t}})]}})}var gl=c("<div class=page><!$><!/><div class=page-content><h2></h2><br><!$><!/></div><!$><!/>"),ml=c("<div class=extended-wrapper style=margin-block-start:1rem;>");function be(e){return(()=>{var t=o(gl),n=t.firstChild,[i,l]=d(n.nextSibling),a=i.nextSibling,u=a.firstChild,g=u.nextSibling,m=g.nextSibling,[$,h]=d(m.nextSibling),S=a.nextSibling,[_,b]=d(S.nextSibling);return s(t,(()=>{var f=M(()=>e.showQuickmenu!==!1);return()=>f()?r(ul,{get changePage(){return e.changePage},get saveState(){return e.saveState},get lastSaved(){return e.lastSaved}}):null})(),i,l),s(u,()=>e.title),s(a,()=>e.children,$,h),s(t,(()=>{var f=M(()=>e.showQuickmenu!==!1);return()=>f()?(()=>{var v=o(ml);return s(v,r(dl,{get changePage(){return e.changePage},get saveState(){return e.saveState},get lastSaved(){return e.lastSaved}})),v})():null})(),_,b),t})()}const hl=x({uuid:p().uuid(),name:p()}),Kt=x({entries:ee(hl)}),$l=Kt;async function Sl(e,t){console.log("loadRegistration still mocked",e.substring(0,4),"...");const n=await Ui(t),i=Kt.safeParse(n);if(!i.success)return{kind:"FAILURE"};const l=_l(i.data);return l.success?{kind:"SUCCESS",data:l.data}:{kind:"FAILURE"}}function _l(e){return $l.safeParse(e)}const bl=x({uuid:p().uuid(),title:p(),system:p(),gamemaster:p(),description:x({short:p(),long:p()}),slot:x({day:gt,from:L(),to:L()}),playerCount:x({min:L(),max:L(),reserved:L()}),tags:ee(p())}),fl=ee(bl),vl=x({uuid:p().uuid(),title:p(),system:p(),gamemaster:p(),description:x({short:p(),long:p()}),slot:x({day:gt,from:L(),to:L()}),playerCount:x({min:L(),max:L(),reserved:L()}),tags:ee(p())}),pl=ee(vl);async function kl(e){const t=e==="demo"?await Ti():await Gi();if(t.kind==="FAILURE")return console.error("Unexpected error. Maybe network, maybe server error."),{kind:"FAILURE"};const n=fl.safeParse(t.data);if(!n.success)return console.log(t.data),console.error(n.error),{kind:"FAILURE"};const i=yl(n.data);return i.success?{kind:"SUCCESS",data:i.data}:{kind:"FAILURE"}}function yl(e){return pl.safeParse(e)}var xl=c("<br>"),Tt=c("<pre>"),Cl=c("<hr>"),El=c("<div><code>Registrations (read-only)"),wl=c("<em>loading...");function Al(e){const t=new URL(location.href);t.searchParams.set("page",e.page.kind.toLowerCase()),e.page.kind==="EDIT_GAMEROUND"&&t.searchParams.set("uuid",e.page.uuid),t.searchParams.delete("showCreateMessage"),history.replaceState({page:e},"",t);const n=k.pageTitle[e.page.kind];document.title=k.metaTitle.replace("{}",n)}function Rl(e){const[t,n]=R(e.page);return(i,l)=>{if(ki(i,t))return;if(!l){const u=new URL(location.href);u.searchParams.set("page",i.kind.toLowerCase()),i.kind==="EDIT_GAMEROUND"?u.searchParams.set("uuid",i.uuid):u.searchParams.delete("uuid"),history.pushState({page:i},"",u)}const a=k.pageTitle[i.kind];document.title=k.metaTitle.replace("{}",a),n(i),window.scrollTo({top:0})}}function Tl(e){Al(e.meta);const[t,n]=R({meta:e.meta,save:e.save}),i=()=>t.save.master.games.flatMap(h=>h.slots.map(S=>S.uuid)),[l]=He(i(),h=>Sl(t.meta.secret,h)),[a]=He(()=>kl(t.meta.secret)),[u,g]=It(!1);He(()=>JSON.stringify(t.save),async()=>{if(!u()){g(!0);return}const h=dn(t.save);try{const S=await nl(t.meta,h,t.meta.secret);S.kind==="FAILURE"?console.error(S):n("save","lastSaved",S.data)}catch(S){console.error(S),n("meta","saveState","ERROR")}});const m=Rl(t.meta),$=rn();return Mt(()=>{window.addEventListener("popstate",h=>{if(typeof h=="object"&&h!==null&&"state"in h){const S=new URL(location.href),_=jt(S);m(_.page,!0)}}),setInterval(async()=>{const h=$.dequeue();h.kind==="NEXT_ELEMENT"&&await h.data()},1e3)}),[r(C,{get when(){return t.meta.showCreateMessage},get children(){return[r(w,{type:"success",get children(){return k.registrationStarted}}),o(xl)]}}),r(oe,{get fallback(){return r(be,{title:"Wo mÃ¶chtest du starten?",showQuickmenu:!1,changePage:m,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r(br,{changePage:m,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get isDebugging(){return t.meta.isDebugging}})}})},get children(){return[r(T,{get when(){return t.meta.page.kind==="PLAYER"},get children(){return r(be,{title:"SpielrundenÃ¼bersicht",changePage:m,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r(or,{program:a,get isDebugging(){return t.meta.isDebugging}})}})}}),r(T,{get when(){return t.meta.page.kind==="GAMEMASTER"},get children(){return r(be,{title:"Meine Spielrunden",changePage:m,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r(Qn,{get store(){return t.save.master},changePage:m})}})}}),r(T,{get when(){return t.meta.page.kind==="EDIT_GAMEROUND"},get children(){return r(be,{title:"Spielrunde editieren",changePage:m,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r(di,{get allRounds(){return t.save.master.games},get uuid(){return t.meta.page.kind==="EDIT_GAMEROUND"?t.meta.page.uuid:"should never happen"},get fallback(){return r(w,{type:"danger",get children(){return k.error.gameroundUuidError}})},children:h=>r(ci,{store:h,registrations:l,queue:$,changePage:m})})}})}}),r(T,{get when(){return t.meta.page.kind==="HELPING"},get children(){return r(be,{title:"Helfen",changePage:m,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r(Ln,{})}})}}),r(T,{get when(){return t.meta.page.kind==="SUMMARY"},get children(){return r(be,{title:"Zusammenfassung",changePage:m,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r(Un,{get store(){return t.save},changePage:m})}})}})]}}),r(C,{get when(){return t.meta.isDebugging},get children(){return[(()=>{var h=o(Tt);return s(h,()=>JSON.stringify(t,null,2)),h})(),o(Cl),o(El),r(dt,{get fallback(){return o(wl)},get children(){return r(C,{get when(){return l()},children:h=>(()=>{var S=o(Tt);return s(S,()=>JSON.stringify(h(),null,2)),S})()})}})]}}),r(Ni,{})]}function qt(){return r(w,{get children(){return k.loading}})}function Ll(){const[e,t]=It(null);return Mt(()=>{const n=new URL(location.href);t(jt(n))}),r(C,{get fallback(){return r(qt,{})},get when(){return e()},children:n=>r(Dl,{get page(){return n()}})})}function Dl(e){const[t]=He(()=>Qi(e.page.secret));return r(un,{fallback:n=>(console.error(n),r(w,{type:"danger",get children(){return k.error.general}})),get children(){return r(dt,{get fallback(){return r(qt,{})},get children(){return r(oe,{get children(){return r(T,{get when(){return t()},children:n=>{const{kind:i,value:l}=ln(n());return i==="SECRET_INVALID"?r(w,{type:"danger",get children(){return k.error.secretError}}):i==="FAILURE"?r(w,{type:"danger",get children(){return k.error.ourMistake}}):r(Tl,{get meta(){return e.page},get save(){return l.data}})}})}})}})}})}export{Ll as MeineAnmeldungWrapper};
