import{c as Ct,I as Jt,B as w,d as Qt,f as z,g as Ye,h as Y,b as W,s as Xt,i as Et,j as Be,k as en,e as Xe,l as tn,m as wt,n as nn,u as rn}from"./utils.CDxFvly-.js";import{b as ln,g as u,t as c,a as d,u as an,i as s,c as r,S as C,d as ae,e as he,F,M as D,f as se,s as ze,h as Me,j as Le,k as et,m as L,r as tt,l as nt,n as sn,o as Ie,p as At,q as Tt,E as on}from"./web.CQCfMWOb.js";/* empty css                                 */import{c as A,u as un}from"./store.C6sBeAjO.js";import{T as dn}from"./Textarea.Bmm2iH4o.js";import{s as k,n as P,e as Fe,T as p,o as x,a as X,C as Rt,d as cn,l as de,b as pe,c as gn}from"./texts.D7lwL5J7.js";var mn=c("<dialog><!$><!/><!$><!/><!$><!/>"),hn=c("<h4>");function ve(){return{open:!1}}function ke(e){let t;const[n,i]=A(e.store);ln(()=>{n.open?t.showModal():t.close()});function l(){i({open:!1}),e.onClose?.()}const a=()=>{const o=[];return e.type!==void 0&&o.push(e.type),e.size!==void 0&&o.push(e.size),e.onClose!==void 0&&o.push("dialog-with-close"),o};return(()=>{var o=u(mn),g=o.firstChild,[m,$]=d(g.nextSibling),h=m.nextSibling,[S,_]=d(h.nextSibling),b=S.nextSibling,[f,v]=d(b.nextSibling);o.addEventListener("close",l);var y=t;return typeof y=="function"?an(y,o):t=o,s(o,r(C,{get when(){return e.onClose},get children(){return r(Ct,{onClick:l,icon:"circle-xmark",kind:"gray"})}}),m,$),s(o,r(C,{get when(){return e.title},children:E=>(()=>{var R=u(hn);return s(R,E),R})()}),S,_),s(o,()=>e.children,f,v),ae(()=>he(o,a().join(" "))),o})()}var rt=c("<p>");function Ae(e){const[t,n]=A(e.store),i=e.showErrors==="ALWAYS",l=()=>i||t.isDirty?e.errors??[]:[];return[r(Jt,{get label(){return e.label},get name(){return e.name},get value(){return t.value},onValueUpdate:a=>n("value",a),onBlur:()=>n("isDirty",!0),get type(){return e.type},get required(){return e.required},get isHoneypot(){return e.isHoneypot}}),r(C,{get when(){return l().length>0},get children(){return r(w,{type:"danger",get children(){return r(F,{get each(){return l()},children:a=>(()=>{var o=u(rt);return s(o,a),o})()})}})}})]}function ut(e){const[t,n]=A(e.store),i=e.showErrors==="ALWAYS",l=()=>i||t.isDirty?e.errors??[]:[];return[r(Qt,{get label(){return e.label},get name(){return e.name},get value(){return t.value},onValueUpdate:a=>n("value",a),onBlur:()=>n("isDirty",!0),get required(){return e.required},get isHoneypot(){return e.isHoneypot},get min(){return e.min},get max(){return e.max}}),r(C,{get when(){return l().length>0},get children(){return r(w,{type:"danger",get children(){return r(F,{get each(){return l()},children:a=>(()=>{var o=u(rt);return s(o,a),o})()})}})}})]}function Ve(e){const[t,n]=A(e.store),i=e.showErrors==="ALWAYS",l=()=>i||t.isDirty?e.errors??[]:[];return[r(dn,{get label(){return e.label},get name(){return e.name},get value(){return t.value},onValueUpdate:a=>n("value",a),onBlur:()=>n("isDirty",!0),get required(){return e.required},get size(){return e.size}}),r(C,{get when(){return l().length>0},get children(){return r(w,{type:"danger",get children(){return r(F,{get each(){return l()},children:a=>(()=>{var o=u(rt);return s(o,a),o})()})}})}})]}const De=k().transform(e=>({value:e,isDirty:!1}));function We(e){return{value:e,isDirty:!1}}const dt=P().transform(e=>({value:e,isDirty:!1})),Ne={SATURDAY:{open:{from:10,to:24},breaks:[{from:13,to:14},{from:18,to:19}]},SUNDAY:{open:{from:10,to:18},breaks:[{from:13,to:14}]}};Fe(["SATURDAY","SUNDAY"]);function Ue(e,t){const{from:n,to:i}=t;return n<e&&e<i}function $n(e,t){const{from:n,to:i}=e,{from:l,to:a}=t;return Ue(n,t)||Ue(i,t)||Ue(l,e)||Ue(a,e)||n===l&&i===a}function Je(e,t=!1){const{from:n,to:i}=e;if(n>i)return[];const l=i-n;return[...Array(t?l+1:l)].map((a,o)=>o+n)}var Sn=c("<div class=dynamic-columns style=gap:1rem;--min-width:30rem;><!$><!/><!$><!/>"),_n=c("<div><h4 style=margin-block-end:1.5rem;></h4><!$><!/>"),bn=c("<p>Konflikte gefunden! Bitte stelle sicher, dass du nicht zeitlich überlappende Spielrunden eingetragen hast:"),fn=c('<div style="display:grid;grid-template-columns:1fr max-content 1fr;gap:1rem;margin-block:0.5rem;"><!$><!/><span style=color:var(--clr-warning-10);align-self:center;font-size:2rem;></span><!$><!/>'),vn=c("<div class=timetable><!$><!/><div class=entries></div><div class=after-hour><div class=annotation>"),pn=c("<div><div class=annotation></div><div class=background>"),kn=c("<div class=entry>");function yn(e){return(()=>{var t=u(Sn),n=t.firstChild,[i,l]=d(n.nextSibling),a=i.nextSibling,[o,g]=d(a.nextSibling);return s(t,r(ct,{get programEntries(){return e.programEntries.SATURDAY},get openingHours(){return Ne.SATURDAY},day:"SATURDAY"}),i,l),s(t,r(ct,{get programEntries(){return e.programEntries.SUNDAY},get openingHours(){return Ne.SUNDAY},day:"SUNDAY"}),o,g),t})()}function ct(e){const t=Cn(e.programEntries);return(()=>{var n=u(_n),i=n.firstChild,l=i.nextSibling,[a,o]=d(l.nextSibling);return s(i,()=>p.days[e.day]),s(n,r(se,{get fallback(){return[r(w,{type:"danger",get children(){return u(bn)}}),r(F,{each:t,children:([g,m])=>(()=>{var $=u(fn),h=$.firstChild,[S,_]=d(h.nextSibling),b=S.nextSibling,f=b.nextSibling,[v,y]=d(f.nextSibling);return s($,()=>g.component(),S,_),s(b,r(z,{icon:"triangle-exclamation"})),s($,()=>m.component(),v,y),$})()})]},get children(){return r(D,{get when(){return t.length===0},get children(){return r(xn,{get programEntries(){return e.programEntries},get openingHours(){return e.openingHours},get day(){return e.day}})}})}}),a,o),n})()}function xn(e){const t=Je(e.openingHours.open),n=e.openingHours.breaks.map(({from:a})=>a),i=(t[0]??0)-1,l=t.at(-1)??0;return(()=>{var a=u(vn),o=a.firstChild,[g,m]=d(o.nextSibling),$=g.nextSibling,h=$.nextSibling,S=h.firstChild;return s(a,r(F,{each:t,children:_=>{const b=n.includes(_);return(()=>{var f=u(pn),v=f.firstChild;return he(f,`hour ${b?"break":""}`),s(v,_),ae(y=>ze(f,gt({from:_,to:_},i,e.day),y)),f})()}}),g,m),s($,r(F,{get each(){return e.programEntries},children:_=>(()=>{var b=u(kn);return s(b,()=>_.component()),ae(f=>ze(b,gt(_.range,i,e.day),f)),b})()})),s(S,l+1),ae(_=>ze($,`grid-row: 1 / ${l-i+1};`,_)),a})()}function gt(e,t,n){const{from:i,to:l}=e,a=i-t,o=l-t,g=Ne[n].open.to;return Ye(a>0,`Entry can't start at ${i}.`),Ye(o>0,`Entry can't end at ${l}.`),Ye(l<=g,`Entry can't end at ${l}.`),`grid-row: ${a} / ${o};`}function Cn(e){const t=[];return e.forEach((n,i)=>{e.slice(i+1).forEach(l=>{$n(n.range,l.range)&&t.push([n,l])})}),t}var En=c("<span>");function Dt(e){const t=()=>{const n=["chip"];return n.push(e.kind??"gray"),e.inverted&&n.push("inverted"),e.size==="small"&&n.push("small"),n.join(" ")};return(()=>{var n=u(En);return s(n,()=>e.children),ae(i=>{var l=t(),a=e.title;return l!==i.e&&he(n,i.e=l),a!==i.t&&Me(n,"title",i.t=a),i},{e:void 0,t:void 0}),n})()}var Ut=c("<br>"),wn=c("<div style=display:grid;gap:1rem;><h3>Meine Kontaktdaten</h3><p><strong>Name:</strong> <!$><!/></p><p><strong>E-Mail:</strong> <!$><!/></p><p><strong>Handynummer:</strong> <!$><!/></p><div>"),An=c("<form novalidate><!$><!/><!$><!/><!$><!/><!$><!/>"),Tn=c("<h3>Mein Programm"),Rn=c("<div><!$><!/><!$><!/><h5></h5><p class=duration>von <!$><!/> bis <!$><!/> Uhr <em><small>(<!$><!/> <!$><!/>)");function Dn(e){const t=e.store.master.games.flatMap(n=>n.slots.map(i=>({status:n.kind,uuid:n.uuid,title:n.title.value,dateTime:i})));return[r(Un,{get store(){return e.store.init}}),u(Ut),r(In,{entries:{play:[],master:t,help:[]},get changePage(){return e.changePage}})]}function Un(e){const[t,n]=A(e.store),[i,l]=A(ve());return r(w,{get children(){return[r(C,{get when(){return i.open},get children(){return r(On,{dialogStore:i,get currentState(){return e.store},updateCurrentState:n})}}),(()=>{var a=u(wn),o=a.firstChild,g=o.nextSibling,m=g.firstChild,$=m.nextSibling,h=$.nextSibling,[S,_]=d(h.nextSibling),b=g.nextSibling,f=b.firstChild,v=f.nextSibling,y=v.nextSibling,[E,R]=d(y.nextSibling),O=b.nextSibling,M=O.firstChild,H=M.nextSibling,Z=H.nextSibling,[I,G]=d(Z.nextSibling),q=O.nextSibling;return s(g,()=>e.store.name,S,_),s(b,()=>e.store.email,E,R),s(O,()=>e.store.mobile,I,G),s(q,r(Y,{icon:"pencil",label:"Kontakdaten editieren",onClick:()=>l("open",!0)})),a})()]}})}function On(e){const[t]=A({name:We(e.currentState.name),email:We(e.currentState.email),mobile:We(e.currentState.mobile)}),n=Le(()=>{const a={name:[],email:[]};return t.name.value.trim().length===0&&a.name.push(p.mandatoryField),t.email.value.trim().length===0?a.email.push(p.mandatoryField):t.email.value.includes("@")||a.email.push(p.invalidEmail),{...a,hasErrors:a.name.length+a.email.length>0}}),[i,l]=A(e.dialogStore);return r(ke,{get store(){return e.dialogStore},title:"Kontaktdaten editieren",onClose:()=>{},size:"medium",get children(){var a=u(An),o=a.firstChild,[g,m]=d(o.nextSibling),$=g.nextSibling,[h,S]=d($.nextSibling),_=h.nextSibling,[b,f]=d(_.nextSibling),v=b.nextSibling,[y,E]=d(v.nextSibling);return s(a,r(Ae,{get store(){return t.name},label:"Name",name:"name",showErrors:"ON_BLUR",get errors(){return n().name}}),g,m),s(a,r(Ae,{get store(){return t.email},label:"E-Mail",name:"email",showErrors:"ON_BLUR",get errors(){return n().email}}),h,S),s(a,r(Ae,{get store(){return t.mobile},label:"Handynummer",name:"mobile"}),b,f),s(a,r(W,{label:"Speichern",get disabled(){return n().hasErrors},onClick:()=>{n().hasErrors||(e.updateCurrentState({name:t.name.value,email:t.email.value,mobile:t.mobile.value}),l("open",!1))}}),y,E),a}})}function In(e){const t=Mn(e.entries,e.changePage);return[u(Tn),u(Ut),r(yn,{programEntries:t})]}function Ze(e){const t=e.range.to-e.range.from,n={"master-draft":{label:"SL",help:"Spielleitung",link:{icon:"pencil",label:"Spielrunde bearbeiten"}},master:{label:"SL",help:"Spielleitung",link:{icon:"pencil",label:"Spielrunde bearbeiten"}},play:{label:"TN",help:"Teilnehmer:in",link:{icon:"link",label:"Zur Spielrunde"}},help:{label:"HL",help:"Helfen",link:{icon:"link",label:""}}}[e.kind],i=()=>{const l=["timeview-entry","box-simple"];return e.kind==="master-draft"&&l.push("gray"),e.kind==="master"&&l.push("special"),l.join(" ")};return(()=>{var l=u(Rn),a=l.firstChild,[o,g]=d(a.nextSibling),m=o.nextSibling,[$,h]=d(m.nextSibling),S=$.nextSibling,_=S.nextSibling,b=_.firstChild,f=b.nextSibling,[v,y]=d(f.nextSibling),E=v.nextSibling,R=E.nextSibling,[O,M]=d(R.nextSibling),H=O.nextSibling,Z=H.nextSibling,I=Z.firstChild,G=I.firstChild,q=G.nextSibling,[V,J]=d(q.nextSibling),re=V.nextSibling,Q=re.nextSibling,[ee,te]=d(Q.nextSibling);return ee.nextSibling,s(l,r(Dt,{get title(){return n.help},inverted:!0,size:"small",get children(){return n.label}}),o,g),s(l,r(C,{get when(){return e.onClick},children:N=>r(Ct,{get icon(){return n.link.icon},kind:"ghost",get onClick(){return N()},get title(){return n.link.label}})}),$,h),s(S,()=>e.title),s(_,()=>e.range.from,v,y),s(_,()=>e.range.to,O,M),s(I,t,V,J),s(I,t===1?"Stunde":"Stunden",ee,te),ae(N=>{var ne=i(),B=e.title;return ne!==N.e&&he(l,N.e=ne),B!==N.t&&Me(S,"title",N.t=B),N},{e:void 0,t:void 0}),l})()}function Mn(e,t){const n={SATURDAY:[],SUNDAY:[]};return e.play.forEach(i=>{n[i.dateTime.day].push({range:i.dateTime,component:()=>r(Ze,{get title(){return i.title},get range(){return i.dateTime},kind:"play"})})}),e.master.forEach(i=>{if(i.status==="deleted")return;const l=[i.title];i.status==="draft"&&l.unshift("(noch nicht veröffentlicht)"),n[i.dateTime.day].push({range:i.dateTime,component:()=>r(Ze,{get title(){return l.join(" ")},get range(){return i.dateTime},get kind(){return i.status==="published"?"master":"master-draft"},onClick:()=>t({kind:"EDIT_GAMEROUND",uuid:i.uuid})})})}),e.help.forEach(i=>{n[i.dateTime.day].push({range:i.dateTime,component:()=>r(Ze,{get title(){return i.title},get range(){return i.dateTime},kind:"help"})})}),n}var Nn=c("<p>Diese Seite ist leider noch nicht bereit. Komm bitte später nochmal zurück.");function Pn(){return r(w,{type:"danger",get children(){return u(Nn)}})}var Ln=c("<div class=grid><!$><!/><div>"),Fn=c("<div class=boxLink>");function fe(e){const t=e.type??"special";return(()=>{var n=u(Fn);return s(n,r(w,{type:t,get onClick(){return e.onClick},get children(){var i=u(Ln),l=i.firstChild,[a,o]=d(l.nextSibling),g=a.nextSibling;return s(i,r(z,{get icon(){return e.icon}}),a,o),s(g,()=>e.children),i}})),n})()}const it=Fe(["SATURDAY","SUNDAY"]),Ot=x({uuid:k().uuid(),day:it,from:P(),to:P()}).refine(e=>e.from<e.to,{message:"A TimeSlot can't end before it starts."});x({name:k(),label:k(),description:k()});const It=Fe(["draft","published","deleted"]),Hn=x({uuid:k().uuid(),kind:It,title:k(),system:k(),description:x({short:k(),long:k()}),slots:X(Ot),playerCount:x({min:P().min(1),max:P()}).transform(e=>{const[t,n]=Xt([e.min,e.max]);return{min:t,max:n}}),tagNames:X(k())}),Mt=x({uuid:k().uuid(),kind:It,title:De,system:De,description:x({short:De,long:De}),slots:X(Ot),playerCount:x({min:dt,max:dt}),tagNames:X(k())});function Gn(){const e={uuid:crypto.randomUUID(),kind:"draft",title:"",system:"",description:{short:"",long:""},slots:[],playerCount:{min:2,max:4},tagNames:["deutsch"]},t=Yn(e);if(t.success)return t.data;throw console.error(t),Error("should not happen")}function Yn(e){return Mt.safeParse(e)}function Bn(e){return{...e,title:e.title.value,system:e.system.value,description:{short:e.description.short.value,long:e.description.long.value},playerCount:{min:e.playerCount.min.value,max:e.playerCount.max.value}}}const lt=[{name:"ab6jahren",label:"Ab 6 Jahren",description:"Spannungs- und Bedrohungsmomente werden kurz gehalten. In Begleitung oder nach Absprache mit einem Elternteil. Beispiele: My Little Pony, ..."},{name:"ab12jahren",label:"Ab 12 Jahren",description:"Antisoziales und destruktives wird auf ein Minimum begrenzt. Keine Diskriminierung, keine Radikalisierung, Sexualität wird nicht explizit dargestellt."},{name:"ab18jahren",label:"Ab 18 Jahren",description:"Keinerlei Richtlinien bezüglich Inhalt, in der Gruppe sollte aber diskutiert werden, was akzeptabel ist und was nicht. Beispiele: Vampire the Masquerade, ..."},{name:"fantasy",label:"Fantasy",description:"Spielt in einer alternativen Vergangenheit, in welcher Elemente wie: Ritterinnen, Hexenmeister, Rüstungen, Magie, Goblins, Turniere usw. vorkommen können. Beispiele: Das Schwarze Auge, Dungeons & Dragons, ..."},{name:"sciencefiction",label:"Science Fiction",description:"Spielt in einer alternativen Zukunft, in welcher Elemente wie: Raumschiffe, Sternenportale, Künstliche Intelligenzen, Laserkanonen usw. vorkommen können. Beispiele: Shadowrun, Alien, ..."},{name:"postapokalyptisch",label:"Postapokalyptisch",description:"Spielt in einer Welt mitten oder nach einem Kollaps, wo die Mehrheit ums Überleben kämpft. Beispiele: Mutant Year Zero, Apocalypse World"},{name:"horror",label:"Horror",description:"Eine gruselige Atmosphäre, psychologischen Druck oder unvorhersehbare Schreckensmomente. Beispiele: Cthulhu, ..."},{name:"offenewelt",label:"Offene Welt",description:"Es gibt nur einen losen Handlungsfaden, die Rollenspiel-Gruppe muss sich ihre Ziele selber festlegen. Beispiele: Ironsworn, Blades in the Dark, ..."},{name:"gemeinsamespielleitung",label:"Gemeinsame Spielleitung",description:"Die Regeln und die Umwelt werden gemeinsam von allen Spielenden umgesetzt. Beispiele: Microscope, The Quiet Year, ..."},{name:"regelleicht",label:"Regelleicht",description:"Die kompletten Regeln haben alle auf einer Seite Platz. Beispiele: Fiasco, Everyone is John, ..."},{name:"deutsch",label:"Deutsch",description:"Bei der Spielrunde reden die Spielenden miteinander Deutsch."},{name:"englisch",label:"Englisch",description:"Bei der Spielrunde reden die Spielenden miteinander Englisch."},{name:"workshop",label:"Workshop",description:"Unter Anleitung, gemeinsam ein Rollenspiel-Thema vertiefen. Kreative Techniken stehen im Vordergrund. Beispiele: Gemeinsam ein Dungeon erschaffen, Gemeinsam ein Hintergrundgeschichte schreiben, ..."}],He=200,Nt=500,Pt=200;function zn(e){const t=e.title.value.trim().length===0,n=e.description.short.value.trim().length===0,i=e.description.short.value.length>He,l=e.description.long.value.length>Nt,a=e.slots.length===0;return{titleMissing:t,descriptionShortMissing:n,descriptionShortTooLong:i,descriptionLongTooLong:l,slotMissing:a,hasErrors:t||n||i||l||a}}function Wn(e){const t=e.updateText.value.trim().length===0,n=e.updateText.value.length>Pt;return{missing:t,tooLong:n,hasErrors:t||n}}var Zn=c("<h3>"),jn=c("<br>"),Kn=c("<div style=margin-top:2rem;><h3 style=margin-bottom:1rem;></h3><ul class=event-list role=list>"),qn=c('<li><h3 class=event-title></h3><div class=event-details><div class=event-tags><strong>Status:</strong><!$><!/></div><div class=event-tags><strong>System:</strong><!$><!/></div><div class=event-tags><strong>Tag, Zeit:</strong><!$><!/></div><div class=event-tags><strong>Spielende:</strong> <!$><!/> - <!$><!/></div> <div class=event-tags><strong>Kategorien:</strong> <!$><!/></div></div><div class="event-description content"><p><strong>Kurzbeschreibung:</strong><br><!$><!/></p></div><ul role=list class=event-links><li><button class=event-link><span>Bearbeiten'),Ee=c("<em>"),Vn=c("<span><!$><!/>, <!$><!/> - <!$><!/> Uhr");function Jn(e){const[t,n]=A(e.store);function i(){const l=Gn();n("games",t.games.length,l),e.changePage({kind:"EDIT_GAMEROUND",uuid:l.uuid})}return[r(fe,{icon:"grid-2-plus",type:"success",onClick:i,get children(){var l=u(Zn);return s(l,()=>p.createNewGameRound),l}}),u(jn),r(Rt,{label:"Ich habe wenig bis keine Spielleitung-Erfahrung und möchte gerne in der Vorbereitung und/oder während der Spielrunde unterstützt werden.",get checked(){return t.wantsHelp},name:"wantsHelp",value:"wantsHelp",onValueUpdate:l=>{n("wantsHelp",l)}}),r(C,{get when(){return e.store.games},children:l=>(()=>{var a=u(Kn),o=a.firstChild,g=o.nextSibling;return s(o,()=>p.myGameRounds),s(g,r(F,{get each(){return l().filter(m=>m.kind!=="deleted")},children:m=>{const $=m.tagNames.map(h=>lt.find(({name:S})=>S===h)).filter(h=>h!==void 0).map(({label:h})=>h);return r(F,{get each(){return m.slots},get fallback(){return r(mt,{game:m,slot:null,tags:$,get changePage(){return e.changePage}})},children:h=>r(mt,{game:m,slot:h,tags:$,get changePage(){return e.changePage}})})}})),a})()})]}function mt(e){const{game:t,slot:n,tags:i,changePage:l}=e;return(()=>{var a=u(qn),o=a.firstChild,g=o.nextSibling,m=g.firstChild,$=m.firstChild,h=$.nextSibling,[S,_]=d(h.nextSibling),b=m.nextSibling,f=b.firstChild,v=f.nextSibling,[y,E]=d(v.nextSibling),R=b.nextSibling,O=R.firstChild,M=O.nextSibling,[H,Z]=d(M.nextSibling),I=R.nextSibling,G=I.firstChild,q=G.nextSibling,V=q.nextSibling,[J,re]=d(V.nextSibling),Q=J.nextSibling,ee=Q.nextSibling,[te,N]=d(ee.nextSibling),ne=I.nextSibling,B=ne.nextSibling,j=B.firstChild,oe=j.nextSibling,U=oe.nextSibling,[ie,le]=d(U.nextSibling),ue=g.nextSibling,K=ue.firstChild,ge=K.firstChild,$e=ge.nextSibling,ye=$e.nextSibling,[Se,_e]=d(ye.nextSibling),xe=ue.nextSibling,Ce=xe.firstChild,Ge=Ce.firstChild;return s(o,(()=>{var T=L(()=>t.title.value.length>0);return()=>T()?t.title.value:(()=>{var me=u(Ee);return s(me,()=>p.missingTitle),me})()})()),s(m,()=>p.publishingSteps[t.kind],S,_),s(b,()=>t.system.value||(()=>{var T=u(Ee);return s(T,()=>p.missingSystem),T})(),y,E),s(R,n!==null?(()=>{var T=u(Vn),me=T.firstChild,[at,zt]=d(me.nextSibling),Wt=at.nextSibling,Zt=Wt.nextSibling,[st,jt]=d(Zt.nextSibling),Kt=st.nextSibling,qt=Kt.nextSibling,[ot,Vt]=d(qt.nextSibling);return ot.nextSibling,s(T,()=>p.days[n.day],at,zt),s(T,()=>n.from,st,jt),s(T,()=>n.to,ot,Vt),T})():(()=>{var T=u(Ee);return s(T,()=>p.missingSlot),T})(),H,Z),s(I,()=>t.playerCount.min.value,J,re),s(I,()=>t.playerCount.max.value,te,N),s(B,()=>i.join(", ")||(()=>{var T=u(Ee);return s(T,()=>p.missingTags),T})(),ie,le),s(K,(()=>{var T=L(()=>t.description.short.value.length===0);return()=>T()?(()=>{var me=u(Ee);return s(me,()=>p.missingShortDescription),me})():Et(t.description.short.value,He)})(),Se,_e),Ge.$$click=()=>l({kind:"EDIT_GAMEROUND",uuid:t.uuid}),ae(()=>he(a,["event-entry",t.kind==="draft"?"gray":""].join(" "))),tt(),a})()}et(["click"]);var Qn=c("<p>WIP"),Xn=c("<p>Diese Seite ist leider noch nicht bereit. Komm bitte später nochmal zurück."),er=c("<h1>loading"),tr=c("<p>Programm konnte nicht geladen werden."),nr=c("<h3>Samstag"),ht=c("<ul class=event-list role=list>"),rr=c("<h3>Sonntag"),ir=c('<li><h3 class=event-title></h3><div class=event-details><div class=event-tags><strong>System:</strong><!$><!/></div><div class=event-tags><strong>Tag, Zeit:</strong><span><!$><!/>, <!$><!/> - <!$><!/> Uhr</span></div><div class=event-tags><strong>Freie Plätze:</strong> <!$><!/></div> <div class=event-tags><strong>Kategorien:</strong> <!$><!/></div></div><div class="event-description content"><p><strong>Kurzbeschreibung:</strong><br><!$><!/></p></div><ul role=list class=event-links><li><button class=event-link><span>Teilnehmen</span></button></li><li><button class=event-link><span>Details');function lr(e){return r(se,{get fallback(){return r(w,{type:"danger",get children(){return u(Xn)}})},get children(){return r(D,{get when(){return e.isDebugging},get children(){return[r(w,{type:"danger",get children(){return u(Qn)}}),r(C,{get when(){return e.program()},get fallback(){return u(er)},children:t=>r(C,{get when(){return t().kind==="SUCCESS"},get fallback(){return r(w,{type:"danger",get children(){return u(tr)}})},get children(){return r(ar,{get program(){return t().data}})}})})]}})}})}function ar(e){const t=or(sr(e.program));return[u(nr),(()=>{var n=u(ht);return s(n,r(F,{get each(){return t.SATURDAY},children:i=>r($t,{entry:i})})),n})(),u(rr),(()=>{var n=u(ht);return s(n,r(F,{get each(){return t.SUNDAY},children:i=>r($t,{entry:i})})),n})()]}function sr(e){const t=Object.groupBy(e,n=>n.slot.day);return{SATURDAY:t.SATURDAY??[],SUNDAY:t.SUNDAY??[]}}function or(e){function t(n,i){const{from:l,to:a}=n.slot,{from:o,to:g}=i.slot;return l===o?a-g:l-o}return{SATURDAY:e.SATURDAY.toSorted(t),SUNDAY:e.SUNDAY.toSorted(t)}}function $t(e){const t=e.entry.tags.map(n=>lt.find(({name:i})=>i===n)).filter(n=>n!==void 0).map(({label:n})=>n);return(()=>{var n=u(ir),i=n.firstChild,l=i.nextSibling,a=l.firstChild,o=a.firstChild,g=o.nextSibling,[m,$]=d(g.nextSibling),h=a.nextSibling,S=h.firstChild,_=S.nextSibling,b=_.firstChild,[f,v]=d(b.nextSibling),y=f.nextSibling,E=y.nextSibling,[R,O]=d(E.nextSibling),M=R.nextSibling,H=M.nextSibling,[Z,I]=d(H.nextSibling);Z.nextSibling;var G=h.nextSibling,q=G.firstChild,V=q.nextSibling,J=V.nextSibling,[re,Q]=d(J.nextSibling),ee=G.nextSibling,te=ee.nextSibling,N=te.firstChild,ne=N.nextSibling,B=ne.nextSibling,[j,oe]=d(B.nextSibling),U=l.nextSibling,ie=U.firstChild,le=ie.firstChild,ue=le.nextSibling,K=ue.nextSibling,[ge,$e]=d(K.nextSibling),ye=U.nextSibling,Se=ye.firstChild,_e=Se.firstChild,xe=Se.nextSibling,Ce=xe.firstChild;return s(i,()=>e.entry.title),s(a,()=>e.entry.system,m,$),s(_,()=>p.days[e.entry.slot.day],f,v),s(_,()=>e.entry.slot.from,R,O),s(_,()=>e.entry.slot.to,Z,I),s(G,()=>Math.max(e.entry.playerCount.max-1-e.entry.playerCount.reserved,0),re,Q),s(te,()=>t.join(", "),j,oe),s(ie,()=>Et(e.entry.description.short,He),ge,$e),_e.$$click=()=>console.log("not yet implemented"),Ce.$$click=()=>console.log("not yet implemented"),ae(()=>he(n,["event-entry"].join(" "))),tt(),n})()}et(["click"]);var St=c("<h3>Spielrunden ansehen"),_t=c("<p>Melde dich (und deine Freunde) für diverse Spielrunden an."),je=c("<br>"),ur=c("<h3>Spielrunden erstellen"),dr=c("<p>Falls du wenig oder gar keine Erfahrung als Spielleiter:in hast, werden wir dich vor und während dem Anlass unterstützen."),cr=c("<h3>Helfen"),gr=c("<p>Beim Kiosk und der Essensausgabe können wir immer ein paar helfende Hände gebrauchen."),bt=c("<p><strong>Noch nicht verfügbar."),mr=c("<h3>Zusammenfassung"),hr=c("<p>Erhalte einen Überblick über dein gesamtes Programm.");function $r(e){return[r(se,{get fallback(){return r(fe,{type:"gray",icon:"dice-d20",onClick:()=>e.changePage({kind:"PLAYER"}),get children(){return[u(St),u(_t),u(bt)]}})},get children(){return r(D,{get when(){return e.isDebugging},get children(){return r(fe,{icon:"dice-d20",onClick:()=>e.changePage({kind:"PLAYER"}),get children(){return[u(St),u(_t)]}})}})}}),u(je),r(fe,{icon:"grid-2-plus",onClick:()=>e.changePage({kind:"GAMEMASTER"}),get children(){return[u(ur),u(dr)]}}),u(je),r(fe,{type:"gray",icon:"hand-heart",onClick:()=>e.changePage({kind:"HELPING"}),get children(){return[u(cr),u(gr),u(bt)]}}),u(je),r(fe,{icon:"list",onClick:()=>e.changePage({kind:"SUMMARY"}),get children(){return[u(mr),u(hr)]}})]}var Sr=c("<fieldset><legend>Zeitslots</legend><!$><!/><!$><!/>"),ft=c("<br>"),_r=c("<div style=margin-block-end:0.5rem;>Zeitslot: <!$><!/>, <!$><!/> -<!$><!/> Uhr"),br=c("<ul class=event-list role=list>"),fr=c("<em>werden geladen..."),vr=c("<li class=event-entry><h3 class=event-title><!$><!/>, <!$><!/> - <!$><!/> Uhr</h3><div class=event-details><div class=event-tags><strong>Dauer:</strong><!$><!/> <!$><!/></div><div class=event-tags><strong>Spielende:</strong> <!$><!/></div></div><div></div><ul role=list class=event-links>"),pr=c("<em>Fehler beim Laden."),kr=c("<em>noch keine Anmeldungen"),yr=c("<li><em style=font-size:smaller;>Aktionen werden geladen..."),vt=c("<li><em style=font-size:smaller;>kann nicht gelöscht werden"),xr=c("<li><button type=button class=event-link><div style=display:flex;gap:0.25rem;align-items:center;><!$><!/><span>Löschen"),Cr=c("<div style=display:grid;gap:0.5rem;>"),Er=c("<div style=display:grid;gap:0.5rem;><!$><!/><!$><!/>"),wr=c("<div style=display:grid;gap:0.5rem;><!$><!/><!$><!/><!$><!/>"),Ar=c("<div style=display:grid;gap:0.5rem;><!$><!/><!$><!/><!$><!/><div style=margin-block-start:1rem;>"),Tr=c("<div style=display:flex;flex-wrap:wrap;gap:0.5rem;align-items:center;><!$><!/> <span>Neuen Slot erfassen"),Rr=c("<em>Wähle eine Tag:"),Dr=c("<div style=display:flex;flex-wrap:wrap;gap:.5rem;><!$><!/><!$><!/>"),Ur=c("<em>Wähle eine Startzeit:"),Lt=c("<div style=display:flex;flex-wrap:wrap;gap:.5rem;>"),Ft=c("<span style=white-space:nowrap;><!$><!/> Uhr"),Or=c("<em>Wähle eine Endzeit:");function Ir(e){return(()=>{var t=u(Sr),n=t.firstChild,i=n.nextSibling,[l,a]=d(i.nextSibling),o=l.nextSibling,[g,m]=d(o.nextSibling);return s(t,r(Nr,{get store(){return e.store},get registrations(){return e.registrations}}),l,a),s(t,r(C,{get when(){return e.slotMissing},get children(){return r(w,{type:"danger",children:"Wähle mindestens einen Zeitslot aus."})}}),g,m),t})()}const pt=1;function Mr(e){function t(n){const i=Je(n.open,!0);return n.breaks.map(a=>Je(a,!0)).reduce((a,o)=>{const g=o.at(0),m=o.at(-1);if(g===void 0||m===void 0)return a;const $=[];return a.forEach(h=>{const S=[],_=[];h.forEach(b=>{b<=g&&S.push(b),m<=b&&_.push(b)}),S.length>0&&$.push(S),_.length>0&&$.push(_)}),$},[i]).map(a=>{const o=a.slice(0,pt*-1);return en(o.map(g=>{const m=a.filter($=>$>=g+pt);return[g,m]}))}).reduce((a,o)=>({...a,...o}),{})}return{SATURDAY:t(e.SATURDAY),SUNDAY:t(e.SUNDAY)}}function Nr(e){const[t,n]=A(e.store),[i,l]=A({dialog:ve()}),a=Le(()=>Mr(Ne));function o($){n(t.concat($))}function g($){l("dialog","open",!1),l("slot",void 0),n(t.filter(h=>h.uuid!==$))}function m($){l("dialog","open",!0),l("slot",t.find(h=>h.uuid===$))}return[r(Lr,{get daySections(){return a()},chooseTimeSlot:o}),u(ft),u(ft),r(ke,{get store(){return i.dialog},title:"Zeitslot löschen",onClose:()=>l("slot",void 0),get children(){return[(()=>{var $=u(_r),h=$.firstChild,S=h.nextSibling,[_,b]=d(S.nextSibling),f=_.nextSibling,v=f.nextSibling,[y,E]=d(v.nextSibling),R=y.nextSibling,O=R.nextSibling,[M,H]=d(O.nextSibling);return M.nextSibling,s($,()=>p.days[i.slot?.day],_,b),s($,()=>i.slot?.from,y,E),s($,()=>i.slot?.to,M,H),$})(),r(Y,{kind:"danger",icon:"trash",label:"Löschen",onClick:()=>g(i.slot?.uuid)})]}}),r(Pr,{slots:t,get registrations(){return e.registrations},confirmRemoval:m})]}function Pr(e){return(()=>{var t=u(br);return s(t,r(F,{get each(){return Fr(e.slots)},children:n=>(()=>{var i=u(vr),l=i.firstChild,a=l.firstChild,[o,g]=d(a.nextSibling),m=o.nextSibling,$=m.nextSibling,[h,S]=d($.nextSibling),_=h.nextSibling,b=_.nextSibling,[f,v]=d(b.nextSibling);f.nextSibling;var y=l.nextSibling,E=y.firstChild,R=E.firstChild,O=R.nextSibling,[M,H]=d(O.nextSibling),Z=M.nextSibling,I=Z.nextSibling,[G,q]=d(I.nextSibling),V=E.nextSibling,J=V.firstChild,re=J.nextSibling,Q=re.nextSibling,[ee,te]=d(Q.nextSibling),N=y.nextSibling,ne=N.nextSibling;return s(l,()=>p.days[n.day],o,g),s(l,()=>n.from,h,S),s(l,()=>n.to,f,v),s(E,()=>n.to-n.from,M,H),s(E,()=>n.to-n.from>1?"Stunden":"Stunde",G,q),s(V,r(se,{get children(){return[r(D,{get when(){return e.registrations.loading},get children(){return u(fr)}}),r(D,{get when(){return e.registrations()},children:B=>{const j=B();if(j.kind==="FAILURE")return u(pr);const oe=j.data.entries.filter(U=>U.uuid===n.uuid).map(U=>U.name);return L(()=>oe.join(", ")||u(kr))}})]}}),ee,te),s(ne,r(nt,{get fallback(){return u(yr)},get children(){return r(C,{get when(){return e.registrations()},children:B=>{const j=B();return j.kind==="FAILURE"?u(vt):j.data.entries.filter(U=>U.uuid===n.uuid).map(U=>U.name).length>0?u(vt):(()=>{var U=u(xr),ie=U.firstChild,le=ie.firstChild,ue=le.firstChild,[K,ge]=d(ue.nextSibling);return K.nextSibling,ie.$$click=()=>e.confirmRemoval(n.uuid),s(le,r(z,{icon:"trash"}),K,ge),tt(),U})()}})}})),i})()})),t})()}function Lr(e){const[t,n]=A({slot:{kind:"CHOOSE_DAY"},dialog:ve()});function i(){n("slot",{kind:"CHOOSE_DAY"}),n("dialog","open",!1)}function l(a){e.chooseTimeSlot(a),i()}return[r(W,{kind:"success",get label(){return(()=>{var a=u(Tr),o=a.firstChild,[g,m]=d(o.nextSibling);return g.nextSibling,s(a,r(z,{icon:"circle-plus"}),g,m),a})()},onClick:()=>n("dialog","open",!0)}),r(ke,{title:"Zeitslot erfassen",get store(){return t.dialog},size:"medium",onClose:i,get children(){return r(se,{get children(){return[r(D,{get when(){return t.slot.kind==="CHOOSE_DAY"},get children(){var a=u(Cr);return s(a,r(Oe,{changeDay:o=>n("slot",{kind:"CHOOSE_START",day:o})})),a}}),r(D,{get when(){return t.slot.kind==="CHOOSE_START"},get children(){var a=u(Er),o=a.firstChild,[g,m]=d(o.nextSibling),$=g.nextSibling,[h,S]=d($.nextSibling);return s(a,r(Oe,{get chosenDay(){return t.slot.kind==="CHOOSE_START"?t.slot.day:void 0},changeDay:_=>n("slot",{kind:"CHOOSE_START",day:_})}),g,m),s(a,r(Ke,{get startTimes(){return L(()=>t.slot.kind==="CHOOSE_START")()?Be(e.daySections[t.slot.day]):[]},changeStart:_=>n("slot",{kind:"CHOOSE_END",start:_})}),h,S),a}}),r(D,{get when(){return t.slot.kind==="CHOOSE_END"},get children(){var a=u(wr),o=a.firstChild,[g,m]=d(o.nextSibling),$=g.nextSibling,[h,S]=d($.nextSibling),_=h.nextSibling,[b,f]=d(_.nextSibling);return s(a,r(Oe,{get chosenDay(){return t.slot.kind==="CHOOSE_END"?t.slot.day:void 0},changeDay:v=>n("slot",{kind:"CHOOSE_START",day:v})}),g,m),s(a,r(Ke,{get chosenStart(){return t.slot.kind==="CHOOSE_END"?t.slot.start:void 0},get startTimes(){return L(()=>t.slot.kind==="CHOOSE_END")()?Be(e.daySections[t.slot.day]):[]},changeStart:v=>n("slot",{kind:"CHOOSE_END",start:v})}),h,S),s(a,r(kt,{get endTimes(){return t.slot.kind==="CHOOSE_END"?e.daySections[t.slot.day][t.slot.start]??[]:[]},changeEnd:v=>{t.slot.kind==="CHOOSE_END"&&n("slot",{kind:"WAIT_FOR_CONFIRMATION",day:t.slot.day,start:t.slot.start,end:v})}}),b,f),a}}),r(D,{get when(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"},get children(){var a=u(Ar),o=a.firstChild,[g,m]=d(o.nextSibling),$=g.nextSibling,[h,S]=d($.nextSibling),_=h.nextSibling,[b,f]=d(_.nextSibling),v=b.nextSibling;return s(a,r(Oe,{get chosenDay(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"?t.slot.day:void 0},changeDay:y=>n("slot",{kind:"CHOOSE_START",day:y})}),g,m),s(a,r(Ke,{get chosenStart(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"?t.slot.start:void 0},get startTimes(){return L(()=>t.slot.kind==="WAIT_FOR_CONFIRMATION")()?Be(e.daySections[t.slot.day]):[]},changeStart:y=>n("slot",{kind:"CHOOSE_END",start:y})}),h,S),s(a,r(kt,{get chosenEnd(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"?t.slot.end:void 0},get endTimes(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"?e.daySections[t.slot.day][t.slot.start]??[]:[]},changeEnd:y=>{t.slot.kind==="WAIT_FOR_CONFIRMATION"&&n("slot",{kind:"WAIT_FOR_CONFIRMATION",day:t.slot.day,start:t.slot.start,end:y})}}),b,f),s(v,r(W,{get label(){return`Slot "${t.slot.kind==="WAIT_FOR_CONFIRMATION"?`${p.days[t.slot.day]}, von ${t.slot.start} bis ${t.slot.end} Uhr`:""}" erstellen`},kind:"success",onClick:()=>{t.slot.kind==="WAIT_FOR_CONFIRMATION"&&l({uuid:crypto.randomUUID(),day:t.slot.day,from:t.slot.start,to:t.slot.end})}})),a}})]}})}})]}function Oe(e){return[u(Rr),(()=>{var t=u(Dr),n=t.firstChild,[i,l]=d(n.nextSibling),a=i.nextSibling,[o,g]=d(a.nextSibling);return s(t,r(W,{get kind(){return e.chosenDay==="SATURDAY"?"success":"gray"},label:"Samstag",onClick:()=>e.changeDay("SATURDAY")}),i,l),s(t,r(W,{get kind(){return e.chosenDay==="SUNDAY"?"success":"gray"},label:"Sonntag",onClick:()=>e.changeDay("SUNDAY")}),o,g),t})()]}function Ke(e){return[u(Ur),(()=>{var t=u(Lt);return s(t,r(F,{get each(){return e.startTimes},children:n=>r(W,{get kind(){return e.chosenStart===n?"success":"gray"},get label(){return(()=>{var i=u(Ft),l=i.firstChild,[a,o]=d(l.nextSibling);return a.nextSibling,s(i,n,a,o),i})()},onClick:()=>e.changeStart(n)})})),t})()]}function kt(e){return[u(Or),(()=>{var t=u(Lt);return s(t,r(F,{get each(){return e.endTimes},children:n=>r(W,{get kind(){return e.chosenEnd===n?"success":"gray"},get label(){return(()=>{var i=u(Ft),l=i.firstChild,[a,o]=d(l.nextSibling);return a.nextSibling,s(i,n,a,o),i})()},onClick:()=>e.changeEnd(n)})})),t})()]}function Fr(e){return e.toSorted((t,n)=>t.day!==n.day?t.day==="SATURDAY"?-1:1:t.from-n.from)}et(["click"]);function Hr(e){const t=new Date;return async()=>new Promise(n=>{setTimeout(()=>(console.error("NOT YET IMPLEMENTED: `publishGameround`",e,t),n()),500)})}function Gr(e,t){const n=new Date;return async()=>new Promise(i=>{setTimeout(()=>(console.error("NOT YET IMPLEMENTED: `sendGameroundUpdate`",e,t.join(", "),n),i()),500)})}var Te=c("<br>"),Yr=c("<div class=content><p>Möchtest du diese Spielrunde gerne veröffentlichen?</p><!$><!/>"),Br=c("<em>Informationen zu den Anmeldungen müssen geladen werden..."),zr=c("<em>Du kannst kein Update versenden, da sich noch niemand für diese Spielrunde angemeldet hat."),Wr=c("<p>An: <!$><!/>"),Zr=c("<em>Du kannst die Spielrunde nur löschen, wenn du zuerst alle Zeitslots entfernt hast."),jr=c("<div class=content><p>Bist du sicher, dass du die Spielrunde löschen möchtest?</p><!$><!/>"),Kr=c('<form novalidate><!$><!/><!$><!/><!$><!/><div style="display:grid;grid-template-columns:repeat(2, 1fr);gap:1rem;"><!$><!/><!$><!/></div><!$><!/><!$><!/><!$><!/><fieldset><legend>Kategorien (optional)</legend><!$><!/></fieldset><!$><!/><div style=display:flex;flex-wrap:wrap;gap:1rem;justify-content:space-between;><!$><!/><div style=display:flex;flex-wrap:wrap;gap:1rem;><!$><!/><!$><!/><!$><!/>'),qr=c("<h4>Spielrunde inkomplett"),Vr=c("<p>Du hast noch einen oder mehre Fehler/fehlende Informationen in dieser Spielrunde:"),Jr=c("<li>«Titel» ist ein Pflichtfeld."),Qr=c("<li>«kurz Beschreibung» ist ein Pflichtfeld."),Xr=c("<li>«kurz Beschreibung» ist zu lang."),ei=c("<li>«lange Beschreibung» ist zu lang."),ti=c("<li>Mindest einen Zeitslot muss ausgewählt werden."),ni=c("<ul><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),ri=c("<p><strong>Erklärung:</strong> Hast du eine wichtige Änderung an dieser Spielrunde durchgeführt, während bereits Spielende angemeldet waren? Lass hiermit die Angemeldeten wissen, was du geändert hast. Wichtige Änderungen können sein: System geändert, Kategorien geändert. Für kleine Änderungen, wie z.B. Rechtschreibfehler, sollte dies nicht genutzt werden."),ii=c("<p><em>Halte dich kurz und am besten Stichwortartig."),li=c("<form><!$><!/><!$><!/>"),ai=c("<div style=display:grid;gap:0.5rem;margin-block-end:1rem;>");function si(e){const t=e.allRounds.find(n=>n.uuid===e.uuid);return r(C,{get fallback(){return e.fallback},when:t,children:n=>e.children(n())})}function oi(e){const[t,n]=A(e.store),[i,l]=A({delete:ve(),publish:ve(),sendUpdate:ve()});function a(g){g.preventDefault(),l("publish","open",!0)}function o(){e.changePage({kind:"GAMEMASTER"})}return[r(Dt,{kind:"special",get children(){return["Status: ",L(()=>p.publishingSteps[t.kind])]}}),u(Te),u(Te),r(gi,{store:t,get registrations(){return e.registrations},onSubmit:a,onCancel:()=>l("delete","open",!0),onSendUpdate:()=>l("sendUpdate","open",!0),goBack:o}),r(ui,{get store(){return i.publish},get title(){return t.title.value},onPublish:()=>{n("kind","published"),l("publish","open",!1),e.queue.enqueue(Hr(t.uuid))}}),r(di,{get store(){return i.sendUpdate},get players(){return $i(e.registrations,t.slots.map(g=>g.uuid))},onSend:g=>{e.queue.enqueue(Gr(g,t.slots.map(m=>m.uuid)))}}),r(ci,{get store(){return i.delete},get hasSlots(){return t.slots.length!==0},get title(){return t.title.value},onDelete:()=>{n("kind","deleted"),e.changePage({kind:"GAMEMASTER"})}})]}function ui(e){return r(ke,{get store(){return e.store},title:"Spielrunde veröffentlichen",onClose:()=>{},get children(){var t=u(Yr),n=t.firstChild,i=n.nextSibling,[l,a]=d(i.nextSibling);return s(t,r(Y,{kind:"success",icon:"circle-plus",get label(){return`Ja, bitte "${e.title||"["+p.missingTitle+"]"}" veröffentlichen.`},get onClick(){return e.onPublish}}),l,a),t}})}function di(e){return r(ke,{get store(){return e.store},title:"Update senden",onClose:()=>{},size:"medium",get children(){return()=>e.players.kind==="LOADING"?u(Br):e.players.kind==="ERROR"?L(()=>p.error.general):e.players.data.length===0?u(zr):[(()=>{var t=u(Wr),n=t.firstChild,i=n.nextSibling,[l,a]=d(i.nextSibling);return s(t,()=>e.players.data.map(o=>o.name).join(", "),l,a),t})(),u(Te),r(mi,{get onSend(){return e.onSend}})]}})}function ci(e){return r(ke,{get store(){return e.store},title:"Spielrunde löschen",onClose:()=>{},get children(){return[r(C,{get when(){return e.hasSlots},get children(){return u(Zr)}}),r(C,{get when(){return!e.hasSlots},get children(){var t=u(jr),n=t.firstChild,i=n.nextSibling,[l,a]=d(i.nextSibling);return s(t,r(Y,{kind:"danger",icon:"trash",get label(){return`Ja, bitte "${e.title||"["+p.missingTitle+"]"}" löschen.`},get onClick(){return e.onDelete}}),l,a),t}})]}})}function gi(e){const[t]=A(e.store),n=Le(()=>zn(t));return(()=>{var i=u(Kr),l=i.firstChild,[a,o]=d(l.nextSibling),g=a.nextSibling,[m,$]=d(g.nextSibling),h=m.nextSibling,[S,_]=d(h.nextSibling),b=S.nextSibling,f=b.firstChild,[v,y]=d(f.nextSibling),E=v.nextSibling,[R,O]=d(E.nextSibling),M=b.nextSibling,[H,Z]=d(M.nextSibling),I=H.nextSibling,[G,q]=d(I.nextSibling),V=G.nextSibling,[J,re]=d(V.nextSibling),Q=J.nextSibling,ee=Q.firstChild,te=ee.nextSibling,[N,ne]=d(te.nextSibling),B=Q.nextSibling,[j,oe]=d(B.nextSibling),U=j.nextSibling,ie=U.firstChild,[le,ue]=d(ie.nextSibling),K=le.nextSibling,ge=K.firstChild,[$e,ye]=d(ge.nextSibling),Se=$e.nextSibling,[_e,xe]=d(Se.nextSibling),Ce=_e.nextSibling,[Ge,T]=d(Ce.nextSibling);return s(i,r(C,{get when(){return t.kind==="published"},get children(){return r(yt,{get errors(){return n()}})}}),a,o),s(i,r(Ae,{get store(){return t.title},label:"Titel",name:"title",get showErrors(){return t.kind==="published"?"ALWAYS":"ON_BLUR"},get errors(){return n().titleMissing?[p.mandatoryField]:[]}}),m,$),s(i,r(Ae,{get store(){return t.system},label:"System (optional)",name:"System"}),S,_),s(b,r(ut,{get store(){return t.playerCount.min},label:"Anzahl Mitspielende (Minimum)",name:"playerCountMin",min:1,get max(){return t.playerCount.max.value}}),v,y),s(b,r(ut,{get store(){return t.playerCount.max},label:"Anzahl Mitspielende (Maximum)",name:"playerCountMax",get min(){return t.playerCount.min.value}}),R,O),s(i,r(Ve,{get store(){return t.description.short},label:"kurze Beschreibung",name:"descriptionShort",size:"small",get showErrors(){return t.kind==="published"?"ALWAYS":"ON_BLUR"},get errors(){return L(()=>!!n().descriptionShortMissing)()?[p.mandatoryField]:L(()=>!!n().descriptionShortTooLong)()?[p.charLimitBy.replace("{}",String(He))]:[]}}),H,Z),s(i,r(Ve,{get store(){return t.description.long},label:"lange Beschreibung (optional)",name:"descriptionLong",get showErrors(){return t.kind==="published"?"ALWAYS":"ON_BLUR"},get errors(){return L(()=>!!n().descriptionLongTooLong)()?[p.charLimitBy.replace("{}",String(Nt))]:[]}}),G,q),s(i,r(Ir,{get store(){return e.store.slots},get registrations(){return e.registrations},get slotMissing(){return n().slotMissing}}),J,re),s(Q,r(hi,{get store(){return t.tagNames}}),N,ne),s(i,r(yt,{get errors(){return n()}}),j,oe),s(U,r(Y,{icon:"backward",label:"Zurück zu deinen Spielrunden",get onClick(){return e.goBack}}),le,ue),s(K,r(C,{get when(){return t.kind!=="deleted"},get children(){return r(Y,{icon:"trash",kind:"danger",label:"Löschen",onClick:()=>e.onCancel()})}}),$e,ye),s(K,r(C,{get when(){return t.kind==="draft"},get children(){return r(Y,{icon:"circle-plus",get kind(){return n().hasErrors?"gray":"success"},get disabled(){return n().hasErrors},label:"Spielrunde veröffentlichen",get onClick(){return n().hasErrors?void 0:e.onSubmit}})}}),_e,xe),s(K,r(C,{get when(){return t.kind==="published"},get children(){return r(Y,{icon:"circle-plus",kind:"success",label:"Update an Spielende schicken",get onClick(){return e.onSendUpdate}})}}),Ge,T),i})()}function yt(e){return r(C,{get when(){return e.errors.hasErrors},get children(){return r(w,{type:"danger",get children(){return[u(qr),u(Vr),(()=>{var t=u(ni),n=t.firstChild,[i,l]=d(n.nextSibling),a=i.nextSibling,[o,g]=d(a.nextSibling),m=o.nextSibling,[$,h]=d(m.nextSibling),S=$.nextSibling,[_,b]=d(S.nextSibling),f=_.nextSibling,[v,y]=d(f.nextSibling);return s(t,r(C,{get when(){return e.errors.titleMissing},get children(){return u(Jr)}}),i,l),s(t,r(C,{get when(){return e.errors.descriptionShortMissing},get children(){return u(Qr)}}),o,g),s(t,r(C,{get when(){return e.errors.descriptionShortTooLong},get children(){return u(Xr)}}),$,h),s(t,r(C,{get when(){return e.errors.descriptionLongTooLong},get children(){return u(ei)}}),_,b),s(t,r(C,{get when(){return e.errors.slotMissing},get children(){return u(ti)}}),v,y),t})()]}})}})}function mi(e){const[t,n]=A({updateText:{value:"",isDirty:!1},hasBeenSent:!1}),i=Le(()=>Wn(t));return r(se,{get fallback(){return r(w,{type:"success",children:"Nachricht wurde registriert und wird in den nächsten 24 Stunden an die Spielenden verschickt."})},get children(){return r(D,{get when(){return!t.hasBeenSent},get children(){return[u(ri),u(Te),u(ii),u(Te),(()=>{var l=u(li),a=l.firstChild,[o,g]=d(a.nextSibling),m=o.nextSibling,[$,h]=d(m.nextSibling);return sn(l,"novalidate",!0),s(l,r(Ve,{get store(){return t.updateText},label:"Zusammenfassung der Änderung",name:"updateText",size:"small",showErrors:"ALWAYS",get errors(){return L(()=>!!i().missing)()?[p.mandatoryField]:L(()=>!!i().tooLong)()?[p.charLimitBy.replace("{}",String(Pt))]:[]}}),o,g),s(l,r(Y,{icon:"paper-plane",label:"Spielende informieren",get kind(){return i().hasErrors?"gray":"success"},get disabled(){return i().hasErrors},get onClick(){return i().hasErrors?void 0:()=>{e.onSend(t.updateText.value),n("hasBeenSent",!0)}}}),$,h),l})()]}})}})}function hi(e){const[t,n]=A(e.store);return[(()=>{var i=u(ai);return s(i,r(F,{each:lt,children:l=>r(Rt,{get label(){return l.label},get description(){return l.description},get checked(){return t.includes(l.name)},get name(){return l.name},get value(){return l.name},onValueUpdate:a=>{n(a?t.concat([l.name]):t.filter(o=>o!==l.name))}})})),i})(),r(w,{get children(){return p.tagIdeas}})]}const $i=(e,t)=>{if(e.loading)return{kind:"LOADING"};if(e.error)return{kind:"ERROR"};const n=e();return n===void 0||n.kind==="FAILURE"?{kind:"ERROR"}:{kind:"SUCCESS",data:n.data.entries.filter(i=>t.includes(i.uuid))}},Si=cn("kind",[x({kind:de("CHOOSE")}),x({kind:de("PLAYER")}),x({kind:de("GAMEMASTER")}),x({kind:de("HELPING")}),x({kind:de("SUMMARY")}),x({kind:de("EDIT_GAMEROUND"),uuid:k().uuid()})]),_i=Fe(["SAVING","IDLE","ERROR"]),bi=x({saveState:_i,page:Si,secret:k(),showCreateMessage:pe(),isDebugging:pe()});function Ht(e){const t=e.searchParams.get("page")??"",n=e.searchParams.get("uuid")??void 0,i=e.searchParams.get("secret")??"",l=e.searchParams.get("showCreateMessage")==="true",a=e.searchParams.get("debug")==="true",o=bi.safeParse({saveState:"IDLE",page:{kind:t.toUpperCase(),uuid:n},secret:i,showCreateMessage:l,isDebugging:a});return o.success?o.data:{saveState:"IDLE",page:{kind:"CHOOSE"},secret:i,showCreateMessage:l,isDebugging:a}}function fi(e,t){return e.kind!==t.kind?!1:e.kind!=="EDIT_GAMEROUND"||t.kind!=="EDIT_GAMEROUND"?!0:e.uuid===t.uuid}const vi="2024-08-15T07:45:21.335Z",Pe={game:"37831e19-29d6-40bd-b99d-fb91b78aa7f9",slot:"bfcbd156-b703-4664-9944-8936aede8476"};function pi(e,t){const n=localStorage.getItem(e);return n===null?t:n}function ki(e,t){localStorage.setItem(e,t)}const Gt="SAVE",yi={version:1,init:{name:"John Doe",email:"john@doe.ch",mobile:"+41 66 123 45 67"},lastSaved:vi,playing:{wantsUpdates:!1},master:{games:[{uuid:Pe.game,kind:"published",title:"Grolle in der Dunkelheit",system:"Warhammer Fantasy Rollenspiel",description:{short:"Ein kurzes Abenteuer bei dem es um Fantasy, Action und einfaches Rollenspiel geht.",long:"Eine kleine Gruppe wagt sich in die dunklen Schächten einer Mine und weiter hinab, um einen mächtigen Gegenstand wieder zu erlangen. Wie werden die Gefährten auf die Gefahren des Untergrundes reagieren und welche Gefahren lauern in der Finsternis?"},slots:[{uuid:Pe.slot,day:"SATURDAY",from:10,to:12},{uuid:crypto.randomUUID(),day:"SUNDAY",from:14,to:17}],playerCount:{min:1,max:3},tagNames:["deutsch"]}],wantsHelp:!1},helping:{}};async function xi(){return new Promise(e=>setTimeout(()=>e({kind:"SUCCESS",data:JSON.parse(pi(Gt,JSON.stringify(yi)))}),1e3))}async function Ci(e,t){return new Promise(n=>setTimeout(()=>(ki(Gt,JSON.stringify(e)),n({kind:"SUCCESS",data:t})),1e3))}const Ei=[{uuid:crypto.randomUUID(),gamemaster:"Mike Hunziker",title:"Grolle in der Dunkelheit",system:"Warhammer Fantasy Rollenspiel",description:{short:"Ein kurzes Abenteuer bei dem es um Fantasy, Action und einfaches Rollenspiel geht.",long:"Eine kleine Gruppe wagt sich in die dunklen Schächten einer Mine und weiter hinab, um einen mächtigen Gegenstand wieder zu erlangen. Wie werden die Gefährten auf die Gefahren des Untergrundes reagieren und welche Gefahren lauern in der Finsternis?"},slot:{day:"SATURDAY",from:10,to:13},playerCount:{min:1,max:3,reserved:0},tags:["children"]}];async function wi(){return new Promise(e=>setTimeout(()=>e({kind:"SUCCESS",data:Ei}),5e3))}const Ai={entries:[{uuid:Pe.slot,name:"Alice"},{uuid:Pe.slot,name:"Bob"}]};async function Ti(e){return new Promise(t=>setTimeout(()=>t({entries:Ai.entries.filter(n=>e.includes(n.uuid))}),5e3))}var Ri=c("<div aria-atomic=true><!$><!/><!$><!/>"),Di=c("<div class=toast-container aria-live=polite aria-atomic=true>");const[ce,Re]=A([]);function Ui(e){const t=()=>{const n=["toast"];return e.options.kind!==void 0&&n.push(`toast-${e.options.kind}`),n.join(" ")};return(()=>{var n=u(Ri),i=n.firstChild,[l,a]=d(i.nextSibling),o=l.nextSibling,[g,m]=d(o.nextSibling);return s(n,()=>e.options.message,l,a),s(n,r(C,{get when(){return e.options.dismissable},get children(){return r(W,{kind:"ghost",get label(){return r(z,{icon:"xmark",classes:["toast-dismiss"]})},get onClick(){return e.dismiss}})}}),g,m),ae($=>{var h=t(),S=e.options.kind==="danger"?"alert":"status",_=e.options.kind==="danger"?"assertive":"polite";return h!==$.e&&he(n,$.e=h),S!==$.t&&Me(n,"role",$.t=S),_!==$.a&&Me(n,"aria-live",$.a=_),$},{e:void 0,t:void 0,a:void 0}),n})()}function Oi(){function e(t){ce.find(n=>n.uuid===t)?.cleanup(),Re(ce.filter(n=>n.uuid!==t))}return(()=>{var t=u(Di);return s(t,r(F,{each:ce,children:n=>r(Ui,{options:n,dismiss:()=>e(n.uuid)})})),t})()}function Ii(e,t){if(t?.uuid!==void 0&&ce.find(g=>g.uuid===t.uuid)!==void 0)return Qe(t.uuid,e,t);const n=t?.uuid??crypto.randomUUID(),i=t?.duration??5e3,l=t?.kind??"gray",a=t?.dismissable,o=setTimeout(()=>{Re(ce.filter(g=>g.uuid!==n))},i);return Re(ce.length,{uuid:n,kind:l,message:e,duration:i,dismissable:a,cleanup:()=>clearTimeout(o)}),n}function Qe(e,t,n){const i=ce.find(m=>m.uuid===e);if(i===void 0)return e;i.cleanup();const l=n.duration??i.duration,a=n.kind??i.kind,o=n?.dismissable??i.dismissable,g=setTimeout(()=>{Re(ce.filter(m=>m.uuid!==e))},l);return Re(m=>m.uuid===e,{uuid:e,kind:a,message:t,duration:l,dismissable:o,cleanup:()=>clearTimeout(g)}),e}const Mi={version:1,init:{name:"",email:"",mobile:""},lastSaved:new Date().toISOString(),playing:{wantsUpdates:!0},master:{games:[],wantsHelp:!1},helping:{}};async function Ni(e){const t=new URL(Xe("/rst25/load"));t.searchParams.append("secret",e);const n=await fetch(t);if(!n.ok)return{kind:"FAILURE"};const i=await n.json();return typeof i=="object"&&i!==null?{kind:"SUCCESS",data:Object.assign(Mi,i)}:(console.error("`last_save` not found on ",i),{kind:"FAILURE"})}async function Pi(e,t){try{const n=await fetch(Xe("/rst25/save"),{method:"post",body:JSON.stringify({secret:t,save:e}),headers:{"Content-Type":"application/json"}});return n.ok?{kind:"SUCCESS",data:t}:(console.error(await n.text()),{kind:"FAILURE"})}catch(n){return console.error(n),{kind:"FAILURE"}}}async function Li(){try{const e=await fetch(Xe("/rst25/program"),{headers:{"Content-Type":"application/json"}});return e.ok?{kind:"SUCCESS",data:await e.json()}:(console.error(await e.text()),{kind:"FAILURE"})}catch(e){return console.error(e),{kind:"FAILURE"}}}const Fi=x({name:k(),email:k(),mobile:k()}),Hi=x({name:k(),email:k(),mobile:k()}),Gi=x({wantsUpdates:pe()}),Yi=x({wantsUpdates:pe()}),Bi=x({games:X(Hn),wantsHelp:pe()}),zi=x({games:X(Mt),wantsHelp:pe()}),Wi=x({}),Zi=x({}),ji=x({version:de(1),init:Fi,lastSaved:k(),playing:Gi,master:Bi,helping:Wi}),Ki=x({version:de(1),init:Hi,lastSaved:gn.date(),playing:Yi,master:zi,helping:Zi});async function qi(e){const t=e==="demo"?await xi():await Ni(e);if(t.kind==="FAILURE")return console.error("Unexpected error. Maybe network, maybe server error."),{kind:"FAILURE"};const n=ji.safeParse(t.data);if(!n.success)return console.error(n.error),{kind:"FAILURE"};const i=Vi(n.data);return i.success?{kind:"SUCCESS",data:i.data}:{kind:"FAILURE"}}function Vi(e){return Ki.safeParse(e)}const qe=crypto.randomUUID();async function Ji(e,t,n){const[i,l]=A(e);l("saveState","SAVING"),Ii("Am Speichern...",{uuid:qe,dismissable:!1});const a=new Date;t.lastSaved=a;const o=Qi(t);try{if((n==="demo"?await Ci(o,n):await Pi(o,n)).kind==="FAILURE")throw Error("")}catch(g){return l("saveState","ERROR"),console.error(g),Qe(qe,"Speichern war nicht möglich!",{kind:"danger",duration:1e4,dismissable:!0}),{kind:"FAILURE"}}return Qe(qe,`Zuletzt gespeichert um: ${wt(a)} Uhr`,{kind:"success",dismissable:!0}),l("saveState","IDLE"),{kind:"SUCCESS",data:a}}function Qi(e){return{...e,lastSaved:String(e.lastSaved),master:{...e.master,games:e.master.games.map(Bn)}}}const Xi=tn(Ji,1e3);var el=c("<div class=tooltip-wrapper><div class=tooltip></div><!$><!/>");function we(e){return(()=>{var t=u(el),n=t.firstChild,i=n.nextSibling,[l,a]=d(i.nextSibling);return s(n,()=>e.tooltip),s(t,()=>e.children,l,a),t})()}var tl=c("<div class=quickmenu-wrapper><div class=quickmenu><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),nl=c('<div class="quickmenu extended"><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>'),rl=c("<div style=margin-block-start:1rem;display:flex;gap:0.5rem;align-items:center;><!$><!/><em>Zuletzt gespeichert um: <!$><!/> Uhr"),il=c("<div style=margin-block-start:1rem;display:flex;gap:0.5rem;align-items:center;><!$><!/><em>Am Speichern..."),ll=c("<div style=margin-block-start:1rem;display:flex;gap:0.5rem;align-items:center;><!$><!/><em>Speichern war nicht möglich!");function al(e){return(()=>{var t=u(tl),n=t.firstChild,i=n.firstChild,[l,a]=d(i.nextSibling),o=l.nextSibling,[g,m]=d(o.nextSibling),$=g.nextSibling,[h,S]=d($.nextSibling),_=h.nextSibling,[b,f]=d(_.nextSibling),v=b.nextSibling,[y,E]=d(v.nextSibling);return s(n,r(we,{tooltip:"Zur Übersicht",get children(){return r(W,{get label(){return r(z,{icon:"backward"})},onClick:()=>e.changePage({kind:"CHOOSE"})})}}),l,a),s(n,r(we,{tooltip:"Zu den Spielrunden",get children(){return r(W,{get label(){return r(z,{icon:"dice-d20"})},onClick:()=>e.changePage({kind:"PLAYER"})})}}),g,m),s(n,r(we,{tooltip:"Zu deinen Spielrunden",get children(){return r(W,{get label(){return r(z,{icon:"grid-2-plus"})},onClick:()=>e.changePage({kind:"GAMEMASTER"})})}}),h,S),s(n,r(we,{tooltip:"Zum Helferplan",get children(){return r(W,{get label(){return r(z,{icon:"hand-heart"})},onClick:()=>e.changePage({kind:"HELPING"})})}}),b,f),s(n,r(we,{tooltip:"Zur Zusammenfassung",get children(){return r(W,{get label(){return r(z,{icon:"list"})},onClick:()=>e.changePage({kind:"SUMMARY"})})}}),y,E),t})()}function sl(e){return[r(w,{type:"gray",get children(){var t=u(nl),n=t.firstChild,[i,l]=d(n.nextSibling),a=i.nextSibling,[o,g]=d(a.nextSibling),m=o.nextSibling,[$,h]=d(m.nextSibling),S=$.nextSibling,[_,b]=d(S.nextSibling),f=_.nextSibling,[v,y]=d(f.nextSibling);return s(t,r(Y,{icon:"backward",label:"Zur Übersicht",onClick:()=>e.changePage({kind:"CHOOSE"})}),i,l),s(t,r(Y,{icon:"dice-d20",label:"Zu den Spielrunden",onClick:()=>e.changePage({kind:"PLAYER"})}),o,g),s(t,r(Y,{icon:"grid-2-plus",label:"Zu deinen Spielrunden",onClick:()=>e.changePage({kind:"GAMEMASTER"})}),$,h),s(t,r(Y,{icon:"hand-heart",label:"Zum Helferplan",onClick:()=>e.changePage({kind:"HELPING"})}),_,b),s(t,r(Y,{icon:"list",label:"Zur Zusammenfassung",onClick:()=>e.changePage({kind:"SUMMARY"})}),v,y),t}}),r(ol,{get saveState(){return e.saveState},get lastSaved(){return e.lastSaved}})]}function ol(e){return r(se,{get children(){return[r(D,{get when(){return e.saveState==="IDLE"},get children(){var t=u(rl),n=t.firstChild,[i,l]=d(n.nextSibling),a=i.nextSibling,o=a.firstChild,g=o.nextSibling,[m,$]=d(g.nextSibling);return m.nextSibling,s(t,r(z,{icon:"circle-check"}),i,l),s(a,()=>wt(e.lastSaved),m,$),t}}),r(D,{get when(){return e.saveState==="SAVING"},get children(){var t=u(il),n=t.firstChild,[i,l]=d(n.nextSibling);return i.nextSibling,s(t,r(z,{icon:"floppy-disk-circle-arrow-right"}),i,l),t}}),r(D,{get when(){return e.saveState==="ERROR"},get children(){var t=u(ll),n=t.firstChild,[i,l]=d(n.nextSibling);return i.nextSibling,s(t,r(z,{icon:"triangle-exclamation"}),i,l),t}})]}})}var ul=c("<div class=page><!$><!/><div class=page-content><h2></h2><br><!$><!/></div><!$><!/>"),dl=c("<div class=extended-wrapper style=margin-block-start:1rem;>");function be(e){return(()=>{var t=u(ul),n=t.firstChild,[i,l]=d(n.nextSibling),a=i.nextSibling,o=a.firstChild,g=o.nextSibling,m=g.nextSibling,[$,h]=d(m.nextSibling),S=a.nextSibling,[_,b]=d(S.nextSibling);return s(t,(()=>{var f=L(()=>e.showQuickmenu!==!1);return()=>f()?r(al,{get changePage(){return e.changePage},get saveState(){return e.saveState},get lastSaved(){return e.lastSaved}}):null})(),i,l),s(o,()=>e.title),s(a,()=>e.children,$,h),s(t,(()=>{var f=L(()=>e.showQuickmenu!==!1);return()=>f()?(()=>{var v=u(dl);return s(v,r(sl,{get changePage(){return e.changePage},get saveState(){return e.saveState},get lastSaved(){return e.lastSaved}})),v})():null})(),_,b),t})()}const cl=x({uuid:k().uuid(),name:k()}),Yt=x({entries:X(cl)}),gl=Yt;async function ml(e,t){console.log("loadRegistration still mocked",e.substring(0,4),"...");const n=await Ti(t),i=Yt.safeParse(n);if(!i.success)return{kind:"FAILURE"};const l=hl(i.data);return l.success?{kind:"SUCCESS",data:l.data}:{kind:"FAILURE"}}function hl(e){return gl.safeParse(e)}const $l=x({uuid:k().uuid(),title:k(),system:k(),gamemaster:k(),description:x({short:k(),long:k()}),slot:x({day:it,from:P(),to:P()}),playerCount:x({min:P(),max:P(),reserved:P()}),tags:X(k())}),Sl=X($l),_l=x({uuid:k().uuid(),title:k(),system:k(),description:x({short:k(),long:k()}),slot:x({day:it,from:P(),to:P()}),playerCount:x({min:P(),max:P(),reserved:P()}),tags:X(k())}),bl=X(_l);async function fl(e){const t=e==="demo"?await wi():await Li();if(t.kind==="FAILURE")return console.error("Unexpected error. Maybe network, maybe server error."),{kind:"FAILURE"};const n=Sl.safeParse(t.data);if(!n.success)return console.log(t.data),console.error(n.error),{kind:"FAILURE"};const i=vl(n.data);return i.success?{kind:"SUCCESS",data:i.data}:{kind:"FAILURE"}}function vl(e){return bl.safeParse(e)}var pl=c("<br>"),xt=c("<pre>"),kl=c("<hr>"),yl=c("<div><code>Registrations (read-only)"),xl=c("<em>loading...");function Cl(e){const t=new URL(location.href);t.searchParams.set("page",e.page.kind.toLowerCase()),e.page.kind==="EDIT_GAMEROUND"&&t.searchParams.set("uuid",e.page.uuid),t.searchParams.delete("showCreateMessage"),history.replaceState({page:e},"",t);const n=p.pageTitle[e.page.kind];document.title=p.metaTitle.replace("{}",n)}function El(e){const[t,n]=A(e.page);return(i,l)=>{if(fi(i,t))return;if(!l){const o=new URL(location.href);o.searchParams.set("page",i.kind.toLowerCase()),i.kind==="EDIT_GAMEROUND"?o.searchParams.set("uuid",i.uuid):o.searchParams.delete("uuid"),history.pushState({page:i},"",o)}const a=p.pageTitle[i.kind];document.title=p.metaTitle.replace("{}",a),n(i),window.scrollTo({top:0})}}function wl(e){Cl(e.meta);const[t,n]=A({meta:e.meta,save:e.save}),i=()=>t.save.master.games.flatMap(h=>h.slots.map(S=>S.uuid)),[l]=Ie(i(),h=>ml(t.meta.secret,h)),[a]=Ie(()=>fl(t.meta.secret)),[o,g]=At(!1);Ie(()=>JSON.stringify(t.save),async()=>{if(!o()){g(!0);return}const h=un(t.save);try{const S=await Xi(t.meta,h,t.meta.secret);S.kind==="FAILURE"?console.error(S):n("save","lastSaved",S.data)}catch(S){console.error(S),n("meta","saveState","ERROR")}});const m=El(t.meta),$=nn();return Tt(()=>{window.addEventListener("popstate",h=>{if(typeof h=="object"&&h!==null&&"state"in h){const S=new URL(location.href),_=Ht(S);m(_.page,!0)}}),setInterval(async()=>{const h=$.dequeue();h.kind==="NEXT_ELEMENT"&&await h.data()},1e3)}),[r(C,{get when(){return t.meta.showCreateMessage},get children(){return[r(w,{type:"success",get children(){return p.registrationStarted}}),u(pl)]}}),r(se,{get fallback(){return r(be,{title:"Wo möchtest du starten?",showQuickmenu:!1,changePage:m,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r($r,{changePage:m,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get isDebugging(){return t.meta.isDebugging}})}})},get children(){return[r(D,{get when(){return t.meta.page.kind==="PLAYER"},get children(){return r(be,{title:"Spielrundenübersicht",changePage:m,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r(lr,{program:a,get isDebugging(){return t.meta.isDebugging}})}})}}),r(D,{get when(){return t.meta.page.kind==="GAMEMASTER"},get children(){return r(be,{title:"Meine Spielrunden",changePage:m,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r(Jn,{get store(){return t.save.master},changePage:m})}})}}),r(D,{get when(){return t.meta.page.kind==="EDIT_GAMEROUND"},get children(){return r(be,{title:"Spielrunde editieren",changePage:m,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r(si,{get allRounds(){return t.save.master.games},get uuid(){return t.meta.page.kind==="EDIT_GAMEROUND"?t.meta.page.uuid:"should never happen"},get fallback(){return r(w,{type:"danger",get children(){return p.error.gameroundUuidError}})},children:h=>r(oi,{store:h,registrations:l,queue:$,changePage:m})})}})}}),r(D,{get when(){return t.meta.page.kind==="HELPING"},get children(){return r(be,{title:"Helfen",changePage:m,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r(Pn,{})}})}}),r(D,{get when(){return t.meta.page.kind==="SUMMARY"},get children(){return r(be,{title:"Zusammenfassung",changePage:m,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return r(Dn,{get store(){return t.save},changePage:m})}})}})]}}),r(C,{get when(){return t.meta.isDebugging},get children(){return[(()=>{var h=u(xt);return s(h,()=>JSON.stringify(t,null,2)),h})(),u(kl),u(yl),r(nt,{get fallback(){return u(xl)},get children(){return r(C,{get when(){return l()},children:h=>(()=>{var S=u(xt);return s(S,()=>JSON.stringify(h(),null,2)),S})()})}})]}}),r(Oi,{})]}function Bt(){return r(w,{get children(){return p.loading}})}function Ml(){const[e,t]=At(null);return Tt(()=>{const n=new URL(location.href);t(Ht(n))}),r(C,{get fallback(){return r(Bt,{})},get when(){return e()},children:n=>r(Al,{get page(){return n()}})})}function Al(e){const[t]=Ie(()=>qi(e.page.secret));return r(on,{fallback:n=>(console.error(n),r(w,{type:"danger",get children(){return p.error.general}})),get children(){return r(nt,{get fallback(){return r(Bt,{})},get children(){return r(se,{get children(){return r(D,{get when(){return t()},children:n=>{const{kind:i,value:l}=rn(n());return i==="SECRET_INVALID"?r(w,{type:"danger",get children(){return p.error.secretError}}):i==="FAILURE"?r(w,{type:"danger",get children(){return p.error.ourMistake}}):r(wl,{get meta(){return e.page},get save(){return l.data}})}})}})}})}})}export{Ml as MeineAnmeldungWrapper};
