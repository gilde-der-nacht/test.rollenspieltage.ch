import{g as u,t as m,e as z,o as H,d as i,M as b,f as A,h as O,j as K,E as B,S as X,a as _,i as T}from"./web.DiohJL2p.js";import{e as C,B as v}from"./utils.BUJ3cRZp.js";import{e as Z,a as k,o as d,s as a,b as E,n as c,c as q,l as U,u as F,d as N}from"./index.BmTnCDYh.js";import{c as Q}from"./store.CLzkyqdf.js";/* empty css                                 */const w=1,$="SAVE",M="PROGRAM",L={registrationId:-1,name:"Demo",email:"demo@mail.com",handynummer:"+41 12 123 12 12",wantsEmailUpdates:!0,games:[],lastSaved:"2024-08-15T07:45:21.335Z"};function ee(){const t=localStorage.getItem($);let e;return t===null?e={version:w,data:L}:e=JSON.parse(t),e.version!==w&&(console.error("Your local storage data was outdated and has been replaced with new demo content."),e={version:w,data:L}),localStorage.setItem($,JSON.stringify(e)),e.data}const I={gameList:[],reservedList:[]};function te(){const t=localStorage.getItem(M);let e;return t===null?e={version:w,data:I}:e=JSON.parse(t),e.version!==w&&(console.error("Your local storage data was outdated and has been replaced with new demo content."),e={version:w,data:I}),localStorage.setItem(M,JSON.stringify(e)),e.data}const x=Z(["SATURDAY","SUNDAY"]);k(d({uuid:a(),description:E(a()),title:E(a()),system:a(),master:d({first:a(),last:E(a())}),playerCount:d({min:c(),max:c()}),slot:d({day:x,start:c(),end:c()})}));const V=d({game:a(),self:U(!0),spielerName:q()}),W=d({game:a(),self:U(!1),spielerName:a()}),re=F([V.extend({id:c()}),W.extend({id:c()})]),ne=F([V,W]),ae=d({registrationId:c(),name:a(),email:a(),handynummer:a(),wantsEmailUpdates:N(),games:k(re),lastSaved:a()});d({registrationId:c(),name:a(),email:a(),handynummer:a(),wantsEmailUpdates:N(),games:k(ne),lastSaved:a()});async function se(t){if(t==="demo")return{kind:"SUCCESS",save:ee()};const e=C("/rst24/load");e.searchParams.append("secret",t);const r=await fetch(e);if(!r.ok)return{kind:"FAILED"};const s=await r.json(),g=ae.safeParse(s);return g.success?{kind:"SUCCESS",save:g.data}:{kind:"FAILED"}}const ie=d({uuid:a(),title:E(a()),system:a(),description:E(a()),playerCount:d({min:c(),max:c()}),master:d({first:a(),last:E(a())}),slot:d({day:x,start:c(),end:c()})}),oe=d({id:c(),gameId:a()});async function le(t){if(t)return{kind:"SUCCESS",program:te()};const e=C("/rst24/program"),r=C("/rst24/reserved"),[s,g]=await Promise.all([fetch(e),fetch(r)]);if(!s.ok)return{kind:"FAILED"};if(!g.ok)return{kind:"FAILED"};const h=await s.json(),R=await g.json(),f=k(ie).safeParse(h);if(!f.success)return{kind:"FAILED"};const S=k(oe).safeParse(R);return S.success?{kind:"SUCCESS",program:{gameList:f.data,reservedList:S.data}}:{kind:"FAILED"}}const de=["CHOOSE","OVERVIEW"],P={OVERVIEW:"Übersicht",CHOOSE:"Auswahl"};function j(t){const e=t.searchParams.get("page");return de.find(r=>e?.toUpperCase()===r.toUpperCase())??"OVERVIEW"}function ce(){const t=new URL(location.href),e=t.searchParams.get("secret"),r=j(t),s=t.searchParams.get("showCreateMessage")==="true";return{secret:e,page:r,showCreateMessage:s}}async function J(t){if(t.secret===null)throw Error("SECRET_ERROR");const e=await se(t.secret);if(e.kind==="FAILED")throw Error("SECRET_ERROR");return{state:"IDLE",secret:t.secret,page:t.page,showCreateMessage:t.showCreateMessage,currentSave:e.save,activeTab:"Contact",lastSaved:e.save.lastSaved,hasChanged:!1,tentativeReservations:[],markedForDeletionReservations:[]}}async function ue(t=!1){const e=await le(t);if(e.kind==="FAILED")throw Error("PROGRAM_ERROR");return e.program}function ge(t){const[e,r]=Q(t);function s(n){r("activeTab",n),window.scrollTo({top:0})}function g(n){const o=new URL(location.href);o.searchParams.set("page",n.toLowerCase()),o.searchParams.delete("showCreateMessage"),history.replaceState({page:n},"",o);const p=P[n];document.title=`Meine Anmeldung: ${p} | Luzerner Rollenspieltage `}g(t.page);function h(n,o=!1){if(!o){const l=new URL(location.href);l.searchParams.set("page",n.toLowerCase()),history.pushState({page:n},"",l)}const p=P[n];document.title=`Meine Anmeldung: ${p} | Luzerner Rollenspieltage `,r("page",n),window.scrollTo({top:0})}function R(n,o){r("hasChanged",!0),r("currentSave",n,o)}async function f(){if(e.state!=="IDLE")throw Error("ASSERTION_ERROR");r("state","SAVING");const n=C("/rst24/save"),o={...e.currentSave,games:[...e.currentSave.games.filter(l=>!e.markedForDeletionReservations.includes(l.id)),...e.tentativeReservations.map(l=>l.friendsName===null?{game:l.gameUuid,self:!0,spielerName:null}:{game:l.gameUuid,self:!1,spielerName:l.friendsName})]};if((await fetch(n,{method:"post",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}})).ok){const l=await J({secret:e.secret,page:e.page,showCreateMessage:!1});r({...l,activeTab:e.activeTab})}else throw Error("SAVE_ERROR")}function S(n){r("hasChanged",!0),r("tentativeReservations",o=>[...o,n])}function y(n){if(r("hasChanged",!0),n.confirmed)r("markedForDeletionReservations",o=>[...o,n.reservationId]);else{const o=e.currentSave.name;r("tentativeReservations",p=>p.filter(l=>l.gameUuid!==n.gameUuid?!0:l.friendsName===n.name?!1:n.name!==o))}}return{state:e,actions:{changeTab:s,changePage:h,updateSave:R,saveCurrentState:f,addTentativeReservation:S,deleteReservation:y}}}var D=m("<br>"),me=m("<strong>Donnerstag, 21. August 2025");const he=function(){const e="Donnerstag, 21. August 2025",r=["Deine Anmeldung wurde erfolgreich gestartet.",u(D),u(D),"Wir haben eine E-Mail an deine Adresse gesendet. In dieser E-Mail findest du einen persönlichen Link, um deine Anmeldung bis am"," ",u(me)," anzupassen."];return{registrationDeadline:e,registrationStarted:r}}();var pe=m("<p>Deine Anmeldung wird geladen..."),fe=m("<p>Wir konnten leider keine Anmeldung finden. Wenn du bereits eine Anmeldung begonnen hast, solltest du den korrekten Link per E-Mail erhalten haben.<br><br> Falls du noch keine Anmeldung begonnen hast, kannst du <a href=/anmeldung>hier</a> deine persönliche Anmeldung beginnen. <br><br>Für generelle Fragen oder Probleme, schreibe uns doch bitte über unser <a href=/kontatk>Kontaktformular</a>."),Se=m("<p>Leider ist ein unerwarteter Fehler passiert. Versuche deine Anmeldung erneut zu laden. Wiederholt sich dieser Fehler, bitte kontaktiere uns sobald als möglich über das <a href=/kontakt>Kontaktformular</a>, da dies nicht passieren sollte."),ve=m("<br>"),Ee=m('<div class=grid><i class="fa-duotone fa-dice-d20"></i><div><h3>Spielrunden ansehen</h3><p>Melde dich (und deine Freunde) für diverse Spielrunden an.'),we=m('<div class=grid><i class="fa-duotone fa-grid-2-plus"></i><div><h3>Spielrunden erstellen</h3><p>Falls du wenig oder gar keine Erfahrung als Spielleiter:in hast, werden wir dich vor und während dem Anlass unterstützen.'),Re=m('<div class=grid><i class="fa-duotone fa-hand-heart"></i><div><h3>Helfen</h3><p>Beim Kiosk und der Essensausgabe können wir immer ein paar helfende Hände gebrauchen.'),be=m("<div class=choose><!$><!/><br><!$><!/><br><!$><!/>"),ke=m("<h1>Overview");function G(){return i(v,{get children(){return u(pe)}})}function Me(){const[t,e]=z(null);return H(()=>{e(ce())}),i(A,{get fallback(){return i(G,{})},get children(){return i(b,{get when(){return t()},children:r=>i(ye,{get params(){return r()}})})}})}function ye(t){const[e]=O(()=>J(t.params)),[r]=O(()=>ue(t.params.secret==="demo"));return i(B,{fallback:s=>i(v,{type:"danger",get children(){return i(A,{get fallback(){return u(Se)},get children(){return i(b,{get when(){return s.message==="SECRET_ERROR"},get children(){return u(fe)}})}})}}),get children(){return i(K,{get fallback(){return i(G,{})},get children(){return i(A,{get children(){return i(b,{get when(){return e()},children:s=>i(Ae,{get state(){return s()},programResource:r})})}})}})}})}function Ae(t){const{state:e,actions:r}=ge(t.state);return window.addEventListener("popstate",s=>{if(typeof s=="object"&&s!==null&&"state"in s){const g=new URL(location.href),h=j(g);r.changePage(h,!0)}}),[i(X,{get when(){return e.showCreateMessage},get children(){return[i(v,{type:"success",get children(){return he.registrationStarted}}),u(ve)]}}),i(A,{get children(){return[i(b,{get when(){return e.page==="CHOOSE"},get children(){var s=u(be),g=s.firstChild,[h,R]=_(g.nextSibling),f=h.nextSibling,S=f.nextSibling,[y,n]=_(S.nextSibling),o=y.nextSibling,p=o.nextSibling,[l,Y]=_(p.nextSibling);return T(s,i(v,{get children(){return u(Ee)}}),h,R),T(s,i(v,{get children(){return u(we)}}),y,n),T(s,i(v,{get children(){return u(Re)}}),l,Y),s}}),i(b,{get when(){return e.page==="OVERVIEW"},get children(){return u(ke)}})]}})]}export{Me as MeineAnmeldungWrapper};
