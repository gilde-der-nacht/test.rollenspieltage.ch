import{c as P,B as M,s as tt,d as Ct,I as wt,f as At,g as Rt,h as D,b as O,i as Re,j as Tt,k as Dt,l as nt,u as Ot}from"./utils.CAwOA8yA.js";import{g as u,t as g,i as a,c as n,a as d,d as rt,F as G,S as E,m as U,b as Ie,e as Me,r as it,f as It,u as Mt,h as lt,j as ne,M as w,k as fe,l as Ut,n as _e,o as Nt,p as Pt,E as Lt}from"./web.-Ks0M2FI.js";/* empty css                                 */import{c as I,u as Ft}from"./store.DKnwlr3W.js";import{e as pe,o as p,n as j,s as f,a as F,T as v,C as Ht,d as Gt,l as ee,b as oe,c as Bt}from"./texts.X4339IX-.js";import{T as Yt}from"./Textarea.Ae_Ymg2p.js";var zt=g("<pre><code>Noch nicht implementiert");function Wt(){return u(zt)}var Zt=g("<pre><code>Noch nicht implementiert");function jt(){return u(Zt)}var Jt=g("<div class=grid><!$><!/><div>"),Vt=g("<div class=boxLink>");function se(e){const t=e.type??"special";return(()=>{var r=u(Vt);return a(r,n(M,{type:t,get onClick(){return e.onClick},get children(){var i=u(Jt),o=i.firstChild,[l,s]=d(o.nextSibling),c=l.nextSibling;return a(i,n(P,{get icon(){return e.icon}}),l,s),a(c,()=>e.children),i}})),r})()}const qt=pe(["SATURDAY","SUNDAY"]),Ue=p({uuid:f().uuid(),day:qt,from:j(),to:j()}).refine(e=>e.from<e.to,{message:"A TimeSlot can't end before it starts."});p({name:f(),label:f(),description:f()});const at=pe(["DRAFT","PUBLISHED","DELETED"]),$e=f().transform(e=>({value:e,isDirty:!1})),Ge=j().transform(e=>({value:e,isDirty:!1})),Kt=p({uuid:f().uuid(),kind:at,title:f(),system:f(),description:p({short:f(),long:f()}),slots:F(Ue),playerCount:p({min:j().min(1),max:j()}).transform(e=>{const[t,r]=tt([e.min,e.max]);return{min:t,max:r}}),tagNames:F(f())}),st=p({uuid:f().uuid(),kind:at,title:$e,system:$e,description:p({short:$e,long:$e}),slots:F(Ue),playerCount:p({min:Ge,max:Ge}),tagNames:F(f())});function Qt(){const e={uuid:crypto.randomUUID(),kind:"DRAFT",title:"",system:"",description:{short:"",long:""},slots:[],playerCount:{min:2,max:4},tagNames:["deutsch"]},t=Xt(e);if(t.success)return t.data;throw console.error(t),Error("should not happen")}function Xt(e){return st.safeParse(e)}function en(e){return{...e,title:e.title.value,system:e.system.value,description:{short:e.description.short.value,long:e.description.long.value},playerCount:{min:e.playerCount.min.value,max:e.playerCount.max.value}}}const ot=[{name:"ab6jahren",label:"Ab 6 Jahren",description:"Spannungs- und Bedrohungsmomente werden kurz gehalten. In Begleitung oder nach Absprache mit einem Elternteil. Beispiele: My Little Pony, ..."},{name:"ab12jahren",label:"Ab 12 Jahren",description:"Antisoziales und destruktives wird auf ein Minimum begrenzt. Keine Diskriminierung, keine Radikalisierung, Sexualität wird nicht explizit dargestellt."},{name:"ab18jahren",label:"Ab 18 Jahren",description:"Keinerlei Richtlinien bezüglich Inhalt, in der Gruppe sollte aber diskutiert werden, was akzeptabel ist und was nicht. Beispiele: Vampire the Masquerade, ..."},{name:"fantasy",label:"Fantasy",description:"Spielt in einer alternativen Vergangenheit, in welcher Elemente wie: Ritterinnen, Hexenmeister, Rüstungen, Magie, Goblins, Turniere usw. vorkommen können. Beispiele: Das Schwarze Auge, Dungeons & Dragons, ..."},{name:"sciencefiction",label:"Science Fiction",description:"Spielt in einer alternativen Zukunft, in welcher Elemente wie: Raumschiffe, Sternenportale, Künstliche Intelligenzen, Laserkanonen usw. vorkommen können. Beispiele: Shadowrun, Alien, ..."},{name:"postapokalyptisch",label:"Postapokalyptisch",description:"Spielt in einer Welt mitten oder nach einem Kollaps, wo nur ein grosser Teil der Gesellschaft ums Überleben kämpft. Beispiele: Mutant Year Zero, Apocalypse World"},{name:"offenewelt",label:"Offene Welt",description:"Es gibt nur einen losen Handlungsfaden, die Rollenspiel-Gruppe muss sich ihre Ziele selber festlegen. Beispiele: Ironsworn, Blades in the Dark, ..."},{name:"gemeinsamespielleitung",label:"Gemeinsame Spielleitung",description:"Die Regeln und die Umwelt werden gemeinsam von allen Spielenden umgesetzt. Beispiele: Microscope, The Quiet Year, ..."},{name:"regelleicht",label:"Regelleicht",description:"Die kompletten Regeln haben alle auf einer Seite Platz. Beispiele: Fiasco, Everyone is John, ..."},{name:"deutsch",label:"Deutsch",description:"Bei der Spielrunde reden die Spielenden miteinander Deutsch."},{name:"englisch",label:"Englisch",description:"Bei der Spielrunde reden die Spielenden miteinander Englisch."}],Ne=200,ut=500;function tn(e){const t=e.title.value.trim().length===0,r=e.description.short.value.trim().length===0,i=e.description.short.value.length>Ne,o=e.description.long.value.length>ut,l=e.slots.length===0;return{titleMissing:t,descriptionShortMissing:r,descriptionShortTooLong:i,descriptionLongTooLong:o,slotMissing:l,hasErrors:t||r||i||o||l}}var nn=g("<h3>"),rn=g("<div style=margin-top:2rem;><h3 style=margin-bottom:1rem;></h3><ul class=event-list role=list>"),ln=g('<li><h1 class=event-title></h1><div class=event-details><div class=event-tags><strong>Status:</strong><!$><!/></div><div class=event-tags><strong>System:</strong><!$><!/></div><div class=event-tags><strong>Tag, Zeit:</strong><!$><!/></div><div class=event-tags><strong>Spielende:</strong> <!$><!/> - <!$><!/></div> <div class=event-tags><strong>Kategorien:</strong> <!$><!/></div></div><div class="event-description content"><p><strong>Kurzbeschreibung:</strong><br><!$><!/></p></div><ul role=list class=event-links><li><button class=event-link><span>Bearbeiten'),ae=g("<em>"),an=g("<span><!$><!/>, <!$><!/> - <!$><!/> Uhr");function sn(e){const[t,r]=I(e.store);function i(){const o=Qt();r("games",t.games.length,o),e.changePage({kind:"EDIT_GAMEROUND",uuid:o.uuid})}return[n(se,{icon:"grid-2-plus",type:"success",onClick:i,get children(){var o=u(nn);return a(o,()=>v.createNewGameRound),o}}),n(E,{get when(){return e.store.games},children:o=>(()=>{var l=u(rn),s=l.firstChild,c=s.nextSibling;return a(s,()=>v.myGameRounds),a(c,n(G,{get each(){return o().filter(h=>h.kind!=="DELETED")},children:h=>{const m=h.tagNames.map($=>ot.find(({name:S})=>S===$)).filter($=>$!==void 0).map(({label:$})=>$);return n(G,{get each(){return h.slots},get fallback(){return n(Be,{game:h,slot:null,tags:m,get changePage(){return e.changePage}})},children:$=>n(Be,{game:h,slot:$,tags:m,get changePage(){return e.changePage}})})}})),l})()})]}function Be(e){const{game:t,slot:r,tags:i,changePage:o}=e;return(()=>{var l=u(ln),s=l.firstChild,c=s.nextSibling,h=c.firstChild,m=h.firstChild,$=m.nextSibling,[S,b]=d($.nextSibling),_=h.nextSibling,x=_.firstChild,k=x.nextSibling,[y,R]=d(k.nextSibling),A=_.nextSibling,N=A.firstChild,L=N.nextSibling,[B,re]=d(L.nextSibling),Y=A.nextSibling,q=Y.firstChild,J=q.nextSibling,H=J.nextSibling,[z,T]=d(H.nextSibling),W=z.nextSibling,K=W.nextSibling,[ie,Q]=d(K.nextSibling),le=Y.nextSibling,ue=le.nextSibling,ce=ue.firstChild,ke=ce.nextSibling,de=ke.nextSibling,[ye,ge]=d(de.nextSibling),he=c.nextSibling,X=he.firstChild,xe=X.firstChild,me=xe.nextSibling,Ee=me.nextSibling,[Ce,we]=d(Ee.nextSibling),Ae=he.nextSibling,_t=Ae.firstChild,ft=_t.firstChild;return a(s,(()=>{var C=U(()=>t.title.value.length>0);return()=>C()?t.title.value:(()=>{var V=u(ae);return a(V,()=>v.missingTitle),V})()})()),a(h,()=>v.publishingSteps[t.kind],S,b),a(_,()=>t.system.value||(()=>{var C=u(ae);return a(C,()=>v.missingSystem),C})(),y,R),a(A,r!==null?(()=>{var C=u(an),V=C.firstChild,[Le,bt]=d(V.nextSibling),vt=Le.nextSibling,pt=vt.nextSibling,[Fe,kt]=d(pt.nextSibling),yt=Fe.nextSibling,xt=yt.nextSibling,[He,Et]=d(xt.nextSibling);return He.nextSibling,a(C,()=>v.days[r.day],Le,bt),a(C,()=>r.from,Fe,kt),a(C,()=>r.to,He,Et),C})():(()=>{var C=u(ae);return a(C,()=>v.missingSlot),C})(),B,re),a(Y,()=>t.playerCount.min.value,z,T),a(Y,()=>t.playerCount.max.value,ie,Q),a(ue,()=>i.join(", ")||(()=>{var C=u(ae);return a(C,()=>v.missingTags),C})(),ye,ge),a(X,(()=>{var C=U(()=>t.description.short.value.length===0);return()=>C()?(()=>{var V=u(ae);return a(V,()=>v.missingShortDescription),V})():Ct(t.description.short.value,Ne)})(),Ce,we),ft.$$click=()=>o({kind:"EDIT_GAMEROUND",uuid:t.uuid}),Ie(()=>Me(l,["event-entry",t.kind==="DRAFT"?"gray":""].join(" "))),it(),l})()}rt(["click"]);var on=g("<pre><code>Noch nicht implementiert");function un(){return u(on)}var cn=g("<h3>Spielrunden ansehen"),dn=g("<p>Melde dich (und deine Freunde) für diverse Spielrunden an."),Te=g("<br>"),gn=g("<h3>Spielrunden erstellen"),hn=g("<p>Falls du wenig oder gar keine Erfahrung als Spielleiter:in hast, werden wir dich vor und während dem Anlass unterstützen."),mn=g("<h3>Helfen"),$n=g("<p>Beim Kiosk und der Essensausgabe können wir immer ein paar helfende Hände gebrauchen."),Sn=g("<h3>Zusammenfassung"),_n=g("<p>Erhalte einen Überblick über dein gesamtes Programm.");function fn(e){return[n(se,{icon:"dice-d20",onClick:()=>e.changePage({kind:"PLAYER"}),get children(){return[u(cn),u(dn)]}}),u(Te),n(se,{icon:"grid-2-plus",onClick:()=>e.changePage({kind:"GAMEMASTER"}),get children(){return[u(gn),u(hn)]}}),u(Te),n(se,{icon:"hand-heart",onClick:()=>e.changePage({kind:"HELPING"}),get children(){return[u(mn),u($n)]}}),u(Te),n(se,{icon:"list",onClick:()=>e.changePage({kind:"SUMMARY"}),get children(){return[u(Sn),u(_n)]}})]}var Pe=g("<p>");function Ye(e){const[t,r]=I(e.store),i=e.showErrors==="ALWAYS",o=()=>i||t.isDirty?e.errors??[]:[];return[n(wt,{get label(){return e.label},get name(){return e.name},get value(){return t.value},onValueUpdate:l=>r("value",l),onBlur:()=>r("isDirty",!0),get type(){return e.type},get required(){return e.required},get isHoneypot(){return e.isHoneypot}}),n(E,{get when(){return o().length>0},get children(){return n(M,{type:"danger",get children(){return n(G,{get each(){return o()},children:l=>(()=>{var s=u(Pe);return a(s,l),s})()})}})}})]}function ze(e){const[t,r]=I(e.store),i=e.showErrors==="ALWAYS",o=()=>i||t.isDirty?e.errors??[]:[];return[n(At,{get label(){return e.label},get name(){return e.name},get value(){return t.value},onValueUpdate:l=>r("value",l),onBlur:()=>r("isDirty",!0),get required(){return e.required},get isHoneypot(){return e.isHoneypot},get min(){return e.min},get max(){return e.max}}),n(E,{get when(){return o().length>0},get children(){return n(M,{type:"danger",get children(){return n(G,{get each(){return o()},children:l=>(()=>{var s=u(Pe);return a(s,l),s})()})}})}})]}function We(e){const[t,r]=I(e.store),i=e.showErrors==="ALWAYS",o=()=>i||t.isDirty?e.errors??[]:[];return[n(Yt,{get label(){return e.label},get name(){return e.name},get value(){return t.value},onValueUpdate:l=>r("value",l),onBlur:()=>r("isDirty",!0),get required(){return e.required},get size(){return e.size}}),n(E,{get when(){return o().length>0},get children(){return n(M,{type:"danger",get children(){return n(G,{get each(){return o()},children:l=>(()=>{var s=u(Pe);return a(s,l),s})()})}})}})]}pe(["SATURDAY","SUNDAY"]);function Ze(e,t=!1){const{from:r,to:i}=e;if(r>i)return[];const o=i-r;return[...Array(t?o+1:o)].map((l,s)=>s+r)}const bn={SATURDAY:{open:{from:10,to:24},breaks:[{from:13,to:14},{from:18,to:19}]},SUNDAY:{open:{from:10,to:18},breaks:[{from:13,to:14}]}};var vn=g("<dialog><!$><!/><!$><!/><!$><!/>"),pn=g("<h4>");function be(e){let t;const[r,i]=I(e.store);It(()=>{r.open?t.showModal():t.close()});function o(){i({open:!1}),e.onClose?.()}const l=()=>{const s=[];return e.type!==void 0&&s.push(e.type),e.size!==void 0&&s.push(e.size),e.onClose!==void 0&&s.push("dialog-with-close"),s};return(()=>{var s=u(vn),c=s.firstChild,[h,m]=d(c.nextSibling),$=h.nextSibling,[S,b]=d($.nextSibling),_=S.nextSibling,[x,k]=d(_.nextSibling);s.addEventListener("close",o);var y=t;return typeof y=="function"?Mt(y,s):t=s,a(s,n(E,{get when(){return e.onClose},get children(){return n(Rt,{onClick:o,icon:"circle-xmark",kind:"gray"})}}),h,m),a(s,n(E,{get when(){return e.title},children:R=>(()=>{var A=u(pn);return a(A,R),A})()}),S,b),a(s,()=>e.children,x,k),Ie(()=>Me(s,l().join(" "))),s})()}var kn=g("<fieldset><legend>Zeitslots</legend><!$><!/><!$><!/>"),je=g("<br>"),yn=g("<div style=margin-block-end:0.5rem;>Zeitslot: <!$><!/>, <!$><!/> -<!$><!/> Uhr"),xn=g("<ul class=event-list role=list>"),En=g("<em>werden geladen..."),Cn=g("<li class=event-entry><h2 class=event-title><!$><!/>, <!$><!/> - <!$><!/> Uhr</h2><div class=event-details><div class=event-tags><strong>Spielende:</strong> <!$><!/></div></div><div></div><ul role=list class=event-links>"),wn=g("<em>Fehler beim Laden."),An=g("<em>noch keine Anmeldungen"),Rn=g("<li><em style=font-size:smaller;>Aktionen werden geladen..."),Je=g("<li><em style=font-size:smaller;>kann nicht gelöscht werden"),Tn=g("<li><button type=button class=event-link><div style=display:flex;gap:0.25rem;align-items:center;><!$><!/><span>Löschen"),Dn=g("<div style=display:grid;gap:0.5rem;>"),On=g("<div style=display:grid;gap:0.5rem;><!$><!/><!$><!/>"),In=g("<div style=display:grid;gap:0.5rem;><!$><!/><!$><!/><!$><!/>"),Mn=g("<div style=display:grid;gap:0.5rem;><!$><!/><!$><!/><!$><!/><div style=margin-block-start:1rem;>"),Un=g("<div style=display:flex;flex-wrap:wrap;gap:0.5rem;align-items:center;><!$><!/> <span>Neuen Slot erfassen"),Nn=g("<em>Wähle eine Tag:"),Pn=g("<div style=display:flex;flex-wrap:wrap;gap:.5rem;><!$><!/><!$><!/>"),Ln=g("<em>Wähle eine Startzeit:"),ct=g("<div style=display:flex;flex-wrap:wrap;gap:.5rem;>"),dt=g("<span style=white-space:nowrap;><!$><!/> Uhr"),Fn=g("<em>Wähle eine Endzeit:");function Hn(e){return(()=>{var t=u(kn),r=t.firstChild,i=r.nextSibling,[o,l]=d(i.nextSibling),s=o.nextSibling,[c,h]=d(s.nextSibling);return a(t,n(Bn,{get store(){return e.store},get registrations(){return e.registrations}}),o,l),a(t,n(E,{get when(){return e.slotMissing},get children(){return n(M,{type:"danger",children:"Wähle mindestens einen Zeitslot aus."})}}),c,h),t})()}const Ve=1;function Gn(e){function t(r){const i=Ze(r.open,!0);return r.breaks.map(l=>Ze(l,!0)).reduce((l,s)=>{const c=s.at(0),h=s.at(-1);if(c===void 0||h===void 0)return l;const m=[];return l.forEach($=>{const S=[],b=[];$.forEach(_=>{_<=c&&S.push(_),h<=_&&b.push(_)}),S.length>0&&m.push(S),b.length>0&&m.push(b)}),m},[i]).map(l=>{const s=l.slice(0,Ve*-1);return Tt(s.map(c=>{const h=l.filter(m=>m>=c+Ve);return[c,h]}))}).reduce((l,s)=>({...l,...s}),{})}return{SATURDAY:t(e.SATURDAY),SUNDAY:t(e.SUNDAY)}}function Bn(e){const[t,r]=I(e.store),[i,o]=I({dialog:{open:!1}}),l=lt(()=>Gn(bn));function s(m){r(t.concat(m))}function c(m){o("dialog","open",!1),o("slot",void 0),r(t.filter($=>$.uuid!==m))}function h(m){o("dialog","open",!0),o("slot",t.find($=>$.uuid===m))}return[n(zn,{get daySections(){return l()},chooseTimeSlot:s}),u(je),u(je),n(be,{get store(){return i.dialog},title:"Zeitslot löschen",onClose:()=>o("slot",void 0),get children(){return[(()=>{var m=u(yn),$=m.firstChild,S=$.nextSibling,[b,_]=d(S.nextSibling),x=b.nextSibling,k=x.nextSibling,[y,R]=d(k.nextSibling),A=y.nextSibling,N=A.nextSibling,[L,B]=d(N.nextSibling);return L.nextSibling,a(m,()=>v.days[i.slot?.day],b,_),a(m,()=>i.slot?.from,y,R),a(m,()=>i.slot?.to,L,B),m})(),n(D,{kind:"danger",icon:"trash",label:"Löschen",onClick:()=>c(i.slot?.uuid)})]}}),n(Yn,{slots:t,get registrations(){return e.registrations},confirmRemoval:h})]}function Yn(e){return(()=>{var t=u(xn);return a(t,n(G,{get each(){return Wn(e.slots)},children:r=>(()=>{var i=u(Cn),o=i.firstChild,l=o.firstChild,[s,c]=d(l.nextSibling),h=s.nextSibling,m=h.nextSibling,[$,S]=d(m.nextSibling),b=$.nextSibling,_=b.nextSibling,[x,k]=d(_.nextSibling);x.nextSibling;var y=o.nextSibling,R=y.firstChild,A=R.firstChild,N=A.nextSibling,L=N.nextSibling,[B,re]=d(L.nextSibling),Y=y.nextSibling,q=Y.nextSibling;return a(o,()=>v.days[r.day],s,c),a(o,()=>r.from,$,S),a(o,()=>r.to,x,k),a(R,n(ne,{get children(){return[n(w,{get when(){return e.registrations.loading},get children(){return u(En)}}),n(w,{get when(){return e.registrations()},children:J=>{const H=J();if(H.kind==="FAILURE")return u(wn);const z=H.data.entries.filter(T=>T.uuid===r.uuid).map(T=>T.name);return U(()=>z.join(", ")||u(An))}})]}}),B,re),a(q,n(fe,{get fallback(){return u(Rn)},get children(){return n(E,{get when(){return e.registrations()},children:J=>{const H=J();return H.kind==="FAILURE"?u(Je):H.data.entries.filter(T=>T.uuid===r.uuid).map(T=>T.name).length>0?u(Je):(()=>{var T=u(Tn),W=T.firstChild,K=W.firstChild,ie=K.firstChild,[Q,le]=d(ie.nextSibling);return Q.nextSibling,W.$$click=()=>e.confirmRemoval(r.uuid),a(K,n(P,{icon:"trash"}),Q,le),it(),T})()}})}})),i})()})),t})()}function zn(e){const[t,r]=I({slot:{kind:"CHOOSE_DAY"},dialog:{open:!1}});function i(){r("slot",{kind:"CHOOSE_DAY"}),r("dialog","open",!1)}function o(l){e.chooseTimeSlot(l),i()}return[n(O,{kind:"success",get label(){return(()=>{var l=u(Un),s=l.firstChild,[c,h]=d(s.nextSibling);return c.nextSibling,a(l,n(P,{icon:"circle-plus"}),c,h),l})()},onClick:()=>r("dialog","open",!0)}),n(be,{title:"Zeitslot erfassen",get store(){return t.dialog},size:"medium",onClose:i,get children(){return n(ne,{get children(){return[n(w,{get when(){return t.slot.kind==="CHOOSE_DAY"},get children(){var l=u(Dn);return a(l,n(Se,{changeDay:s=>r("slot",{kind:"CHOOSE_START",day:s})})),l}}),n(w,{get when(){return t.slot.kind==="CHOOSE_START"},get children(){var l=u(On),s=l.firstChild,[c,h]=d(s.nextSibling),m=c.nextSibling,[$,S]=d(m.nextSibling);return a(l,n(Se,{get chosenDay(){return t.slot.kind==="CHOOSE_START"?t.slot.day:void 0},changeDay:b=>r("slot",{kind:"CHOOSE_START",day:b})}),c,h),a(l,n(De,{get startTimes(){return U(()=>t.slot.kind==="CHOOSE_START")()?Re(e.daySections[t.slot.day]):[]},changeStart:b=>r("slot",{kind:"CHOOSE_END",start:b})}),$,S),l}}),n(w,{get when(){return t.slot.kind==="CHOOSE_END"},get children(){var l=u(In),s=l.firstChild,[c,h]=d(s.nextSibling),m=c.nextSibling,[$,S]=d(m.nextSibling),b=$.nextSibling,[_,x]=d(b.nextSibling);return a(l,n(Se,{get chosenDay(){return t.slot.kind==="CHOOSE_END"?t.slot.day:void 0},changeDay:k=>r("slot",{kind:"CHOOSE_START",day:k})}),c,h),a(l,n(De,{get chosenStart(){return t.slot.kind==="CHOOSE_END"?t.slot.start:void 0},get startTimes(){return U(()=>t.slot.kind==="CHOOSE_END")()?Re(e.daySections[t.slot.day]):[]},changeStart:k=>r("slot",{kind:"CHOOSE_END",start:k})}),$,S),a(l,n(qe,{get endTimes(){return t.slot.kind==="CHOOSE_END"?e.daySections[t.slot.day][t.slot.start]??[]:[]},changeEnd:k=>{t.slot.kind==="CHOOSE_END"&&r("slot",{kind:"WAIT_FOR_CONFIRMATION",day:t.slot.day,start:t.slot.start,end:k})}}),_,x),l}}),n(w,{get when(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"},get children(){var l=u(Mn),s=l.firstChild,[c,h]=d(s.nextSibling),m=c.nextSibling,[$,S]=d(m.nextSibling),b=$.nextSibling,[_,x]=d(b.nextSibling),k=_.nextSibling;return a(l,n(Se,{get chosenDay(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"?t.slot.day:void 0},changeDay:y=>r("slot",{kind:"CHOOSE_START",day:y})}),c,h),a(l,n(De,{get chosenStart(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"?t.slot.start:void 0},get startTimes(){return U(()=>t.slot.kind==="WAIT_FOR_CONFIRMATION")()?Re(e.daySections[t.slot.day]):[]},changeStart:y=>r("slot",{kind:"CHOOSE_END",start:y})}),$,S),a(l,n(qe,{get chosenEnd(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"?t.slot.end:void 0},get endTimes(){return t.slot.kind==="WAIT_FOR_CONFIRMATION"?e.daySections[t.slot.day][t.slot.start]??[]:[]},changeEnd:y=>{t.slot.kind==="WAIT_FOR_CONFIRMATION"&&r("slot",{kind:"WAIT_FOR_CONFIRMATION",day:t.slot.day,start:t.slot.start,end:y})}}),_,x),a(k,n(O,{get label(){return`Slot "${t.slot.kind==="WAIT_FOR_CONFIRMATION"?`${v.days[t.slot.day]}, von ${t.slot.start} bis ${t.slot.end} Uhr`:""}" erstellen`},kind:"success",onClick:()=>{t.slot.kind==="WAIT_FOR_CONFIRMATION"&&o({uuid:crypto.randomUUID(),day:t.slot.day,from:t.slot.start,to:t.slot.end})}})),l}})]}})}})]}function Se(e){return[u(Nn),(()=>{var t=u(Pn),r=t.firstChild,[i,o]=d(r.nextSibling),l=i.nextSibling,[s,c]=d(l.nextSibling);return a(t,n(O,{get kind(){return e.chosenDay==="SATURDAY"?"success":"gray"},label:"Samstag",onClick:()=>e.changeDay("SATURDAY")}),i,o),a(t,n(O,{get kind(){return e.chosenDay==="SUNDAY"?"success":"gray"},label:"Sonntag",onClick:()=>e.changeDay("SUNDAY")}),s,c),t})()]}function De(e){return[u(Ln),(()=>{var t=u(ct);return a(t,n(G,{get each(){return e.startTimes},children:r=>n(O,{get kind(){return e.chosenStart===r?"success":"gray"},get label(){return(()=>{var i=u(dt),o=i.firstChild,[l,s]=d(o.nextSibling);return l.nextSibling,a(i,r,l,s),i})()},onClick:()=>e.changeStart(r)})})),t})()]}function qe(e){return[u(Fn),(()=>{var t=u(ct);return a(t,n(G,{get each(){return e.endTimes},children:r=>n(O,{get kind(){return e.chosenEnd===r?"success":"gray"},get label(){return(()=>{var i=u(dt),o=i.firstChild,[l,s]=d(o.nextSibling);return l.nextSibling,a(i,r,l,s),i})()},onClick:()=>e.changeEnd(r)})})),t})()]}function Wn(e){return e.toSorted((t,r)=>t.day!==r.day?t.day==="SATURDAY"?-1:1:t.from-r.from)}rt(["click"]);var Zn=g("<span>");function jn(e){return(()=>{var t=u(Zn);return a(t,()=>e.children),Ie(()=>Me(t,`chip ${e.kind??"gray"}`)),t})()}var Ke=g("<br>"),Jn=g("<div class=content><p>Möchtest du diese Spielrunde gerne veröffentlichen?</p><!$><!/>"),Vn=g("<em>Du kannst die Spielrunde nur löschen, wenn du zuerst alle Zeitslots entfernt hast."),qn=g("<div class=content><p>Bist du sicher, dass du die Spielrunde löschen möchtest?</p><!$><!/>"),Kn=g('<form novalidate><!$><!/><!$><!/><!$><!/><div style="display:grid;grid-template-columns:repeat(2, 1fr);gap:1rem;"><!$><!/><!$><!/></div><!$><!/><!$><!/><!$><!/><fieldset><legend>Kategorien (optional)</legend><!$><!/></fieldset><!$><!/><div style=display:flex;flex-wrap:wrap;gap:1rem;justify-content:space-between;><!$><!/><div style=display:flex;flex-wrap:wrap;gap:1rem;><!$><!/><!$><!/>'),Qn=g("<h4>Spielrunde inkomplett"),Xn=g("<p>Du hast noch einen oder mehre Fehler/fehlende Informationen in dieser Spielrunde:"),er=g('<li>"Titel" ist ein Pflichtfeld.'),tr=g('<li>"kurz Beschreibung" ist ein Pflichtfeld.'),nr=g('<li>"kurz Beschreibung" ist zu lang.'),rr=g('<li>"lange Beschreibung" ist zu lang.'),ir=g("<li>Mindest einen Zeitslot muss ausgewählt werden."),lr=g("<ul><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),ar=g("<div style=display:grid;gap:0.5rem;margin-block-end:1rem;>");function sr(e){const t=e.allRounds.find(r=>r.uuid===e.uuid);return n(E,{get fallback(){return e.fallback},when:t,children:r=>e.children(r())})}function or(e){const[t,r]=I(e.store),[i,o]=I({delete:{open:!1},publish:{open:!1}});function l(c){c.preventDefault(),o("publish","open",!0)}function s(){e.changePage({kind:"GAMEMASTER"})}return[n(jn,{kind:"special",get children(){return["Status: ",U(()=>v.publishingSteps[t.kind])]}}),u(Ke),u(Ke),n(ur,{store:t,get registrations(){return e.registrations},onSubmit:l,onCancel:()=>o("delete","open",!0),goBack:s}),n(be,{get store(){return i.publish},title:"Spielrunde veröffentlichen",onClose:()=>{},get children(){var c=u(Jn),h=c.firstChild,m=h.nextSibling,[$,S]=d(m.nextSibling);return a(c,n(D,{kind:"success",icon:"circle-plus",get label(){return`Ja, bitte "${t.title.value||"["+v.missingTitle+"]"}" veröffentlichen.`},onClick:()=>{r("kind","PUBLISHED"),o("publish","open",!1)}}),$,S),c}}),n(be,{get store(){return i.delete},title:"Spielrunde löschen",onClose:()=>{},get children(){return[n(E,{get when(){return t.slots.length>0},get children(){return u(Vn)}}),n(E,{get when(){return t.slots.length===0},get children(){var c=u(qn),h=c.firstChild,m=h.nextSibling,[$,S]=d(m.nextSibling);return a(c,n(D,{kind:"danger",icon:"trash",get label(){return`Ja, bitte "${t.title.value||"["+v.missingTitle+"]"}" löschen.`},onClick:()=>{r("kind","DELETED"),e.changePage({kind:"GAMEMASTER"})}}),$,S),c}})]}})]}function ur(e){const[t]=I(e.store),r=lt(()=>tn(t));return(()=>{var i=u(Kn),o=i.firstChild,[l,s]=d(o.nextSibling),c=l.nextSibling,[h,m]=d(c.nextSibling),$=h.nextSibling,[S,b]=d($.nextSibling),_=S.nextSibling,x=_.firstChild,[k,y]=d(x.nextSibling),R=k.nextSibling,[A,N]=d(R.nextSibling),L=_.nextSibling,[B,re]=d(L.nextSibling),Y=B.nextSibling,[q,J]=d(Y.nextSibling),H=q.nextSibling,[z,T]=d(H.nextSibling),W=z.nextSibling,K=W.firstChild,ie=K.nextSibling,[Q,le]=d(ie.nextSibling),ue=W.nextSibling,[ce,ke]=d(ue.nextSibling),de=ce.nextSibling,ye=de.firstChild,[ge,he]=d(ye.nextSibling),X=ge.nextSibling,xe=X.firstChild,[me,Ee]=d(xe.nextSibling),Ce=me.nextSibling,[we,Ae]=d(Ce.nextSibling);return Ut(i,"submit",e.onSubmit),a(i,n(E,{get when(){return t.kind==="PUBLISHED"},get children(){return n(Qe,{get errors(){return r()}})}}),l,s),a(i,n(Ye,{get store(){return t.title},label:"Titel",name:"title",get showErrors(){return t.kind==="PUBLISHED"?"ALWAYS":"ON_BLUR"},get errors(){return r().titleMissing?[v.mandatoryField]:[]}}),h,m),a(i,n(Ye,{get store(){return t.system},label:"System (optional)",name:"System"}),S,b),a(_,n(ze,{get store(){return t.playerCount.min},label:"Anzahl Mitspielende (Minimum)",name:"playerCountMin",min:1,get max(){return t.playerCount.max.value}}),k,y),a(_,n(ze,{get store(){return t.playerCount.max},label:"Anzahl Mitspielende (Maximum)",name:"playerCountMax",get min(){return t.playerCount.min.value}}),A,N),a(i,n(We,{get store(){return t.description.short},label:"kurze Beschreibung",name:"descriptionShort",size:"sm",get showErrors(){return t.kind==="PUBLISHED"?"ALWAYS":"ON_BLUR"},get errors(){return U(()=>!!r().descriptionShortMissing)()?[v.mandatoryField]:U(()=>!!r().descriptionShortTooLong)()?[v.charLimitBy.replace("{}",String(Ne))]:[]}}),B,re),a(i,n(We,{get store(){return t.description.long},label:"lange Beschreibung (optional)",name:"descriptionLong",get showErrors(){return t.kind==="PUBLISHED"?"ALWAYS":"ON_BLUR"},get errors(){return U(()=>!!r().descriptionLongTooLong)()?[v.charLimitBy.replace("{}",String(ut))]:[]}}),q,J),a(i,n(Hn,{get store(){return e.store.slots},get registrations(){return e.registrations},get slotMissing(){return r().slotMissing}}),z,T),a(W,n(cr,{get store(){return t.tagNames}}),Q,le),a(i,n(Qe,{get errors(){return r()}}),ce,ke),a(de,n(D,{icon:"backward",label:"Zurück zu deinen Spielrunden",get onClick(){return e.goBack}}),ge,he),a(X,n(D,{icon:"trash",kind:"danger",label:"Löschen",onClick:()=>e.onCancel()}),me,Ee),a(X,n(E,{get when(){return t.kind==="DRAFT"},get children(){return n(D,{icon:"circle-plus",type:"submit",get kind(){return r().hasErrors?"gray":"success"},get disabled(){return r().hasErrors},label:"Spielrunde veröffentlichen"})}}),we,Ae),i})()}function Qe(e){return n(E,{get when(){return e.errors.hasErrors},get children(){return n(M,{type:"danger",get children(){return[u(Qn),u(Xn),(()=>{var t=u(lr),r=t.firstChild,[i,o]=d(r.nextSibling),l=i.nextSibling,[s,c]=d(l.nextSibling),h=s.nextSibling,[m,$]=d(h.nextSibling),S=m.nextSibling,[b,_]=d(S.nextSibling),x=b.nextSibling,[k,y]=d(x.nextSibling);return a(t,n(E,{get when(){return e.errors.titleMissing},get children(){return u(er)}}),i,o),a(t,n(E,{get when(){return e.errors.descriptionShortMissing},get children(){return u(tr)}}),s,c),a(t,n(E,{get when(){return e.errors.descriptionShortTooLong},get children(){return u(nr)}}),m,$),a(t,n(E,{get when(){return e.errors.descriptionLongTooLong},get children(){return u(rr)}}),b,_),a(t,n(E,{get when(){return e.errors.slotMissing},get children(){return u(ir)}}),k,y),t})()]}})}})}function cr(e){const[t,r]=I(e.store);return[(()=>{var i=u(ar);return a(i,n(G,{each:ot,children:o=>n(Ht,{get label(){return o.label},get description(){return o.description},get checked(){return t.includes(o.name)},get name(){return o.name},get value(){return o.name},onValueUpdate:l=>{r(l?t.concat([o.name]):t.filter(s=>s!==o.name))}})})),i})(),n(M,{get children(){return v.tagIdeas}})]}const dr=Gt("kind",[p({kind:ee("CHOOSE")}),p({kind:ee("PLAYER")}),p({kind:ee("GAMEMASTER")}),p({kind:ee("HELPING")}),p({kind:ee("SUMMARY")}),p({kind:ee("EDIT_GAMEROUND"),uuid:f().uuid()})]),gr=pe(["SAVING","IDLE","ERROR"]),hr=p({saveState:gr,page:dr,secret:f(),showCreateMessage:oe()});function gt(e){const t=e.searchParams.get("page")??"",r=e.searchParams.get("uuid")??void 0,i=e.searchParams.get("secret")??"",o=e.searchParams.get("showCreateMessage")==="true",l=hr.safeParse({saveState:"IDLE",page:{kind:t.toUpperCase(),uuid:r},secret:i,showCreateMessage:o});return l.success?l.data:{saveState:"IDLE",page:{kind:"CHOOSE"},secret:i,showCreateMessage:o}}function mr(e,t){return e.kind!==t.kind?!1:e.kind!=="EDIT_GAMEROUND"||t.kind!=="EDIT_GAMEROUND"?!0:e.uuid===t.uuid}const $r="2024-08-15T07:45:21.335Z",ve={game:"37831e19-29d6-40bd-b99d-fb91b78aa7f9",slot:"bfcbd156-b703-4664-9944-8936aede8476"};function Sr(e,t){const r=localStorage.getItem(e);return r===null?t:r}function _r(e,t){localStorage.setItem(e,t)}const ht="SAVE",fr={uuid:crypto.randomUUID(),name:"John Doe",email:"john@doe.ch",mobile:"+41 66 123 45 67",lastSaved:$r,playing:{wantsUpdates:!1},master:{games:[{uuid:ve.game,kind:"PUBLISHED",title:"Grolle in der Dunkelheit",system:"Warhammer Fantasy Rollenspiel",description:{short:"Ein kurzes Abenteuer bei dem es um Fantasy, Action und einfaches Rollenspiel geht.",long:"Eine kleine Gruppe wagt sich in die dunklen Schächten einer Mine und weiter hinab, um einen mächtigen Gegenstand wieder zu erlangen. Wie werden die Gefährten auf die Gefahren des Untergrundes reagieren und welche Gefahren lauern in der Finsternis?"},slots:[{uuid:ve.slot,day:"SATURDAY",from:10,to:12},{uuid:crypto.randomUUID(),day:"SUNDAY",from:14,to:17}],playerCount:{min:1,max:3},tagNames:["deutsch"]}],wantsHelp:!1},helping:{}};async function br(){return new Promise(e=>setTimeout(()=>e(Sr(ht,JSON.stringify(fr))),1e3))}async function vr(e){return new Promise(t=>setTimeout(()=>t(_r(ht,JSON.stringify(e))),1e3))}const pr={entries:[{uuid:crypto.randomUUID(),gamemaster:"Mike Hunziker",title:"Grolle in der Dunkelheit",system:"Warhammer Fantasy Rollenspiel",description:{short:"Ein kurzes Abenteuer bei dem es um Fantasy, Action und einfaches Rollenspiel geht.",long:"Eine kleine Gruppe wagt sich in die dunklen Schächten einer Mine und weiter hinab, um einen mächtigen Gegenstand wieder zu erlangen. Wie werden die Gefährten auf die Gefahren des Untergrundes reagieren und welche Gefahren lauern in der Finsternis?"},slots:[],playerCount:{min:1,max:3,reserved:0},tagNames:["children"]}]};async function kr(){return new Promise(e=>setTimeout(()=>e(pr),5e3))}const yr={entries:[{uuid:ve.slot,name:"Alice"},{uuid:ve.slot,name:"Bob"}]};async function xr(e){return new Promise(t=>setTimeout(()=>t({entries:yr.entries.filter(r=>e.includes(r.uuid))}),5e3))}const Er=p({wantsUpdates:oe()}),Cr=p({wantsUpdates:oe()}),wr=p({games:F(Kt),wantsHelp:oe()}),Ar=p({games:F(st),wantsHelp:oe()}),Rr=p({}),Tr=p({}),Dr=p({uuid:f().uuid(),name:f(),email:f(),mobile:f(),lastSaved:f(),playing:Er,master:wr,helping:Rr}),Or=p({uuid:f().uuid(),name:f(),email:f(),mobile:f(),lastSaved:Bt.date(),playing:Cr,master:Ar,helping:Tr});async function Ir(e){if(e!=="demo")return{kind:"SECRET_INVALID"};const t=await br(),r=Dr.safeParse(JSON.parse(t));if(!r.success)return console.log(t),console.error(r.error),{kind:"FAILURE"};const i=Mr(r.data);return i.success?{kind:"SUCCESS",data:i.data}:{kind:"FAILURE"}}function Mr(e){return Or.safeParse(e)}async function Ur(e){console.log("saving");const t=new Date;e.lastSaved=t;const r=Nr(e);try{await vr(r)}catch(i){return console.error(i),{kind:"FAILURE"}}return{kind:"SUCCESS",data:t}}function Nr(e){return{...e,lastSaved:String(e.lastSaved),master:{...e.master,games:e.master.games.map(en)}}}const Pr=Dt(Ur,1e3);var Lr=g("<div class=tooltip-wrapper><div class=tooltip></div><!$><!/>");function Z(e){return(()=>{var t=u(Lr),r=t.firstChild,i=r.nextSibling,[o,l]=d(i.nextSibling);return a(r,()=>e.tooltip),a(t,()=>e.children,o,l),t})()}var Fr=g("<div class=quickmenu-wrapper><div class=quickmenu><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),Hr=g('<div class="quickmenu extended"><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>');function Gr(e){return(()=>{var t=u(Fr),r=t.firstChild,i=r.firstChild,[o,l]=d(i.nextSibling),s=o.nextSibling,[c,h]=d(s.nextSibling),m=c.nextSibling,[$,S]=d(m.nextSibling),b=$.nextSibling,[_,x]=d(b.nextSibling),k=_.nextSibling,[y,R]=d(k.nextSibling),A=y.nextSibling,[N,L]=d(A.nextSibling);return a(r,n(Z,{tooltip:"Zur Übersicht",get children(){return n(O,{get label(){return n(P,{icon:"backward"})},onClick:()=>e.changePage({kind:"CHOOSE"})})}}),o,l),a(r,n(Z,{tooltip:"Zu den Spielrunden",get children(){return n(O,{get label(){return n(P,{icon:"dice-d20"})},onClick:()=>e.changePage({kind:"PLAYER"})})}}),c,h),a(r,n(Z,{tooltip:"Zu deinen Spielrunden",get children(){return n(O,{get label(){return n(P,{icon:"grid-2-plus"})},onClick:()=>e.changePage({kind:"GAMEMASTER"})})}}),$,S),a(r,n(Z,{tooltip:"Zum Helferplan",get children(){return n(O,{get label(){return n(P,{icon:"hand-heart"})},onClick:()=>e.changePage({kind:"HELPING"})})}}),_,x),a(r,n(Z,{tooltip:"Zur Zusammenfassung",get children(){return n(O,{get label(){return n(P,{icon:"list"})},onClick:()=>e.changePage({kind:"SUMMARY"})})}}),y,R),a(r,n(ne,{get children(){return[n(w,{get when(){return e.saveState==="IDLE"},get children(){return n(Z,{get tooltip(){return`Zuletzt gespeichert um: ${nt(e.lastSaved)} Uhr`},get children(){return n(O,{get label(){return n(P,{icon:"circle-check"})},kind:"gray"})}})}}),n(w,{get when(){return e.saveState==="SAVING"},get children(){return n(Z,{tooltip:"Am Speichern...",get children(){return n(O,{get label(){return n(P,{icon:"floppy-disk-circle-arrow-right"})},kind:"success"})}})}}),n(w,{get when(){return e.saveState==="ERROR"},get children(){return n(Z,{tooltip:"Speichern war nicht möglich!",get children(){return n(O,{get label(){return n(P,{icon:"triangle-exclamation"})},kind:"danger"})}})}})]}}),N,L),t})()}function Br(e){return(()=>{var t=u(Hr),r=t.firstChild,[i,o]=d(r.nextSibling),l=i.nextSibling,[s,c]=d(l.nextSibling),h=s.nextSibling,[m,$]=d(h.nextSibling),S=m.nextSibling,[b,_]=d(S.nextSibling),x=b.nextSibling,[k,y]=d(x.nextSibling),R=k.nextSibling,[A,N]=d(R.nextSibling);return a(t,n(D,{icon:"backward",label:"Zur Übersicht",onClick:()=>e.changePage({kind:"CHOOSE"})}),i,o),a(t,n(D,{icon:"dice-d20",label:"Zu den Spielrunden",onClick:()=>e.changePage({kind:"PLAYER"})}),s,c),a(t,n(D,{icon:"grid-2-plus",label:"Zu deinen Spielrunden",onClick:()=>e.changePage({kind:"GAMEMASTER"})}),m,$),a(t,n(D,{icon:"hand-heart",label:"Zum Helferplan",onClick:()=>e.changePage({kind:"HELPING"})}),b,_),a(t,n(D,{icon:"list",label:"Zur Zusammenfassung",onClick:()=>e.changePage({kind:"SUMMARY"})}),k,y),a(t,n(ne,{get children(){return[n(w,{get when(){return e.saveState==="IDLE"},get children(){return n(D,{icon:"circle-check",get label(){return`Zuletzt gespeichert um: ${nt(e.lastSaved)} Uhr`},kind:"gray"})}}),n(w,{get when(){return e.saveState==="SAVING"},get children(){return n(D,{icon:"floppy-disk-circle-arrow-right",label:"Am Speichern...",kind:"success"})}}),n(w,{get when(){return e.saveState==="ERROR"},get children(){return n(D,{icon:"triangle-exclamation",label:"Speichern war nicht möglich!",kind:"danger"})}})]}}),A,N),t})()}var Yr=g("<div class=page><!$><!/><div class=page-content><h2></h2><br><!$><!/></div><!$><!/>");function te(e){return(()=>{var t=u(Yr),r=t.firstChild,[i,o]=d(r.nextSibling),l=i.nextSibling,s=l.firstChild,c=s.nextSibling,h=c.nextSibling,[m,$]=d(h.nextSibling),S=l.nextSibling,[b,_]=d(S.nextSibling);return a(t,(()=>{var x=U(()=>e.showQuickmenu!==!1);return()=>x()?n(Gr,{get changePage(){return e.changePage},get saveState(){return e.saveState},get lastSaved(){return e.lastSaved}}):null})(),i,o),a(s,()=>e.title),a(l,()=>e.children,m,$),a(t,(()=>{var x=U(()=>e.showQuickmenu!==!1);return()=>x()?n(Br,{get changePage(){return e.changePage},get saveState(){return e.saveState},get lastSaved(){return e.lastSaved}}):null})(),b,_),t})()}const mt=p({entries:F(p({uuid:f().uuid(),name:f()}))}),zr=mt;async function Wr(e,t){if(e!=="demo")return{kind:"FAILURE"};const r=await xr(t),i=mt.safeParse(r);if(!i.success)return{kind:"FAILURE"};const o=Zr(i.data);return o.success?{kind:"SUCCESS",data:o.data}:{kind:"FAILURE"}}function Zr(e){return zr.safeParse(e)}const jr=p({uuid:f().uuid(),gamemaster:f(),title:f(),system:f(),description:p({short:f(),long:f()}),slots:F(Ue),playerCount:p({min:j().min(1),max:j(),reserved:j()}).transform(e=>{const[t,r]=tt([e.min,e.max]),i=Math.min(r,e.reserved);return{min:t,max:r,reserved:i}}),tagNames:F(f())}),$t=p({entries:F(jr)}),Jr=$t;async function Vr(e){if(e!=="demo")return{kind:"FAILURE"};const t=await kr(),r=$t.safeParse(t);if(!r.success)return{kind:"FAILURE"};const i=qr(r.data);return i.success?{kind:"SUCCESS",data:i.data}:{kind:"FAILURE"}}function qr(e){return Jr.safeParse(e)}var Kr=g("<br>"),Oe=g("<pre>"),Xe=g("<hr>"),Qr=g("<div><code>Registrations (read-only)"),Xr=g("<div><code>Program (read-only)"),et=g("<em>loading...");function ei(e){const t=new URL(location.href);t.searchParams.set("page",e.page.kind.toLowerCase()),e.page.kind==="EDIT_GAMEROUND"&&t.searchParams.set("uuid",e.page.uuid),t.searchParams.delete("showCreateMessage"),history.replaceState({page:e},"",t);const r=v.pageTitle[e.page.kind];document.title=v.metaTitle.replace("{}",r)}function ti(e){const[t,r]=I(e.page);return(i,o)=>{if(mr(i,t))return;if(!o){const s=new URL(location.href);s.searchParams.set("page",i.kind.toLowerCase()),i.kind==="EDIT_GAMEROUND"&&s.searchParams.set("uuid",i.uuid),history.pushState({page:i},"",s)}const l=v.pageTitle[i.kind];document.title=v.metaTitle.replace("{}",l),r(i),window.scrollTo({top:0})}}function ni(e){ei(e.meta);const[t,r]=I({meta:e.meta,save:e.save}),i=()=>t.save.master.games.flatMap(c=>c.slots.map(h=>h.uuid)),[o]=_e(i(),c=>Wr(t.meta.secret,c)),[l]=_e(()=>Vr(t.meta.secret));_e(()=>JSON.stringify(t.save),async()=>{r("meta","saveState","SAVING");const c=Ft(t.save);try{const h=await Pr(c);h.kind==="FAILURE"?(console.error(h),r("meta","saveState","ERROR")):(r("save","lastSaved",h.data),r("meta","saveState","IDLE"))}catch(h){console.error(h),r("meta","saveState","ERROR")}});const s=ti(t.meta);return window.addEventListener("popstate",c=>{if(typeof c=="object"&&c!==null&&"state"in c){const h=new URL(location.href),m=gt(h);s(m.page,!0)}}),[n(E,{get when(){return t.meta.showCreateMessage},get children(){return[n(M,{type:"success",get children(){return v.registrationStarted}}),u(Kr)]}}),n(ne,{get fallback(){return n(te,{title:"Wo möchtest du starten?",showQuickmenu:!1,changePage:s,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return n(fn,{changePage:s,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved}})}})},get children(){return[n(w,{get when(){return t.meta.page.kind==="PLAYER"},get children(){return n(te,{title:"Spielrundenübersicht",changePage:s,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return n(un,{})}})}}),n(w,{get when(){return t.meta.page.kind==="GAMEMASTER"},get children(){return n(te,{title:"Meine Spielrunden",changePage:s,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return n(sn,{get store(){return t.save.master},changePage:s})}})}}),n(w,{get when(){return t.meta.page.kind==="EDIT_GAMEROUND"},get children(){return n(te,{title:"Spielrunde editieren",changePage:s,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return n(sr,{get allRounds(){return t.save.master.games},get uuid(){return t.meta.page.kind==="EDIT_GAMEROUND"?t.meta.page.uuid:"should never happen"},get fallback(){return n(M,{type:"danger",get children(){return v.error.gameroundUuidError}})},children:c=>n(or,{store:c,registrations:o,changePage:s})})}})}}),n(w,{get when(){return t.meta.page.kind==="HELPING"},get children(){return n(te,{title:"Helfen",changePage:s,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return n(jt,{})}})}}),n(w,{get when(){return t.meta.page.kind==="SUMMARY"},get children(){return n(te,{title:"Zusammenfassung",changePage:s,get saveState(){return t.meta.saveState},get lastSaved(){return t.save.lastSaved},get children(){return n(Wt,{})}})}})]}}),(()=>{var c=u(Oe);return a(c,()=>JSON.stringify(t,null,2)),c})(),u(Xe),u(Qr),n(fe,{get fallback(){return u(et)},get children(){return n(E,{get when(){return o()},children:c=>(()=>{var h=u(Oe);return a(h,()=>JSON.stringify(c(),null,2)),h})()})}}),u(Xe),u(Xr),n(fe,{get fallback(){return u(et)},get children(){return n(E,{get when(){return l()},children:c=>(()=>{var h=u(Oe);return a(h,()=>JSON.stringify(c(),null,2)),h})()})}})]}function St(){return n(M,{get children(){return v.loading}})}function ci(){const[e,t]=Nt(null);return Pt(()=>{const r=new URL(location.href);t(gt(r))}),n(E,{get fallback(){return n(St,{})},get when(){return e()},children:r=>n(ri,{get page(){return r()}})})}function ri(e){const[t]=_e(()=>Ir(e.page.secret));return n(Lt,{fallback:r=>(console.error(r),n(M,{type:"danger",get children(){return v.error.general}})),get children(){return n(fe,{get fallback(){return n(St,{})},get children(){return n(ne,{get children(){return n(w,{get when(){return t()},children:r=>{const{kind:i,value:o}=Ot(r());return i==="SECRET_INVALID"?n(M,{type:"danger",get children(){return v.error.secretError}}):i==="FAILURE"?n(M,{type:"danger",get children(){return v.error.ourMistake}}):n(ni,{get meta(){return e.page},get save(){return o.data}})}})}})}})}})}export{ci as MeineAnmeldungWrapper};
