import{g as i,t as o,i as s,d as t,a as g,m as V,e as $e,o as Se,M as x,f as G,h as W,j as pe,E as fe,S as _e}from"./web.5PWvPun-.js";import{e as F,c as A,B as H,b,I as j}from"./utils.CPa6uZZn.js";import{e as be,a as D,o as v,s as d,b as L,n as E,c as ve,l as ee,u as ne,d as te}from"./index.BmTnCDYh.js";import{c as re}from"./store.UIwYTWTH.js";/* empty css                                 */import{T as B}from"./Textarea.lGUyJjjl.js";const T=1,J="SAVE",z="PROGRAM",K={registrationId:-1,name:"Demo",email:"demo@mail.com",handynummer:"+41 12 123 12 12",wantsEmailUpdates:!0,games:[],lastSaved:"2024-08-15T07:45:21.335Z"};function Ee(){const n=localStorage.getItem(J);let e;return n===null?e={version:T,data:K}:e=JSON.parse(n),e.version!==T&&(console.error("Your local storage data was outdated and has been replaced with new demo content."),e={version:T,data:K}),localStorage.setItem(J,JSON.stringify(e)),e.data}const Q={gameList:[],reservedList:[]};function Pe(){const n=localStorage.getItem(z);let e;return n===null?e={version:T,data:Q}:e=JSON.parse(n),e.version!==T&&(console.error("Your local storage data was outdated and has been replaced with new demo content."),e={version:T,data:Q}),localStorage.setItem(z,JSON.stringify(e)),e.data}const ae=be(["SATURDAY","SUNDAY"]);D(v({uuid:d(),description:L(d()),title:L(d()),system:d(),master:v({first:d(),last:L(d())}),playerCount:v({min:E(),max:E()}),slot:v({day:ae,start:E(),end:E()})}));const ie=v({game:d(),self:ee(!0),spielerName:ve()}),le=v({game:d(),self:ee(!1),spielerName:d()}),ke=ne([ie.extend({id:E()}),le.extend({id:E()})]),Re=ne([ie,le]),we=v({registrationId:E(),name:d(),email:d(),handynummer:d(),wantsEmailUpdates:te(),games:D(ke),lastSaved:d()});v({registrationId:E(),name:d(),email:d(),handynummer:d(),wantsEmailUpdates:te(),games:D(Re),lastSaved:d()});async function Ae(n){if(n==="demo")return{kind:"SUCCESS",save:Ee()};const e=F("/rst24/load");e.searchParams.append("secret",n);const r=await fetch(e);if(!r.ok)return{kind:"FAILED"};const a=await r.json(),c=we.safeParse(a);return c.success?{kind:"SUCCESS",save:c.data}:{kind:"FAILED"}}const Ce=v({uuid:d(),title:L(d()),system:d(),description:L(d()),playerCount:v({min:E(),max:E()}),master:v({first:d(),last:L(d())}),slot:v({day:ae,start:E(),end:E()})}),xe=v({id:E(),gameId:d()});async function Me(n){if(n)return{kind:"SUCCESS",program:Pe()};const e=F("/rst24/program"),r=F("/rst24/reserved"),[a,c]=await Promise.all([fetch(e),fetch(r)]);if(!a.ok)return{kind:"FAILED"};if(!c.ok)return{kind:"FAILED"};const $=await a.json(),p=await c.json(),_=D(Ce).safeParse($);if(!_.success)return{kind:"FAILED"};const P=D(xe).safeParse(p);return P.success?{kind:"SUCCESS",program:{gameList:_.data,reservedList:P.data}}:{kind:"FAILED"}}const ye=["CHOOSE","PLAYER","GAMEMASTER","GAMEMASTER_NEW","HELPING","SUMMARY"],q={CHOOSE:"Übersicht",PLAYER:"Spielanmeldung",GAMEMASTER:"Spielleitung",GAMEMASTER_NEW:"Neue Spielrunde",HELPING:"Helfen",SUMMARY:"Zusammenfassung"};function se(n){const e=n.searchParams.get("page");return ye.find(r=>e?.toUpperCase()===r.toUpperCase())??"CHOOSE"}function Le(){const n=new URL(location.href),e=n.searchParams.get("secret"),r=se(n),a=n.searchParams.get("showCreateMessage")==="true";return{secret:e,page:r,showCreateMessage:a}}async function oe(n){if(n.secret===null)throw Error("SECRET_ERROR");const e=await Ae(n.secret);if(e.kind==="FAILED")throw Error("SECRET_ERROR");return{state:"IDLE",secret:n.secret,page:n.page,showCreateMessage:n.showCreateMessage,gameRoundEdit:{form:{titel:"",system:"",descriptionShort:"",descriptionLong:"",slot:1,playerCountMin:3,playerCountMax:6,tags:[]},errors:{titleMissing:!1,descriptionShortTooLong:!1,descriptionLongTooLong:!1,slotMissing:!1,playerCountInvalid:!1}},currentSave:e.save,activeTab:"Contact",lastSaved:e.save.lastSaved,hasChanged:!1,tentativeReservations:[],markedForDeletionReservations:[]}}async function Te(n=!1){const e=await Me(n);if(e.kind==="FAILED")throw Error("PROGRAM_ERROR");return e.program}function Ne(n){const[e,r]=re(n);function a(l){r("activeTab",l),window.scrollTo({top:0})}function c(l){const m=new URL(location.href);m.searchParams.set("page",l.toLowerCase()),m.searchParams.delete("showCreateMessage"),history.replaceState({page:l},"",m);const f=q[l];document.title=`Meine Anmeldung: ${f} | Luzerner Rollenspieltage `}c(n.page);function $(l,m=!1){if(l===e.page)return;if(!m){const h=new URL(location.href);h.searchParams.set("page",l.toLowerCase()),history.pushState({page:l},"",h)}const f=q[l];document.title=`Meine Anmeldung: ${f} | Luzerner Rollenspieltage `,r("page",l),window.scrollTo({top:0})}function p(l,m){r("hasChanged",!0),r("currentSave",l,m)}async function _(){if(e.state!=="IDLE")throw Error("ASSERTION_ERROR");r("state","SAVING");const l=F("/rst24/save"),m={...e.currentSave,games:[...e.currentSave.games.filter(h=>!e.markedForDeletionReservations.includes(h.id)),...e.tentativeReservations.map(h=>h.friendsName===null?{game:h.gameUuid,self:!0,spielerName:null}:{game:h.gameUuid,self:!1,spielerName:h.friendsName})]};if((await fetch(l,{method:"post",body:JSON.stringify(m),headers:{"Content-Type":"application/json"}})).ok){const h=await oe({secret:e.secret,page:e.page,showCreateMessage:!1});r({...h,activeTab:e.activeTab})}else throw Error("SAVE_ERROR")}function P(l){r("hasChanged",!0),r("tentativeReservations",m=>[...m,l])}function k(l){if(r("hasChanged",!0),l.confirmed)r("markedForDeletionReservations",m=>[...m,l.reservationId]);else{const m=e.currentSave.name;r("tentativeReservations",f=>f.filter(h=>h.gameUuid!==l.gameUuid?!0:h.friendsName===l.name?!1:l.name!==m))}}return{state:e,actions:{changeTab:a,changePage:$,updateSave:p,saveCurrentState:_,addTentativeReservation:P,deleteReservation:k}}}var X=o("<br>"),Ue=o("<strong>Donnerstag, 21. August 2025");const Ie=function(){const e="Donnerstag, 21. August 2025",r=["Deine Anmeldung wurde erfolgreich gestartet.",i(X),i(X),"Wir haben eine E-Mail an deine Adresse gesendet. In dieser E-Mail findest du einen persönlichen Link, um deine Anmeldung bis am"," ",i(Ue)," anzupassen."];return{registrationDeadline:e,registrationStarted:r}}();var Oe=o("<div class=grid><!$><!/><div>"),De=o("<div class=boxLink>");function O(n){const e=n.type??"special";return(()=>{var r=i(De);return s(r,t(H,{type:e,get onClick(){return n.onClick},get children(){var a=i(Oe),c=a.firstChild,[$,p]=g(c.nextSibling),_=$.nextSibling;return s(a,t(A,{get icon(){return n.icon}}),$,p),s(_,()=>n.children),a}})),r})()}var Ge=o("<div class=tooltip-wrapper><div class=tooltip></div><!$><!/>");function I(n){return(()=>{var e=i(Ge),r=e.firstChild,a=r.nextSibling,[c,$]=g(a.nextSibling);return s(r,()=>n.tooltip),s(e,()=>n.children,c,$),e})()}var Fe=o("<div class=quickmenu-wrapper><div class=quickmenu><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),He=o('<div class="quickmenu extended"><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>'),Ye=o("<div class=grid><!$><!/><span>Zur Übersicht"),Ze=o("<div class=grid><!$><!/><span>Zu den Spielrunden"),Ve=o("<div class=grid><!$><!/><span>Zu deinen Spielrunden"),We=o("<div class=grid><!$><!/><span>Zum Helferplan"),je=o("<div class=grid><!$><!/><span>Zur Zusammenfassung");function Be(n){return(()=>{var e=i(Fe),r=e.firstChild,a=r.firstChild,[c,$]=g(a.nextSibling),p=c.nextSibling,[_,P]=g(p.nextSibling),k=_.nextSibling,[l,m]=g(k.nextSibling),f=l.nextSibling,[h,C]=g(f.nextSibling),y=h.nextSibling,[U,u]=g(y.nextSibling);return s(r,t(I,{tooltip:"Zur Übersicht",get children(){return t(b,{get label(){return t(A,{icon:"backward"})},onClick:()=>n.changePage("CHOOSE")})}}),c,$),s(r,t(I,{tooltip:"Zu den Spielrunden",get children(){return t(b,{get label(){return t(A,{icon:"dice-d20"})},onClick:()=>n.changePage("PLAYER")})}}),_,P),s(r,t(I,{tooltip:"Zu deinen Spielrunden",get children(){return t(b,{get label(){return t(A,{icon:"grid-2-plus"})},onClick:()=>n.changePage("GAMEMASTER")})}}),l,m),s(r,t(I,{tooltip:"Zum Helferplan",get children(){return t(b,{get label(){return t(A,{icon:"hand-heart"})},onClick:()=>n.changePage("HELPING")})}}),h,C),s(r,t(I,{tooltip:"Zur Zusammenfassung",get children(){return t(b,{get label(){return t(A,{icon:"list"})},onClick:()=>n.changePage("SUMMARY")})}}),U,u),e})()}function Je(n){return(()=>{var e=i(He),r=e.firstChild,[a,c]=g(r.nextSibling),$=a.nextSibling,[p,_]=g($.nextSibling),P=p.nextSibling,[k,l]=g(P.nextSibling),m=k.nextSibling,[f,h]=g(m.nextSibling),C=f.nextSibling,[y,U]=g(C.nextSibling);return s(e,t(b,{get label(){return(()=>{var u=i(Ye),R=u.firstChild,[S,w]=g(R.nextSibling);return S.nextSibling,s(u,t(A,{icon:"backward"}),S,w),u})()},onClick:()=>n.changePage("CHOOSE")}),a,c),s(e,t(b,{get label(){return(()=>{var u=i(Ze),R=u.firstChild,[S,w]=g(R.nextSibling);return S.nextSibling,s(u,t(A,{icon:"dice-d20"}),S,w),u})()},onClick:()=>n.changePage("PLAYER")}),p,_),s(e,t(b,{get label(){return(()=>{var u=i(Ve),R=u.firstChild,[S,w]=g(R.nextSibling);return S.nextSibling,s(u,t(A,{icon:"grid-2-plus"}),S,w),u})()},onClick:()=>n.changePage("GAMEMASTER")}),k,l),s(e,t(b,{get label(){return(()=>{var u=i(We),R=u.firstChild,[S,w]=g(R.nextSibling);return S.nextSibling,s(u,t(A,{icon:"hand-heart"}),S,w),u})()},onClick:()=>n.changePage("HELPING")}),f,h),s(e,t(b,{get label(){return(()=>{var u=i(je),R=u.firstChild,[S,w]=g(R.nextSibling);return S.nextSibling,s(u,t(A,{icon:"list"}),S,w),u})()},onClick:()=>n.changePage("SUMMARY")}),y,U),e})()}var ze=o("<div class=page><!$><!/><div><h2></h2><br><!$><!/></div><!$><!/>");function N(n){return(()=>{var e=i(ze),r=e.firstChild,[a,c]=g(r.nextSibling),$=a.nextSibling,p=$.firstChild,_=p.nextSibling,P=_.nextSibling,[k,l]=g(P.nextSibling),m=$.nextSibling,[f,h]=g(m.nextSibling);return s(e,(()=>{var C=V(()=>n.showQuickmenu!==!1);return()=>C()?t(Be,{get changePage(){return n.changePage}}):null})(),a,c),s(p,()=>n.title),s($,()=>n.children,k,l),s(e,(()=>{var C=V(()=>n.showQuickmenu!==!1);return()=>C()?t(Je,{get changePage(){return n.changePage}}):null})(),f,h),e})()}var Ke=o("<h3>Spielrunden ansehen"),Qe=o("<p>Melde dich (und deine Freunde) für diverse Spielrunden an."),Y=o("<br>"),qe=o("<h3>Spielrunden erstellen"),Xe=o("<p>Falls du wenig oder gar keine Erfahrung als Spielleiter:in hast, werden wir dich vor und während dem Anlass unterstützen."),en=o("<h3>Helfen"),nn=o("<p>Beim Kiosk und der Essensausgabe können wir immer ein paar helfende Hände gebrauchen."),tn=o("<h3>Zusammenfassung"),rn=o("<p>Erhalte einen Überblick über dein gesamtes Programm.");function an(n){return t(N,{title:"Wo möchtest du starten?",showQuickmenu:!1,get changePage(){return n.changePage},get children(){return[t(O,{icon:"dice-d20",onClick:()=>n.changePage("PLAYER"),get children(){return[i(Ke),i(Qe)]}}),i(Y),t(O,{icon:"grid-2-plus",onClick:()=>n.changePage("GAMEMASTER"),get children(){return[i(qe),i(Xe)]}}),i(Y),t(O,{icon:"hand-heart",onClick:()=>n.changePage("HELPING"),get children(){return[i(en),i(nn)]}}),i(Y),t(O,{icon:"list",onClick:()=>n.changePage("SUMMARY"),get children(){return[i(tn),i(rn)]}})]}})}var ln=o("<h3>Neue Spielrunde erstellen"),sn=o("<form novalidate><!$><!/><!$><!/><!$><!/><!$><!/><div style=display:flex;flex-wrap:wrap;gap:1rem;><!$><!/><!$><!/><!$><!/>");function on(n){return t(N,{title:"Meine Spielrunden",get changePage(){return n.changePage},get children(){return t(O,{icon:"grid-2-plus",type:"success",onClick:()=>n.changePage("GAMEMASTER_NEW"),get children(){return i(ln)}})}})}function cn(n){const[e,r]=re(n.store);function a(c){c.preventDefault(),console.log(e)}return t(N,{title:"Neue Spielrunde erfassen",get changePage(){return n.changePage},get children(){var c=i(sn),$=c.firstChild,[p,_]=g($.nextSibling),P=p.nextSibling,[k,l]=g(P.nextSibling),m=k.nextSibling,[f,h]=g(m.nextSibling),C=f.nextSibling,[y,U]=g(C.nextSibling),u=y.nextSibling,R=u.firstChild,[S,w]=g(R.nextSibling),ge=S.nextSibling,[Z,ue]=g(ge.nextSibling),de=Z.nextSibling,[me,he]=g(de.nextSibling);return c.addEventListener("submit",a),s(c,t(j,{label:"Titel",name:"title",get value(){return e.form.titel},onValueUpdate:M=>r("form","titel",M)}),p,_),s(c,t(j,{label:"System",name:"System",get value(){return e.form.system},onValueUpdate:M=>r("form","system",M)}),k,l),s(c,t(B,{label:"Beschreibung (kurz)",name:"descriptionShort",get value(){return e.form.descriptionShort},onValueUpdate:M=>r("form","descriptionShort",M)}),f,h),s(c,t(B,{label:"Beschreibung (lang, optional)",name:"descriptionLong",get value(){return e.form.descriptionLong},onValueUpdate:M=>r("form","descriptionLong",M)}),y,U),s(u,t(b,{kind:"gray",label:"Spielrunde als Entwurf speichern"}),S,w),s(u,t(b,{kind:"danger",label:"Abbrechen"}),Z,ue),s(u,t(b,{type:"submit",kind:"success",label:"Spielrunde erstellen"}),me,he),c}})}var gn=o("<pre><code>Noch nicht implementiert");function un(n){return t(N,{title:"Helfen",get changePage(){return n.changePage},get children(){return i(gn)}})}var dn=o("<pre><code>Noch nicht implementiert");function mn(n){return t(N,{title:"Spielrundenübersicht",get changePage(){return n.changePage},get children(){return i(dn)}})}var hn=o("<pre><code>Noch nicht implementiert");function $n(n){return t(N,{title:"Zusammenfassung",get changePage(){return n.changePage},get children(){return i(hn)}})}var Sn=o("<p>Deine Anmeldung wird geladen..."),pn=o("<p>Wir konnten leider keine Anmeldung finden. Wenn du bereits eine Anmeldung begonnen hast, solltest du den korrekten Link per E-Mail erhalten haben.<br><br> Falls du noch keine Anmeldung begonnen hast, kannst du <a href=/anmeldung>hier</a> deine persönliche Anmeldung beginnen. <br><br>Für generelle Fragen oder Probleme, schreibe uns doch bitte über unser <a href=/kontatk>Kontaktformular</a>."),fn=o("<p>Leider ist ein unerwarteter Fehler passiert. Versuche deine Anmeldung erneut zu laden. Wiederholt sich dieser Fehler, bitte kontaktiere uns sobald als möglich über das <a href=/kontakt>Kontaktformular</a>, da dies nicht passieren sollte."),_n=o("<br>"),bn=o("<pre>");function ce(){return t(H,{get children(){return i(Sn)}})}function xn(){const[n,e]=$e(null);return Se(()=>{e(Le())}),t(G,{get fallback(){return t(ce,{})},get children(){return t(x,{get when(){return n()},children:r=>t(vn,{get params(){return r()}})})}})}function vn(n){const[e]=W(()=>oe(n.params)),[r]=W(()=>Te(n.params.secret==="demo"));return t(fe,{fallback:a=>t(H,{type:"danger",get children(){return t(G,{get fallback(){return i(fn)},get children(){return t(x,{get when(){return a.message==="SECRET_ERROR"},get children(){return i(pn)}})}})}}),get children(){return t(pe,{get fallback(){return t(ce,{})},get children(){return t(G,{get children(){return t(x,{get when(){return e()},children:a=>t(En,{get state(){return a()},programResource:r})})}})}})}})}function En(n){const{state:e,actions:r}=Ne(n.state);return window.addEventListener("popstate",a=>{if(typeof a=="object"&&a!==null&&"state"in a){const c=new URL(location.href),$=se(c);r.changePage($,!0)}}),[t(_e,{get when(){return e.showCreateMessage},get children(){return[t(H,{type:"success",get children(){return Ie.registrationStarted}}),i(_n)]}}),t(G,{get fallback(){return t(an,{get changePage(){return r.changePage}})},get children(){return[t(x,{get when(){return e.page==="PLAYER"},get children(){return t(mn,{get changePage(){return r.changePage}})}}),t(x,{get when(){return e.page==="GAMEMASTER"},get children(){return t(on,{get changePage(){return r.changePage}})}}),t(x,{get when(){return e.page==="GAMEMASTER_NEW"},get children(){return t(cn,{get store(){return e.gameRoundEdit},get changePage(){return r.changePage}})}}),t(x,{get when(){return e.page==="HELPING"},get children(){return t(un,{get changePage(){return r.changePage}})}}),t(x,{get when(){return e.page==="SUMMARY"},get children(){return t($n,{get changePage(){return r.changePage}})}})]}}),(()=>{var a=i(bn);return s(a,()=>JSON.stringify(e,null,2)),a})()]}export{xn as MeineAnmeldungWrapper};
