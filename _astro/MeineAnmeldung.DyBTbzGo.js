import{g as a,t as o,i as b,d as n,a as K,m as X,e as Z,o as q,M as h,f as M,h as _,j as Q,E as ee,S as te}from"./web.5PWvPun-.js";import{e as $,I as ne,B as y}from"./utils.BiZNXF97.js";import{e as re,a as w,o as u,s,b as E,n as g,c as ae,l as G,u as V,d as W}from"./index.BmTnCDYh.js";import{c as se}from"./store.UIwYTWTH.js";/* empty css                                 */const v=1,T="SAVE",L="PROGRAM",I={registrationId:-1,name:"Demo",email:"demo@mail.com",handynummer:"+41 12 123 12 12",wantsEmailUpdates:!0,games:[],lastSaved:"2024-08-15T07:45:21.335Z"};function ie(){const t=localStorage.getItem(T);let e;return t===null?e={version:v,data:I}:e=JSON.parse(t),e.version!==v&&(console.error("Your local storage data was outdated and has been replaced with new demo content."),e={version:v,data:I}),localStorage.setItem(T,JSON.stringify(e)),e.data}const N={gameList:[],reservedList:[]};function oe(){const t=localStorage.getItem(L);let e;return t===null?e={version:v,data:N}:e=JSON.parse(t),e.version!==v&&(console.error("Your local storage data was outdated and has been replaced with new demo content."),e={version:v,data:N}),localStorage.setItem(L,JSON.stringify(e)),e.data}const x=re(["SATURDAY","SUNDAY"]);w(u({uuid:s(),description:E(s()),title:E(s()),system:s(),master:u({first:s(),last:E(s())}),playerCount:u({min:g(),max:g()}),slot:u({day:x,start:g(),end:g()})}));const H=u({game:s(),self:G(!0),spielerName:ae()}),Y=u({game:s(),self:G(!1),spielerName:s()}),le=V([H.extend({id:g()}),Y.extend({id:g()})]),ce=V([H,Y]),de=u({registrationId:g(),name:s(),email:s(),handynummer:s(),wantsEmailUpdates:W(),games:w(le),lastSaved:s()});u({registrationId:g(),name:s(),email:s(),handynummer:s(),wantsEmailUpdates:W(),games:w(ce),lastSaved:s()});async function ue(t){if(t==="demo")return{kind:"SUCCESS",save:ie()};const e=$("/rst24/load");e.searchParams.append("secret",t);const r=await fetch(e);if(!r.ok)return{kind:"FAILED"};const l=await r.json(),m=de.safeParse(l);return m.success?{kind:"SUCCESS",save:m.data}:{kind:"FAILED"}}const ge=u({uuid:s(),title:E(s()),system:s(),description:E(s()),playerCount:u({min:g(),max:g()}),master:u({first:s(),last:E(s())}),slot:u({day:x,start:g(),end:g()})}),me=u({id:g(),gameId:s()});async function he(t){if(t)return{kind:"SUCCESS",program:oe()};const e=$("/rst24/program"),r=$("/rst24/reserved"),[l,m]=await Promise.all([fetch(e),fetch(r)]);if(!l.ok)return{kind:"FAILED"};if(!m.ok)return{kind:"FAILED"};const p=await l.json(),R=await m.json(),f=w(ge).safeParse(p);if(!f.success)return{kind:"FAILED"};const A=w(me).safeParse(R);return A.success?{kind:"SUCCESS",program:{gameList:f.data,reservedList:A.data}}:{kind:"FAILED"}}const pe=["CHOOSE","OVERVIEW","PLAYER","GAMEMASTER","GAMEMASTER_NEW","HELPING"],O={OVERVIEW:"Übersicht",CHOOSE:"Auswahl",PLAYER:"Spielanmeldung",GAMEMASTER:"Spielleitung",GAMEMASTER_NEW:"Neue Spielrunde",HELPING:"Helfen"};function j(t){const e=t.searchParams.get("page");return pe.find(r=>e?.toUpperCase()===r.toUpperCase())??"OVERVIEW"}function fe(){const t=new URL(location.href),e=t.searchParams.get("secret"),r=j(t),l=t.searchParams.get("showCreateMessage")==="true";return{secret:e,page:r,showCreateMessage:l}}async function J(t){if(t.secret===null)throw Error("SECRET_ERROR");const e=await ue(t.secret);if(e.kind==="FAILED")throw Error("SECRET_ERROR");return{state:"IDLE",secret:t.secret,page:t.page,showCreateMessage:t.showCreateMessage,currentSave:e.save,activeTab:"Contact",lastSaved:e.save.lastSaved,hasChanged:!1,tentativeReservations:[],markedForDeletionReservations:[]}}async function Se(t=!1){const e=await he(t);if(e.kind==="FAILED")throw Error("PROGRAM_ERROR");return e.program}function Ee(t){const[e,r]=se(t);function l(i){r("activeTab",i),window.scrollTo({top:0})}function m(i){const c=new URL(location.href);c.searchParams.set("page",i.toLowerCase()),c.searchParams.delete("showCreateMessage"),history.replaceState({page:i},"",c);const S=O[i];document.title=`Meine Anmeldung: ${S} | Luzerner Rollenspieltage `}m(t.page);function p(i,c=!1){if(!c){const d=new URL(location.href);d.searchParams.set("page",i.toLowerCase()),history.pushState({page:i},"",d)}const S=O[i];document.title=`Meine Anmeldung: ${S} | Luzerner Rollenspieltage `,r("page",i),window.scrollTo({top:0})}function R(i,c){r("hasChanged",!0),r("currentSave",i,c)}async function f(){if(e.state!=="IDLE")throw Error("ASSERTION_ERROR");r("state","SAVING");const i=$("/rst24/save"),c={...e.currentSave,games:[...e.currentSave.games.filter(d=>!e.markedForDeletionReservations.includes(d.id)),...e.tentativeReservations.map(d=>d.friendsName===null?{game:d.gameUuid,self:!0,spielerName:null}:{game:d.gameUuid,self:!1,spielerName:d.friendsName})]};if((await fetch(i,{method:"post",body:JSON.stringify(c),headers:{"Content-Type":"application/json"}})).ok){const d=await J({secret:e.secret,page:e.page,showCreateMessage:!1});r({...d,activeTab:e.activeTab})}else throw Error("SAVE_ERROR")}function A(i){r("hasChanged",!0),r("tentativeReservations",c=>[...c,i])}function B(i){if(r("hasChanged",!0),i.confirmed)r("markedForDeletionReservations",c=>[...c,i.reservationId]);else{const c=e.currentSave.name;r("tentativeReservations",S=>S.filter(d=>d.gameUuid!==i.gameUuid?!0:d.friendsName===i.name?!1:i.name!==c))}}return{state:e,actions:{changeTab:l,changePage:p,updateSave:R,saveCurrentState:f,addTentativeReservation:A,deleteReservation:B}}}var D=o("<br>"),ve=o("<strong>Donnerstag, 21. August 2025");const Re=function(){const e="Donnerstag, 21. August 2025",r=["Deine Anmeldung wurde erfolgreich gestartet.",a(D),a(D),"Wir haben eine E-Mail an deine Adresse gesendet. In dieser E-Mail findest du einen persönlichen Link, um deine Anmeldung bis am"," ",a(ve)," anzupassen."];return{registrationDeadline:e,registrationStarted:r}}();var we=o("<div class=grid><!$><!/><div>"),Ae=o("<div class=boxLink>");function P(t){const e=t.type??"special";return(()=>{var r=a(Ae);return b(r,n(y,{type:e,get onClick(){return t.onClick},get children(){var l=a(we),m=l.firstChild,[p,R]=K(m.nextSibling),f=p.nextSibling;return b(l,n(ne,{get icon(){return t.icon}}),p,R),b(f,()=>t.children),l}})),r})()}var ke=o("<h2>"),be=o("<br>");function C(t){return[(()=>{var e=a(ke);return b(e,()=>t.title),e})(),a(be),X(()=>t.children)]}var Pe=o("<h3>Spielrunden ansehen"),Me=o("<p>Melde dich (und deine Freunde) für diverse Spielrunden an."),U=o("<br>"),$e=o("<h3>Spielrunden erstellen"),ye=o("<p>Falls du wenig oder gar keine Erfahrung als Spielleiter:in hast, werden wir dich vor und während dem Anlass unterstützen."),Ce=o("<h3>Helfen"),_e=o("<p>Beim Kiosk und der Essensausgabe können wir immer ein paar helfende Hände gebrauchen.");function Te(t){return n(C,{title:"Wie möchtest du starten?",get children(){return[n(P,{icon:"dice-d20",onClick:()=>t.changePage("PLAYER"),get children(){return[a(Pe),a(Me)]}}),a(U),n(P,{icon:"grid-2-plus",onClick:()=>t.changePage("GAMEMASTER"),get children(){return[a($e),a(ye)]}}),a(U),n(P,{icon:"hand-heart",onClick:()=>t.changePage("HELPING"),get children(){return[a(Ce),a(_e)]}})]}})}var Le=o("<h3>Neue Spielrunde erstellen");function Ie(t){return n(C,{title:"Meine Spielrunden",get children(){return n(P,{icon:"grid-2-plus",type:"success",onClick:()=>t.changePage("GAMEMASTER_NEW"),get children(){return a(Le)}})}})}function Ne(){return n(C,{title:"Neue Spielrunde erfassen"})}var Oe=o("<p>Deine Anmeldung wird geladen..."),De=o("<p>Wir konnten leider keine Anmeldung finden. Wenn du bereits eine Anmeldung begonnen hast, solltest du den korrekten Link per E-Mail erhalten haben.<br><br> Falls du noch keine Anmeldung begonnen hast, kannst du <a href=/anmeldung>hier</a> deine persönliche Anmeldung beginnen. <br><br>Für generelle Fragen oder Probleme, schreibe uns doch bitte über unser <a href=/kontatk>Kontaktformular</a>."),Ue=o("<p>Leider ist ein unerwarteter Fehler passiert. Versuche deine Anmeldung erneut zu laden. Wiederholt sich dieser Fehler, bitte kontaktiere uns sobald als möglich über das <a href=/kontakt>Kontaktformular</a>, da dies nicht passieren sollte."),Fe=o("<br>"),F=o("<h1>Overview"),k=o("<pre><code>Noch nicht implementiert"),Ge=o("<h1>Spielrundenübersicht"),Ve=o("<h1>Helfen");function z(){return n(y,{get children(){return a(Oe)}})}function Be(){const[t,e]=Z(null);return q(()=>{e(fe())}),n(M,{get fallback(){return n(z,{})},get children(){return n(h,{get when(){return t()},children:r=>n(We,{get params(){return r()}})})}})}function We(t){const[e]=_(()=>J(t.params)),[r]=_(()=>Se(t.params.secret==="demo"));return n(ee,{fallback:l=>n(y,{type:"danger",get children(){return n(M,{get fallback(){return a(Ue)},get children(){return n(h,{get when(){return l.message==="SECRET_ERROR"},get children(){return a(De)}})}})}}),get children(){return n(Q,{get fallback(){return n(z,{})},get children(){return n(M,{get children(){return n(h,{get when(){return e()},children:l=>n(xe,{get state(){return l()},programResource:r})})}})}})}})}function xe(t){const{state:e,actions:r}=Ee(t.state);return window.addEventListener("popstate",l=>{if(typeof l=="object"&&l!==null&&"state"in l){const m=new URL(location.href),p=j(m);r.changePage(p,!0)}}),[n(te,{get when(){return e.showCreateMessage},get children(){return[n(y,{type:"success",get children(){return Re.registrationStarted}}),a(Fe)]}}),n(M,{get fallback(){return[a(F),a(k)]},get children(){return[n(h,{get when(){return e.page==="CHOOSE"},get children(){return n(Te,{get changePage(){return r.changePage}})}}),n(h,{get when(){return e.page==="OVERVIEW"},get children(){return[a(F),a(k)]}}),n(h,{get when(){return e.page==="PLAYER"},get children(){return[a(Ge),a(k)]}}),n(h,{get when(){return e.page==="GAMEMASTER"},get children(){return n(Ie,{get changePage(){return r.changePage}})}}),n(h,{get when(){return e.page==="GAMEMASTER_NEW"},get children(){return n(Ne,{})}}),n(h,{get when(){return e.page==="HELPING"},get children(){return[a(Ve),a(k)]}})]}})]}export{Be as MeineAnmeldungWrapper};
