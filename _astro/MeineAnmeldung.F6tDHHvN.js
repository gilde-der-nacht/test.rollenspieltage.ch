import{g as a,c as i,t as d,i as o,S as X,a as h,b as Y,s as tt,d as te,e as nt,f as Ne,m as c,h as ce,r as W,j as ee,k as V,M as z,o as rt,l as ve,E as at}from"./web.CfGZwRa2.js";import{I as $e,B as w,a as it,e as ne,S as Ee,b as G}from"./utils.D8gCBPD4.js";import{e as lt,a as Z,o as C,s as S,b as j,n as A,c as st,l as Ce,u as Ae,d as Te}from"./index.BmTnCDYh.js";import{c as ut}from"./store.Wny7_hGz.js";var dt=d("<h2>Kontaktdaten"),ot=d("<div class=content><small>Deine persönlichen Daten werden ausschliesslich verwendet, um dich über das Programm der Luzerner Rollenspieltage 2024 zu informieren. Nach dem Event werden diese gelöscht."),le=d("<br>"),se=d("<div style=margin-block:.5rem;>");function gt(e){let t;return[a(dt),a(ot),a(le),i($e,{label:"Name",name:"name",get value(){return e.save.name},onValueUpdate:n=>e.updateSave("name",n)}),i(X,{get when(){return e.save.name.trim().length===0},get children(){var n=a(se);return o(n,i(w,{type:"danger",children:"Dies ist ein Pflichtfeld."})),n}}),a(le),i(it,{label:"E-Mail",name:"email",type:"email",get value(){return e.save.email},onValueUpdate:n=>e.updateSave("email",n),ref(n){var l=t;typeof l=="function"?l(n):t=n}}),i(X,{get when(){return e.save.email.trim().length===0},get children(){var n=a(se);return o(n,i(w,{type:"danger",children:"Dies ist ein Pflichtfeld."})),n}}),i(X,{get when(){return e.save.email.length>0&&t.validity.typeMismatch},get children(){var n=a(se);return o(n,i(w,{type:"danger",children:"Die Eingabe scheint keine gültige E-Mail-Adresse zu sein."})),n}}),a(le),i($e,{label:"Handynummer",name:"tel",type:"tel",get value(){return e.save.handynummer},required:!1,onValueUpdate:n=>e.updateSave("handynummer",n)})]}const J=1,he="SAVE",fe="PROGRAM",Se={registrationId:-1,name:"Demo",email:"demo@mail.com",handynummer:"+41 12 123 12 12",wantsEmailUpdates:!0,games:[],lastSaved:"2024-08-15T07:45:21.335Z"};function ct(){const e=localStorage.getItem(he);let t;return e===null?t={version:J,data:Se}:t=JSON.parse(e),t.version!==J&&(console.error("Your local storage data was outdated and has been replaced with new demo content."),t={version:J,data:Se}),localStorage.setItem(he,JSON.stringify(t)),t.data}const _e={gameList:[],reservedList:[]};function mt(){const e=localStorage.getItem(fe);let t;return e===null?t={version:J,data:_e}:t=JSON.parse(e),t.version!==J&&(console.error("Your local storage data was outdated and has been replaced with new demo content."),t={version:J,data:_e}),localStorage.setItem(fe,JSON.stringify(t)),t.data}const we=lt(["SATURDAY","SUNDAY"]);Z(C({uuid:S(),description:j(S()),title:j(S()),system:S(),master:C({first:S(),last:j(S())}),playerCount:C({min:A(),max:A()}),slot:C({day:we,start:A(),end:A()})}));const De=C({game:S(),self:Ce(!0),spielerName:st()}),Ue=C({game:S(),self:Ce(!1),spielerName:S()}),vt=Ae([De.extend({id:A()}),Ue.extend({id:A()})]),$t=Ae([De,Ue]),ht=C({registrationId:A(),name:S(),email:S(),handynummer:S(),wantsEmailUpdates:Te(),games:Z(vt),lastSaved:S()});C({registrationId:A(),name:S(),email:S(),handynummer:S(),wantsEmailUpdates:Te(),games:Z($t),lastSaved:S()});async function ft(e){if(e==="demo")return{kind:"SUCCESS",save:ct()};const t=ne("/rst24/load");t.searchParams.append("secret",e);const n=await fetch(t);if(!n.ok)return{kind:"FAILED"};const l=await n.json(),s=ht.safeParse(l);return s.success?{kind:"SUCCESS",save:s.data}:{kind:"FAILED"}}const St=C({uuid:S(),title:j(S()),system:S(),description:j(S()),playerCount:C({min:A(),max:A()}),master:C({first:S(),last:j(S())}),slot:C({day:we,start:A(),end:A()})}),_t=C({id:A(),gameId:S()});async function bt(e){if(e)return{kind:"SUCCESS",program:mt()};const t=ne("/rst24/program"),n=ne("/rst24/reserved"),[l,s]=await Promise.all([fetch(t),fetch(n)]);if(!l.ok)return{kind:"FAILED"};if(!s.ok)return{kind:"FAILED"};const r=await l.json(),u=await s.json(),g=Z(St).safeParse(r);if(!g.success)return{kind:"FAILED"};const v=Z(_t).safeParse(u);return v.success?{kind:"SUCCESS",program:{gameList:g.data,reservedList:v.data}}:{kind:"FAILED"}}function pe(e,t){const l=t.gameList.filter(r=>r.slot.day===e).map(r=>{const u=r.uuid,g=t.reservedList.filter(v=>v.gameId===u);return{...r,reservedIds:g.map(v=>v.id)}});let s={};for(const r of l){const{start:u}=r.slot,g=s[u]??[];g.push(r),s[u]=g}return Object.entries(s)}var yt=d("<label class=input-checkbox><input type=checkbox><!$><!/>");function Rt(e){return(()=>{var t=a(yt),n=t.firstChild,l=n.nextSibling,[s,r]=h(l.nextSibling);return n.addEventListener("change",u=>e.onValueUpdate(u.target.checked)),o(t,()=>e.label,s,r),Y(()=>tt(n,"name",e.name)),Y(()=>te(n,"value",e.value)),Y(()=>te(n,"checked",e.checked)),t})()}var kt=d("<div style=display:flex;flex-wrap:wrap;gap:0.5rem;align-items:center;><p><strong></strong></p>|<small><!$><!/> bis <!$><!/> Uhr"),xt=d("<p><small>"),Nt=d("<small><!$><!/> - <!$><!/> Uhr"),Et=d("<h4 style=margin-block-end:0.5rem;>"),Ct=d("<p>Wir kochen: <span>");function re(e){const t=e.type==="LUNCH"?13:18,n=e.type==="LUNCH"?14:19,l=e.small===!0,s=e.type==="LUNCH"?"Mittagessen":"Nachtessen";return l?i(w,{get children(){return[(()=>{var r=a(kt),u=r.firstChild,g=u.firstChild,v=u.nextSibling,m=v.nextSibling,f=m.firstChild,[$,_]=h(f.nextSibling),b=$.nextSibling,R=b.nextSibling,[x,D]=h(R.nextSibling);return x.nextSibling,o(g,s),o(m,t,$,_),o(m,n,x,D),r})(),(()=>{var r=a(xt),u=r.firstChild;return te(u,"innerHTML","Pilzrisotto (vegi&nbsp;/&nbsp;vegan), Penne All'Arrabbiata und Penne Pesto (vegi&nbsp;/&nbsp;vegan)."),r})()]}}):i(w,{get children(){return[(()=>{var r=a(Nt),u=r.firstChild,[g,v]=h(u.nextSibling),m=g.nextSibling,f=m.nextSibling,[$,_]=h(f.nextSibling);return $.nextSibling,o(r,t,g,v),o(r,n,$,_),r})(),(()=>{var r=a(Et);return o(r,s),r})(),(()=>{var r=a(Ct),u=r.firstChild,g=u.nextSibling;return te(g,"innerHTML","Pilzrisotto (vegi&nbsp;/&nbsp;vegan), Penne All'Arrabbiata und Penne Pesto (vegi&nbsp;/&nbsp;vegan)."),r})()]}})}var At=d("<li><h1 class=event-title></h1><div class=event-details><div class=event-tags><strong>Zeit:</strong> <!$><!/> - <!$><!/> Uhr</div><div class=event-tags><strong>Spielleitung:</strong> <!$><!/> <!$><!/></div><div class=event-tags><strong>Freie Plätze:</strong> <!$><!/></div><!$><!/></div><div class=event-description><!$><!/><!$><!/></div><!$><!/>"),Tt=d("<span>Es hat noch <strong><!$><!/> Plätze</strong> frei."),wt=d("<span>Es hat noch <strong><!$><!/> Platz</strong> frei."),Dt=d("<div class=event-tags style=display:block;><em>(Du hast dich bereits für eine Spielrunde eingetragen, die diese Spielrunde zeitlich überschneidet.)"),Ut=d('<div class="event-description content"><p><strong>Beschreibung:</strong><br><!$><!/>'),pt=d("<div><p><strong>Deine Reservationen</strong></p><ul>"),Ft=d("<li style=font-size:0.83rem;>"),It=d("<s>"),be=d('<span title="ungespeicherte Änderung"> *'),Ot=d('<a href=javascript:; style=border:none; title="Reservation löschen"><i class="fa-duotone fa-circle-xmark">'),Pt=d("<ul role=list class=event-links><li><a class=event-link href=javascript:;>+ Platz für mich reservieren"),Gt=d("<ul role=list class=event-links><li><a class=event-link href=javascript:;>+ Platz für Begleitung reservieren"),Mt=d("<h3 style=margin-block:1rem;>Start <!$><!/> Uhr"),Lt=d("<ul class=event-list role=list>"),Ht=d(`<style>
          .event-filters .active {
            color: var(--clr-success-10) !important;
          }
        `),Bt=d("<div class=content><small>Auf dieser Seite kannst du dich und deine Freunde für Spielrunden einschreiben, solange es freie Plätze hat."),ye=d("<br>"),Yt=d("<div class=event-filters><h2>Filter</h2><ul role=list><li><a href=javascript:;>Alle</a></li><!$><!/>"),Re=d("<div style=margin-block:2rem;>"),Vt=d("<li><a href=javascript:;><!$><!/> Uhr");const zt=1;function Q(e,t){const{from:n,to:l}=t;return n<=e&&e<=l}function jt(e,t){const{from:n,to:l}=e,{from:s,to:r}=t;return Q(n,t)||Q(l,t)||Q(s,e)||Q(r,e)}function Jt(e){function t(){return[...e.confirmedReservations.map(s=>({name:s.spielerName??e.selfName,confirmed:!0,gameUuid:e.entry.uuid,reservationId:s.id,markedForDeletion:e.markedForDeletionReservations.includes(s.id)})),...e.tentativeReservations.map(s=>({name:s.friendsName??e.selfName,confirmed:!1,gameUuid:e.entry.uuid,markedForDeletion:!1}))]}function n(){const s=e.confirmedReservations.map(u=>u.id),r=e.entry.reservedIds.filter(u=>!s.includes(u));return e.entry.playerCount.max-zt-r.length-t().filter(u=>!u.markedForDeletion).length}function l(){const{start:s,end:r}=e.entry.slot;return e.reservedTimeRanges.filter(g=>jt({from:s,to:r},g.range)).filter(g=>g.gameUuid!==e.entry.uuid).length===0}return(()=>{var s=a(At),r=s.firstChild,u=r.nextSibling,g=u.firstChild,v=g.firstChild,m=v.nextSibling,f=m.nextSibling,[$,_]=h(f.nextSibling),b=$.nextSibling,R=b.nextSibling,[x,D]=h(R.nextSibling);x.nextSibling;var N=g.nextSibling,M=N.firstChild,I=M.nextSibling,F=I.nextSibling,[L,H]=h(F.nextSibling),K=L.nextSibling,ae=K.nextSibling,[Pe,Ge]=h(ae.nextSibling),ie=N.nextSibling,Me=ie.firstChild,Le=Me.nextSibling,He=Le.nextSibling,[Be,Ye]=h(He.nextSibling),Ve=ie.nextSibling,[ze,je]=h(Ve.nextSibling),q=u.nextSibling,Je=q.firstChild,[me,Ke]=h(Je.nextSibling),We=me.nextSibling,[Ze,qe]=h(We.nextSibling),Qe=q.nextSibling,[Xe,et]=h(Qe.nextSibling);return o(r,()=>e.entry.title===null?e.entry.system:`${e.entry.title} (${e.entry.system})`),o(g,()=>e.entry.slot.start,$,_),o(g,()=>e.entry.slot.end,x,D),o(N,()=>e.entry.master.first,L,H),o(N,()=>e.entry.master.last,Pe,Ge),o(ie,(()=>{var U=c(()=>n()>1);return()=>U()?(()=>{var y=a(Tt),T=y.firstChild,E=T.nextSibling,k=E.firstChild,[p,O]=h(k.nextSibling);return p.nextSibling,o(E,n,p,O),y})():c(()=>n()===1)()?(()=>{var y=a(wt),T=y.firstChild,E=T.nextSibling,k=E.firstChild,[p,O]=h(k.nextSibling);return p.nextSibling,o(E,n,p,O),y})():"Diese Spielrunde ist bereits voll besetzt."})(),Be,Ye),o(u,(()=>{var U=c(()=>n()>0&&!l());return()=>U()?a(Dt):null})(),ze,je),o(q,(()=>{var U=c(()=>e.entry.description!==null&&e.entry.description.trim().length>0);return()=>U()?(()=>{var y=a(Ut),T=y.firstChild,E=T.firstChild,k=E.nextSibling,p=k.nextSibling,[O,P]=h(p.nextSibling);return o(T,()=>e.entry.description,O,P),y})():null})(),me,Ke),o(q,(()=>{var U=c(()=>t().length>0);return()=>U()?(()=>{var y=a(pt),T=y.firstChild,E=T.nextSibling;return o(E,()=>t().map(k=>(()=>{var p=a(Ft);return o(p,(()=>{var O=c(()=>!!k.markedForDeletion);return()=>O()?[(()=>{var P=a(It);return o(P,()=>k.name),P})(),a(be)]:[c(()=>k.name),c(()=>c(()=>!!k.confirmed)()?null:a(be)),(()=>{var P=a(Ot);return P.$$click=()=>e.deleteReservation(k),W(),P})()]})()),p})())),y})():null})(),Ze,qe),o(s,(()=>{var U=c(()=>!!(n()>0&&l()));return()=>U()?c(()=>t().filter(y=>!y.markedForDeletion).length===0)()?(()=>{var y=a(Pt),T=y.firstChild,E=T.firstChild;return E.$$click=()=>e.addTentativeReservation({gameUuid:e.entry.uuid,friendsName:null}),W(),y})():(()=>{var y=a(Gt),T=y.firstChild,E=T.firstChild;return E.$$click=()=>{const k=prompt("Bitte teile uns mit, wie deine Begleitung heisst:");k!==null&&k.trim().length>0&&e.addTentativeReservation({gameUuid:e.entry.uuid,friendsName:k})},W(),y})():null})(),Xe,et),Y(()=>ce(s,`event-entry ${t().filter(U=>!U.markedForDeletion).length>0?"success":n()>0&&l()?"special":"gray"}`)),s})()}function Kt(e){const t=e.confirmedReservations.filter(r=>!e.markedForDeletionReservations.includes(r.id)).map(r=>r.game);t.push(...e.tentativeReservations.map(r=>r.gameUuid));const n=new Set(t);return e.programByHour.flatMap(([r,u])=>u).filter(r=>n.has(r.uuid)).map(r=>({range:{from:r.slot.start,to:r.slot.end},gameUuid:r.uuid}))}function Wt(e){const t={MORNING:[],AFTERNOON:[],EVENING:[]};return e.forEach(n=>{const l=Number(n[0]);l<13?t.MORNING.push(n):l<18?t.AFTERNOON.push(n):t.EVENING.push(n)}),t}function Fe(e){const[t,n]=Ne([]);function l(m){n(f=>f.includes(m)?f.filter($=>$!==m):[...f,m])}const s=()=>Kt({programByHour:e.programByHour,confirmedReservations:e.confirmedReservations,tentativeReservations:e.tentativeReservations,markedForDeletionReservations:e.markedForDeletionReservations}),{MORNING:r,AFTERNOON:u,EVENING:g}=Wt(e.programByHour);function v(m){return c(()=>m.program.filter(([f])=>t().includes(f)||t().length===0).map(([f,$])=>[(()=>{var _=a(Mt),b=_.firstChild,R=b.nextSibling,[x,D]=h(R.nextSibling);return x.nextSibling,o(_,f,x,D),_})(),(()=>{var _=a(Lt);return o(_,()=>$.map(b=>i(Jt,{entry:b,get selfName(){return e.selfName},get confirmedReservations(){return e.confirmedReservations.filter(R=>R.game===b.uuid)},get tentativeReservations(){return e.tentativeReservations.filter(R=>R.gameUuid===b.uuid)},get markedForDeletionReservations(){return e.markedForDeletionReservations},get reservedTimeRanges(){return s()},get addTentativeReservation(){return e.addTentativeReservation},get deleteReservation(){return e.deleteReservation}}))),_})()]))}return[a(Ht),a(Bt),a(ye),i(Rt,{get checked(){return e.wantsEmailUpdates},onValueUpdate:m=>e.updateSave("wantsEmailUpdates",m),label:"Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschaltet werden.",name:"wantsUpdates",value:"true"}),a(ye),(()=>{var m=a(Yt),f=m.firstChild,$=f.nextSibling,_=$.firstChild,b=_.firstChild,R=_.nextSibling,[x,D]=h(R.nextSibling);return b.$$click=()=>n([]),o($,()=>e.programByHour.map(([N,M])=>(()=>{var I=a(Vt),F=I.firstChild,L=F.firstChild,[H,K]=h(L.nextSibling);return H.nextSibling,F.$$click=()=>l(N),o(F,N,H,K),Y(()=>ce(F,t().includes(N)?"active":"")),W(),I})()),x,D),Y(()=>ce(b,t().length===0?"active":"")),W(),m})(),i(v,{program:r}),(()=>{var m=a(Re);return o(m,i(re,{type:"LUNCH"})),m})(),i(v,{program:u}),c(()=>c(()=>g.length>0)()?[(()=>{var m=a(Re);return o(m,i(re,{type:"DINNER"})),m})(),i(v,{program:g})," "]:null)]}nt(["click"]);function Zt(e){const t=pe("SATURDAY",e.program);return i(Fe,{get selfName(){return e.selfName},programByHour:t,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get wantsEmailUpdates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})}function qt(e){const t=pe("SUNDAY",e.program);return i(Fe,{get selfName(){return e.selfName},programByHour:t,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get wantsEmailUpdates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})}var Qt=d("<p><strong><!$><!/> </strong>| <!$><!/>, <!$><!/> bis <!$><!/> Uhr"),Xt=d("<p>Reservation für <strong>"),en=d("<ul role=list style=display:grid;gap:.5rem;>"),tn=d("<li>"),ke=d("<div style=max-inline-size:60ch;>"),nn=d("<h3>Kontaktdaten"),rn=d("<ul><li><strong>Name:</strong> <!$><!/></li><li><strong>E-Mail:</strong> <!$><!/></li><li><strong>Handynummer:</strong> <!$><!/>"),xe=d("<br>"),an=d("<h3>Deine Reservationen"),ln=d("<h3>Updates"),sn=d("<p><em>"),un=d("<p><em>Noch keine Reservationen getätigt."),dn=d("<h4>Unbestätigt"),on=d("<p>Bitte speichere deinen aktuellen Stand der Anmeldung, damit wir die folgenden Reservationen bestätigen können."),ue=d("<h5>Samstag, 24. August 2024"),de=d("<h5>Sonntag, 25. August 2024"),gn=d("<h4>Reservationen, die du entfernen möchtest"),cn=d("<p>Bitte speichere deinen aktuellen Stand der Anmeldung, damit wir die folgenden Reservationen entfernen können."),mn=d("<h4>Bestätigt"),vn=d("<span style=color:var(--clr-success-10);>Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschaltet werden."),$n=d("<span style=color:var(--clr-danger-10);>Nein, ich möchte keine E-Mails über neue Spielrunden erhalten.");function hn(e){const{game:t}=e;return i(w,{get type(){return e.type??"gray"},get children(){return[(()=>{var n=a(Qt),l=n.firstChild,s=l.firstChild,[r,u]=h(s.nextSibling);r.nextSibling;var g=l.nextSibling,v=g.nextSibling,[m,f]=h(v.nextSibling),$=m.nextSibling,_=$.nextSibling,[b,R]=h(_.nextSibling),x=b.nextSibling,D=x.nextSibling,[N,M]=h(D.nextSibling);return N.nextSibling,o(l,()=>t.title===null?t.system:`${t.title} (${t.system})`,r,u),o(n,()=>t.slot.day==="SATURDAY"?"Samstag":"Sonntag",m,f),o(n,()=>t.slot.start,b,R),o(n,()=>t.slot.end,N,M),n})(),(()=>{var n=a(Xt),l=n.firstChild,s=l.nextSibling;return o(s,()=>e.players.join(", ")),n})()]}})}function oe(e,t){const n=[],l=[];for(const s of e){const r=t.gameList.find(u=>u.uuid===s.gameUuid);r?.slot.day==="SATURDAY"&&n.push({reservation:s,game:r}),r?.slot.day==="SUNDAY"&&l.push({reservation:s,game:r})}return{SATURDAY:n.toSorted((s,r)=>s.game.slot.start<r.game.slot.start?-1:1),SUNDAY:l.toSorted((s,r)=>s.game.slot.start<r.game.slot.start?-1:1)}}function fn(e,t){const n=Object.groupBy(e,l=>l.game.uuid);return Object.values(n).map(l=>{const s=l?.[0];return l===void 0||s===void 0?null:{game:s.game,players:l.map(r=>r.reservation.friendsName??t)}}).filter(l=>l!==null)}function Sn(e){const t={MORNING:[],AFTERNOON:[],EVENING:[]};return e.forEach(n=>{const l=n.game.slot.start;l<13?t.MORNING.push(n):l<18?t.AFTERNOON.push(n):t.EVENING.push(n)}),t}function B(e){const t=fn(e.entries,e.selfName),{MORNING:n,AFTERNOON:l,EVENING:s}=Sn(t),r=e.entries[0]?.game.slot.day==="SATURDAY";function u(g){return(()=>{var v=a(en);return o(v,()=>g.entries.map(m=>(()=>{var f=a(tn);return o(f,i(hn,{get game(){return m.game},get players(){return m.players},get type(){return e.type}})),f})())),v})()}return[c(()=>c(()=>n.length>0)()?i(u,{entries:n}):null),c(()=>c(()=>n.length>0||l.length>0)()?(()=>{var g=a(ke);return o(g,i(re,{type:"LUNCH",small:!0})),g})():null),c(()=>c(()=>l.length>0)()?i(u,{entries:l}):null),c(()=>c(()=>!!(r&&(l.length>0||s.length>0)))()?(()=>{var g=a(ke);return o(g,i(re,{type:"DINNER",small:!0})),g})():null),c(()=>c(()=>s.length>0)()?i(u,{entries:s}):null)]}function _n(e){const{con:t,del:n}=e.save.games.reduce((u,g)=>e.markedForDeletionReservations.includes(g.id)?{...u,del:[...u.del,g]}:{...u,con:[...u.con,g]},{con:[],del:[]}),l=oe(t.map(u=>({gameUuid:u.game,friendsName:u.spielerName})),e.program),s=oe(n.map(u=>({gameUuid:u.game,friendsName:u.spielerName})),e.program),r=oe(e.tentativeReservations,e.program);return[a(nn),(()=>{var u=a(rn),g=u.firstChild,v=g.firstChild,m=v.nextSibling,f=m.nextSibling,[$,_]=h(f.nextSibling),b=g.nextSibling,R=b.firstChild,x=R.nextSibling,D=x.nextSibling,[N,M]=h(D.nextSibling),I=b.nextSibling,F=I.firstChild,L=F.nextSibling,H=L.nextSibling,[K,ae]=h(H.nextSibling);return o(g,()=>e.save.name,$,_),o(b,()=>e.save.email,N,M),o(I,()=>e.save.handynummer,K,ae),u})(),a(xe),a(an),c(()=>c(()=>e.save.games.length===0&&e.tentativeReservations.length===0)()?a(un):null),c(()=>c(()=>e.tentativeReservations.length>0)()?[a(dn),a(on),c(()=>c(()=>r.SATURDAY.length>0)()?[a(ue),i(B,{get entries(){return r.SATURDAY},get selfName(){return e.save.name},type:"special"})]:null),c(()=>c(()=>r.SUNDAY.length>0)()?[a(de),i(B,{get entries(){return r.SUNDAY},get selfName(){return e.save.name},type:"special"})]:null)]:null),c(()=>c(()=>n.length>0)()?[a(gn),a(cn),c(()=>c(()=>s.SATURDAY.length>0)()?[a(ue),i(B,{get entries(){return s.SATURDAY},get selfName(){return e.save.name},type:"danger"})]:null),c(()=>c(()=>s.SUNDAY.length>0)()?[a(de),i(B,{get entries(){return s.SUNDAY},get selfName(){return e.save.name},type:"danger"})]:null)]:null),c(()=>c(()=>t.length>0)()?[a(mn),c(()=>c(()=>l.SATURDAY.length>0)()?[a(ue),i(B,{get entries(){return l.SATURDAY},get selfName(){return e.save.name},type:"success"})]:null),c(()=>c(()=>l.SUNDAY.length>0)()?[a(de),i(B,{get entries(){return l.SUNDAY},get selfName(){return e.save.name},type:"success"})]:null)]:null),a(xe),a(ln),(()=>{var u=a(sn),g=u.firstChild;return o(g,(()=>{var v=c(()=>!!e.save.wantsEmailUpdates);return()=>v()?a(vn):a($n)})()),u})()]}var bn=d("<ul role=list style=display:flex;flex-wrap:wrap;column-gap:1rem;row-gap:.5rem;><li></li><li></li><li></li><li>"),yn=d("<div style=display:flex;justify-content:space-between;><div></div><div>"),Rn=d("<div style=display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:1rem;><div>Zuletzt gespeichert am <!$><!/></div><div style=display:flex;flex-wrap:wrap;gap:1rem;align-items:center;margin-left:auto;><p><em><small></small></em></p><!$><!/>"),kn=d('<div style="padding-block:2rem 1rem;position:sticky;bottom:0;background-image:linear-gradient(transparent, var(--clr-3) 25%);">'),xn=d("<div style=padding-block:1rem;>"),Nn=d("<h2>Programm Samstag"),En=d("<h2>Programm Sonntag"),Cn=d("<div class=content><h2>Zusammenfassung</h2><small>Hier hast du die komplette Übersicht über alle deine Eingaben. Du kannst bis am <strong>Freitag, 23. August 2024</strong> zurückkommen und deine Kontaktdaten und Reservationen anpassen.</small><!$><!/>");function An(e){return(()=>{var t=a(bn),n=t.firstChild,l=n.nextSibling,s=l.nextSibling,r=s.nextSibling;return o(n,i(G,{label:"Kontaktdaten",get kind(){return e.activeTab==="Contact"?"special":"gray"},onClick:()=>e.changeTab("Contact")})),o(l,i(G,{label:"Programm Samstag",get kind(){return e.activeTab==="Saturday"?"special":"gray"},onClick:()=>e.changeTab("Saturday")})),o(s,i(G,{label:"Program Sonntag",get kind(){return e.activeTab==="Sunday"?"special":"gray"},onClick:()=>e.changeTab("Sunday")})),o(r,i(G,{label:"Zusammenfassung",get kind(){return e.activeTab==="Summary"?"special":"gray"},onClick:()=>e.changeTab("Summary")})),t})()}function Tn(e){function t(){switch(e.activeTab){case"Saturday":e.changeTab("Contact");break;case"Sunday":e.changeTab("Saturday");break;case"Summary":e.changeTab("Sunday");break}}function n(){switch(e.activeTab){case"Contact":e.changeTab("Saturday");break;case"Saturday":e.changeTab("Sunday");break;case"Sunday":e.changeTab("Summary");break}}return(()=>{var l=a(yn),s=l.firstChild,r=s.nextSibling;return o(s,(()=>{var u=c(()=>e.activeTab!=="Contact");return()=>u()?i(G,{label:"<< Vorheriger Schritt",onClick:t}):null})()),o(r,(()=>{var u=c(()=>e.activeTab!=="Summary");return()=>u()?i(G,{label:"Nächster Schritt >>",onClick:n}):null})()),l})()}function wn(e){const t=new Intl.DateTimeFormat("de-CH",{timeStyle:"short",dateStyle:"long"});return i(Ee,{get type(){return e.state==="HAS_CHANGES"?"success":"gray"},get children(){var n=a(Rn),l=n.firstChild,s=l.firstChild,r=s.nextSibling,[u,g]=h(r.nextSibling),v=l.nextSibling,m=v.firstChild,f=m.firstChild,$=f.firstChild,_=m.nextSibling,[b,R]=h(_.nextSibling);return o(l,()=>t.format(new Date(e.lastSaved)),u,g),o($,()=>e.state==="NO_CHANGES"?"keine Änderungen entdeckt":e.state==="HAS_CHANGES"?"ungespeicherte Änderungen entdeckt":""),o(v,i(G,{get disabled(){return e.state!=="HAS_CHANGES"},get label(){return e.state==="NO_CHANGES"?"Gespeichert.":e.state==="SAVING"?"Wird gespeichert...":"Speichern"},get kind(){return e.state==="HAS_CHANGES"?"success":"gray"},get onClick(){return e.saveCurrentState}}),b,R),n}})}function Dn(e){return[i(An,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}}),(()=>{var t=a(xn);return o(t,i(Ee,{get children(){return[c(()=>c(()=>e.activeTab==="Contact")()?i(gt,{get save(){return e.save},get updateSave(){return e.updateSave}}):c(()=>e.activeTab==="Saturday")()?[a(Nn),i(ee,{get fallback(){return i(w,{children:"Programm wird geladen ..."})},get children(){return i(V,{get children(){return i(z,{get when(){return e.programResource()},children:n=>i(Zt,{get selfName(){return e.save.name},get program(){return n()},get wantsEmailUpdates(){return e.save.wantsEmailUpdates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})})}})}})]:c(()=>e.activeTab==="Sunday")()?[a(En),i(ee,{get fallback(){return i(w,{children:"Programm wird geladen ..."})},get children(){return i(V,{get children(){return i(z,{get when(){return e.programResource()},children:n=>i(qt,{get selfName(){return e.save.name},get program(){return n()},get wantsEmailUpdates(){return e.save.wantsEmailUpdates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})})}})}})]:(()=>{var n=a(Cn),l=n.firstChild,s=l.nextSibling,r=s.nextSibling,[u,g]=h(r.nextSibling);return o(n,i(ee,{get fallback(){return i(w,{children:"Zusammenfassung wird geladen ..."})},get children(){return i(V,{get children(){return i(z,{get when(){return e.programResource()},children:v=>i(_n,{get save(){return e.save},get tentativeReservations(){return e.tentativeReservations},get program(){return v()},get markedForDeletionReservations(){return e.markedForDeletionReservations}})})}})}}),u,g),n})()),(()=>{var n=a(kn);return o(n,i(wn,{get lastSaved(){return e.lastSaved},get saveCurrentState(){return e.saveCurrentState},get state(){return e.saveState}})),n})()]}})),t})(),i(Tn,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}})]}function Un(){return typeof window<"u"}function pn(){if(Un()){const e=new URL(location.href),t=e.searchParams.get("secret"),n=e.searchParams.get("showCreateMessage")==="true";return{secret:t,showCreateMessage:n}}return null}async function Ie(e){if(e.secret===null)throw Error("SECRET_ERROR");const t=await ft(e.secret);if(t.kind==="FAILED")throw Error("SECRET_ERROR");return{state:"IDLE",secret:e.secret,showCreateMessage:e.showCreateMessage,currentSave:t.save,activeTab:"Contact",lastSaved:t.save.lastSaved,hasChanged:!1,tentativeReservations:[],markedForDeletionReservations:[]}}async function Fn(e=!1){const t=await bt(e);if(t.kind==="FAILED")throw Error("PROGRAM_ERROR");return t.program}function In(e){const[t,n]=ut(e);function l(v){n("activeTab",v),window.scrollTo({top:0})}function s(v,m){n("hasChanged",!0),n("currentSave",v,m)}async function r(){if(t.state!=="IDLE")throw Error("ASSERTION_ERROR");n("state","SAVING");const v=ne("/rst24/save"),m={...t.currentSave,games:[...t.currentSave.games.filter($=>!t.markedForDeletionReservations.includes($.id)),...t.tentativeReservations.map($=>$.friendsName===null?{game:$.gameUuid,self:!0,spielerName:null}:{game:$.gameUuid,self:!1,spielerName:$.friendsName})]};if((await fetch(v,{method:"post",body:JSON.stringify(m),headers:{"Content-Type":"application/json"}})).ok){const $=await Ie({secret:t.secret,showCreateMessage:!1});n({...$,activeTab:t.activeTab})}else throw Error("SAVE_ERROR")}function u(v){n("hasChanged",!0),n("tentativeReservations",m=>[...m,v])}function g(v){if(n("hasChanged",!0),v.confirmed)n("markedForDeletionReservations",m=>[...m,v.reservationId]);else{const m=t.currentSave.name;n("tentativeReservations",f=>f.filter($=>$.gameUuid!==v.gameUuid?!0:$.friendsName===v.name?!1:v.name!==m))}}return{state:t,actions:{changeTab:l,updateSave:s,saveCurrentState:r,addTentativeReservation:u,deleteReservation:g}}}var ge=d("<br>"),On=d("<strong>Freitag, 23. August 2024"),Pn=d("<p>Deine Anmeldung wird geladen..."),Gn=d("<p>Wir konnten leider keine Anmeldung finden. Wenn du bereits eine Anmeldung begonnen hast, solltest du den korrekten Link per E-Mail erhalten haben.<br><br> Falls du noch keine Anmeldung begonnen hast, kannst du <a href=/anmeldung>hier</a> deine persönliche Anmeldung beginnen. <br><br>Für generelle Fragen oder Probleme, schreibe uns doch bitte über unser <a href=/kontatk>Kontaktformular</a>."),Mn=d("<p>Leider ist ein unerwarteter Fehler passiert. Versuche deine Anmeldung erneut zu laden. Wiederholt sich dieser Fehler, bitte kontaktiere uns sobald als möglich über das <a href=/kontakt>Kontaktformular</a>, da dies nicht passieren sollte.");function Ln(e){const{state:t,actions:n}=In(e.state);return[i(X,{get when(){return t.showCreateMessage},get children(){return[i(w,{type:"success",get children(){return["Deine Anmeldung wurde erfolgreich gestartet.",a(ge),a(ge),"Wir haben eine E-Mail an deine Adresse gesendet. In dieser E-Mail findest du einen persönlichen Link, um deine Anmeldung bis am"," ",a(On)," anzupassen."]}}),a(ge)]}}),i(Dn,{get activeTab(){return t.activeTab},get changeTab(){return n.changeTab},get save(){return t.currentSave},get updateSave(){return n.updateSave},get lastSaved(){return t.lastSaved},get saveCurrentState(){return n.saveCurrentState},get saveState(){return t.state==="SAVING"?"SAVING":t.hasChanged?"HAS_CHANGES":"NO_CHANGES"},get programResource(){return e.programResource},get confirmedReservations(){return t.currentSave.games},get tentativeReservations(){return t.tentativeReservations},get addTentativeReservation(){return n.addTentativeReservation},get deleteReservation(){return n.deleteReservation},get markedForDeletionReservations(){return t.markedForDeletionReservations}})]}function Oe(){return i(w,{get children(){return a(Pn)}})}function jn(){const[e,t]=Ne(null);return rt(()=>{t(pn())}),i(V,{get fallback(){return i(Oe,{})},get children(){return i(z,{get when(){return e()},children:n=>i(Hn,{get params(){return n()}})})}})}function Hn(e){const[t]=ve(()=>Ie(e.params)),[n]=ve(()=>Fn(e.params.secret==="demo"));return i(at,{fallback:l=>i(w,{type:"danger",get children(){return i(V,{get fallback(){return a(Mn)},get children(){return i(z,{get when(){return l.message==="SECRET_ERROR"},get children(){return a(Gn)}})}})}}),get children(){return i(ee,{get fallback(){return i(Oe,{})},get children(){return i(V,{get children(){return i(z,{get when(){return t()},children:l=>i(Ln,{get state(){return l()},programResource:n})})}})}})}})}export{jn as MeineAnmeldungWrapper};
