import{g as m,t as h,e as J,o as Y,d as o,M as k,f as y,h as C,j as z,E as B,S as K,a as H,i as X}from"./web.DiohJL2p.js";import{e as b,B as A,a as T}from"./utils.nA1oNKGa.js";import{e as Z,a as R,o as c,s as n,b as S,n as d,c as q,l as D,u as _,d as F}from"./index.BmTnCDYh.js";import{c as Q}from"./store.CLzkyqdf.js";const v=1,O="SAVE",P="PROGRAM",L={registrationId:-1,name:"Demo",email:"demo@mail.com",handynummer:"+41 12 123 12 12",wantsEmailUpdates:!0,games:[],lastSaved:"2024-08-15T07:45:21.335Z"};function ee(){const t=localStorage.getItem(O);let e;return t===null?e={version:v,data:L}:e=JSON.parse(t),e.version!==v&&(console.error("Your local storage data was outdated and has been replaced with new demo content."),e={version:v,data:L}),localStorage.setItem(O,JSON.stringify(e)),e.data}const I={gameList:[],reservedList:[]};function te(){const t=localStorage.getItem(P);let e;return t===null?e={version:v,data:I}:e=JSON.parse(t),e.version!==v&&(console.error("Your local storage data was outdated and has been replaced with new demo content."),e={version:v,data:I}),localStorage.setItem(P,JSON.stringify(e)),e.data}const N=Z(["SATURDAY","SUNDAY"]);R(c({uuid:n(),description:S(n()),title:S(n()),system:n(),master:c({first:n(),last:S(n())}),playerCount:c({min:d(),max:d()}),slot:c({day:N,start:d(),end:d()})}));const $=c({game:n(),self:D(!0),spielerName:q()}),V=c({game:n(),self:D(!1),spielerName:n()}),re=_([$.extend({id:d()}),V.extend({id:d()})]),ne=_([$,V]),ae=c({registrationId:d(),name:n(),email:n(),handynummer:n(),wantsEmailUpdates:F(),games:R(re),lastSaved:n()});c({registrationId:d(),name:n(),email:n(),handynummer:n(),wantsEmailUpdates:F(),games:R(ne),lastSaved:n()});async function se(t){if(t==="demo")return{kind:"SUCCESS",save:ee()};const e=b("/rst24/load");e.searchParams.append("secret",t);const r=await fetch(e);if(!r.ok)return{kind:"FAILED"};const s=await r.json(),u=ae.safeParse(s);return u.success?{kind:"SUCCESS",save:u.data}:{kind:"FAILED"}}const oe=c({uuid:n(),title:S(n()),system:n(),description:S(n()),playerCount:c({min:d(),max:d()}),master:c({first:n(),last:S(n())}),slot:c({day:N,start:d(),end:d()})}),ie=c({id:d(),gameId:n()});async function le(t){if(t)return{kind:"SUCCESS",program:te()};const e=b("/rst24/program"),r=b("/rst24/reserved"),[s,u]=await Promise.all([fetch(e),fetch(r)]);if(!s.ok)return{kind:"FAILED"};if(!u.ok)return{kind:"FAILED"};const g=await s.json(),E=await u.json(),f=R(oe).safeParse(g);if(!f.success)return{kind:"FAILED"};const w=R(ie).safeParse(E);return w.success?{kind:"SUCCESS",program:{gameList:f.data,reservedList:w.data}}:{kind:"FAILED"}}const ce=["CHOOSE","OVERVIEW"],M={OVERVIEW:"Übersicht",CHOOSE:"Auswahl"};function x(t){const e=t.searchParams.get("page");return ce.find(r=>e?.toUpperCase()===r.toUpperCase())??"OVERVIEW"}function de(){const t=new URL(location.href),e=t.searchParams.get("secret"),r=x(t),s=t.searchParams.get("showCreateMessage")==="true";return{secret:e,page:r,showCreateMessage:s}}async function W(t){if(t.secret===null)throw Error("SECRET_ERROR");const e=await se(t.secret);if(e.kind==="FAILED")throw Error("SECRET_ERROR");return{state:"IDLE",secret:t.secret,page:t.page,showCreateMessage:t.showCreateMessage,currentSave:e.save,activeTab:"Contact",lastSaved:e.save.lastSaved,hasChanged:!1,tentativeReservations:[],markedForDeletionReservations:[]}}async function ue(t=!1){const e=await le(t);if(e.kind==="FAILED")throw Error("PROGRAM_ERROR");return e.program}function me(t){const[e,r]=Q(t);function s(a){r("activeTab",a),window.scrollTo({top:0})}function u(a){const i=new URL(location.href);i.searchParams.set("page",a.toLowerCase()),history.replaceState({page:a},"",i);const p=M[a];document.title=`Meine Anmeldung: ${p} | Luzerner Rollenspieltage `}u(t.page);function g(a,i=!1){if(!i){const l=new URL(location.href);l.searchParams.set("page",a.toLowerCase()),history.pushState({page:a},"",l)}const p=M[a];document.title=`Meine Anmeldung: ${p} | Luzerner Rollenspieltage `,r("page",a),window.scrollTo({top:0})}function E(a,i){r("hasChanged",!0),r("currentSave",a,i)}async function f(){if(e.state!=="IDLE")throw Error("ASSERTION_ERROR");r("state","SAVING");const a=b("/rst24/save"),i={...e.currentSave,games:[...e.currentSave.games.filter(l=>!e.markedForDeletionReservations.includes(l.id)),...e.tentativeReservations.map(l=>l.friendsName===null?{game:l.gameUuid,self:!0,spielerName:null}:{game:l.gameUuid,self:!1,spielerName:l.friendsName})]};if((await fetch(a,{method:"post",body:JSON.stringify(i),headers:{"Content-Type":"application/json"}})).ok){const l=await W({secret:e.secret,page:e.page,showCreateMessage:!1});r({...l,activeTab:e.activeTab})}else throw Error("SAVE_ERROR")}function w(a){r("hasChanged",!0),r("tentativeReservations",i=>[...i,a])}function G(a){if(r("hasChanged",!0),a.confirmed)r("markedForDeletionReservations",i=>[...i,a.reservationId]);else{const i=e.currentSave.name;r("tentativeReservations",p=>p.filter(l=>l.gameUuid!==a.gameUuid?!0:l.friendsName===a.name?!1:a.name!==i))}}return{state:e,actions:{changeTab:s,changePage:g,updateSave:E,saveCurrentState:f,addTentativeReservation:w,deleteReservation:G}}}var U=h("<br>"),ge=h("<strong>Freitag, 23. August 2024");const he=function(){const e="Freitag, 23. August 2024",r=["Deine Anmeldung wurde erfolgreich gestartet.",m(U),m(U),"Wir haben eine E-Mail an deine Adresse gesendet. In dieser E-Mail findest du einen persönlichen Link, um deine Anmeldung bis am"," ",m(ge)," anzupassen."];return{registrationDeadline:e,registrationStarted:r}}();var fe=h("<br>"),pe=h("<h1>Current Page: <!$><!/>"),Se=h("<p>Deine Anmeldung wird geladen..."),ve=h("<p>Wir konnten leider keine Anmeldung finden. Wenn du bereits eine Anmeldung begonnen hast, solltest du den korrekten Link per E-Mail erhalten haben.<br><br> Falls du noch keine Anmeldung begonnen hast, kannst du <a href=/anmeldung>hier</a> deine persönliche Anmeldung beginnen. <br><br>Für generelle Fragen oder Probleme, schreibe uns doch bitte über unser <a href=/kontatk>Kontaktformular</a>."),Ee=h("<p>Leider ist ein unerwarteter Fehler passiert. Versuche deine Anmeldung erneut zu laden. Wiederholt sich dieser Fehler, bitte kontaktiere uns sobald als möglich über das <a href=/kontakt>Kontaktformular</a>, da dies nicht passieren sollte.");function Re(t){const{state:e,actions:r}=me(t.state);return window.addEventListener("popstate",s=>{if(typeof s=="object"&&s!==null&&"state"in s){const u=new URL(location.href),g=x(u);r.changePage(g,!0)}}),[o(K,{get when(){return e.showCreateMessage},get children(){return[o(A,{type:"success",get children(){return he.registrationStarted}}),m(fe)]}}),(()=>{var s=m(pe),u=s.firstChild,g=u.nextSibling,[E,f]=H(g.nextSibling);return X(s,()=>e.page,E,f),s})(),o(T,{label:"Go To Overview",onClick:()=>r.changePage("OVERVIEW")}),o(T,{label:"Go To Choose",onClick:()=>r.changePage("CHOOSE")})]}function j(){return o(A,{get children(){return m(Se)}})}function Ce(){const[t,e]=J(null);return Y(()=>{e(de())}),o(y,{get fallback(){return o(j,{})},get children(){return o(k,{get when(){return t()},children:r=>o(we,{get params(){return r()}})})}})}function we(t){const[e]=C(()=>W(t.params)),[r]=C(()=>ue(t.params.secret==="demo"));return o(B,{fallback:s=>o(A,{type:"danger",get children(){return o(y,{get fallback(){return m(Ee)},get children(){return o(k,{get when(){return s.message==="SECRET_ERROR"},get children(){return m(ve)}})}})}}),get children(){return o(z,{get fallback(){return o(j,{})},get children(){return o(y,{get children(){return o(k,{get when(){return e()},children:s=>o(Re,{get state(){return s()},programResource:r})})}})}})}})}export{Ce as MeineAnmeldungWrapper};
